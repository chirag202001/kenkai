<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
  <meta name="cache-version" content="v2.0.20250630-021" />
  <title>Embrion IVF Platform Prototype - v2.0.20250630-021</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --primary:#0052cc;
      --accent:#ff8c00;
      --bg:#ffffff;
      --surface:#f4f6f8;
      --text:#333333;
      --muted:#777777;
      --radius:8px;
      --gap:16px;
      --shadow:0 2px 8px rgba(0,0,0,0.1);
    }
    *{box-sizing:border-box;}
    body{margin:0;font-family:'Inter',sans-serif;background:var(--surface);color:var(--text);}
    header{display:flex;align-items:center;justify-content:space-between;background:var(--bg);padding:12px var(--gap);box-shadow:0 2px 4px rgba(0,0,0,0.1);position:sticky;top:0;z-index:100;min-height:50px;}
    .header-right{display:flex;align-items:center;gap:15px;}
    .logout-btn{background:var(--primary);color:#fff;border:none;padding:8px 16px;border-radius:var(--radius);cursor:pointer;font-size:13px;font-weight:500;transition:background 0.3s ease;height:36px;}
    .logout-btn:hover{background:#003d99;}
    .icon{font-size:1.2rem;cursor:pointer;color:var(--muted);position:relative;display:inline-block;}
    .notification-icon{position:relative;display:inline-block;}
    .notification-badge{background:var(--accent);color:#fff;font-size:10px;font-weight:600;padding:2px 6px;border-radius:10px;position:absolute;top:-8px;right:-8px;min-width:16px;text-align:center;}
    
    /* Debug styles to ensure header visibility */
    header * {
      visibility: visible !important;
      opacity: 1 !important;
    }
    
    .header-right {
      background: rgba(0, 0, 0, 0.05);
      border-radius: 4px;
      padding: 8px;
    }
    
    .notification-icon {
      background: rgba(255, 140, 0, 0.1);
      border-radius: 4px;
      padding: 4px;
    }
    
    .logout-btn {
      visibility: visible !important;
      opacity: 1 !important;
    }
    
    /* End debug styles */
    
    h1{margin:0;font-size:1.25rem;font-weight:600;}
    .container{padding:8px var(--gap) 0 var(--gap);max-width:1200px;margin:0 auto;min-height:auto;}
    .screen{display:none;}
    .screen.active{display:block !important;}
    .active{display:block;}
    
    /* Ensure login screen is visible by default */
    #login.screen.active {
      display: block !important;
      visibility: visible !important;
      opacity: 1 !important;
    }
    .btn{background:var(--primary);color:#fff;border:none;padding:10px 20px;border-radius:var(--radius);cursor:pointer;font-weight:600;box-shadow:var(--shadow);}
    .btn-secondary{background:#e0e0e0;color:var(--text);}
    .grid{display:grid;gap:var(--gap);}
    .grid-2{grid-template-columns:repeat(auto-fit,minmax(240px,1fr));}
    .grid-3{grid-template-columns:repeat(auto-fit,minmax(200px,1fr));}
    .card{background:var(--bg);padding:var(--gap);border-radius:var(--radius);box-shadow:var(--shadow);position:relative;}
    .badge{background:var(--accent);color:#fff;padding:4px 8px;font-size:12px;border-radius:12px;position:absolute;top:var(--gap);right:var(--gap);}
    nav.footer{display:flex;justify-content:space-around;padding:8px 0;position:fixed;bottom:0;width:100%;background:var(--bg);box-shadow:0 -2px 4px rgba(0,0,0,0.1);}
    .footer-item{display:flex;flex-direction:column;align-items:center;font-size:12px;color:var(--muted);cursor:pointer;}
    .footer-item.active{color:var(--primary);}
    .tabs{display:flex;gap:var(--gap);border-bottom:1px solid #ddd;margin-bottom:var(--gap);}
    .tab{padding:8px 16px;cursor:pointer;color:var(--muted);border-radius:var(--radius) var(--radius) 0 0;}
    .tab.active{background:var(--bg);color:var(--text);box-shadow:0 -2px 0 var(--primary) inset;}
    input,select,textarea{width:100%;padding:8px;margin:8px 0;border:1px solid #ddd;border-radius:var(--radius);}
    table{width:100%;border-collapse:collapse;margin:16px 0;}
    th,td{padding:12px;border-bottom:1px solid #eee;text-align:left;}
    th{background:#f9f9f9;font-weight:600;}
    .modal-backdrop{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.6);z-index:150;display:none;}
    .modal{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:var(--bg);padding:24px;border-radius:var(--radius);box-shadow:var(--shadow);width:90%;max-width:500px;max-height:90vh;overflow-y:auto;z-index:200;display:none;}
    .modal h3{margin-top:0;}
    .modal footer{display:flex;justify-content:flex-end;gap:8px;margin-top:16px;}
    
    /* Ensure modals stay within viewport */
    @media (max-height: 700px) {
      .modal{max-height:95vh;top:2.5vh;transform:translateX(-50%);}
    }
    
    @media (max-width: 600px) {
      .modal{width:95%;max-width:none;margin:10px;}
    }

    /* Admin Service Modal Specific Styles */
    #addServiceModal, #editServiceModal {
      max-height: 85vh;
      overflow-y: auto;
    }

    #addServiceModal form, #editServiceModal form {
      max-height: calc(85vh - 120px);
      overflow-y: auto;
    }
    .toggle-switch{position:relative;display:inline-block;width:44px;height:24px;}
    .toggle-switch input{opacity:0;width:0;height:0;}
    .slider{position:absolute;cursor:pointer;top:0;left:0;right:0;bottom:0;background-color:#ccc;transition:.4s;border-radius:24px;}
    .slider:before{position:absolute;content:"";height:18px;width:18px;left:3px;bottom:3px;background-color:white;transition:.4s;border-radius:50%;}
    input:checked + .slider{background-color:var(--primary);}
    input:focus + .slider{box-shadow:0 0 1px var(--primary);}
    input:checked + .slider:before{transform:translateX(20px);}
    .payment-card{transition:all 0.2s ease;border:2px solid transparent;}
    .payment-card:hover{box-shadow:0 4px 12px rgba(0,0,0,0.15);transform:translateY(-1px);}
    .payment-card:focus{border-color:var(--primary);outline:none;}
    .strength-indicator{font-size:12px;margin-top:4px;}
    .strength-weak{color:#dc3545;}
    .strength-medium{color:#ffc107;}
    .strength-strong{color:#28a745;}
    
    /* Enhanced Search Tab Styles */
    .search-section{background:var(--bg);padding:24px;border-radius:var(--radius);box-shadow:var(--shadow);margin-bottom:20px;}
    .section-header{text-align:center;margin-bottom:20px;}
    .section-title{font-size:24px;font-weight:700;margin:0 0 8px 0;color:var(--text);}
    .section-subtitle{font-size:16px;color:var(--muted);margin:0;}
    .search-input-container{display:flex;gap:12px;max-width:600px;margin:0 auto;}
    .search-input{flex:1;padding:14px 20px;font-size:16px;border:2px solid #e1e5e9;border-radius:50px;transition:border-color 0.3s ease;}
    .search-input:focus{border-color:var(--primary);outline:none;}
    .search-btn{background:var(--primary);color:#fff;border:none;padding:14px 24px;border-radius:50px;font-weight:600;cursor:pointer;transition:background 0.3s ease;}
    .search-btn:hover{background:var(--accent);}
    
    .search-container{display:flex;gap:20px;margin-bottom:16px;}
    .filters-panel{background:var(--bg);padding:16px;border-radius:var(--radius);box-shadow:var(--shadow);width:260px;flex-shrink:0;height:fit-content;position:sticky;top:20px;}
    .results-area{flex:1;min-width:0;}
    .comparison-panel{background:var(--bg);padding:16px;border-radius:var(--radius);box-shadow:var(--shadow);width:260px;flex-shrink:0;position:sticky;top:20px;height:fit-content;}
    
    /* Filters Panel Styles */
    .filters-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;padding-bottom:12px;border-bottom:2px solid #f0f2f5;}
    .filters-title{font-size:18px;font-weight:600;margin:0;color:var(--text);}
    .clear-all-btn{background:none;border:none;color:var(--primary);font-size:13px;font-weight:500;cursor:pointer;padding:4px 8px;border-radius:4px;transition:background 0.2s;}
    .clear-all-btn:hover{background:#f0f2f5;}
    
    .filter-section{margin-bottom:24px;padding-bottom:16px;border-bottom:1px solid #f0f2f5;}
    .filter-section:last-child{border-bottom:none;margin-bottom:0;}
    .filter-section-title{font-size:14px;font-weight:600;margin:0 0 12px 0;color:var(--text);display:flex;align-items:center;gap:6px;}
    .filter-group{margin-bottom:16px;}
    .filter-label{display:block;font-weight:500;margin-bottom:8px;font-size:13px;color:var(--text);}
    .range-value{color:var(--primary);font-weight:600;}
    .location-input{width:100%;padding:10px 12px;border:1px solid #e1e5e9;border-radius:6px;font-size:14px;}
    .date-input{width:100%;padding:10px 12px;border:1px solid #e1e5e9;border-radius:6px;font-size:14px;}
    
    .star-rating-filter{display:flex;gap:6px;flex-wrap:wrap;}
    .filter-actions{margin-top:20px;}
    .apply-filters-btn{width:100%;padding:12px;font-size:14px;font-weight:600;border-radius:6px;}
    
    /* Results Section Styles */
    .results-section{background:var(--bg);border-radius:var(--radius);box-shadow:var(--shadow);padding:0;overflow:hidden;}
    .results-header{display:flex;justify-content:space-between;align-items:center;padding:20px 24px;background:#f8f9fa;border-bottom:1px solid #e1e5e9;}
    .results-title{font-size:18px;font-weight:600;margin:0 0 4px 0;color:var(--text);}
    .results-count{font-size:14px;color:var(--muted);}
    .results-controls{display:flex;align-items:center;gap:12px;}
    .sort-select{padding:8px 12px;border:1px solid #e1e5e9;border-radius:6px;font-size:14px;background:#fff;}
    .compare-toggle-btn{background:var(--accent);color:#fff;border:none;padding:8px 16px;border-radius:6px;font-size:14px;font-weight:500;cursor:pointer;display:flex;align-items:center;gap:6px;transition:background 0.3s;}
    .compare-toggle-btn:hover{background:#e6790d;}
    .compare-toggle-btn:disabled{background:#e1e5e9;color:#999;cursor:not-allowed;}
    .compare-icon{font-size:16px;}
    
    .results-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(380px,1fr));gap:20px;padding:24px;}
    
    /* Comparison Panel Styles */
    .comparison-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;padding-bottom:12px;border-bottom:2px solid #f0f2f5;}
    .comparison-title-section{flex:1;}
    .comparison-title{font-size:16px;font-weight:600;margin:0 0 4px 0;color:var(--text);}
    .comparison-count{font-size:13px;color:var(--muted);}
    .close-comparison-btn{background:none;border:none;color:var(--muted);font-size:18px;cursor:pointer;padding:4px;border-radius:4px;transition:all 0.2s;}
    .close-comparison-btn:hover{background:#f0f2f5;color:var(--text);}
    
    .comparison-content{display:flex;flex-direction:column;height:100%;}
    .comparison-list{flex:1;margin-bottom:16px;}
    .comparison-actions{display:flex;flex-direction:column;gap:8px;}
    .comparison-action-btn{width:100%;padding:10px;font-size:13px;font-weight:500;border-radius:6px;display:flex;align-items:center;justify-content:center;gap:6px;}
    
    .filter-group{margin-bottom:12px;}
    .filter-label{display:block;font-weight:600;margin-bottom:6px;font-size:13px;}
    .location-input{position:relative;}
    .location-input::before{content:'üìç';position:absolute;left:8px;top:50%;transform:translateY(-50%);z-index:1;}
    .location-input input{padding-left:32px;}
    .distance-slider{position:relative;margin:8px 0;}
    .distance-slider input[type="range"]{width:100%;-webkit-appearance:none;appearance:none;height:4px;background:linear-gradient(to right, var(--primary) 0%, var(--primary) 50%, #ddd 50%, #ddd 100%);border-radius:2px;outline:none;}
    .distance-slider input[type="range"]::-webkit-slider-thumb{-webkit-appearance:none;appearance:none;width:20px;height:20px;background:var(--primary);border-radius:50%;cursor:pointer;}
    .distance-slider input[type="range"]::-moz-range-thumb{width:20px;height:20px;background:var(--primary);border-radius:50%;border:none;cursor:pointer;}
    .distance-badge{position:absolute;top:-8px;right:0;background:var(--accent);color:#fff;padding:2px 8px;border-radius:12px;font-size:12px;font-weight:600;}
    .price-range{display:flex;align-items:center;gap:8px;}
    .star-rating{display:flex;gap:4px;margin:8px 0;}
    .star-rating input{display:none;}
    .star-rating label{cursor:pointer;font-size:20px;color:#ddd;transition:color 0.2s ease;}
    .star-rating label:hover{color:#ffc107;}
    .star-rating input:checked ~ label{color:#ffd700;}
    .star-rating label.active{color:#ffd700;}
    .services-chips{display:flex;flex-wrap:wrap;gap:8px;margin:8px 0;}
    .service-chip{display:inline-flex;align-items:center;padding:6px 12px;background:#f0f0f0;border:1px solid #ddd;border-radius:20px;font-size:12px;cursor:pointer;transition:all 0.2s ease;}
    .service-chip.active{background:var(--primary);color:#fff;border-color:var(--primary);}
    .service-chip input{display:none;}
    .date-input{position:relative;}
    .date-input::after{content:'üìÖ';position:absolute;right:8px;top:50%;transform:translateY(-50%);pointer-events:none;}
    .filter-buttons{display:flex;gap:8px;margin-top:20px;}
    .filter-buttons .btn{flex:1;padding:12px;font-weight:600;text-align:center;}
    .collapsible-section{margin:16px 0;}
    .collapsible-header{display:flex;justify-content:space-between;align-items:center;cursor:pointer;padding:8px 0;border-bottom:1px solid #eee;}
    .collapsible-content{padding:12px 0;display:none;}
    .collapsible-content.open{display:block;}
    .appointment-header{display:flex;align-items:center;gap:16px;margin-bottom:24px;padding-bottom:12px;border-bottom:1px solid #eee;}
    .date-carousel{display:flex;align-items:center;gap:12px;margin:16px 0;}
    .date-nav{background:none;border:none;font-size:18px;cursor:pointer;padding:8px;}
    .date-option{padding:12px 16px;border:1px solid #ddd;border-radius:var(--radius);cursor:pointer;text-align:center;min-width:80px;}
    .date-option.active{background:var(--primary);color:#fff;border-color:var(--primary);}
    .time-slots{display:grid;grid-template-columns:repeat(auto-fill,minmax(80px,1fr));gap:8px;margin:16px 0;}
    .time-slot{padding:8px 12px;border:1px solid #ddd;border-radius:var(--radius);text-align:center;cursor:pointer;font-size:14px;}
    .time-slot:hover{background:#f0f0f0;}
    .time-slot.selected{background:var(--primary);color:#fff;border-color:var(--primary);}
    .time-slot:disabled{background:#f5f5f5;color:#ccc;cursor:not-allowed;}
    .emergency-toggle{display:flex;align-items:center;gap:8px;margin:16px 0;padding:12px;border:1px solid #ddd;border-radius:var(--radius);}
    .emergency-toggle.active{border-color:#dc3545;background:#fff5f5;}
    .booking-summary{background:#f9f9f9;padding:16px;border-radius:var(--radius);margin:16px 0;}
    .payment-selector{margin:16px 0;}
    .terms-checkbox{display:flex;align-items:center;gap:8px;margin:16px 0;padding:12px;background:#f9f9f9;border-radius:var(--radius);}
    .booking-actions{display:flex;gap:12px;justify-content:flex-end;margin-top:24px;}
    .results-header{display:flex;justify-content:space-between;align-items:center;padding:20px 24px;background:#f8f9fa;border-bottom:1px solid #e1e5e9;}
    .results-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(380px,1fr));gap:20px;padding:24px;}
    
    /* Loading State Styles */
    .loading-state{grid-column:1/-1;display:flex;justify-content:center;align-items:center;min-height:200px;}
    .loading-content{text-align:center;}
    .loading-spinner{width:40px;height:40px;border:3px solid #f0f2f5;border-top:3px solid var(--primary);border-radius:50%;animation:spin 1s linear infinite;margin:0 auto 16px;}
    .loading-text{color:var(--muted);margin:0;}
    @keyframes spin{0%{transform:rotate(0deg);}100%{transform:rotate(360deg);}}
    
    /* Empty State Styles */
    .empty-state{grid-column:1/-1;display:flex;justify-content:center;align-items:center;min-height:300px;}
    .empty-state-content{text-align:center;max-width:400px;}
    .empty-state-icon{font-size:48px;margin-bottom:16px;}
    .empty-state-title{font-size:20px;font-weight:600;margin:0 0 8px 0;color:var(--text);}
    .empty-state-text{color:var(--muted);margin:0 0 20px 0;line-height:1.5;}
    
    .service-card{background:var(--bg);border-radius:var(--radius);box-shadow:0 2px 8px rgba(0,0,0,0.08);padding:20px;transition:all 0.3s ease;border:1px solid #f0f2f5;}
    .service-card:hover{box-shadow:0 8px 25px rgba(0,0,0,0.15);transform:translateY(-2px);border-color:#e1e5e9;}
    .card-header{display:flex;align-items:center;gap:12px;margin-bottom:12px;}
    .lab-logo{width:60px;height:60px;border-radius:50%;background:#f0f0f0;display:flex;align-items:center;justify-content:center;font-size:24px;}
    .lab-info{flex:1;}
    .lab-name{font-weight:600;font-size:16px;margin-bottom:4px;}
    .lab-rating{display:flex;align-items:center;gap:4px;font-size:14px;}
    .favorite-btn{background:none;border:none;cursor:pointer;font-size:20px;color:#ddd;}
    .favorite-btn.active{color:#ff4757;}
    .service-info{margin-bottom:12px;}
    .service-name{font-weight:600;color:var(--primary);}
    .service-price{font-size:18px;font-weight:600;color:var(--accent);margin:4px 0;}
    .service-details{display:flex;gap:16px;margin:8px 0;font-size:14px;color:var(--muted);}
    .card-actions{display:flex;gap:8px;align-items:center;}
    .compare-checkbox{margin-left:auto;}
    .comparison-item{display:flex;justify-content:space-between;align-items:center;padding:12px;background:#f8f9fa;border:1px solid #e1e5e9;border-radius:6px;margin-bottom:8px;font-size:13px;}
    .comparison-item:hover{background:#f0f2f5;}
    .dual-range{position:relative;margin:6px 0;}
    .dual-range input[type="range"]{position:absolute;pointer-events:none;-webkit-appearance:none;appearance:none;width:100%;height:4px;background:transparent;}
    .dual-range input[type="range"]::-webkit-slider-thumb{-webkit-appearance:none;appearance:none;height:14px;width:14px;border-radius:50%;background:var(--primary);cursor:pointer;pointer-events:all;}
    .dual-range-track{height:4px;background:#ddd;border-radius:2px;position:relative;}
    .dual-range-fill{height:4px;background:var(--primary);border-radius:2px;position:absolute;}
    .service-chips{display:flex;flex-wrap:wrap;gap:6px;margin-top:6px;}
    .service-chip{padding:4px 8px;background:#f0f0f0;border:1px solid #ddd;border-radius:12px;font-size:11px;cursor:pointer;transition:all 0.2s;}
    .service-chip.active{background:var(--primary);color:#fff;border-color:var(--primary);}
    .collapsible{margin-bottom:16px;}
    .collapsible-header{display:flex;justify-content:space-between;align-items:center;padding:8px 0;cursor:pointer;font-weight:600;}
    .collapsible-content{display:none;padding:8px 0;}
    .collapsible.active .collapsible-content{display:block;}
    .date-carousel{display:flex;align-items:center;gap:12px;margin:16px 0;}
    .date-nav{background:none;border:1px solid #ddd;border-radius:50%;width:32px;height:32px;cursor:pointer;display:flex;align-items:center;justify-content:center;}
    .date-item{padding:8px 16px;border:1px solid #ddd;border-radius:8px;cursor:pointer;text-align:center;min-width:60px;}
    .date-item.active{background:var(--primary);color:#fff;border-color:var(--primary);}
    .date-item.disabled{background:#f5f5f5;color:#999;cursor:not-allowed;border-color:#eee;}
    .time-slots{display:grid;grid-template-columns:repeat(auto-fill,minmax(80px,1fr));gap:8px;margin:16px 0;}
    .time-slot{padding:8px;border:1px solid #ddd;border-radius:4px;text-align:center;cursor:pointer;font-size:14px;}
    .time-slot.active{background:var(--primary);color:#fff;border-color:var(--primary);}
    .time-slot.disabled{background:#f5f5f5;color:#999;cursor:not-allowed;}
    .emergency-toggle{display:flex;align-items:center;gap:8px;margin:16px 0;padding:12px;background:#fff3cd;border:1px solid #ffeaa7;border-radius:8px;}
    .booking-summary{background:#f8f9fa;padding:16px;border-radius:8px;margin:16px 0;}
    .payment-selector{position:relative;margin:16px 0;}
    .payment-dropdown{width:100%;padding:10px;border:1px solid #ddd;border-radius:8px;background:#fff;cursor:pointer;}
    .star-filter{cursor:pointer;padding:3px 6px;border-radius:4px;transition:background 0.2s;font-size:12px;}
    .star-filter:hover{background:#f0f0f0;}
    .star-filter.active{background:var(--primary);color:#fff;}
    
    /* My Bookings Tab Styles */
    .bookings-header{text-align:center;margin-bottom:24px;padding:20px;background:var(--bg);border-radius:var(--radius);box-shadow:var(--shadow);}
    .bookings-title{font-size:24px;font-weight:700;margin:0 0 8px 0;color:var(--text);}
    .bookings-subtitle{font-size:16px;color:var(--muted);margin:0;}
    
    .bookings-nav{display:flex;gap:8px;margin-bottom:24px;background:var(--bg);padding:8px;border-radius:var(--radius);box-shadow:var(--shadow);}
    .booking-nav-tab{flex:1;display:flex;flex-direction:column;align-items:center;gap:4px;padding:12px 16px;border:none;background:transparent;cursor:pointer;border-radius:6px;transition:all 0.3s ease;position:relative;}
    .booking-nav-tab:hover{background:#f8f9fa;}
    .booking-nav-tab.active{background:var(--primary);color:#fff;}
    .nav-icon{font-size:20px;}
    .nav-text{font-size:14px;font-weight:600;}
    .nav-count{background:var(--accent);color:#fff;padding:2px 8px;border-radius:12px;font-size:11px;font-weight:600;position:absolute;top:8px;right:8px;}
    .booking-nav-tab.active .nav-count{background:#fff;color:var(--primary);}
    
    .booking-content{display:none;}
    .booking-content.active{display:block;}
    .bookings-list{display:flex;flex-direction:column;gap:16px;margin-bottom:24px;}
    
    .booking-card{background:var(--bg);border-radius:var(--radius);box-shadow:0 2px 8px rgba(0,0,0,0.08);padding:20px;border:1px solid #f0f2f5;transition:all 0.3s ease;}
    .booking-card:hover{box-shadow:0 8px 25px rgba(0,0,0,0.15);transform:translateY(-2px);border-color:#e1e5e9;}
    .booking-card.past{opacity:0.9;}
    
    .booking-header{display:flex;align-items:center;gap:12px;margin-bottom:16px;}
    .booking-index{font-size:18px;font-weight:700;color:var(--primary);min-width:24px;}
    .booking-lab-service{flex:1;display:flex;align-items:center;gap:8px;flex-wrap:wrap;}
    .lab-name{font-size:16px;font-weight:600;color:var(--text);}
    .service-separator{color:var(--muted);font-weight:400;}
    .service-code{font-size:14px;font-weight:500;color:var(--primary);background:#f0f8ff;padding:2px 8px;border-radius:4px;}
    
    .status-badge{padding:4px 12px;border-radius:20px;font-size:11px;font-weight:600;text-transform:uppercase;letter-spacing:0.5px;}
    .status-badge.confirmed{background:#d4edda;color:#155724;border:1px solid #c3e6cb;}
    .status-badge.pending{background:#fff3cd;color:#856404;border:1px solid #ffeaa7;}
    .status-badge.cancelled{background:#f8d7da;color:#721c24;border:1px solid #f5c6cb;}
    .status-badge.completed{background:#d1ecf1;color:#0c5460;border:1px solid #bee5eb;}
    .status-badge.no-show{background:#f8d7da;color:#721c24;border:1px solid #f5c6cb;}
    .status-badge.expired{background:#e2e3e5;color:#383d41;border:1px solid #d6d8db;}
    
    .booking-details{margin-bottom:16px;}
    .booking-datetime{display:flex;align-items:center;gap:16px;margin-bottom:8px;flex-wrap:wrap;}
    .booking-date,.booking-time{display:flex;align-items:center;gap:6px;font-size:14px;color:var(--text);}
    .booking-meta{display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:8px;}
    .service-name{font-size:14px;color:var(--muted);}
    .booking-price{font-size:16px;font-weight:600;color:var(--accent);}
    
    .booking-actions{display:flex;gap:8px;flex-wrap:wrap;}
    .booking-action-btn{display:flex;align-items:center;gap:6px;padding:8px 16px;font-size:13px;font-weight:500;border-radius:6px;transition:all 0.3s ease;flex:1;min-width:100px;justify-content:center;}
    .booking-action-btn.primary{background:var(--primary);color:#fff;border:none;}
    .booking-action-btn.primary:hover{background:#003d99;}
    .booking-action-btn.disabled{opacity:0.5;cursor:not-allowed;}
    .action-icon{font-size:14px;}
    
    .load-more-container{text-align:center;margin:24px 0;}
    .load-more-btn{display:inline-flex;align-items:center;gap:8px;padding:12px 24px;font-size:14px;font-weight:500;border-radius:6px;}
    .load-icon{font-size:16px;}
    
    .booking-empty{text-align:center;padding:60px 20px;background:var(--bg);border-radius:var(--radius);box-shadow:var(--shadow);}
    .booking-empty .empty-icon{font-size:48px;margin-bottom:16px;}
    .booking-empty .empty-title{font-size:20px;font-weight:600;margin:0 0 8px 0;color:var(--text);}
    .booking-empty .empty-text{color:var(--muted);margin:0 0 20px 0;line-height:1.5;}
    
    /* Feedback Modal Styles */
    .star-rating-btn{cursor:pointer;transition:all 0.3s ease;opacity:0.3;}
    .star-rating-btn:hover{transform:scale(1.2);opacity:1;}
    
    @media (max-width: 768px){
      .search-container{flex-direction:column;}
      .filters-panel,.comparison-panel{width:100%;flex-shrink:unset;position:static;}
      .results-grid{grid-template-columns:1fr;padding:16px;}
      .comparison-panel{position:fixed;bottom:0;left:0;right:0;transform:translateY(100%);transition:transform 0.3s ease;width:100%;z-index:200;}
      .comparison-panel.active{transform:translateY(0);}
      .search-input-container{flex-direction:column;}
      .search-input,.search-btn{width:100%;}
      .results-controls{flex-direction:column;gap:8px;align-items:stretch;}
      .sort-select,.compare-toggle-btn{width:100%;}
      .filter-section-title{font-size:13px;}
      .section-title{font-size:20px;}
      .search-section{padding:16px;}
      .booking-actions{flex-direction:column;}
      .booking-action-btn{flex:none;}
      .booking-datetime{flex-direction:column;align-items:flex-start;gap:8px;}
      .booking-lab-service{flex-direction:column;align-items:flex-start;gap:4px;}
    }
    
    /* Doctor Dashboard Styles */
    .doctor-content{background:var(--bg);border-radius:var(--radius);box-shadow:var(--shadow);padding:24px;}
    .doctorTab{display:none;}
    .doctorTab.active{display:block;}
    
    /* Patient Selection Card */
    .patient-selection-card,.service-selection-card,.lab-selection-card,.booking-summary-card{
      background:var(--bg);border-radius:var(--radius);box-shadow:var(--shadow);padding:20px;margin-bottom:20px;
    }
    
    .patient-search-container{display:flex;gap:12px;margin-bottom:16px;align-items:center;}
    .patient-search-input{flex:1;padding:12px;border:2px solid #e1e5e9;border-radius:var(--radius);font-size:14px;}
    .patient-search-input:focus{border-color:var(--primary);outline:none;}
    
    .selected-patient-info{margin-top:16px;}
    .patient-card{display:flex;align-items:center;gap:16px;padding:16px;background:#f8f9fa;border-radius:var(--radius);border:2px solid #e9ecef;}
    .patient-avatar{width:50px;height:50px;background:var(--primary);color:#fff;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:20px;}
    .patient-details{flex:1;}
    .patient-details h4{margin:0 0 4px 0;font-size:16px;font-weight:600;color:var(--text);}
    .patient-details p{margin:2px 0;font-size:14px;color:var(--muted);}
    
    /* Service Categories */
    .service-categories{display:flex;gap:8px;margin-bottom:20px;flex-wrap:wrap;}
    .service-category{display:flex;align-items:center;gap:8px;padding:10px 16px;border:2px solid #e9ecef;border-radius:var(--radius);cursor:pointer;transition:all 0.3s ease;font-size:14px;font-weight:500;}
    .service-category:hover{border-color:var(--primary);background:#f0f8ff;}
    .service-category.active{border-color:var(--primary);background:var(--primary);color:#fff;}
    .category-icon{font-size:16px;}
    
    /* Services Grid */
    .services-grid,.labs-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:16px;}
    .service-item,.lab-item{padding:16px;border:2px solid #e9ecef;border-radius:var(--radius);cursor:pointer;transition:all 0.3s ease;}
    .service-item:hover,.lab-item:hover{border-color:var(--primary);box-shadow:0 4px 12px rgba(0,0,0,0.1);transform:translateY(-2px);}
    .service-item.selected,.lab-item.selected{border-color:var(--primary);background:#f0f8ff;}
    .service-item h4,.lab-item h4{margin:0 0 8px 0;font-size:16px;font-weight:600;color:var(--text);}
    .service-item p{margin:0 0 12px 0;font-size:14px;color:var(--muted);}
    .service-price,.lab-price{font-size:16px;font-weight:600;color:var(--accent);}
    
    .lab-info{flex:1;}
    .lab-rating{font-size:13px;color:var(--muted);margin-top:4px;}
    .lab-item{display:flex;align-items:center;justify-content:space-between;}
    
    /* Booking Summary */
    .summary-details{margin-bottom:16px;}
    .summary-row{display:flex;justify-content:space-between;align-items:center;padding:8px 0;border-bottom:1px solid #f0f2f5;}
    .summary-row:last-child{border-bottom:none;}
    .summary-row.total{font-weight:600;font-size:16px;margin-top:8px;padding-top:12px;border-top:2px solid #e9ecef;}
    .summary-input{padding:6px 8px;border:1px solid #e1e5e9;border-radius:4px;font-size:14px;min-width:120px;}
    
    /* Patients Tab Styles */
    .patients-header,.bookings-header,.invoices-header,.support-header{
      display:flex;justify-content:space-between;align-items:center;margin-bottom:24px;flex-wrap:wrap;gap:16px;
    }
    .patients-actions,.bookings-filter,.invoices-actions{display:flex;gap:12px;align-items:center;flex-wrap:wrap;}
    
    .patients-grid{display:grid;gap:16px;}
    .patient-card-detailed{background:var(--bg);border-radius:var(--radius);box-shadow:var(--shadow);padding:20px;border:1px solid #f0f2f5;}
    .patient-header{display:flex;align-items:center;gap:16px;margin-bottom:16px;}
    .patient-info{flex:1;}
    .patient-info h4{margin:0 0 4px 0;font-size:16px;font-weight:600;}
    .patient-info p{margin:2px 0;font-size:14px;color:var(--muted);}
    .patient-actions{display:flex;gap:8px;}
    .btn-icon{background:none;border:none;padding:8px;border-radius:var(--radius);cursor:pointer;transition:background 0.3s ease;font-size:16px;}
    .btn-icon:hover{background:#f0f2f5;}
    
    .patient-stats{display:flex;gap:24px;flex-wrap:wrap;}
    .stat-item{display:flex;flex-direction:column;gap:4px;}
    .stat-label{font-size:12px;color:var(--muted);text-transform:uppercase;font-weight:500;}
    .stat-value{font-size:14px;font-weight:600;color:var(--text);}
    .stat-value.status-active{color:#28a745;}
    
    /* Doctor Bookings Styles */
    .doctor-bookings-list{display:flex;flex-direction:column;gap:16px;}
    .doctor-booking-card{background:var(--bg);border-radius:var(--radius);box-shadow:var(--shadow);padding:20px;border:1px solid #f0f2f5;display:flex;justify-content:space-between;align-items:center;gap:20px;}
    .booking-info{display:flex;gap:16px;flex:1;}
    .booking-patient{display:flex;align-items:center;gap:12px;min-width:150px;}
    .booking-patient h4{margin:0;font-size:14px;font-weight:600;}
    .booking-patient p{margin:0;font-size:12px;color:var(--muted);}
    .booking-details p{margin:4px 0;font-size:13px;}
    .booking-status{display:flex;flex-direction:column;align-items:flex-end;gap:12px;}
    .booking-actions{display:flex;gap:8px;}
    
    /* Invoices Styles */
    .invoices-list{display:flex;flex-direction:column;gap:16px;}
    .invoice-card{background:var(--bg);border-radius:var(--radius);box-shadow:var(--shadow);padding:20px;border:1px solid #f0f2f5;}
    .invoice-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;}
    .invoice-number h4{margin:0;font-size:16px;font-weight:600;}
    .invoice-number p{margin:4px 0 0 0;font-size:14px;color:var(--muted);}
    .invoice-details{margin-bottom:16px;}
    .invoice-row{display:flex;justify-content:space-between;padding:4px 0;font-size:14px;}
    .invoice-amount{font-weight:600;color:var(--accent);}
    .invoice-actions{display:flex;gap:8px;justify-content:flex-end;}
    
    /* Support/Tickets Styles */
    .tickets-list{display:flex;flex-direction:column;gap:16px;}
    .ticket-card{background:var(--bg);border-radius:var(--radius);box-shadow:var(--shadow);padding:20px;border:1px solid #f0f2f5;}
    .ticket-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;}
    .ticket-info h4{margin:0;font-size:16px;font-weight:600;}
    .ticket-info p{margin:4px 0 0 0;font-size:14px;color:var(--muted);}
    .ticket-meta{display:flex;gap:16px;margin-bottom:16px;font-size:13px;color:var(--muted);}
    .ticket-actions{display:flex;justify-content:flex-end;}
    
    /* Profile Styles */
    .profile-card{background:var(--bg);border-radius:var(--radius);box-shadow:var(--shadow);padding:24px;}
    .profile-header{display:flex;align-items:center;gap:20px;margin-bottom:24px;flex-wrap:wrap;}
    .profile-avatar{width:80px;height:80px;background:var(--primary);color:#fff;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:32px;}
    .profile-info{flex:1;}
    .profile-info h2{margin:0 0 4px 0;font-size:24px;font-weight:600;}
    .profile-info p{margin:4px 0;font-size:14px;color:var(--muted);}
    .profile-stats{display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:16px;}
    .stat-card{text-align:center;padding:20px;background:#f8f9fa;border-radius:var(--radius);}
    .stat-card h3{margin:0 0 8px 0;font-size:24px;font-weight:700;color:var(--primary);}
    .stat-card p{margin:0;font-size:14px;color:var(--muted);}
    
    /* Doctor Dashboard Footer */
    .doctor-footer{display:flex;justify-content:space-around;padding:8px 0;position:fixed;bottom:0;width:100%;background:var(--bg);box-shadow:0 -2px 4px rgba(0,0,0,0.1);}
    .doctor-footer-item{display:flex;flex-direction:column;align-items:center;font-size:12px;color:var(--muted);cursor:pointer;padding:8px;}
    .doctor-footer-item.active{color:var(--primary);}
    
    /* Responsive Design for Doctor Dashboard */
    @media (max-width: 768px) {
      .doctor-content{padding:16px;}
      .patient-search-container{flex-direction:column;align-items:stretch;}
      .service-categories{justify-content:center;}
      .services-grid,.labs-grid{grid-template-columns:1fr;}
      .doctor-booking-card{flex-direction:column;align-items:stretch;gap:16px;}
      .booking-info{flex-direction:column;}
      .booking-status{flex-direction:row;justify-content:space-between;align-items:center;}
      .patients-header,.bookings-header,.invoices-header,.support-header{flex-direction:column;align-items:stretch;}
      .patients-actions,.invoices-actions{flex-direction:column;}
      .profile-header{flex-direction:column;text-align:center;}
      .profile-stats{grid-template-columns:1fr;}
    }
    
    /* Modal Content Styles */
    .patient-form{margin:16px 0;}
    .detail-section{margin-bottom:20px;padding-bottom:16px;border-bottom:1px solid #f0f2f5;}
    .detail-section:last-child{border-bottom:none;}
    .detail-section h4{margin:0 0 12px 0;font-size:16px;font-weight:600;color:var(--primary);}
    .detail-section p{margin:4px 0;font-size:14px;}
    
    .invoice-content{margin:16px 0;}
    .invoice-header-info,.invoice-patient-info,.invoice-service-info,.invoice-status-info{margin-bottom:16px;}
    .invoice-header-info h4{margin:0 0 4px 0;font-size:16px;font-weight:600;}
    .invoice-patient-info h5,.invoice-service-info h5,.invoice-status-info h5{margin:0 0 8px 0;font-size:14px;font-weight:600;color:var(--primary);}
    
    .ticket-form{margin:16px 0;}
    .ticket-conversation{margin:16px 0;}
    .ticket-header-info{margin-bottom:16px;padding-bottom:12px;border-bottom:1px solid #f0f2f5;}
    .ticket-header-info h4{margin:0 0 4px 0;font-size:16px;font-weight:600;}
    .ticket-header-info p{margin:0 0 8px 0;font-size:14px;color:var(--muted);}
    
    .conversation-messages{background:#f8f9fa;}
    .message{margin-bottom:16px;padding:12px;border-radius:var(--radius);}
    .message.user-message{background:#e3f2fd;margin-left:20%;}
    .message.support-message{background:#fff;margin-right:20%;border:1px solid #e1e5e9;}
    .message-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;}
    .message-header strong{font-size:14px;}
    .message-time{font-size:12px;color:var(--muted);}
    .message p{margin:0;font-size:14px;line-height:1.4;}
    
    .reply-section{margin-top:16px;}
    .payment-info{margin:16px 0;}
    .invoice-summary{background:#f8f9fa;padding:16px;border-radius:var(--radius);margin-bottom:16px;}
    .invoice-summary h4{margin:0 0 8px 0;font-size:16px;font-weight:600;}
    .invoice-summary p{margin:4px 0;font-size:14px;}
    .invoice-summary .amount{font-size:16px;font-weight:600;color:var(--accent);}
    
    /* Profile Tab Styles */
    .profile-overview-card{background:var(--bg);border-radius:var(--radius);box-shadow:var(--shadow);padding:32px;max-width:600px;margin:0 auto;}
    .profile-details-grid{margin-bottom:32px;}
    .profile-detail-row{display:flex;justify-content:space-between;align-items:center;padding:12px 0;border-bottom:1px solid #f0f2f5;}
    .profile-detail-row:last-child{border-bottom:none;}
    .profile-label{font-weight:600;color:var(--text);min-width:140px;}
    .profile-value{color:var(--muted);flex:1;text-align:right;}
    .profile-actions{display:flex;gap:16px;justify-content:center;}
    
    .edit-profile-form,.change-password-form{margin:16px 0;}
    .password-strength-indicator{font-size:12px;margin-top:4px;min-height:16px;}
    .password-strength-weak{color:#dc3545;}
    .password-strength-medium{color:#ffc107;}
    .password-strength-strong{color:#28a745;}
    .password-strength-weak{color:#dc3545;}
    .password-strength-medium{color:#ffc107;}
    .password-strength-strong{color:#28a745;}
    
    /* Form Validation Styles */
    .field-error {
      color: #dc3545;
      font-size: 12px;
      margin-top: 4px;
      display: block;
    }
    
    input.error, textarea.error, select.error {
      border-color: #dc3545 !important;
      box-shadow: 0 0 0 2px rgba(220, 53, 69, 0.1) !important;
    }
    
    /* Success Banner Styles */
    .success-banner {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 10000;
      background: #d4edda;
      border: 1px solid #c3e6cb;
      border-radius: 8px;
      padding: 0;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      animation: slideDown 0.3s ease-out;
      max-width: 90%;
      min-width: 300px;
    }
    
    .success-content {
      display: flex;
      align-items: center;
      padding: 16px;
      gap: 12px;
    }
    
    .success-icon {
      background: #28a745;
      color: white;
      border-radius: 50%;
      width: 24px;
      height: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 14px;
      flex-shrink: 0;
    }
    
    .success-message {
      color: #155724;
      font-weight: 500;
      flex: 1;
    }
    
    .success-close {
      background: none;
      border: none;
      color: #155724;
      font-size: 20px;
      cursor: pointer;
      padding: 0;
      width: 24px;
      height: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 4px;
      transition: background-color 0.2s;
    }
    
    .success-close:hover {
      background: rgba(21, 87, 36, 0.1);
    }
    
    @keyframes slideDown {
      from {
        opacity: 0;
        transform: translateX(-50%) translateY(-20px);
      }
      to {
        opacity: 1;
        transform: translateX(-50%) translateY(0);
      }
    }
    
    /* Support Tab Styles */
    .support-search{margin-bottom:24px;}
    .support-search .search-container{display:flex;gap:8px;max-width:400px;}
    .support-search .search-input{flex:1;padding:12px 16px;border:2px solid #e1e5e9;border-radius:var(--radius);font-size:14px;}
    .support-search .search-input:focus{border-color:var(--primary);outline:none;}
    .search-icon-btn{background:var(--primary);color:#fff;border:none;padding:12px 16px;border-radius:var(--radius);cursor:pointer;font-size:14px;}
    .search-icon-btn:hover{background:#003d99;}
    
    .tickets-table-container{background:var(--bg);border-radius:var(--radius);box-shadow:var(--shadow);overflow:hidden;}
    .tickets-table{width:100%;border-collapse:collapse;}
    .tickets-table th{background:#f8f9fa;padding:16px;text-align:left;font-weight:600;color:var(--text);border-bottom:2px solid #e9ecef;}
    .tickets-table td{padding:16px;border-bottom:1px solid #f0f2f5;}
    .ticket-row{cursor:pointer;transition:background 0.3s ease;}
    .ticket-row:hover{background:#f8f9fa;}
    .ticket-row:last-child td{border-bottom:none;}
    
    /* Conversation Messages */
    .message{margin-bottom:16px;padding:12px;border-radius:var(--radius);max-width:75%;}
    .message.support-message{background:#fff;margin-right:20%;border:1px solid #e1e5e9;}
    .message.user-message{background:#e3f2fd;margin-left:20%;border:1px solid #90caf9;}
    .message-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;font-size:12px;}
    .message-header strong{color:var(--primary);}
    .message-time{color:var(--muted);font-size:11px;}
    .message p{margin:0;font-size:14px;line-height:1.4;}

    /* Admin Dashboard Report Styles */
    .report-section{margin-bottom:24px;}
    .report-section h3{font-size:18px;font-weight:600;margin:0 0 16px 0;color:var(--text);}
    .report-stats{display:grid;grid-template-columns:repeat(auto-fit, minmax(200px, 1fr));gap:16px;}
    .stat-item{background:#f8f9fa;padding:16px;border-radius:var(--radius);border-left:4px solid var(--primary);}
    .stat-label{display:block;font-size:14px;color:var(--muted);margin-bottom:4px;}
    .stat-value{display:block;font-size:24px;font-weight:700;color:var(--text);}
    
    /* Admin Navigation Tabs */
    .admin-nav-tabs{display:flex;gap:8px;margin-bottom:24px;border-bottom:2px solid #f0f2f5;padding-bottom:8px;flex-wrap:wrap;}
    .admin-nav-tab{background:none;border:none;padding:12px 16px;border-radius:6px 6px 0 0;cursor:pointer;font-weight:500;color:var(--muted);transition:all 0.3s ease;border-bottom:3px solid transparent;}
    .admin-nav-tab:hover{background:#f8f9fa;color:var(--text);}
    .admin-nav-tab.active{color:var(--primary);border-bottom-color:var(--primary);background:#f8f9fa;}
    
    /* Admin Content Areas */
    .adminTab{display:none;padding:0;}
    .adminTab.active{display:block;}
    .admin-content{background:var(--bg);border-radius:var(--radius);box-shadow:var(--shadow);padding:24px;}
    .admin-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:24px;padding-bottom:16px;border-bottom:2px solid #f0f2f5;}
    .admin-header h2{margin:0;font-size:24px;font-weight:600;color:var(--text);}
    
    /* Admin Tables */
    .admin-table{width:100%;border-collapse:collapse;background:var(--bg);border-radius:var(--radius);overflow:hidden;box-shadow:0 1px 3px rgba(0,0,0,0.1);}
    .admin-table th{background:#f8f9fa;padding:16px;text-align:left;font-weight:600;color:var(--text);border-bottom:2px solid #e9ecef;}
    .admin-table td{padding:16px;border-bottom:1px solid #f0f2f5;}
    .admin-table tbody tr:hover{background:#f8f9fa;}
    .admin-table tbody tr:last-child td{border-bottom:none;}
    
    /* Button Icons */
    .btn-icon{background:none;border:none;padding:8px;border-radius:4px;cursor:pointer;font-size:16px;transition:all 0.2s ease;margin:0 2px;}
    .btn-icon:hover{background:#f0f2f5;}
    .btn-icon.danger:hover{background:#fff5f5;color:#dc3545;}
    
    /* Badge Styles */
    .badge{display:inline-block;padding:4px 8px;border-radius:12px;font-size:11px;font-weight:600;text-transform:uppercase;letter-spacing:0.5px;}
    .badge.confirmed{background:#d4edda;color:#155724;}
    .badge.pending{background:#fff3cd;color:#856404;}
    .badge.cancelled{background:#f8d7da;color:#721c24;}
    .badge.open{background:#cce5ff;color:#004085;}
    .badge.closed{background:#d1ecf1;color:#0c5460;}
    .badge.in-progress{background:#fff3cd;color:#856404;}
    .badge.priority-high{background:#f8d7da;color:#721c24;}
    .badge.priority-medium{background:#fff3cd;color:#856404;}
    .badge.priority-low{background:#d4edda;color:#155724;}
    
    /* Booking Details Modal */
    .booking-details{max-width:100%;}
    .detail-row{display:flex;justify-content:space-between;align-items:center;padding:12px 0;border-bottom:1px solid #f0f2f5;}
    .detail-row:last-child{border-bottom:none;}
    .detail-row strong{color:var(--text);font-weight:600;}
    
    /* Schedule Management */
    .schedule-grid{display:grid;grid-template-columns:repeat(auto-fit, minmax(300px, 1fr));gap:16px;margin:16px 0;}
    .schedule-card{background:var(--bg);border:1px solid #e1e5e9;border-radius:var(--radius);padding:16px;}
    .schedule-card h4{margin:0 0 12px 0;font-size:16px;font-weight:600;color:var(--text);}
    .schedule-slots{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin:8px 0;}
    .schedule-slot{display:flex;justify-content:space-between;align-items:center;padding:8px;background:#f8f9fa;border-radius:4px;}
    .slot-time{font-weight:500;color:var(--text);}
    .slot-capacity{font-size:12px;color:var(--muted);}
    .capacity-input{width:60px;padding:4px 6px;border:1px solid #ddd;border-radius:4px;text-align:center;}
    
    /* Success Banner */
    .success-banner{position:fixed;top:20px;right:20px;background:#28a745;color:#fff;padding:12px 16px;border-radius:var(--radius);box-shadow:var(--shadow);z-index:300;transform:translateX(100%);transition:transform 0.3s ease;}
    .success-banner.show{transform:translateX(0);}

    /* Report Cards */
    .reports-grid{display:grid;grid-template-columns:repeat(auto-fit, minmax(280px, 1fr));gap:20px;margin-top:20px;}
    .report-card{background:var(--bg);border:1px solid #e1e5e9;border-radius:var(--radius);padding:20px;cursor:pointer;transition:all 0.3s ease;position:relative;}
    .report-card:hover{box-shadow:0 4px 12px rgba(0,0,0,0.15);transform:translateY(-2px);}
    .report-icon{font-size:32px;margin-bottom:12px;}
    .report-card h3{margin:0 0 8px 0;font-size:18px;font-weight:600;color:var(--text);}
    .report-card p{margin:0 0 16px 0;color:var(--muted);font-size:14px;line-height:1.4;}
    .report-card .btn-secondary{position:absolute;bottom:16px;right:16px;}

    /* Support Filters */
    .support-filters{display:flex;gap:12px;margin-bottom:20px;flex-wrap:wrap;}
    .support-filters select{min-width:150px;padding:8px 12px;border:1px solid #e1e5e9;border-radius:6px;}

    /* Header Actions */
    .header-actions{display:flex;gap:8px;flex-wrap:wrap;}
    
    /* Responsive Design Updates */
    @media (max-width: 768px) {
      .profile-detail-row{flex-direction:column;align-items:flex-start;gap:4px;}
      .profile-value{text-align:left;}
      .profile-actions{flex-direction:column;}
      .support-search .search-container{max-width:100%;}
      .tickets-table-container{overflow-x:auto;}
      .tickets-table{min-width:600px;}
      .admin-nav-tabs{flex-direction:column;}
      .admin-nav-tab{border-radius:6px;border-bottom:none;border-left:3px solid transparent;}
      .admin-nav-tab.active{border-left-color:var(--primary);}
      .admin-header{flex-direction:column;align-items:flex-start;gap:12px;}
      .report-stats{grid-template-columns:1fr;}
      .detail-row{flex-direction:column;align-items:flex-start;gap:4px;}
      .reports-grid{grid-template-columns:1fr;}
      .support-filters{flex-direction:column;}
      .support-filters select{min-width:100%;}
    }
    
    /* Admin Dashboard Layout */
    .admin-main{display:flex;gap:24px;margin-top:0;min-height:calc(100vh - 120px);}
    .admin-sidebar{width:280px;flex-shrink:0;background:var(--bg);border-radius:var(--radius);box-shadow:var(--shadow);padding:24px;height:fit-content;position:sticky;top:20px;}
    .admin-content-area{flex:1;min-width:0;}
    .admin-tab-content{display:none;background:var(--bg);border-radius:var(--radius);box-shadow:var(--shadow);padding:32px;}
    .admin-tab-content.active{display:block;}
    .admin-tab-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:32px;padding-bottom:20px;border-bottom:2px solid #f0f2f5;}
    .admin-tab-title{margin:0;font-size:28px;font-weight:700;color:var(--text);}
    .admin-tab-actions{display:flex;gap:12px;}
    .admin-table-container{background:var(--bg);border-radius:var(--radius);overflow:hidden;box-shadow:var(--shadow);border:1px solid #f0f2f5;}
    .admin-header-content{display:flex;justify-content:space-between;align-items:center;width:100%;padding:24px 32px;background:linear-gradient(135deg,var(--primary),#003d99);color:#fff;border-radius:var(--radius) var(--radius) 0 0;}
    .admin-header-actions{display:flex;align-items:center;gap:16px;}
    .admin-welcome{font-size:16px;color:rgba(255,255,255,0.9);font-weight:500;}
    
    /* Professional Admin Header */
    .admin-header{background:linear-gradient(135deg,var(--primary),#003d99);color:#fff;margin:-32px -32px 32px -32px;padding:32px;border-radius:var(--radius) var(--radius) 0 0;}
    .admin-header h1{color:#fff;font-size:32px;font-weight:700;margin:0;}
    .admin-header .btn-secondary{background:rgba(255,255,255,0.2);color:#fff;border:1px solid rgba(255,255,255,0.3);backdrop-filter:blur(10px);}
    .admin-header .btn-secondary:hover{background:rgba(255,255,255,0.3);}
    
    /* Admin Navigation in Sidebar */
    .admin-nav-tabs{display:flex;flex-direction:column;gap:4px;margin:0;border:none;padding:0;}
    .admin-nav-tab{background:none;border:none;padding:16px 20px;border-radius:var(--radius);cursor:pointer;font-weight:600;color:var(--muted);transition:all 0.3s ease;text-align:left;width:100%;border:2px solid transparent;font-size:15px;display:flex;align-items:center;gap:12px;}
    .admin-nav-tab:hover{background:#f8f9fa;color:var(--text);border-color:#f0f2f5;transform:translateX(4px);}
    .admin-nav-tab.active{color:var(--primary);background:linear-gradient(135deg,#f0f8ff,#e6f3ff);border-color:var(--primary);box-shadow:0 2px 8px rgba(0,82,204,0.15);}
    .admin-nav-tab .nav-icon{font-size:16px;transition:transform 0.3s ease;}
    .admin-nav-tab:hover .nav-icon{transform:scale(1.2);}
    .admin-nav-tab.active .nav-icon{transform:scale(1.15);}
    .admin-nav-tab::before{content:'';opacity:0;transition:opacity 0.3s ease;}
    .admin-nav-tab.active::before{opacity:0;}
    
    /* Enhanced Table Styling */
    .admin-table{width:100%;border-collapse:collapse;background:var(--bg);border-radius:0;overflow:hidden;table-layout:fixed;}
    .admin-table th{background:linear-gradient(135deg,#f8f9fa,#e9ecef);padding:20px 16px;text-align:left;font-weight:700;color:var(--text);border-bottom:2px solid #e9ecef;font-size:14px;text-transform:uppercase;letter-spacing:0.5px;}
    .admin-table td{padding:20px 16px;border-bottom:1px solid #f0f2f5;vertical-align:middle;word-wrap:break-word;}
    .admin-table tbody tr{transition:all 0.2s ease;}
    .admin-table tbody tr:hover{background:#f8f9fa;transform:translateY(-1px);box-shadow:0 2px 8px rgba(0,0,0,0.1);}
    .admin-table tbody tr:last-child td{border-bottom:none;}
    
    /* Specific column widths for bookings table */
    .admin-table th:nth-child(1){width:10%;} /* Booking ID */
    .admin-table th:nth-child(2){width:18%;} /* Patient */
    .admin-table th:nth-child(3){width:16%;} /* Doctor */
    .admin-table th:nth-child(4){width:16%;} /* Lab */
    .admin-table th:nth-child(5){width:14%;} /* Date/Time */
    .admin-table th:nth-child(6){width:12%;} /* Status */
    .admin-table th:nth-child(7){width:14%;} /* Actions */
    
    /* Action buttons in tables */
    .admin-action-btn{padding:6px 12px;margin:0 2px;border:none;border-radius:4px;cursor:pointer;font-size:12px;font-weight:600;transition:all 0.2s ease;}
    .admin-action-btn.view{background:#17a2b8;color:#fff;}
    .admin-action-btn.view:hover{background:#138496;}
    .admin-action-btn.edit{background:#ffc107;color:#000;}
    .admin-action-btn.edit:hover{background:#e0a800;}
    .admin-action-btn.delete{background:#dc3545;color:#fff;}
    .admin-action-btn.delete:hover{background:#c82333;}
    
    /* Button Enhancements */
    .btn{background:linear-gradient(135deg,var(--primary),#003d99);color:#fff;border:none;padding:12px 24px;border-radius:var(--radius);cursor:pointer;font-weight:600;box-shadow:0 4px 12px rgba(0,82,204,0.3);transition:all 0.3s ease;font-size:14px;}
    .btn:hover{transform:translateY(-2px);box-shadow:0 6px 20px rgba(0,82,204,0.4);}
    .btn-secondary{background:linear-gradient(135deg,#f8f9fa,#e9ecef);color:var(--text);border:1px solid #dee2e6;}
    .btn-secondary:hover{background:linear-gradient(135deg,#e9ecef,#dee2e6);transform:translateY(-1px);}
    
    /* Clean up unwanted content */
    .admin-dashboard-footer{display:none !important;}
    .capacity-visualization{margin-top:32px;}
    
    /* Chart hover effects */
    .chart-bar:hover{transform:translateY(-4px);box-shadow:0 4px 16px rgba(0,0,0,0.2) !important;}
    .metric-card:hover{transform:translateY(-2px);box-shadow:0 8px 25px rgba(0,0,0,0.15);}
    .report-card:hover{transform:translateY(-2px);box-shadow:0 8px 25px rgba(0,0,0,0.15);border-color:var(--primary);}
    
    /* Professional spacing */
    .admin-tab-content{min-height:600px;}
    .admin-sidebar{box-shadow:0 4px 20px rgba(0,0,0,0.1);}
    
    /* Hide any footer pollution - FIXED to not hide container or header elements */
    body > div:not(.modal):not(.modal-backdrop):not(#footerNav):not(#doctorFooterNav):not(.container):not(.header-right):not(.notification-icon):last-child{display:none !important;}
    body > *:not(section):not(.container):not(header):not(script):not(style):not(head):not(.modal):not(.modal-backdrop):not(#footerNav):not(#doctorFooterNav){display:none !important;}
    
    /* Force hide any loose content */
    body::after{content:'';display:block;clear:both;height:0;overflow:hidden;}
    
    /* Ensure admin table containers are properly responsive */
    .admin-table-container{background:var(--bg);border-radius:var(--radius);overflow:hidden;box-shadow:var(--shadow);border:1px solid #f0f2f5;overflow-x:auto;}
    .admin-table-container::-webkit-scrollbar{height:8px;}
    .admin-table-container::-webkit-scrollbar-track{background:#f1f1f1;border-radius:4px;}
    .admin-table-container::-webkit-scrollbar-thumb{background:#c1c1c1;border-radius:4px;}
    .admin-table-container::-webkit-scrollbar-thumb:hover{background:#a8a8a8;}
    
    @media (max-width: 1024px) {
      .admin-main{flex-direction:column;gap:20px;min-height:auto;}
      .admin-sidebar{width:100%;position:static;order:2;}
      .admin-content-area{order:1;}
      .admin-nav-tabs{flex-direction:row;flex-wrap:wrap;gap:8px;}
      .admin-nav-tab{width:auto;flex:1;min-width:140px;text-align:center;padding:12px 16px;}
      .admin-nav-tab::before{display:none;}
    }
    
    @media (max-width: 768px) {
      .admin-header-content{flex-direction:column;align-items:flex-start;gap:16px;padding:20px;}
      .admin-header h1{font-size:24px;}
      .admin-header-actions{flex-direction:row;align-items:center;gap:12px;width:100%;justify-content:space-between;}
      .admin-tab-header{flex-direction:column;align-items:flex-start;gap:16px;}
      .admin-tab-title{font-size:24px;}
      .admin-nav-tabs{flex-direction:column;}
      .admin-nav-tab{width:100%;text-align:left;padding:14px 16px;}
      .admin-table-container{overflow-x:auto;}
      .admin-table{min-width:800px;table-layout:auto;}
      .admin-table th,.admin-table td{padding:12px 8px;font-size:12px;}
      .admin-action-btn{padding:4px 8px;font-size:11px;}
      
      /* Stack action buttons vertically on mobile */
      .admin-table td:last-child{display:flex;flex-direction:column;gap:4px;}
      .admin-action-btn{width:100%;margin:0;}
    }
    
    /* Registration Form Styles */
    .form-row {
      margin: 16px 0;
    }
    
    .form-group {
      position: relative;
    }
    
    .form-group label {
      display: block;
      margin-bottom: 6px;
      font-weight: 500;
      color: var(--text);
      font-size: 14px;
    }
    
    .form-group input,
    .form-group select,
    .form-group textarea {
      width: 100%;
      padding: 10px 12px;
      border: 2px solid #e1e5e9;
      border-radius: var(--radius);
      font-size: 14px;
      transition: all 0.3s ease;
      background: var(--bg);
    }
    
    .form-group input:focus,
    .form-group select:focus,
    .form-group textarea:focus {
      border-color: var(--primary);
      outline: none;
      box-shadow: 0 0 0 3px rgba(0, 82, 204, 0.1);
    }
    
    .radio-group {
      display: flex;
      gap: 16px;
      margin-top: 8px;
    }
    
    .radio-option {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 14px;
      cursor: pointer;
    }
    
    .radio-option input[type="radio"] {
      width: auto;
      margin: 0;
    }
    
    .checkbox-group {
      margin: 16px 0;
    }
    
    .checkbox-option {
      display: flex;
      align-items: flex-start;
      gap: 8px;
      font-size: 14px;
      cursor: pointer;
      line-height: 1.4;
    }
    
    .checkbox-option input[type="checkbox"] {
      width: auto;
      margin: 0;
      margin-top: 2px;
    }
    
    .password-strength {
      margin-top: 6px;
      font-size: 12px;
      min-height: 16px;
    }
    
    .strength-weak {
      color: #dc3545;
    }
    
    .strength-medium {
      color: #ffc107;
    }
    
    .strength-strong {
      color: #28a745;
    }
    
    .field-error {
      color: #dc3545;
      font-size: 12px;
      margin-top: 4px;
      display: block;
      min-height: 16px;
    }
    
    .form-group input.error,
    .form-group select.error,
    .form-group textarea.error {
      border-color: #dc3545;
      box-shadow: 0 0 0 3px rgba(220, 53, 69, 0.1);
    }
    
    .success-message {
      background: #d4edda;
      border: 1px solid #c3e6cb;
      color: #155724;
      padding: 12px 16px;
      border-radius: var(--radius);
      margin: 16px 0;
      font-size: 14px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .success-message::before {
      content: "‚úì";
      background: #28a745;
      color: white;
      border-radius: 50%;
      width: 20px;
      height: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      font-weight: bold;
    }
    
    /* Registration specific styles */
    .registration-confirmation {
      text-align: center;
      padding: 40px 20px;
    }
    
    .confirmation-icon {
      font-size: 48px;
      color: #28a745;
      margin-bottom: 16px;
    }
    
    .confirmation-title {
      font-size: 24px;
      font-weight: 600;
      color: var(--text);
      margin: 0 0 8px 0;
    }
    
    .confirmation-message {
      color: var(--muted);
      font-size: 16px;
      line-height: 1.5;
      margin: 0 0 24px 0;
    }
    
    /* Responsive form styles */
    @media (max-width: 768px) {
      .form-row[style*="display:flex"] {
        flex-direction: column !important;
      }
      
      .form-group[style*="flex:1"],
      .form-group[style*="flex:2"] {
        flex: none !important;
      }
      
      .radio-group {
        flex-direction: column;
        gap: 8px;
      }
    }
    /* Onboarding Styles */
    .onboarding-step {
      display: none;
    }
    
    .onboarding-step.active {
      display: block;
    }
    
    .onboarding-header {
      text-align: center;
      margin-bottom: 32px;
    }
    
    .step-indicator {
      display: flex;
      justify-content: center;
      gap: 16px;
      margin-bottom: 24px;
    }
    
    .step-number {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: #e9ecef;
      color: #6c757d;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      font-size: 14px;
      transition: all 0.3s ease;
    }
    
    .step-number.active {
      background: var(--primary);
      color: white;
    }
    
    .step-number.completed {
      background: #28a745;
      color: white;
    }
    
    .onboarding-actions {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 32px;
      gap: 16px;
    }
    
    .days-selector {
      display: flex;
      gap: 8px;
      margin-top: 8px;
      flex-wrap: wrap;
    }
    
    .day-option {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 36px;
      height: 36px;
      border: 2px solid #e9ecef;
      border-radius: 50%;
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: 600;
      font-size: 14px;
    }
    
    .day-option input[type="checkbox"] {
      display: none;
    }
    
    .day-option:has(input:checked) {
      background: var(--primary);
      border-color: var(--primary);
      color: white;
    }
    
    .lab-options {
      margin-top: 16px;
      border: 1px solid #e9ecef;
      border-radius: var(--radius);
      overflow: hidden;
    }
    
    .lab-option {
      padding: 16px;
      border-bottom: 1px solid #e9ecef;
      transition: background 0.3s ease;
    }
    
    .lab-option:last-child {
      border-bottom: none;
    }
    
    .lab-option:hover {
      background: #f8f9fa;
    }
    
    .lab-option .checkbox-option {
      margin: 0;
    }
    
    .services-section {
      border: 1px solid #e9ecef;
      border-radius: var(--radius);
      padding: 20px;
      margin-bottom: 16px;
    }
    
    .services-section h3 {
      margin: 0 0 16px 0;
      color: var(--text);
      font-size: 16px;
      font-weight: 600;
    }
    
    .services-list {
      margin-bottom: 16px;
    }
    
    .service-row {
      display: flex;
      gap: 12px;
      align-items: center;
      margin-bottom: 12px;
    }
    
    .service-row input {
      margin: 0;
    }
    
    .remove-service {
      background: #dc3545;
      color: white;
      border: none;
      width: 32px;
      height: 32px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      flex-shrink: 0;
    }
    
    .remove-service:hover {
      background: #c82333;
    }
    
    /* Responsive onboarding styles */
    @media (max-width: 768px) {
      .onboarding-actions {
        flex-direction: column;
        gap: 12px;
      }
      
      .onboarding-actions button {
        width: 100%;
      }
      
      .service-row {
        flex-direction: column;
        align-items: stretch;
      }
      
      .service-row input,
      .remove-service {
        width: 100%;
      }
      
      .days-selector {
        justify-content: space-between;
      }
      
      .step-indicator {
        gap: 8px;
      }
      
      .step-number {
        width: 28px;
        height: 28px;
        font-size: 12px;
      }
    }
    /* Admin Interface Styles */
    .admin-nav {
      background: var(--primary);
      color: white;
      padding: 0;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      position: sticky;
      top: 0;
      z-index: 100;
    }
    
    .admin-nav-content {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 16px 24px;
      max-width: 1200px;
      margin: 0 auto;
    }
    
    .admin-nav-left h1 {
      margin: 0;
      font-size: 20px;
      font-weight: 600;
      color: white;
    }
    
    .admin-nav-right {
      display: flex;
      align-items: center;
      gap: 16px;
    }
    
    .admin-user {
      color: white;
      font-size: 14px;
    }
    
    .admin-dashboard-content {
      background: var(--surface);
      min-height: calc(100vh - 70px);
      padding: 24px 0;
    }
    
    .admin-cards-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
      gap: 24px;
      margin-bottom: 24px;
    }
    
    .admin-card {
      background: var(--bg);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow: hidden;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    
    .admin-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 16px rgba(0,0,0,0.15);
    }
    
    .admin-card-header {
      padding: 20px 24px 16px;
      border-bottom: 1px solid #f0f2f5;
    }
    
    .admin-card-header h3 {
      margin: 0;
      font-size: 18px;
      font-weight: 600;
      color: var(--text);
    }
    
    .admin-card-content {
      padding: 20px 24px 24px;
    }
    
    .overview-stats {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }
    
    .stat-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 0;
      border-bottom: 1px solid #f0f2f5;
    }
    
    .stat-item:last-child {
      border-bottom: none;
    }
    
    .stat-number {
      font-size: 24px;
      font-weight: 700;
      color: var(--primary);
    }
    
    .stat-label {
      font-size: 14px;
      color: var(--muted);
    }
    
    .approval-items,
    .ticket-info {
      margin-bottom: 20px;
    }
    
    .approval-item,
    .ticket-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 0;
    }
    
    .approval-count,
    .ticket-count {
      font-size: 20px;
      font-weight: 600;
      color: var(--accent);
    }
    
    .approval-label,
    .ticket-label {
      font-size: 14px;
      color: var(--text);
    }
    
    .admin-card-btn {
      width: 100%;
      padding: 10px 16px;
      font-size: 14px;
      margin-top: 8px;
    }
    
    .user-management-buttons {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    
    .admin-user-btn {
      width: 100%;
      padding: 10px 16px;
      font-size: 14px;
      text-align: center;
    }
    
    .booking-management-buttons,
    .reports-buttons {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    
    /* Approval Management Styles */
    .approval-sections {
      display: flex;
      flex-direction: column;
      gap: 32px;
    }
    
    .approval-section h3 {
      margin: 0 0 16px 0;
      font-size: 18px;
      font-weight: 600;
      color: var(--text);
    }
    
    .approval-table {
      background: var(--bg);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow-x: auto;
    }
    
    .approval-table table {
      width: 100%;
      margin: 0;
    }
    
    .approval-table th {
      background: var(--surface);
      font-weight: 600;
      font-size: 14px;
      color: var(--text);
      padding: 16px 12px;
    }
    
    .approval-table td {
      padding: 16px 12px;
      font-size: 14px;
    }
    
    .btn-approve {
      background: #28a745;
      color: white;
      border: none;
      padding: 6px 12px;
      border-radius: 4px;
      font-size: 12px;
      margin-right: 4px;
      cursor: pointer;
    }
    
    .btn-approve:hover {
      background: #218838;
    }
    
    .btn-reject {
      background: #dc3545;
      color: white;
      border: none;
      padding: 6px 12px;
      border-radius: 4px;
      font-size: 12px;
      margin-right: 4px;
      cursor: pointer;
    }
    
    .btn-reject:hover {
      background: #c82333;
    }
    
    .btn-view {
      background: #6c757d;
      color: white;
      border: none;
      padding: 6px 12px;
      border-radius: 4px;
      font-size: 12px;
      cursor: pointer;
    }
    
    .btn-view:hover {
      background: #5a6268;
    }
    
    /* User Management Styles */
    .user-management-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
      gap: 16px;
      flex-wrap: wrap;
    }
    
    .search-container,
    .filter-container {
      display: flex;
      gap: 8px;
      align-items: center;
    }
    
    .users-table-container {
      background: var(--bg);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow-x: auto;
    }
    
    .users-table {
      width: 100%;
      margin: 0;
    }
    
    .users-table th {
      background: var(--surface);
      font-weight: 600;
      font-size: 14px;
      color: var(--text);
      padding: 16px 12px;
      position: sticky;
      top: 0;
    }
    
    .users-table td {
      padding: 16px 12px;
      font-size: 14px;
      border-bottom: 1px solid #f0f2f5;
    }
    
    .user-status {
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 500;
    }
    
    .user-status.active {
      background: #d4edda;
      color: #155724;
    }
    
    .user-status.inactive {
      background: #f8d7da;
      color: #721c24;
    }
    
    .user-status.pending {
      background: #fff3cd;
      color: #856404;
    }
    
    .user-actions {
      display: flex;
      gap: 4px;
    }
    
    .user-action-btn {
      background: none;
      border: 1px solid #dee2e6;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 12px;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .user-action-btn:hover {
      background: var(--surface);
    }
    
    .user-action-btn.edit {
      color: #007bff;
      border-color: #007bff;
    }
    
    .user-action-btn.delete {
      color: #dc3545;
      border-color: #dc3545;
    }
    
    .user-action-btn.view {
      color: #28a745;
      border-color: #28a745;
    }
    
    /* Responsive Admin Styles */
    @media (max-width: 768px) {
      .admin-nav-content {
        flex-direction: column;
        gap: 12px;
        padding: 12px 16px;
      }
      
      .admin-nav-right {
        width: 100%;
        justify-content: space-between;
      }
      
      .admin-cards-grid {
        grid-template-columns: 1fr;
        gap: 16px;
      }
      
      .user-management-buttons {
        flex-direction: row;
        flex-wrap: wrap;
      }
      
      .admin-user-btn {
        flex: 1;
        min-width: 120px;
      }
      
      .user-management-header {
        flex-direction: column;
        align-items: stretch;
      }
      
      .search-container,
      .filter-container {
        width: 100%;
      }
      
      #userSearchInput {
        width: 100% !important;
      }
      
      .approval-table,
      .users-table-container {
        overflow-x: scroll;
      }
      
      .booking-management-buttons,
      .reports-buttons {
        flex-direction: row;
        gap: 8px;
      }
      
      /* Mobile header adjustments */
      header {
        padding: 8px 12px;
      }
      
      .header-right {
        gap: 10px;
      }
      
      .logout-btn {
        padding: 6px 10px;
        font-size: 12px;
        height: 32px;
      }
      
      .notification-badge {
        font-size: 9px;
        padding: 1px 4px;
        min-width: 14px;
      }
      
      h1 {
        font-size: 1.1rem;
      }
    }
    
    /* Admin Tab Styles */
    .admin-tabs {
      display: flex;
      border-bottom: 2px solid #e9ecef;
      margin-bottom: 24px;
      background: var(--bg);
      border-radius: var(--radius) var(--radius) 0 0;
      overflow-x: auto;
      flex-wrap: nowrap;
    }
    
    .admin-tab {
      background: none;
      border: none;
      padding: 12px 20px;
      font-size: 14px;
      font-weight: 500;
      color: var(--muted);
      cursor: pointer;
      border-bottom: 3px solid transparent;
      transition: all 0.3s ease;
      white-space: nowrap;
      min-width: 120px;
    }
    
    .admin-tab:hover {
      color: var(--primary);
      background: rgba(0, 123, 255, 0.1);
    }
    
    .admin-tab.active {
      color: var(--primary);
      background: rgba(0, 123, 255, 0.1);
      border-bottom-color: var(--primary);
    }
    
    .admin-tab-content {
      display: none;
      padding: 20px;
      background: var(--bg);
      border-radius: 0 0 var(--radius) var(--radius);
      box-shadow: var(--shadow);
    }
    
    .admin-tab-content.active {
      display: block;
    }
    
    .admin-services-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
      flex-wrap: wrap;
      gap: 16px;
    }
    
    .admin-services-header h2 {
      margin: 0;
      font-size: 24px;
      font-weight: 600;
      color: var(--text);
    }
    
    /* User Type Tab Styles */
    .user-type-tabs {
      display: flex;
      gap: 8px;
      margin-bottom: 24px;
      flex-wrap: wrap;
    }
    
    .user-type-tab {
      background: var(--surface);
      border: 1px solid #dee2e6;
      padding: 8px 16px;
      border-radius: var(--radius);
      font-size: 14px;
      color: var(--text);
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .user-type-tab:hover {
      background: rgba(0, 123, 255, 0.1);
      border-color: var(--primary);
    }
    
    .user-type-tab.active {
      background: var(--primary);
      color: white;
      border-color: var(--primary);
    }
    
    /* User Management Controls */
    .user-management-controls {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
      gap: 16px;
      flex-wrap: wrap;
    }
    
    .search-container {
      display: flex;
      align-items: center;
      gap: 8px;
      flex: 1;
      min-width: 250px;
    }
    
    .search-input {
      flex: 1;
      padding: 10px 12px;
      border: 1px solid #dee2e6;
      border-radius: var(--radius);
      font-size: 14px;
      max-width: 300px;
    }
    
    .search-btn {
      background: var(--primary);
      color: white;
      border: none;
      padding: 10px 12px;
      border-radius: var(--radius);
      cursor: pointer;
      font-size: 14px;
    }
    
    .filter-container {
      display: flex;
      gap: 8px;
      align-items: center;
    }
    
    .filter-container select {
      padding: 8px 12px;
      border: 1px solid #dee2e6;
      border-radius: var(--radius);
      font-size: 14px;
      background: white;
    }
    
    /* User Management Modal Styles */
    .user-modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
    }
    
    .user-modal-content {
      background-color: var(--bg);
      margin: 5% auto;
      padding: 20px;
      border-radius: var(--radius);
      width: 90%;
      max-width: 500px;
      position: relative;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
    }
    
    .user-modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 1px solid #dee2e6;
    }
    
    .user-modal-header h3 {
      margin: 0;
      font-size: 18px;
      color: var(--text);
    }
    
    .user-modal-close {
      background: none;
      border: none;
      font-size: 24px;
      cursor: pointer;
      color: var(--muted);
      padding: 0;
      width: 30px;
      height: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .user-modal-close:hover {
      color: var(--text);
    }
    
    .user-modal-body {
      margin-bottom: 20px;
    }
    
    .user-detail-row {
      display: flex;
      justify-content: space-between;
      padding: 8px 0;
      border-bottom: 1px solid #f0f2f5;
    }
    
    .user-detail-row:last-child {
      border-bottom: none;
    }
    
    .user-detail-label {
      font-weight: 500;
      color: var(--text);
      min-width: 120px;
    }
    
    .user-detail-value {
      color: var(--muted);
      text-align: right;
    }
    
    .user-modal-actions {
      display: flex;
      gap: 8px;
      justify-content: flex-end;
      flex-wrap: wrap;
    }
    
    .user-modal-btn {
      padding: 8px 16px;
      border: none;
      border-radius: var(--radius);
      font-size: 14px;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .user-modal-btn.primary {
      background: var(--primary);
      color: white;
    }
    
    .user-modal-btn.danger {
      background: #dc3545;
      color: white;
    }
    
    .user-modal-btn.warning {
      background: #ffc107;
      color: #212529;
    }
    
    .user-modal-btn.secondary {
      background: #6c757d;
      color: white;
    }
    
    .user-modal-btn:hover {
      opacity: 0.9;
      transform: translateY(-1px);
    }
    
    /* Status Colors */
    .user-status.suspended {
      background: #f8d7da;
      color: #721c24;
    }
    
    /* Form styles within modals */
    .user-modal .form-group {
      margin-bottom: 16px;
    }
    
    .user-modal .form-group label {
      display: block;
      margin-bottom: 4px;
      font-weight: 500;
      color: var(--text);
    }
    
    .user-modal .form-group input,
    .user-modal .form-group select,
    .user-modal .form-group textarea {
      width: 100%;
      padding: 8px 12px;
      border: 1px solid #dee2e6;
      border-radius: var(--radius);
      font-size: 14px;
      box-sizing: border-box;
    }
    
    .user-modal .form-group input:focus,
    .user-modal .form-group select:focus,
    .user-modal .form-group textarea:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.25);
    }
    
    /* Booking Management Styles */
    .booking-status-tabs {
      display: flex;
      gap: 8px;
      margin-bottom: 24px;
      flex-wrap: wrap;
    }
    
    .booking-status-tab {
      background: var(--surface);
      border: 1px solid #dee2e6;
      padding: 8px 16px;
      border-radius: var(--radius);
      font-size: 14px;
      color: var(--text);
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .booking-status-tab:hover {
      background: rgba(0, 123, 255, 0.1);
      border-color: var(--primary);
    }
    
    .booking-status-tab.active {
      background: var(--primary);
      color: white;
      border-color: var(--primary);
    }
    
    .booking-filters-section {
      background: var(--surface);
      padding: 16px;
      border-radius: var(--radius);
      margin-bottom: 24px;
      border: 1px solid #dee2e6;
    }
    
    .filter-row {
      display: flex;
      gap: 16px;
      margin-bottom: 12px;
      flex-wrap: wrap;
      align-items: end;
    }
    
    .filter-row:last-child {
      margin-bottom: 0;
    }
    
    .filter-group {
      display: flex;
      flex-direction: column;
      gap: 4px;
      min-width: 150px;
    }
    
    .filter-group.search-group {
      flex: 1;
      min-width: 200px;
    }
    
    .filter-group label {
      font-size: 12px;
      font-weight: 500;
      color: var(--muted);
      text-transform: uppercase;
    }
    
    .filter-group input,
    .filter-group select {
      padding: 8px 12px;
      border: 1px solid #dee2e6;
      border-radius: var(--radius);
      font-size: 14px;
      background: white;
    }
    
    .filter-group .search-btn {
      position: absolute;
      right: 8px;
      top: 50%;
      transform: translateY(-50%);
      background: none;
      border: none;
      cursor: pointer;
      font-size: 16px;
    }
    
    .search-group {
      position: relative;
    }
    
    .search-group input {
      padding-right: 40px;
    }
    
    .bookings-table-container {
      background: var(--bg);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow-x: auto;
      margin-bottom: 16px;
    }
    
    .bookings-table {
      width: 100%;
      margin: 0;
    }
    
    .bookings-table th {
      background: var(--surface);
      font-weight: 600;
      font-size: 14px;
      color: var(--text);
      padding: 16px 12px;
      position: sticky;
      top: 0;
    }
    
    .bookings-table td {
      padding: 16px 12px;
      font-size: 14px;
      border-bottom: 1px solid #f0f2f5;
    }
    
    .booking-status {
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 500;
    }
    
    .booking-status.upcoming {
      background: #d1ecf1;
      color: #0c5460;
    }
    
    .booking-status.completed {
      background: #d4edda;
      color: #155724;
    }
    
    .booking-status.cancelled {
      background: #f8d7da;
      color: #721c24;
    }
    
    .booking-status.pending {
      background: #fff3cd;
      color: #856404;
    }
    
    .booking-actions {
      display: flex;
      gap: 4px;
    }
    
    .booking-action-btn {
      background: none;
      border: 1px solid #dee2e6;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 12px;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .booking-action-btn:hover {
      background: var(--surface);
    }
    
    .booking-action-btn.primary {
      color: var(--primary);
      border-color: var(--primary);
    }
    
    .booking-action-btn.danger {
      color: #dc3545;
      border-color: #dc3545;
    }
    
    .pagination-container {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 16px 0;
      flex-wrap: wrap;
      gap: 16px;
    }
    
    .pagination-info {
      font-size: 14px;
      color: var(--muted);
    }
    
    .pagination-controls {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .pagination-btn {
      background: var(--surface);
      border: 1px solid #dee2e6;
      padding: 6px 12px;
      border-radius: var(--radius);
      font-size: 14px;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .pagination-btn:hover:not(:disabled) {
      background: var(--primary);
      color: white;
      border-color: var(--primary);
    }
    
    .pagination-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    
    .pagination-numbers {
      display: flex;
      gap: 4px;
    }
    
    .pagination-numbers span {
      padding: 6px 8px;
      font-size: 14px;
      cursor: pointer;
      border-radius: 4px;
    }
    
    .pagination-numbers span.active {
      background: var(--primary);
      color: white;
    }
    
    .pagination-numbers span:hover:not(.active) {
      background: var(--surface);
    }
    
    /* Chat Log Styles */
    .chat-message {
      margin-bottom: 12px;
      padding: 8px 12px;
      border-radius: 12px;
      max-width: 80%;
    }
    
    .chat-message.doctor {
      background: #e3f2fd;
      border-radius: 12px 12px 12px 4px;
    }
    
    .chat-message.lab {
      background: #f3e5f5;
      border-radius: 12px 12px 12px 4px;
    }
    
    .chat-message.patient {
      background: #e8f5e8;
      border-radius: 12px 12px 4px 12px;
      margin-left: auto;
    }
    
    .chat-message.admin {
      background: #fff3e0;
      border-radius: 12px 12px 12px 4px;
    }
    
    .chat-sender {
      font-weight: 600;
      font-size: 12px;
      margin-bottom: 4px;
    }
    
    .chat-content {
      font-size: 14px;
      line-height: 1.4;
    }
    
    .chat-timestamp {
      font-size: 10px;
      color: var(--muted);
      margin-top: 4px;
    }
    
    /* Additional responsive styles for booking management */
    @media (max-width: 768px) {
      .booking-status-tabs {
        flex-direction: column;
      }
      
      .booking-status-tab {
        text-align: center;
      }
      
      .booking-filters-section {
        padding: 12px;
      }
      
      .filter-row {
        flex-direction: column;
        gap: 12px;
      }
      
      .filter-group {
        min-width: auto;
      }
      
      .filter-group.search-group {
        min-width: auto;
      }
      
      .bookings-table-container {
        overflow-x: scroll;
      }
      
      .bookings-table th,
      .bookings-table td {
        min-width: 100px;
        white-space: nowrap;
      }
      
      .pagination-container {
        flex-direction: column;
        text-align: center;
      }
      
      .pagination-controls {
        justify-content: center;
      }
      
      .booking-actions {
        flex-direction: column;
        gap: 2px;
      }
      
      .booking-action-btn {
        width: 100%;
        text-align: center;
      }
    }
    
    @media (max-width: 768px) {
      .admin-tabs {
        flex-wrap: wrap;
      }
      
      .user-type-tabs {
        flex-direction: column;
      }
      
      .user-type-tab {
        text-align: center;
      }
      
      .user-management-controls {
        flex-direction: column;
        align-items: stretch;
      }
      
      .search-container {
        min-width: auto;
      }
      
      .search-input {
        max-width: none;
      }
      
      .filter-container {
        justify-content: center;
      }
      
      .user-modal-content {
        margin: 10% auto;
        width: 95%;
        padding: 16px;
      }
      
      .user-modal-actions {
        flex-direction: column;
      }
      
      .user-modal-btn {
        width: 100%;
      }
      
      .user-detail-row {
        flex-direction: column;
        text-align: left;
      }
      
      .user-detail-value {
        text-align: left;
        margin-top: 4px;
        font-weight: 500;
      }
    }
  </style>
</head>
<body>
  <header>
    <div class="icon">‚ò∞</div>
    <h1>Embrion IVF</h1>
    <div class="header-right">
      <div class="notification-icon">
        <div class="icon" id="notifIcon">üîî</div>
        <span class="notification-badge">3</span>
      </div>
      <button id="logoutBtn" class="logout-btn" onclick="logout()" style="display:block;">Logout</button>
    </div>
  </header>
  <div class="container">
    <!-- Login -->
    <section id="login" class="screen active">
      <div class="card" style="max-width:400px;margin:40px auto;text-align:center;">
        <h2>Login</h2>
        <select id="roleSelect"><option value="patient">Patient</option><option value="doctor">Doctor</option><option value="admin">Lab Admin</option></select>
        <input type="email" id="emailInput" placeholder="Email" />
        <input type="password" id="passInput" placeholder="Password" />
        <button class="btn" onclick="doLogin()">Login</button>
        <div style="margin-top:16px;padding-top:16px;border-top:1px solid #eee;">
          <p style="margin:8px 0;color:var(--muted);font-size:14px;">Don't have an account?</p>
          <div style="display:flex;gap:8px;justify-content:center;flex-wrap:wrap;">
            <button class="btn-secondary" onclick="showRegister('patient')" style="font-size:12px;padding:6px 12px;">Register as Patient</button>
            <button class="btn-secondary" onclick="showRegister('doctor')" style="font-size:12px;padding:6px 12px;">Register as Doctor</button>
            <button class="btn-secondary" onclick="showRegister('lab')" style="font-size:12px;padding:6px 12px;">Register Lab</button>
          </div>
        </div>
        <div style="margin-top:12px;padding-top:12px;border-top:1px solid #eee;text-align:center;">
          <p style="margin:4px 0;color:var(--muted);font-size:12px;">
            Platform Administrator? 
            <a href="#" onclick="console.log('Admin Access clicked'); try { showAdminLoginFromMain(); } catch(e) { console.error('Error:', e); alert('Error opening admin login: ' + e.message); } return false;" style="color:var(--primary);text-decoration:none;">Admin Access</a>
          </p>
        </div>
      </div>
    </section>

    <!-- Early Admin Functions Script (needed for Admin Access onclick) -->
    <script>
      // Essential admin functions defined early to be available for onclick handlers
      function showAdminLoginFromMain() {
        console.log('showAdminLoginFromMain called from early script');
        
        // Hide all screens
        document.querySelectorAll('.screen').forEach(screen => {
          screen.classList.remove('active');
        });
        
        // Show admin login screen
        const adminLoginScreen = document.getElementById('adminLogin');
        if (adminLoginScreen) {
          adminLoginScreen.classList.add('active');
          console.log('Admin login screen shown');
        } else {
          console.error('Admin login screen not found');
          alert('Admin login screen not found. Please refresh the page.');
        }
      }
      
      function showAdminLogin() {
        console.log('showAdminLogin called from early script');
        showAdminLoginFromMain();
      }
    </script>

    <!-- Patient Registration -->
    <section id="patientRegister" class="screen">
      <div class="card" style="max-width:500px;margin:40px auto;">
        <div style="text-align:center;margin-bottom:24px;">
          <h2>Patient Registration</h2>
          <p style="color:var(--muted);margin:8px 0;">Create your account to book lab tests</p>
        </div>
        
        <form id="patientRegisterForm" onsubmit="registerPatient(); return false;">
          <div class="form-row">
            <div class="form-group">
              <label for="patientFullName">Full Name *</label>
              <input type="text" id="patientFullName" name="fullName" placeholder="Enter your full name" required />
              <span class="field-error" id="patientFullNameError"></span>
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="patientEmail">Email *</label>
              <input type="email" id="patientEmail" name="email" placeholder="Enter your email" required />
              <span class="field-error" id="patientEmailError"></span>
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="patientMobile">Mobile Number *</label>
              <input type="tel" id="patientMobile" name="mobile" placeholder="+91 98765 43210" required pattern="[+][0-9]{2}[0-9]{10}" />
              <span class="field-error" id="patientMobileError"></span>
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="patientDob">Date of Birth *</label>
              <input type="date" id="patientDob" name="dob" required />
              <span class="field-error" id="patientDobError"></span>
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label>Gender *</label>
              <div class="radio-group">
                <label class="radio-option"><input type="radio" name="gender" value="male" required /> Male</label>
                <label class="radio-option"><input type="radio" name="gender" value="female" required /> Female</label>
                <label class="radio-option"><input type="radio" name="gender" value="other" required /> Other</label>
              </div>
              <span class="field-error" id="patientGenderError"></span>
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="patientPassword">Password *</label>
              <input type="password" id="patientPassword" name="password" placeholder="Create password" required onkeyup="checkPasswordStrength('patient')" />
              <div class="password-strength" id="patientPasswordStrength"></div>
              <span class="field-error" id="patientPasswordError"></span>
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="patientConfirmPassword">Confirm Password *</label>
              <input type="password" id="patientConfirmPassword" name="confirmPassword" placeholder="Confirm password" required onkeyup="checkPasswordMatch('patient')" />
              <span class="field-error" id="patientConfirmPasswordError"></span>
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="patientAddress">Address *</label>
              <textarea id="patientAddress" name="address" rows="2" placeholder="Enter your address" required></textarea>
              <span class="field-error" id="patientAddressError"></span>
            </div>
          </div>
          
          <div class="form-row" style="display:flex;gap:12px;">
            <div class="form-group" style="flex:2;">
              <label for="patientCity">City *</label>
              <input type="text" id="patientCity" name="city" placeholder="Enter city" required />
              <span class="field-error" id="patientCityError"></span>
            </div>
            <div class="form-group" style="flex:1;">
              <label for="patientPincode">Pin Code *</label>
              <input type="text" id="patientPincode" name="pincode" placeholder="123456" required pattern="[0-9]{6}" />
              <span class="field-error" id="patientPincodeError"></span>
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="patientState">State *</label>
              <select id="patientState" name="state" required>
                <option value="">Select State</option>
                <option value="AP">Andhra Pradesh</option>
                <option value="AR">Arunachal Pradesh</option>
                <option value="AS">Assam</option>
                <option value="BR">Bihar</option>
                <option value="CG">Chhattisgarh</option>
                <option value="GA">Goa</option>
                <option value="GJ">Gujarat</option>
                <option value="HR">Haryana</option>
                <option value="HP">Himachal Pradesh</option>
                <option value="JK">Jammu and Kashmir</option>
                <option value="JH">Jharkhand</option>
                <option value="KA">Karnataka</option>
                <option value="KL">Kerala</option>
                <option value="MP">Madhya Pradesh</option>
                <option value="MH">Maharashtra</option>
                <option value="MN">Manipur</option>
                <option value="ML">Meghalaya</option>
                <option value="MZ">Mizoram</option>
                <option value="NL">Nagaland</option>
                <option value="OR">Odisha</option>
                <option value="PB">Punjab</option>
                <option value="RJ">Rajasthan</option>
                <option value="SK">Sikkim</option>
                <option value="TN">Tamil Nadu</option>
                <option value="TG">Telangana</option>
                <option value="TR">Tripura</option>
                <option value="UP">Uttar Pradesh</option>
                <option value="UT">Uttarakhand</option>
                <option value="WB">West Bengal</option>
                <option value="DL">Delhi</option>
              </select>
              <span class="field-error" id="patientStateError"></span>
            </div>
          </div>
          
          <div class="form-row">
            <div class="checkbox-group">
              <label class="checkbox-option">
                <input type="checkbox" id="patientTerms" name="terms" required />
                <span>I agree to the <a href="#" onclick="showTerms()">Terms & Conditions</a></span>
              </label>
              <span class="field-error" id="patientTermsError"></span>
            </div>
          </div>
          
          <button type="submit" class="btn" style="width:100%;padding:12px;font-size:16px;margin-top:16px;">Create Account</button>
        </form>
        
        <div style="text-align:center;margin-top:16px;padding-top:16px;border-top:1px solid #eee;">
          <p style="color:var(--muted);font-size:14px;">Already have an account? <a href="#" onclick="showLogin()">Login</a></p>
        </div>
      </div>
    </section>

    <!-- Doctor Registration -->
    <section id="doctorRegister" class="screen">
      <div class="card" style="max-width:500px;margin:40px auto;">
        <div style="text-align:center;margin-bottom:24px;">
          <h2>Doctor Registration</h2>
          <p style="color:var(--muted);margin:8px 0;">Join our platform to manage patient bookings</p>
        </div>
        
        <form id="doctorRegisterForm" onsubmit="registerDoctor(); return false;">
          <div class="form-row">
            <div class="form-group">
              <label for="doctorFullName">Full Name *</label>
              <input type="text" id="doctorFullName" name="fullName" placeholder="Dr. Name" required />
              <span class="field-error" id="doctorFullNameError"></span>
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="doctorEmail">Email *</label>
              <input type="email" id="doctorEmail" name="email" placeholder="doctor@clinic.com" required />
              <span class="field-error" id="doctorEmailError"></span>
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="doctorMobile">Mobile Number *</label>
              <input type="tel" id="doctorMobile" name="mobile" placeholder="+91 98765 43210" required pattern="[+][0-9]{2}[0-9]{10}" />
              <span class="field-error" id="doctorMobileError"></span>
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="doctorLicense">Medical License No *</label>
              <input type="text" id="doctorLicense" name="license" placeholder="Enter license number" required />
              <span class="field-error" id="doctorLicenseError"></span>
            </div>
          </div>
          
          <div class="form-row" style="display:flex;gap:12px;">
            <div class="form-group" style="flex:2;">
              <label for="doctorSpecialization">Specialization *</label>
              <select id="doctorSpecialization" name="specialization" required>
                <option value="">Select Specialization</option>
                <option value="fertility">Fertility Specialist</option>
                <option value="embryology">Embryologist</option>
                <option value="gynecology">Gynecologist</option>
                <option value="andrology">Andrologist</option>
                <option value="genetics">Genetic Counselor</option>
                <option value="endocrinology">Reproductive Endocrinologist</option>
                <option value="general">General Practitioner</option>
              </select>
              <span class="field-error" id="doctorSpecializationError"></span>
            </div>
            <div class="form-group" style="flex:1;">
              <label for="doctorExperience">Years of Experience *</label>
              <input type="number" id="doctorExperience" name="experience" placeholder="5" min="0" max="50" required />
              <span class="field-error" id="doctorExperienceError"></span>
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="doctorClinicName">Clinic Name *</label>
              <input type="text" id="doctorClinicName" name="clinicName" placeholder="Clinic/Hospital Name" required />
              <span class="field-error" id="doctorClinicNameError"></span>
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="doctorClinicAddress">Clinic Address *</label>
              <textarea id="doctorClinicAddress" name="clinicAddress" rows="2" placeholder="Enter clinic address" required></textarea>
              <span class="field-error" id="doctorClinicAddressError"></span>
            </div>
          </div>
          
          <div class="form-row" style="display:flex;gap:12px;">
            <div class="form-group" style="flex:2;">
              <label for="doctorCity">City *</label>
              <input type="text" id="doctorCity" name="city" placeholder="Enter city" required />
              <span class="field-error" id="doctorCityError"></span>
            </div>
            <div class="form-group" style="flex:1;">
              <label for="doctorPincode">Pin Code *</label>
              <input type="text" id="doctorPincode" name="pincode" placeholder="123456" required pattern="[0-9]{6}" />
              <span class="field-error" id="doctorPincodeError"></span>
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="doctorState">State *</label>
              <select id="doctorState" name="state" required>
                <option value="">Select State</option>
                <option value="AP">Andhra Pradesh</option>
                <option value="AR">Arunachal Pradesh</option>
                <option value="AS">Assam</option>
                <option value="BR">Bihar</option>
                <option value="CG">Chhattisgarh</option>
                <option value="GA">Goa</option>
                <option value="GJ">Gujarat</option>
                <option value="HR">Haryana</option>
                <option value="HP">Himachal Pradesh</option>
                <option value="JK">Jammu and Kashmir</option>
                <option value="JH">Jharkhand</option>
                <option value="KA">Karnataka</option>
                <option value="KL">Kerala</option>
                <option value="MP">Madhya Pradesh</option>
                <option value="MH">Maharashtra</option>
                <option value="MN">Manipur</option>
                <option value="ML">Meghalaya</option>
                <option value="MZ">Mizoram</option>
                <option value="NL">Nagaland</option>
                <option value="OR">Odisha</option>
                <option value="PB">Punjab</option>
                <option value="RJ">Rajasthan</option>
                <option value="SK">Sikkim</option>
                <option value="TN">Tamil Nadu</option>
                <option value="TG">Telangana</option>
                <option value="TR">Tripura</option>
                <option value="UP">Uttar Pradesh</option>
                <option value="UT">Uttarakhand</option>
                <option value="WB">West Bengal</option>
                <option value="DL">Delhi</option>
              </select>
              <span class="field-error" id="doctorStateError"></span>
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="doctorPassword">Password *</label>
              <input type="password" id="doctorPassword" name="password" placeholder="Create password" required onkeyup="checkPasswordStrength('doctor')" />
              <div class="password-strength" id="doctorPasswordStrength"></div>
              <span class="field-error" id="doctorPasswordError"></span>
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="doctorConfirmPassword">Confirm Password *</label>
              <input type="password" id="doctorConfirmPassword" name="confirmPassword" placeholder="Confirm password" required onkeyup="checkPasswordMatch('doctor')" />
              <span class="field-error" id="doctorConfirmPasswordError"></span>
            </div>
          </div>
          
          <div class="form-row">
            <div class="checkbox-group">
              <label class="checkbox-option">
                <input type="checkbox" id="doctorTerms" name="terms" required />
                <span>I agree to the <a href="#" onclick="showTerms()">Terms & Conditions</a></span>
              </label>
              <span class="field-error" id="doctorTermsError"></span>
            </div>
          </div>
          
          <button type="submit" class="btn" style="width:100%;padding:12px;font-size:16px;margin-top:16px;">Register Doctor</button>
        </form>
        
        <div style="text-align:center;margin-top:16px;padding-top:16px;border-top:1px solid #eee;">
          <p style="color:var(--muted);font-size:14px;">Already registered? <a href="#" onclick="showLogin()">Login</a></p>
        </div>
      </div>
    </section>

    <!-- Lab Registration -->
    <section id="labRegister" class="screen">
      <div class="card" style="max-width:500px;margin:40px auto;">
        <div style="text-align:center;margin-bottom:24px;">
          <h2>Lab Registration</h2>
          <p style="color:var(--muted);margin:8px 0;">Register your lab to serve patients and doctors</p>
        </div>
        
        <form id="labRegisterForm" onsubmit="registerLab(); return false;">
          <div class="form-row">
            <div class="form-group">
              <label for="labName">Lab Name *</label>
              <input type="text" id="labName" name="labName" placeholder="Lab/Hospital Name" required />
              <span class="field-error" id="labNameError"></span>
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="labEmail">Registered Email *</label>
              <input type="email" id="labEmail" name="email" placeholder="info@lab.com" required />
              <span class="field-error" id="labEmailError"></span>
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="labContact">Contact Number *</label>
              <input type="tel" id="labContact" name="contactNumber" placeholder="+91 98765 43210" required pattern="[+][0-9]{2}[0-9]{10}" />
              <span class="field-error" id="labContactError"></span>
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="labLicense">Lab License No *</label>
              <input type="text" id="labLicense" name="labLicense" placeholder="Enter lab license number" required />
              <span class="field-error" id="labLicenseError"></span>
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="labAddress">Lab Address *</label>
              <textarea id="labAddress" name="labAddress" rows="2" placeholder="Enter lab address" required></textarea>
              <span class="field-error" id="labAddressError"></span>
            </div>
          </div>
          
          <div class="form-row" style="display:flex;gap:12px;">
            <div class="form-group" style="flex:2;">
              <label for="labCity">City *</label>
              <input type="text" id="labCity" name="city" placeholder="Enter city" required />
              <span class="field-error" id="labCityError"></span>
            </div>
            <div class="form-group" style="flex:1;">
              <label for="labPincode">Pin Code *</label>
              <input type="text" id="labPincode" name="pincode" placeholder="123456" required pattern="[0-9]{6}" />
              <span class="field-error" id="labPincodeError"></span>
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="labState">State *</label>
              <select id="labState" name="state" required>
                <option value="">Select State</option>
                <option value="AP">Andhra Pradesh</option>
                <option value="AR">Arunachal Pradesh</option>
                <option value="AS">Assam</option>
                <option value="BR">Bihar</option>
                <option value="CG">Chhattisgarh</option>
                <option value="GA">Goa</option>
                <option value="GJ">Gujarat</option>
                <option value="HR">Haryana</option>
                <option value="HP">Himachal Pradesh</option>
                <option value="JK">Jammu and Kashmir</option>
                <option value="JH">Jharkhand</option>
                <option value="KA">Karnataka</option>
                <option value="KL">Kerala</option>
                <option value="MP">Madhya Pradesh</option>
                <option value="MH">Maharashtra</option>
                <option value="MN">Manipur</option>
                <option value="ML">Meghalaya</option>
                <option value="MZ">Mizoram</option>
                <option value="NL">Nagaland</option>
                <option value="OR">Odisha</option>
                <option value="PB">Punjab</option>
                <option value="RJ">Rajasthan</option>
                <option value="SK">Sikkim</option>
                <option value="TN">Tamil Nadu</option>
                <option value="TG">Telangana</option>
                <option value="TR">Tripura</option>
                <option value="UP">Uttar Pradesh</option>
                <option value="UT">Uttarakhand</option>
                <option value="WB">West Bengal</option>
                <option value="DL">Delhi</option>
              </select>
              <span class="field-error" id="labStateError"></span>
            </div>
          </div>
          
          <div class="form-row" style="display:flex;gap:12px;">
            <div class="form-group" style="flex:2;">
              <label for="labContactPerson">Contact Person Name *</label>
              <input type="text" id="labContactPerson" name="contactPerson" placeholder="Contact person name" required />
              <span class="field-error" id="labContactPersonError"></span>
            </div>
            <div class="form-group" style="flex:1;">
              <label for="labContactRole">Contact Person Role *</label>
              <select id="labContactRole" name="contactRole" required>
                <option value="">Select Role</option>
                <option value="owner">Owner</option>
                <option value="manager">Manager</option>
                <option value="director">Director</option>
                <option value="admin">Administrator</option>
              </select>
              <span class="field-error" id="labContactRoleError"></span>
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label>Lab Type *</label>
              <div class="radio-group">
                <label class="radio-option"><input type="radio" name="labType" value="full-service" required /> Full Service IVF Lab</label>
                <label class="radio-option"><input type="radio" name="labType" value="embryology" required /> Embryology Only</label>
                <label class="radio-option"><input type="radio" name="labType" value="diagnostics" required /> Diagnostics Only</label>
              </div>
              <span class="field-error" id="labTypeError"></span>
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label>Services For *</label>
              <div class="checkbox-group">
                <label class="checkbox-option">
                  <input type="checkbox" name="servicesFor" value="patients" checked />
                  <span>Patients</span>
                </label>
                <label class="checkbox-option">
                  <input type="checkbox" name="servicesFor" value="doctors" checked />
                  <span>Doctors</span>
                </label>
              </div>
              <span class="field-error" id="labServicesForError"></span>
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="labPassword">Password *</label>
              <input type="password" id="labPassword" name="password" placeholder="Create password" required onkeyup="checkPasswordStrength('lab')" />
              <div class="password-strength" id="labPasswordStrength"></div>
              <span class="field-error" id="labPasswordError"></span>
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="labConfirmPassword">Confirm Password *</label>
              <input type="password" id="labConfirmPassword" name="confirmPassword" placeholder="Confirm password" required onkeyup="checkPasswordMatch('lab')" />
              <span class="field-error" id="labConfirmPasswordError"></span>
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="labCertificate">Upload Lab Certificate (Optional)</label>
              <input type="file" id="labCertificate" name="certificate" accept=".pdf,.jpg,.jpeg,.png" style="padding:8px;" />
              <span style="font-size:12px;color:var(--muted);">Accepted formats: PDF, JPG, PNG</span>
            </div>
          </div>
          
          <div class="form-row">
            <div class="checkbox-group">
              <label class="checkbox-option">
                <input type="checkbox" id="labTerms" name="terms" required />
                <span>I agree to the <a href="#" onclick="showTerms()">Terms & Conditions</a></span>
              </label>
              <span class="field-error" id="labTermsError"></span>
            </div>
          </div>
          
          <button type="submit" class="btn" style="width:100%;padding:12px;font-size:16px;margin-top:16px;">Register IVF Lab</button>
        </form>
        
        <div style="text-align:center;margin-top:16px;padding-top:16px;border-top:1px solid #eee;">
          <p style="color:var(--muted);font-size:14px;">Already listed? <a href="#" onclick="showLogin()">Login</a></p>
        </div>
      </div>
    </section>

    <!-- Admin Registration -->
    <section id="adminRegister" class="screen">
      <div class="card" style="max-width:400px;margin:40px auto;">
        <div style="text-align:center;margin-bottom:24px;">
          <h2>Admin Registration</h2>
          <p style="color:var(--muted);margin:8px 0;">Create admin account for platform management</p>
        </div>
        
        <form id="adminRegisterForm" onsubmit="registerAdmin(); return false;">
          <div class="form-row">
            <div class="form-group">
              <label for="adminFullName">Full Name *</label>
              <input type="text" id="adminFullName" name="fullName" placeholder="Enter your full name" required />
              <span class="field-error" id="adminFullNameError"></span>
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="adminEmail">Email Address *</label>
              <input type="email" id="adminEmail" name="email" placeholder="admin@embrion.com" required />
              <span class="field-error" id="adminEmailError"></span>
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="adminPassword">Password *</label>
              <input type="password" id="adminPassword" name="password" placeholder="Create secure password" required onkeyup="checkPasswordStrength('admin')" />
              <div class="password-strength" id="adminPasswordStrength"></div>
              <span class="field-error" id="adminPasswordError"></span>
            </div>
          </div>
          
          <button type="submit" class="btn" style="width:100%;padding:12px;font-size:16px;margin-top:16px;">Register</button>
        </form>
        
        <div style="text-align:center;margin-top:16px;padding-top:16px;border-top:1px solid #eee;">
          <p style="color:var(--muted);font-size:14px;">Already have an admin account? <a href="#" onclick="showAdminLogin()">Login</a></p>
        </div>
      </div>
    </section>

    <!-- Admin Login -->
    <section id="adminLogin" class="screen">
      <div class="card" style="max-width:400px;margin:40px auto;">
        <div style="text-align:center;margin-bottom:24px;">
          <h2>Admin Login</h2>
          <p style="color:var(--muted);margin:8px 0;">Access admin dashboard</p>
        </div>
        
        <form id="adminLoginForm" onsubmit="loginAdmin(); return false;">
          <div class="form-row">
            <div class="form-group">
              <label for="adminLoginEmail">Email Address *</label>
              <input type="email" id="adminLoginEmail" name="email" placeholder="admin@embrion.com" required />
              <span class="field-error" id="adminLoginEmailError"></span>
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="adminLoginPassword">Password *</label>
              <input type="password" id="adminLoginPassword" name="password" placeholder="Enter password" required />
              <span class="field-error" id="adminLoginPasswordError"></span>
            </div>
          </div>
          
          <button type="submit" class="btn" style="width:100%;padding:12px;font-size:16px;margin-top:16px;">Login</button>
        </form>
        
        <div style="text-align:center;margin-top:16px;padding-top:16px;border-top:1px solid #eee;">
          <p style="color:var(--muted);font-size:14px;">Need to create admin account? <a href="#" onclick="showAdminRegister()">Register</a> | <a href="#" onclick="showLogin()">Back to Main Login</a></p>
        </div>
      </div>
    </section>

    <!-- Admin Dashboard Main -->
    <section id="adminDashboard" class="screen">
      <!-- Admin Header -->
      <div class="admin-header">
        <div class="admin-header-content">
          <h1>Platform Admin Dashboard</h1>
          <div class="admin-header-actions">
            <span class="admin-welcome">Welcome, <span id="adminUserName">Platform Admin</span></span>
            <button class="btn-secondary" onclick="logout()">Logout</button>
          </div>
        </div>
      </div>

      <!-- Admin Main Content -->
      <div class="admin-main">
        <!-- Sidebar Navigation -->
        <div class="admin-sidebar">
          <div class="admin-nav-tabs">
            <button class="admin-nav-tab active" onclick="showAdminTab('manageServices')" id="manageServicesTab">
              <span class="nav-icon">üîß</span> Manage Services
            </button>
            <button class="admin-nav-tab" onclick="showAdminTab('scheduleCapacity')" id="scheduleCapacityTab">
              <span class="nav-icon">üìÖ</span> Schedule & Capacity
            </button>
            <button class="admin-nav-tab" onclick="showAdminTab('bookingsOverview')" id="bookingsOverviewTab">
              <span class="nav-icon">üìä</span> Bookings Overview
            </button>
            <button class="admin-nav-tab" onclick="showAdminTab('reports')" id="reportsTab">
              <span class="nav-icon">üìà</span> Reports
            </button>
            <button class="admin-nav-tab" onclick="showAdminTab('userRoles')" id="userRolesTab">
              <span class="nav-icon">üë•</span> User Roles
            </button>
            <button class="admin-nav-tab" onclick="showAdminTab('manageUsers')" id="manageUsersTab">
              <span class="nav-icon">üë§</span> Manage Users
            </button>
            <button class="admin-nav-tab" onclick="showAdminTab('supportTickets')" id="supportTicketsTab">
              <span class="nav-icon">üé´</span> Support Tickets
            </button>
          </div>
        </div>

        <!-- Content Area -->
        <div class="admin-content-area">
          
          <!-- Manage Services Tab -->
          <div id="manageServices" class="admin-tab-content active">
            <div class="admin-tab-header">
              <h2 class="admin-tab-title">Manage Services</h2>
              <div class="admin-tab-actions">
                <button class="btn" onclick="openModal('addServiceModal')">+ Add Service</button>
              </div>
            </div>
            
            <div class="admin-table-container">
              <table class="admin-table">
                <thead>
                  <tr>
                    <th>Code</th>
                    <th>Name</th>
                    <th>Price</th>
                    <th>Currency</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="servicesTableBody">
                  <tr>
                    <td>HP01</td>
                    <td>Health Panel</td>
                    <td>2,000</td>
                    <td>INR</td>
                    <td>
                      <button class="admin-action-btn edit" onclick="editService('HP01')">Edit</button>
                      <button class="admin-action-btn delete" onclick="deleteService('HP01')">Del</button>
                    </td>
                  </tr>
                  <tr>
                    <td>GNT01</td>
                    <td>Genetic Testing</td>
                    <td>5,500</td>
                    <td>INR</td>
                    <td>
                      <button class="admin-action-btn edit" onclick="editService('GNT01')">Edit</button>
                      <button class="admin-action-btn delete" onclick="deleteService('GNT01')">Del</button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>

          <!-- Schedule & Capacity Tab -->  
          <div id="scheduleCapacity" class="admin-tab-content">
            <div class="admin-tab-header">
              <h2 class="admin-tab-title">Schedule & Capacity</h2>
              <div class="admin-tab-actions">
                <button class="btn" onclick="saveScheduleSettings()">Save Changes</button>
              </div>
            </div>
            
            <div class="schedule-settings-panel">
              <div class="schedule-row">
                <div class="schedule-field">
                  <label>Working Hours:</label>
                  <div class="time-range">
                    <input type="time" id="workingHoursStart" value="08:00" />
                    <span>to</span>
                    <input type="time" id="workingHoursEnd" value="18:00" />
                  </div>
                </div>
                <div class="schedule-field">
                  <label>Slot Length:</label>
                  <div class="number-input">
                    <input type="number" id="slotLength" value="30" min="15" max="120" />
                    <span>minutes</span>
                  </div>
                </div>
                <div class="schedule-field">
                  <label>Slots per Time:</label>
                  <input type="number" id="slotsPerTime" value="4" min="1" max="20" />
                </div>
              </div>
              
              <div class="schedule-row">
                <div class="schedule-field">
                  <label>Recurring Holidays:</label>
                  <select multiple id="recurringHolidays">
                    <option value="sundays">Sundays</option>
                    <option value="national">National Holidays</option>
                  </select>
                </div>
                <div class="schedule-field">
                  <label>Maintenance Windows:</label>
                  <button class="btn-secondary" onclick="addMaintenanceWindow()">Add Time Range</button>
                </div>
                <div class="schedule-field">
                  <label>One-off Closures:</label>
                  <button class="btn-secondary" onclick="addClosure()">Add Date</button>
                </div>
              </div>
            </div>
            
            <div class="capacity-visualization">
              <h3>Capacity Utilization (Weekly)</h3>
              <div class="capacity-chart">
                <div class="chart-placeholder">üìä Chart Placeholder</div>
              </div>
            </div>
          </div>

          <!-- Manage Bookings Tab -->
          <div id="bookingsOverview" class="admin-tab-content">
            <div class="admin-tab-header">
              <h2 class="admin-tab-title">Manage Bookings</h2>
              <div class="admin-tab-actions">
                <button class="btn-secondary" onclick="applyBookingFilters()">Filter</button>
                <button class="btn-secondary" onclick="exportBookings()">Export CSV</button>
              </div>
            </div>
            
            <!-- Booking Status Tabs -->
            <div class="booking-status-tabs">
              <button class="booking-status-tab active" onclick="showBookingStatusTab('all')">All Bookings</button>
              <button class="booking-status-tab" onclick="showBookingStatusTab('upcoming')">Upcoming</button>
              <button class="booking-status-tab" onclick="showBookingStatusTab('completed')">Completed</button>
              <button class="booking-status-tab" onclick="showBookingStatusTab('cancelled')">Cancelled</button>
            </div>
            
            <!-- Booking Filters -->
            <div class="booking-filters">
              <div class="filter-row">
                <div class="filter-group">
                  <label>Date Range:</label>
                  <input type="date" id="bookingDateFrom" />
                  <span>to</span>
                  <input type="date" id="bookingDateTo" />
                </div>
                <div class="filter-group">
                  <label>Status:</label>
                  <select id="bookingStatusFilter">
                    <option value="">All Status</option>
                    <option value="upcoming">Upcoming</option>
                    <option value="completed">Completed</option>
                    <option value="cancelled">Cancelled</option>
                  </select>
                </div>
                <div class="filter-group">
                  <label>Lab:</label>
                  <select id="bookingLabFilter">
                    <option value="">All Labs</option>
                    <option value="ivf1">IVF Center Mumbai</option>
                    <option value="ivf2">Advanced Fertility Delhi</option>
                  </select>
                </div>
                <div class="filter-group">
                  <label>Doctor:</label>
                  <select id="bookingDoctorFilter">
                    <option value="">All Doctors</option>
                    <option value="dr-verma">Dr. Anand Verma</option>
                    <option value="dr-sharma">Dr. Priya Sharma</option>
                  </select>
                </div>
              </div>
              <div class="filter-row">
                <div class="filter-group search-group">
                  <label>Search:</label>
                  <input type="text" id="bookingSearchInput" placeholder="Patient name, email, or Booking ID" />
                  <button class="search-btn" onclick="searchBookings()">üîç</button>
                </div>
              </div>
            </div>
            
            <!-- Bookings Table -->
            <div class="admin-table-container">
              <table class="admin-table">
                <thead>
                  <tr>
                    <th>Booking ID</th>
                    <th>Patient</th>
                    <th>Doctor</th>
                    <th>Lab</th>
                    <th>Date/Time</th>
                    <th>Status</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="bookingsTableBody">
                  <tr>
                    <td>BK1023</td>
                    <td>Priya Shah</td>
                    <td>Dr. Anand Verma</td>
                    <td>IVF Center Mumbai</td>
                    <td>Jul 2, 10:00 AM</td>
                    <td><span class="status-badge upcoming">Upcoming</span></td>
                    <td>
                      <button class="admin-action-btn view" onclick="viewBookingDetails('BK1023')">View</button>
                    </td>
                  </tr>
                  <tr>
                    <td>BK1024</td>
                    <td>Nikhil Kumar</td>
                    <td>Dr. Priya Sharma</td>
                    <td>Advanced Fertility Delhi</td>
                    <td>Jul 5, 3:00 PM</td>
                    <td><span class="status-badge upcoming">Upcoming</span></td>
                    <td>
                      <button class="admin-action-btn view" onclick="viewBookingDetails('BK1024')">View</button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>

          <!-- Reports Tab -->
          <div id="reports" class="admin-tab-content">
            <div class="admin-tab-header">
              <h2 class="admin-tab-title">Reports & Analytics</h2>
              <div class="admin-tab-actions">
                <button class="btn" onclick="generateAllReports()">Generate Reports</button>
                <button class="btn-secondary" onclick="exportReportsPDF()">Export PDF</button>
              </div>
            </div>
            
            <!-- Key Metrics Dashboard -->
            <div class="metrics-overview" style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:20px;margin-bottom:32px;">
              <div class="metric-card" style="background:linear-gradient(135deg,var(--primary),#003d99);color:#fff;padding:24px;border-radius:var(--radius);text-align:center;">
                <div class="metric-value" style="font-size:32px;font-weight:700;margin-bottom:8px;">2,487</div>
                <div class="metric-label" style="font-size:14px;opacity:0.9;">Total Bookings</div>
                <div class="metric-change" style="font-size:12px;margin-top:8px;opacity:0.8;">+12% from last month</div>
              </div>
              <div class="metric-card" style="background:linear-gradient(135deg,var(--accent),#e6790d);color:#fff;padding:24px;border-radius:var(--radius);text-align:center;">
                <div class="metric-value" style="font-size:32px;font-weight:700;margin-bottom:8px;">‚Çπ4.2L</div>
                <div class="metric-label" style="font-size:14px;opacity:0.9;">Monthly Revenue</div>
                <div class="metric-change" style="font-size:12px;margin-top:8px;opacity:0.8;">+8% from last month</div>
              </div>
              <div class="metric-card" style="background:linear-gradient(135deg,#28a745,#20923a);color:#fff;padding:24px;border-radius:var(--radius);text-align:center;">
                <div class="metric-value" style="font-size:32px;font-weight:700;margin-bottom:8px;">78%</div>
                <div class="metric-label" style="font-size:14px;opacity:0.9;">Avg Utilization</div>
                <div class="metric-change" style="font-size:12px;margin-top:8px;opacity:0.8;">+5% from last month</div>
              </div>
              <div class="metric-card" style="background:linear-gradient(135deg,#17a2b8,#138496);color:#fff;padding:24px;border-radius:var(--radius);text-align:center;">
                <div class="metric-value" style="font-size:32px;font-weight:700;margin-bottom:8px;">4.8</div>
                <div class="metric-label" style="font-size:14px;opacity:0.9;">Avg Rating</div>
                <div class="metric-change" style="font-size:12px;margin-top:8px;opacity:0.8;">+0.2 from last month</div>
              </div>
            </div>

            <!-- Weekly Capacity Utilization Chart -->
            <div class="capacity-visualization" style="background:var(--bg);padding:32px;border-radius:var(--radius);box-shadow:var(--shadow);margin-bottom:32px;">
              <h3 style="margin:0 0 24px 0;font-size:20px;font-weight:600;color:var(--text);">Weekly Capacity Utilization</h3>
              <div class="capacity-chart" style="display:flex;align-items:end;height:240px;gap:16px;padding:20px;background:#f8f9fa;border-radius:var(--radius);position:relative;">
                <div class="chart-bar" style="flex:1;background:linear-gradient(135deg,var(--primary),#003d99);height:65%;display:flex;flex-direction:column;justify-content:space-between;align-items:center;padding:12px 8px;color:white;border-radius:6px 6px 0 0;transition:all 0.3s ease;box-shadow:0 2px 8px rgba(0,82,204,0.3);">
                  <span class="bar-value" style="font-weight:700;font-size:16px;">65%</span>
                  <span class="bar-label" style="font-size:13px;font-weight:500;margin-top:8px;">Mon</span>
                </div>
                <div class="chart-bar" style="flex:1;background:linear-gradient(135deg,var(--primary),#003d99);height:80%;display:flex;flex-direction:column;justify-content:space-between;align-items:center;padding:12px 8px;color:white;border-radius:6px 6px 0 0;transition:all 0.3s ease;box-shadow:0 2px 8px rgba(0,82,204,0.3);">
                  <span class="bar-value" style="font-weight:700;font-size:16px;">80%</span>
                  <span class="bar-label" style="font-size:13px;font-weight:500;margin-top:8px;">Tue</span>
                </div>
                <div class="chart-bar" style="flex:1;background:linear-gradient(135deg,var(--primary),#003d99);height:75%;display:flex;flex-direction:column;justify-content:space-between;align-items:center;padding:12px 8px;color:white;border-radius:6px 6px 0 0;transition:all 0.3s ease;box-shadow:0 2px 8px rgba(0,82,204,0.3);">
                  <span class="bar-value" style="font-weight:700;font-size:16px;">75%</span>
                  <span class="bar-label" style="font-size:13px;font-weight:500;margin-top:8px;">Wed</span>
                </div>
                <div class="chart-bar" style="flex:1;background:linear-gradient(135deg,var(--accent),#e6790d);height:90%;display:flex;flex-direction:column;justify-content:space-between;align-items:center;padding:12px 8px;color:white;border-radius:6px 6px 0 0;transition:all 0.3s ease;box-shadow:0 2px 8px rgba(255,140,0,0.3);">
                  <span class="bar-value" style="font-weight:700;font-size:16px;">90%</span>
                  <span class="bar-label" style="font-size:13px;font-weight:500;margin-top:8px;">Thu</span>
                </div>
                <div class="chart-bar" style="flex:1;background:linear-gradient(135deg,var(--accent),#e6790d);height:85%;display:flex;flex-direction:column;justify-content:space-between;align-items:center;padding:12px 8px;color:white;border-radius:6px 6px 0 0;transition:all 0.3s ease;box-shadow:0 2px 8px rgba(255,140,0,0.3);">
                  <span class="bar-value" style="font-weight:700;font-size:16px;">85%</span>
                  <span class="bar-label" style="font-size:13px;font-weight:500;margin-top:8px;">Fri</span>
                </div>
                <div class="chart-bar" style="flex:1;background:linear-gradient(135deg,var(--primary),#003d99);height:45%;display:flex;flex-direction:column;justify-content:space-between;align-items:center;padding:12px 8px;color:white;border-radius:6px 6px 0 0;transition:all 0.3s ease;box-shadow:0 2px 8px rgba(0,82,204,0.3);">
                  <span class="bar-value" style="font-weight:700;font-size:16px;">45%</span>
                  <span class="bar-label" style="font-size:13px;font-weight:500;margin-top:8px;">Sat</span>
                </div>
                <div class="chart-bar" style="flex:1;background:linear-gradient(135deg,#6c757d,#5a6268);height:20%;display:flex;flex-direction:column;justify-content:space-between;align-items:center;padding:12px 8px;color:white;border-radius:6px 6px 0 0;transition:all 0.3s ease;box-shadow:0 2px 8px rgba(108,117,125,0.3);">
                  <span class="bar-value" style="font-weight:700;font-size:16px;">20%</span>
                  <span class="bar-label" style="font-size:13px;font-weight:500;margin-top:8px;">Sun</span>
                </div>
              </div>
            </div>
            
            <!-- Report Generation Cards -->
            <div class="reports-grid">
              <div class="report-card" style="background:var(--bg);border:1px solid #f0f2f5;border-radius:var(--radius);padding:24px;text-align:center;transition:all 0.3s ease;">
                <div class="report-icon" style="font-size:48px;margin-bottom:16px;">üìä</div>
                <h4 style="margin:0 0 12px 0;font-size:18px;font-weight:600;color:var(--text);">Revenue Report</h4>
                <p style="margin:0 0 20px 0;color:var(--muted);line-height:1.4;">Generate detailed revenue analytics and financial performance metrics</p>
                <button class="btn" onclick="generateReport('revenue')" style="width:100%;">Generate Report</button>
              </div>
              <div class="report-card" style="background:var(--bg);border:1px solid #f0f2f5;border-radius:var(--radius);padding:24px;text-align:center;transition:all 0.3s ease;">
                <div class="report-icon" style="font-size:48px;margin-bottom:16px;">‚ö°</div>
                <h4 style="margin:0 0 12px 0;font-size:18px;font-weight:600;color:var(--text);">Utilization Report</h4>
                <p style="margin:0 0 20px 0;color:var(--muted);line-height:1.4;">View capacity utilization metrics and operational efficiency data</p>
                <button class="btn" onclick="generateReport('utilization')" style="width:100%;">Generate Report</button>
              </div>
              <div class="report-card" style="background:var(--bg);border:1px solid #f0f2f5;border-radius:var(--radius);padding:24px;text-align:center;transition:all 0.3s ease;">
                <div class="report-icon" style="font-size:48px;margin-bottom:16px;">üìã</div>
                <h4 style="margin:0 0 12px 0;font-size:18px;font-weight:600;color:var(--text);">No-show Rate</h4>
                <p style="margin:0 0 20px 0;color:var(--muted);line-height:1.4;">Analyze patient no-show patterns and attendance trends</p>
                <button class="btn" onclick="generateReport('noshow')" style="width:100%;">Generate Report</button>
              </div>
            </div>
          </div>

          <!-- User Roles Tab -->
          <div id="userRoles" class="admin-tab-content">
            <div class="admin-tab-header">
              <h2 class="admin-tab-title">User Roles</h2>
              <div class="admin-tab-actions">
                <button class="btn" onclick="openModal('addRoleModal')">+ Add Role</button>
              </div>
            </div>
            
            <div class="admin-table-container">
              <table class="admin-table">
                <thead>
                  <tr>
                    <th>Role Name</th>
                    <th>Users Count</th>
                    <th>Permissions</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>Super-admin</td>
                    <td>2</td>
                    <td><span class="permission-badge">All</span></td>
                    <td>
                      <button class="admin-action-btn edit" onclick="editRole('super-admin')">Edit</button>
                    </td>
                  </tr>
                  <tr>
                    <td>Staff</td>
                    <td>5</td>
                    <td><span class="permission-badge">Manage Bookings</span></td>
                    <td>
                      <button class="admin-action-btn edit" onclick="editRole('staff')">Edit</button>
                    </td>
                  </tr>
                  <tr>
                    <td>Billing</td>
                    <td>1</td>
                    <td><span class="permission-badge">View Reports</span></td>
                    <td>
                      <button class="admin-action-btn edit" onclick="editRole('billing')">Edit</button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>

          <!-- Manage Users Tab -->
          <div id="manageUsers" class="admin-tab-content">
            <div class="admin-tab-header">
              <h2 class="admin-tab-title">Manage Users</h2>
            </div>
            
            <!-- User Type Tabs -->
            <div class="user-type-tabs">
              <button class="user-type-tab active" onclick="showUserTypeTab('patients')">Patients</button>
              <button class="user-type-tab" onclick="showUserTypeTab('doctors')">Doctors</button>  
              <button class="user-type-tab" onclick="showUserTypeTab('labs')">IVF Labs</button>
            </div>
            
            <!-- Search and Filter -->
            <div class="user-management-controls">
              <div class="search-container">
                <input type="text" id="userSearchInput" placeholder="Search by name/email" />
                <button class="search-btn" onclick="searchUsers()">üîç</button>
              </div>
              <div class="filter-container">
                <select id="userRoleFilter">
                  <option value="">Filter by Role</option>
                  <option value="patient">Patient</option>
                  <option value="doctor">Doctor</option>
                  <option value="lab">Lab</option>
                </select>
                <select id="userStatusFilter">
                  <option value="">All Status</option>
                  <option value="active">Active</option>
                  <option value="pending">Pending</option>
                  <option value="suspended">Suspended</option>
                </select>
              </div>
            </div>
            
            <!-- Users Table -->
            <div class="admin-table-container">
              <div id="patientsTable" class="user-table active">
                <table class="admin-table">
                  <thead>
                    <tr>
                      <th>Name</th>
                      <th>Email</th>
                      <th>Status</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td>Priya Shah</td>
                      <td>priya@example.com</td>
                      <td><span class="status-badge active">Active</span></td>
                      <td>
                        <button class="admin-action-btn view" onclick="viewUser('patient', 'priya')">View</button>
                        <button class="admin-action-btn edit" onclick="editUser('patient', 'priya')">Edit</button>
                        <button class="admin-action-btn suspend" onclick="suspendUser('patient', 'priya')">Suspend</button>
                        <button class="admin-action-btn delete" onclick="deleteUser('patient', 'priya')">Delete</button>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
              
              <div id="doctorsTable" class="user-table">
                <table class="admin-table">
                  <thead>
                    <tr>
                      <th>Name</th>
                      <th>Email</th>
                      <th>Status</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td>Dr. Anand Verma</td>
                      <td>verma@clinic.com</td>
                      <td><span class="status-badge active">Active</span></td>
                      <td>
                        <button class="admin-action-btn view" onclick="viewUser('doctor', 'verma')">View</button>
                        <button class="admin-action-btn edit" onclick="editUser('doctor', 'verma')">Edit</button>
                        <button class="admin-action-btn suspend" onclick="suspendUser('doctor', 'verma')">Suspend</button>
                        <button class="admin-action-btn delete" onclick="deleteUser('doctor', 'verma')">Delete</button>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
              
              <div id="labsTable" class="user-table">
                <table class="admin-table">
                  <thead>
                    <tr>
                      <th>Name</th>
                      <th>Email</th>
                      <th>Status</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td>IVF Expert Care</td>
                      <td>contact@ivflab.com</td>
                      <td><span class="status-badge pending">Pending</span></td>
                      <td>
                        <button class="admin-action-btn view" onclick="viewUser('lab', 'ivflab')">View</button>
                        <button class="admin-action-btn approve" onclick="approveUser('lab', 'ivflab')">Approve</button>
                        <button class="admin-action-btn reject" onclick="rejectUser('lab', 'ivflab')">Reject</button>
                        <button class="admin-action-btn delete" onclick="deleteUser('lab', 'ivflab')">Delete</button>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>

          <!-- Support Tickets Tab -->
          <div id="supportTickets" class="admin-tab-content">
            <div class="admin-tab-header">
              <h2 class="admin-tab-title">Support Tickets</h2>
              <div class="admin-tab-actions">
                <button class="btn" onclick="openModal('newTicketModal')">+ New Ticket</button>
              </div>
            </div>
            
            <div class="admin-table-container">
              <table class="admin-table">
                <thead>
                  <tr>
                    <th>ID</th>
                    <th>Subject</th>
                    <th>Status</th>
                    <th>Date</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr onclick="openTicketDetails('T1001')">
                    <td>T1001</td>
                    <td>Booking Issue</td>
                    <td><span class="ticket-status open">Open</span></td>
                    <td>2025-06-29</td>
                    <td>
                      <button class="admin-action-btn view" onclick="viewTicket('T1001')">View</button>
                    </td>
                  </tr>
                  <tr onclick="openTicketDetails('T0998')">
                    <td>T0998</td>
                    <td>Invoice Query</td>
                    <td><span class="ticket-status closed">Closed</span></td>
                    <td>2025-06-25</td>
                    <td>
                      <button class="admin-action-btn view" onclick="viewTicket('T0998')">View</button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>

          <!-- Schedule & Capacity Tab -->
          <div id="scheduleCapacity" class="admin-tab-content">
            <div class="admin-services-header">
              <h2>Schedule & Capacity</h2>
              <button class="btn">Save Changes</button>
            </div>
            <div class="schedule-panel">
              <div class="schedule-row">
                <div class="schedule-field">
                  <label>Working Hours:</label>
                  <div style="display:flex;gap:8px;align-items:center;">
                    <input type="time" value="08:00" />
                    <span>to</span>
                    <input type="time" value="18:00" />
                  </div>
                </div>
                <div class="schedule-field">
                  <label>Slot Length:</label>
                  <input type="number" value="30" /> <span>minutes</span>
                </div>
                <div class="schedule-field">
                  <label>Slots per Time:</label>
                  <input type="number" value="4" />
                </div>
              </div>
              <div class="schedule-row">
                <div class="schedule-field">
                  <label>Recurring Holidays:</label>
                  <select multiple>
                    <option>Sundays</option>
                    <option>National Holidays</option>
                  </select>
                </div>
                <div class="schedule-field">
                  <label>Maintenance Windows:</label>
                  <button class="btn-secondary">Add Time Range</button>
                </div>
                <div class="schedule-field">
                  <label>One-off Closures:</label>
                  <button class="btn-secondary">Add Date</button>
                </div>
              </div>
            </div>
            <div class="capacity-chart">
              <p>üìä Capacity Utilization Chart (Weekly)</p>
            </div>
          </div>

          <!-- Bookings Overview Tab -->
          <div id="bookingsOverview" class="admin-tab-content">
            <div class="admin-services-header">
              <h2>Manage Bookings</h2>
              <div style="display:flex;gap:8px;">
                <button class="btn-secondary" onclick="exportBookings()">Export CSV</button>
                <button class="btn" onclick="refreshBookings()">Refresh</button>
              </div>
            </div>
            
            <!-- Booking Status Tabs -->
            <div class="booking-status-tabs">
              <button class="booking-status-tab active" data-status="all" onclick="showBookingStatusTab('all')">All Bookings</button>
              <button class="booking-status-tab" data-status="upcoming" onclick="showBookingStatusTab('upcoming')">Upcoming</button>
              <button class="booking-status-tab" data-status="completed" onclick="showBookingStatusTab('completed')">Completed</button>
              <button class="booking-status-tab" data-status="cancelled" onclick="showBookingStatusTab('cancelled')">Cancelled</button>
            </div>
            
            <!-- Advanced Filters -->
            <div class="booking-filters-section">
              <div class="filter-row">
                <div class="filter-group">
                  <label>Date Range:</label>
                  <input type="date" id="bookingDateFrom" onchange="filterBookings()" />
                  <span>to</span>
                  <input type="date" id="bookingDateTo" onchange="filterBookings()" />
                </div>
                <div class="filter-group">
                  <label>Status:</label>
                  <select id="bookingStatusFilter" onchange="filterBookings()">
                    <option value="">All Status</option>
                    <option value="upcoming">Upcoming</option>
                    <option value="completed">Completed</option>
                    <option value="cancelled">Cancelled</option>
                    <option value="pending">Pending</option>
                  </select>
                </div>
                <div class="filter-group">
                  <label>Lab:</label>
                  <select id="bookingLabFilter" onchange="filterBookings()">
                    <option value="">All Labs</option>
                    <option value="ivf1">IVF Center Mumbai</option>
                    <option value="ivf2">Advanced Fertility Delhi</option>
                    <option value="ivf3">Fertility Plus Bangalore</option>
                  </select>
                </div>
              </div>
              <div class="filter-row">
                <div class="filter-group">
                  <label>Doctor:</label>
                  <select id="bookingDoctorFilter" onchange="filterBookings()">
                    <option value="">All Doctors</option>
                    <option value="dr-verma">Dr. Anand Verma</option>
                    <option value="dr-sharma">Dr. Priya Sharma</option>
                    <option value="dr-gupta">Dr. Rahul Gupta</option>
                  </select>
                </div>
                <div class="filter-group search-group">
                  <label>Search:</label>
                  <input type="text" id="bookingSearchInput" placeholder="Patient name, email, or Booking ID" onkeyup="searchBookings()" />
                  <button class="search-btn" onclick="searchBookings()">üîç</button>
                </div>
              </div>
            </div>
            
            <!-- Bookings Table -->
            <div class="bookings-table-container">
              <table class="bookings-table">
                <thead>
                  <tr>
                    <th>Booking ID</th>
                    <th>Patient</th>
                    <th>Doctor</th>
                    <th>Lab</th>
                    <th>Date & Time</th>
                    <th>Service</th>
                    <th>Status</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="bookingsTableBody">
                  <!-- Content will be populated by JavaScript -->
                </tbody>
              </table>
            </div>
            
            <!-- Pagination -->
            <div class="pagination-container">
              <div class="pagination-info">
                <span id="bookingsPaginationInfo">Showing 1-10 of 25 bookings</span>
              </div>
              <div class="pagination-controls">
                <button class="pagination-btn" onclick="previousBookingsPage()" id="prevBookingsBtn" disabled>Previous</button>
                <span class="pagination-numbers" id="bookingsPaginationNumbers">1 2 3</span>
                <button class="pagination-btn" onclick="nextBookingsPage()" id="nextBookingsBtn">Next</button>
              </div>
            </div>
          </div>

          <!-- Reports Tab -->
          <div id="reports" class="admin-tab-content">
            <div class="admin-services-header">
              <h2>Reports</h2>
              <div style="display:flex;gap:8px;">
                <button class="btn">Generate</button>
                <button class="btn-secondary">Export PDF</button>
              </div>
            </div>
            <div class="reports-grid">
              <div class="report-card">
                <h4>Revenue Report</h4>
                <p>Generate detailed revenue analytics</p>
                <button class="btn">Generate</button>
              </div>
              <div class="report-card">
                <h4>Utilization Report</h4>
                <p>View capacity utilization metrics</p>
                <button class="btn">Generate</button>
              </div>
              <div class="report-card">
                <h4>No-show Rate</h4>
                <p>Analyze patient no-show patterns</p>
                <button class="btn">Generate</button>
              </div>
            </div>
          </div>

          <!-- User Roles Tab -->
          <div id="userRoles" class="admin-tab-content">
            <div class="admin-services-header">
              <h2>User Roles</h2>
              <button class="btn" onclick="openAddRoleModal()">+ Add Role</button>
            </div>
            <table class="roles-table">
              <thead>
                <tr>
                  <th>Role Name</th>
                  <th>Users Count</th>
                  <th>Permissions</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>Super-admin</td>
                  <td>2</td>
                  <td>
                    <div class="role-permissions">
                      <span class="permission-badge">All</span>
                    </div>
                  </td>
                  <td>
                    <button class="service-action-btn service-edit-btn" onclick="editRole('super-admin')">Edit</button>
                  </td>
                </tr>
                <tr>
                  <td>Staff</td>
                  <td>5</td>
                  <td>
                    <div class="role-permissions">
                      <span class="permission-badge">Manage Bookings</span>
                    </div>
                  </td>
                  <td>
                    <button class="service-action-btn service-edit-btn" onclick="editRole('staff')">Edit</button>
                  </td>
                </tr>
                <tr>
                  <td>Billing</td>
                  <td>1</td>
                  <td>
                    <div class="role-permissions">
                      <span class="permission-badge">View Reports</span>
                    </div>
                  </td>
                  <td>
                    <button class="service-action-btn service-edit-btn" onclick="editRole('billing')">Edit</button>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>

          <!-- Manage Users Tab -->
          <div id="manageUsers" class="admin-tab-content">
            <div class="admin-services-header">
              <h2>Manage Users</h2>
            </div>
            
            <!-- User Type Tabs -->
            <div class="user-type-tabs">
              <button class="user-type-tab active" data-user-type="patients" onclick="showUserTypeTab('patients')">Patients</button>
              <button class="user-type-tab" data-user-type="doctors" onclick="showUserTypeTab('doctors')">Doctors</button>
              <button class="user-type-tab" data-user-type="labs" onclick="showUserTypeTab('labs')">IVF Labs</button>
            </div>
            
            <!-- Search and Filter Section -->
            <div class="user-management-controls">
              <div class="search-container">
                <input type="text" id="userSearchInput" placeholder="Search by name/email" class="search-input" />
                <button class="search-btn" onclick="searchUsers()">üîç</button>
              </div>
              <div class="filter-container">
                <select id="userStatusFilter" onchange="filterUsers()">
                  <option value="">All Status</option>
                  <option value="active">Active</option>
                  <option value="pending">Pending</option>
                  <option value="suspended">Suspended</option>
                  <option value="inactive">Inactive</option>
                </select>
              </div>
            </div>
            
            <!-- Users Table -->
            <div class="users-table-container">
              <table class="users-table">
                <thead>
                  <tr id="userTableHeader">
                    <th>Name</th>
                    <th>Email</th>
                    <th>Status</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="userTableBody">
                  <!-- Content will be populated by JavaScript -->
                </tbody>
              </table>
            </div>
          </div>

          <!-- Support Tickets Tab -->
          <div id="supportTickets" class="admin-tab-content">
            <div class="admin-services-header">
              <h2>Support Tickets</h2>
              <button class="btn" onclick="openNewTicketModal()">+ New Ticket</button>
            </div>
            <table class="tickets-table">
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Subject</th>
                  <th>Status</th>
                  <th>Date</th>
                  <th>Action</th>
                </tr>
              </thead>
              <tbody>
                <tr onclick="openTicketDetails('T1001')">
                  <td>T1001</td>
                  <td>Booking Issue</td>
                  <td><span class="ticket-status open">Open</span></td>
                  <td>2025-06-29</td>
                  <td>
                    <button class="service-action-btn service-edit-btn">View</button>
                  </td>
                </tr>
                <tr onclick="openTicketDetails('T0998')">
                  <td>T0998</td>
                  <td>Invoice Query</td>
                  <td><span class="ticket-status closed">Closed</span></td>
                  <td>2025-06-25</td>
                  <td>
                    <button class="service-action-btn service-edit-btn">View</button>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>

        </div>
      </div>
    </section>

    <!-- Approval Management Screen -->
    <section id="approvalManagement" class="screen">
      <div class="admin-nav">
        <div class="admin-nav-content">
          <div class="admin-nav-left">
            <button class="btn-secondary" onclick="showAdminDashboard()">‚Üê Back to Dashboard</button>
            <h1>Approval Management</h1>
          </div>
          <div class="admin-nav-right">
            <button class="btn-secondary" onclick="logoutAdmin()">Logout</button>
          </div>
        </div>
      </div>

      <div class="container" style="padding-top:20px;">
        <div class="approval-sections">
          
          <!-- Lab Registrations -->
          <div class="approval-section">
            <h3>üß™ New Lab Registrations (3)</h3>
            <div class="approval-table">
              <table>
                <thead>
                  <tr>
                    <th>Lab Name</th>
                    <th>Location</th>
                    <th>Contact</th>
                    <th>Registration Date</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>Advanced Fertility Center</td>
                    <td>Mumbai, MH</td>
                    <td>+91 98765 43210</td>
                    <td>2025-06-28</td>
                    <td>
                      <button class="btn-approve" onclick="approveRegistration('lab', 'lab1')">Approve</button>
                      <button class="btn-reject" onclick="rejectRegistration('lab', 'lab1')">Reject</button>
                      <button class="btn-view" onclick="viewRegistrationDetails('lab', 'lab1')">View</button>
                    </td>
                  </tr>
                  <tr>
                    <td>City IVF Lab</td>
                    <td>Delhi, DL</td>
                    <td>+91 87654 32109</td>
                    <td>2025-06-27</td>
                    <td>
                      <button class="btn-approve" onclick="approveRegistration('lab', 'lab2')">Approve</button>
                      <button class="btn-reject" onclick="rejectRegistration('lab', 'lab2')">Reject</button>
                      <button class="btn-view" onclick="viewRegistrationDetails('lab', 'lab2')">View</button>
                    </td>
                  </tr>
                  <tr>
                    <td>Hope Fertility Solutions</td>
                    <td>Bangalore, KA</td>
                    <td>+91 76543 21098</td>
                    <td>2025-06-26</td>
                    <td>
                      <button class="btn-approve" onclick="approveRegistration('lab', 'lab3')">Approve</button>
                      <button class="btn-reject" onclick="rejectRegistration('lab', 'lab3')">Reject</button>
                      <button class="btn-view" onclick="viewRegistrationDetails('lab', 'lab3')">View</button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>

          <!-- Doctor Requests -->
          <div class="approval-section">
            <h3>üë®‚Äç‚öïÔ∏è New Doctor Requests (2)</h3>
            <div class="approval-table">
              <table>
                <thead>
                  <tr>
                    <th>Doctor Name</th>
                    <th>Specialization</th>
                    <th>Experience</th>
                    <th>License No.</th>
                    <th>Registration Date</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>Dr. Rajesh Kumar</td>
                    <td>Fertility Specialist</td>
                    <td>12 years</td>
                    <td>MED123456</td>
                    <td>2025-06-28</td>
                    <td>
                      <button class="btn-approve" onclick="approveRegistration('doctor', 'doc1')">Approve</button>
                      <button class="btn-reject" onclick="rejectRegistration('doctor', 'doc1')">Reject</button>
                      <button class="btn-view" onclick="viewRegistrationDetails('doctor', 'doc1')">View</button>
                    </td>
                  </tr>
                  <tr>
                    <td>Dr. Priya Sharma</td>
                    <td>Embryologist</td>
                    <td>8 years</td>
                    <td>MED789012</td>
                    <td>2025-06-27</td>
                    <td>
                      <button class="btn-approve" onclick="approveRegistration('doctor', 'doc2')">Approve</button>
                      <button class="btn-reject" onclick="rejectRegistration('doctor', 'doc2')">Reject</button>
                      <button class="btn-view" onclick="viewRegistrationDetails('doctor', 'doc2')">View</button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>

        </div>
      </div>
    </section>

    <!-- User Management Screen -->
    <section id="userManagement" class="screen">
      <div class="admin-nav">
        <div class="admin-nav-content">
          <div class="admin-nav-left">
            <button class="btn-secondary" onclick="showAdminDashboard()">‚Üê Back to Dashboard</button>
            <h1>User Management - <span id="userManagementType">Users</span></h1>
          </div>
          <div class="admin-nav-right">
            <button class="btn-secondary" onclick="logoutAdmin()">Logout</button>
          </div>
        </div>
      </div>

      <div class="container" style="padding-top:20px;">
        <div class="user-management-content">
          
          <!-- Search and Filters -->
          <div class="user-management-header">
            <div class="search-container">
              <input type="text" id="userSearchInput" placeholder="Search users..." style="width:300px;" />
              <button class="btn" onclick="searchUsers()">Search</button>
            </div>
            <div class="filter-container">
              <select id="userStatusFilter">
                <option value="">All Status</option>
                <option value="active">Active</option>
                <option value="inactive">Inactive</option>
                <option value="pending">Pending</option>
              </select>
              <button class="btn-secondary" onclick="filterUsers()">Filter</button>
            </div>
          </div>

          <!-- Users Table -->
          <div class="users-table-container">
            <table class="users-table">
              <thead>
                <tr id="userManagementTableHeader">
                  <!-- Dynamic header based on user type -->
                </tr>
              </thead>
              <tbody id="userManagementTableBody">
                <!-- Dynamic content based on user type -->
              </tbody>
            </table>
          </div>

        </div>
      </div>
    </section>

    <!-- Patient Dashboard -->
    <section id="patientDash" class="screen">
      <h1>Welcome, Patient</h1>
      <!-- Welcome Banner -->
      <div class="card banner" style="background:linear-gradient(135deg,var(--primary),var(--accent));color:#fff;position:relative;">
        <h2>Hello, Sarah!</h2>
        <p>Ready to book your next test?</p>
        <button class="btn" onclick="showPatientTab('searchTab')">Search Labs</button>
      </div>

      <!-- Key Actions -->
      <div class="grid grid-3" style="margin-bottom:var(--gap)">
        <div class="card" onclick="showPatientTab('searchTab')"><h3>Search Labs</h3></div>
        <div class="card" onclick="showPatientTab('bookingsTab')"><h3>My Bookings</h3><span class="badge">3</span></div>
        <div class="card" onclick="showPatientTab('supportTab')"><h3>Support Tickets</h3></div>
        <div class="card" onclick="showPatientTab('profileTab')"><h3>Profile</h3></div>
      </div>

      <!-- Tab Panes -->
      <div id="searchTab" class="patientTab screen active">
        <div class="tabs"><div class="tab active">Search Labs & Tests</div></div>
        
        <!-- Search Section -->
        <div class="search-section">
          <div class="section-header">
            <h2 class="section-title">üîç Find Labs & Services</h2>
            <p class="section-subtitle">Discover trusted labs and book tests near you</p>
          </div>
          <div class="search-input-container">
            <input type="text" id="searchInput" placeholder="Search labs, tests, or services..." class="search-input" oninput="performSearch()" />
            <button class="search-btn" onclick="performSearch()">Search</button>
          </div>
        </div>
        
        <!-- Main Search Container -->
        <div class="search-container">
          <!-- Filters Panel -->
          <aside class="filters-panel">
            <div class="filters-header">
              <h3 class="filters-title">Filters</h3>
              <button class="clear-all-btn" onclick="clearFilters()">Clear All</button>
            </div>
            
            <!-- Location Section -->
            <div class="filter-section">
              <h4 class="filter-section-title">üìç Location & Distance</h4>
              <div class="filter-group">
                <input type="text" id="locationFilter" placeholder="Enter your location" class="location-input" />
              </div>
              <div class="filter-group">
                <label class="filter-label">Distance: <span id="distanceDisplay" class="range-value">5 - 25 km</span></label>
                <div class="dual-range" id="distanceRange">
                  <div class="dual-range-track">
                    <div class="dual-range-fill"></div>
                  </div>
                  <input type="range" id="distanceMin" min="0" max="50" value="5" />
                  <input type="range" id="distanceMax" min="0" max="50" value="25" />
                </div>
              </div>
            </div>
            
            <!-- Pricing Section -->
            <div class="filter-section">
              <h4 class="filter-section-title">üí∞ Price & Rating</h4>
              <div class="filter-group">
                <label class="filter-label">Price Range: <span id="priceDisplay" class="range-value">‚Çπ100 - ‚Çπ2000</span></label>
                <div class="dual-range" id="priceRange">
                  <div class="dual-range-track">
                    <div class="dual-range-fill"></div>
                  </div>
                  <input type="range" id="priceMin" min="0" max="5000" value="100" />
                  <input type="range" id="priceMax" min="0" max="5000" value="2000" />
                </div>
              </div>
              <div class="filter-group">
                <label class="filter-label">Minimum Rating</label>
                <div class="star-rating-filter">
                  <span class="star-filter" data-rating="1" onclick="toggleStarFilter(this)">‚≠ê</span>
                  <span class="star-filter" data-rating="2" onclick="toggleStarFilter(this)">‚≠ê‚≠ê</span>
                  <span class="star-filter" data-rating="3" onclick="toggleStarFilter(this)">‚≠ê‚≠ê‚≠ê</span>
                  <span class="star-filter active" data-rating="4" onclick="toggleStarFilter(this)">‚≠ê‚≠ê‚≠ê‚≠ê</span>
                  <span class="star-filter" data-rating="5" onclick="toggleStarFilter(this)">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</span>
                </div>
              </div>
            </div>
            
            <!-- Availability & Services Section -->
            <div class="filter-section">
              <h4 class="filter-section-title">üìÖ Availability & Services</h4>
              <div class="filter-group">
                <label class="filter-label">Next Available Date</label>
                <input type="date" id="availableDate" class="date-input" />
              </div>
              <div class="filter-group">
                <label class="filter-label">Service Categories</label>
                <div class="service-chips">
                  <div class="service-chip active" onclick="toggleServiceChip(this)" data-service="health-panel">Health Panel</div>
                  <div class="service-chip" onclick="toggleServiceChip(this)" data-service="blood-test">Blood Test</div>
                  <div class="service-chip" onclick="toggleServiceChip(this)" data-service="imaging">Imaging</div>
                  <div class="service-chip" onclick="toggleServiceChip(this)" data-service="cardiology">Cardiology</div>
                  <div class="service-chip" onclick="toggleServiceChip(this)" data-service="diabetes">Diabetes</div>
                  <div class="service-chip" onclick="toggleServiceChip(this)" data-service="women-health">Women's Health</div>
                </div>
              </div>
            </div>
            
            <!-- Apply Filters Button -->
            <div class="filter-actions">
              <button class="btn apply-filters-btn" onclick="applyFilters()">
                <span>Apply Filters</span>
              </button>
            </div>
          </aside>
          
          <!-- Results Area -->
          <main class="results-area">
            <div class="results-section">
              <div class="results-header">
                <div class="results-info">
                  <h3 class="results-title">Search Results</h3>
                  <span id="resultsCount" class="results-count">6 labs found</span>
                </div>
                <div class="results-controls">
                  <select id="sortBy" onchange="sortResults()" class="sort-select">
                    <option value="relevance">Sort by: Relevance</option>
                    <option value="price-low">Price: Low to High</option>
                    <option value="price-high">Price: High to Low</option>
                    <option value="rating">Highest Rated</option>
                    <option value="distance">Nearest First</option>
                  </select>
                  <button id="compareBtn" class="compare-toggle-btn" onclick="toggleComparison()" disabled>
                    <span class="compare-icon">‚öñÔ∏è</span>
                    Compare (<span id="compareCount">0</span>)
                  </button>
                </div>
              </div>
              
              <div class="results-grid" id="resultsGrid">
                <!-- Loading State (hidden by default) -->
                <div class="loading-state" id="loadingState" style="display:none;">
                  <div class="loading-content">
                    <div class="loading-spinner"></div>
                    <p class="loading-text">Searching for labs and services...</p>
                  </div>
                </div>
                
                <!-- Empty State (hidden by default) -->
                <div class="empty-state" id="emptyState" style="display:none;">
                  <div class="empty-state-content">
                    <div class="empty-state-icon">üîç</div>
                    <h3 class="empty-state-title">No results found</h3>
                    <p class="empty-state-text">Try adjusting your filters or search terms to find more labs and services.</p>
                    <button class="btn" onclick="clearFilters()">Clear All Filters</button>
                  </div>
                </div>
                
              <!-- Service Card 1 -->
              <div class="service-card" data-lab="lab-a" data-price="2000" data-rating="4.5">
                <div class="card-header">
                  <div class="lab-logo">üè•</div>
                  <div class="lab-info">
                    <div class="lab-name">MediCore Labs</div>
                    <div class="lab-rating">
                      <span>‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</span>
                      <span>4.5 (128 reviews)</span>
                    </div>
                  </div>
                  <button class="favorite-btn" onclick="toggleFavorite(this)">‚ô°</button>
                </div>
                <div class="service-info">
                  <div class="service-name">Comprehensive Health Panel (HP01)</div>
                  <div class="service-price">‚Çπ2,000</div>
                  <div class="service-details">
                    <span>TAT: 24 hrs</span>
                    <span>Next Slot: Jul 3, 2025</span>
                  </div>
                </div>
                <div class="card-actions">
                  <button class="btn-secondary" onclick="viewDetails('lab-a', 'HP01')">View Details</button>
                  <button class="btn" onclick="bookNow('lab-a', 'HP01')">Book Now</button>
                  <label class="compare-checkbox">
                    <input type="checkbox" onchange="toggleCompare(this, 'lab-a')"> Compare
                  </label>
                </div>
              </div>
              
              <!-- Service Card 2 -->
              <div class="service-card" data-lab="lab-b" data-price="1800" data-rating="4.2">
                <div class="card-header">
                  <div class="lab-logo">üî¨</div>
                  <div class="lab-info">
                    <div class="lab-name">HealthFirst Diagnostics</div>
                    <div class="lab-rating">
                      <span>‚≠ê‚≠ê‚≠ê‚≠ê‚òÜ</span>
                      <span>4.2 (95 reviews)</span>
                    </div>
                  </div>
                  <button class="favorite-btn" onclick="toggleFavorite(this)">‚ô°</button>
                </div>
                <div class="service-info">
                  <div class="service-name">Basic Health Checkup (BHC01)</div>
                  <div class="service-price">‚Çπ1,800</div>
                  <div class="service-details">
                    <span>TAT: 48 hrs</span>
                    <span>Next Slot: Jul 2, 2025</span>
                  </div>
                </div>
                <div class="card-actions">
                  <button class="btn-secondary" onclick="viewDetails('lab-b', 'BHC01')">View Details</button>
                  <button class="btn" onclick="bookNow('lab-b', 'BHC01')">Book Now</button>
                  <label class="compare-checkbox">
                    <input type="checkbox" onchange="toggleCompare(this, 'lab-b')"> Compare
                  </label>
                </div>
              </div>
              
              <!-- Service Card 3 -->
              <div class="service-card" data-lab="lab-c" data-price="2500" data-rating="4.8">
                <div class="card-header">
                  <div class="lab-logo">‚öïÔ∏è</div>
                  <div class="lab-info">
                    <div class="lab-name">Elite Medical Center</div>
                    <div class="lab-rating">
                      <span>‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</span>
                      <span>4.8 (203 reviews)</span>
                    </div>
                  </div>
                  <button class="favorite-btn" onclick="toggleFavorite(this)">‚ô°</button>
                </div>
                <div class="service-info">
                  <div class="service-name">Premium Health Package (PHP01)</div>
                  <div class="service-price">‚Çπ2,500</div>
                  <div class="service-details">
                    <span>TAT: 24 hrs</span>
                    <span>Next Slot: Jul 4, 2025</span>
                  </div>
                </div>
                <div class="card-actions">
                  <button class="btn-secondary" onclick="viewDetails('lab-c', 'PHP01')">View Details</button>
                  <button class="btn" onclick="bookNow('lab-c', 'PHP01')">Book Now</button>
                  <label class="compare-checkbox">
                    <input type="checkbox" onchange="toggleCompare(this, 'lab-c')"> Compare
                  </label>
                </div>
              </div>
              
              <!-- Service Card 4 -->
              <div class="service-card" data-lab="lab-d" data-price="1500" data-rating="4.0">
                <div class="card-header">
                  <div class="lab-logo">ü©∫</div>
                  <div class="lab-info">
                    <div class="lab-name">QuickTest Labs</div>
                    <div class="lab-rating">
                      <span>‚≠ê‚≠ê‚≠ê‚≠ê‚òÜ</span>
                      <span>4.0 (67 reviews)</span>
                    </div>
                  </div>
                  <button class="favorite-btn" onclick="toggleFavorite(this)">‚ô°</button>
                </div>
                <div class="service-info">
                  <div class="service-name">Essential Blood Panel (EBP01)</div>
                  <div class="service-price">‚Çπ1,500</div>
                  <div class="service-details">
                    <span>TAT: 12 hrs</span>
                    <span>Next Slot: Jul 1, 2025</span>
                  </div>
                </div>
                <div class="card-actions">
                  <button class="btn-secondary" onclick="viewDetails('lab-d', 'EBP01')">View Details</button>
                  <button class="btn" onclick="bookNow('lab-d', 'EBP01')">Book Now</button>
                  <label class="compare-checkbox">
                    <input type="checkbox" onchange="toggleCompare(this, 'lab-d')"> Compare
                  </label>
                </div>
              </div>
              
              <!-- Service Card 5 -->
              <div class="service-card" data-lab="lab-e" data-price="3000" data-rating="4.6">
                <div class="card-header">
                  <div class="lab-logo">üè•</div>
                  <div class="lab-info">
                    <div class="lab-name">Advanced Diagnostics</div>
                    <div class="lab-rating">
                      <span>‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê</span>
                      <span>4.6 (156 reviews)</span>
                    </div>
                  </div>
                  <button class="favorite-btn" onclick="toggleFavorite(this)">‚ô°</button>
                </div>
                <div class="service-info">
                  <div class="service-name">Complete Wellness Check (CWC01)</div>
                  <div class="service-price">‚Çπ3,000</div>
                  <div class="service-details">
                    <span>TAT: 48 hrs</span>
                    <span>Next Slot: Jul 5, 2025</span>
                  </div>
                </div>
                <div class="card-actions">
                  <button class="btn-secondary" onclick="viewDetails('lab-e', 'CWC01')">View Details</button>
                  <button class="btn" onclick="bookNow('lab-e', 'CWC01')">Book Now</button>
                  <label class="compare-checkbox">
                    <input type="checkbox" onchange="toggleCompare(this, 'lab-e')"> Compare
                  </label>
                </div>
              </div>
              
              <!-- Service Card 6 -->
              <div class="service-card" data-lab="lab-f" data-price="2200" data-rating="4.3">
                <div class="card-header">
                  <div class="lab-logo">üî¨</div>
                  <div class="lab-info">
                    <div class="lab-name">CityLab Diagnostics</div>
                    <div class="lab-rating">
                      <span>‚≠ê‚≠ê‚≠ê‚≠ê‚òÜ</span>
                      <span>4.3 (89 reviews)</span>
                    </div>
                  </div>
                  <button class="favorite-btn" onclick="toggleFavorite(this)">‚ô°</button>
                </div>
                <div class="service-info">
                  <div class="service-name">Standard Health Screen (SHS01)</div>
                  <div class="service-price">‚Çπ2,200</div>
                  <div class="service-details">
                    <span>TAT: 36 hrs</span>
                    <span>Next Slot: Jul 3, 2025</span>
                  </div>
                </div>
                <div class="card-actions">
                  <button class="btn-secondary" onclick="viewDetails('lab-f', 'SHS01')">View Details</button>
                  <button class="btn" onclick="bookNow('lab-f', 'SHS01')">Book Now</button>
                  <label class="compare-checkbox">
                    <input type="checkbox" onchange="toggleCompare(this, 'lab-f')"> Compare
                  </label>
                </div>
              </div>
            </div>
            </div>
          </main>
          
          <!-- Comparison Panel -->
          <aside class="comparison-panel" id="comparisonPanel">
            <div class="comparison-header">
              <div class="comparison-title-section">
                <h3 class="comparison-title">Compare Labs</h3>
                <span class="comparison-count">(<span id="comparisonCount">0</span> selected)</span>
              </div>
              <button class="close-comparison-btn" onclick="closeComparison()" title="Close comparison">
                <span>‚úï</span>
              </button>
            </div>
            
            <div class="comparison-content">
              <div id="comparisonList" class="comparison-list">
                <!-- Comparison items will be added here -->
              </div>
              
              <div class="comparison-actions">
                <button class="btn-secondary comparison-action-btn" onclick="removeAllFromComparison()" id="removeAllBtn">
                  <span>üóëÔ∏è</span> Remove All
                </button>
                <button class="btn comparison-action-btn" onclick="compareSelected()" disabled id="compareSelectedBtn">
                  <span>‚öñÔ∏è</span> Compare Now
                </button>
              </div>
            </div>
          </aside>
        </div>
      </div>

      <div id="bookingsTab" class="patientTab screen">
        <!-- Tab Header -->
        <div class="bookings-header">
          <h2 class="bookings-title">My Bookings</h2>
          <p class="bookings-subtitle">Manage your appointments and view booking history</p>
        </div>
        
        <!-- Secondary Navigation -->
        <div class="bookings-nav">
          <button class="booking-nav-tab active" onclick="showBookingTab('upcoming')" id="upcomingNavTab">
            <span class="nav-icon">üìÖ</span>
            <span class="nav-text">Upcoming</span>
            <span class="nav-count" id="upcomingCount">2</span>
          </button>
          <button class="booking-nav-tab" onclick="showBookingTab('past')" id="pastNavTab">
            <span class="nav-icon">üìã</span>
            <span class="nav-text">Past</span>
            <span class="nav-count" id="pastCount">4</span>
          </button>
        </div>
        
        <!-- Upcoming Bookings Content -->
        <div id="upcomingBookings" class="booking-content active">
          <div class="bookings-list">
            <!-- Booking Card 1 -->
            <div class="booking-card" data-booking-id="book-001">
              <div class="booking-header">
                <div class="booking-index">1.</div>
                <div class="booking-lab-service">
                  <span class="lab-name">MediCore Labs</span>
                  <span class="service-separator">‚Äî</span>
                  <span class="service-code">HP01</span>
                </div>
                <div class="booking-status">
                  <span class="status-badge confirmed">Confirmed</span>
                </div>
              </div>
              
              <div class="booking-details">
                <div class="booking-datetime">
                  <span class="booking-date">üìÖ Jul 1, 2025</span>
                  <span class="booking-time">üïê 14:00 IST (+05:30)</span>
                </div>
                <div class="booking-meta">
                  <span class="service-name">Comprehensive Health Panel</span>
                  <span class="booking-price">‚Çπ2,000</span>
                </div>
              </div>
              
              <div class="booking-actions">
                <button class="btn-secondary booking-action-btn" onclick="openRescheduleModal('book-001')" aria-label="Reschedule booking">
                  <span class="action-icon">üìÖ</span>
                  <span>Reschedule</span>
                </button>
                <button class="btn-secondary booking-action-btn" onclick="openCancelModal('book-001')" aria-label="Cancel booking">
                  <span class="action-icon">‚ùå</span>
                  <span>Cancel</span>
                </button>
                <button class="btn booking-action-btn primary" onclick="openChatModal('book-001')" aria-label="Chat with lab">
                  <span class="action-icon">üí¨</span>
                  <span>Chat</span>
                </button>
              </div>
            </div>
            
            <!-- Booking Card 2 -->
            <div class="booking-card" data-booking-id="book-002">
              <div class="booking-header">
                <div class="booking-index">2.</div>
                <div class="booking-lab-service">
                  <span class="lab-name">HealthFirst Diagnostics</span>
                  <span class="service-separator">‚Äî</span>
                  <span class="service-code">IVF01</span>
                </div>
                <div class="booking-status">
                  <span class="status-badge pending">Pending</span>
                </div>
              </div>
              
              <div class="booking-details">
                <div class="booking-datetime">
                  <span class="booking-date">üìÖ Jul 5, 2025</span>
                  <span class="booking-time">üïê 10:00 IST (+05:30)</span>
                </div>
                <div class="booking-meta">
                  <span class="service-name">IVF Panel Test</span>
                  <span class="booking-price">‚Çπ3,500</span>
                </div>
              </div>
              
              <div class="booking-actions">
                <button class="btn-secondary booking-action-btn" onclick="openRescheduleModal('book-002')" aria-label="Reschedule booking">
                  <span class="action-icon">üìÖ</span>
                  <span>Reschedule</span>
                </button>
                <button class="btn-secondary booking-action-btn" onclick="openCancelModal('book-002')" aria-label="Cancel booking">
                  <span class="action-icon">‚ùå</span>
                  <span>Cancel</span>
                </button>
                <button class="btn booking-action-btn primary" onclick="openChatModal('book-002')" aria-label="Chat with lab">
                  <span class="action-icon">üí¨</span>
                  <span>Chat</span>
                </button>
              </div>
            </div>
          </div>
          
          <!-- Load More Button -->
          <div class="load-more-container">
            <button class="btn-secondary load-more-btn" onclick="loadMoreBookings('upcoming')">
              <span>Load More Upcoming</span>
              <span class="load-icon">‚¨áÔ∏è</span>
            </button>
          </div>
          
          <!-- Empty State for Upcoming -->
          <div class="empty-state booking-empty" id="upcomingEmpty" style="display:none;">
            <div class="empty-icon">üìÖ</div>
            <h3 class="empty-title">No upcoming bookings</h3>
            <p class="empty-text">You have no upcoming bookings.<br>Browse labs to schedule your first appointment.</p>
            <button class="btn" onclick="showPatientTab('searchTab')">Browse Labs</button>
          </div>
        </div>
        
        <!-- Past Bookings Content -->
        <div id="pastBookings" class="booking-content">
          <div class="bookings-list">
            <!-- Past Booking Card 1 -->
            <div class="booking-card past" data-booking-id="book-past-001">
              <div class="booking-header">
                <div class="booking-index">1.</div>
                <div class="booking-lab-service">
                  <span class="lab-name">Elite Medical Center</span>
                  <span class="service-separator">‚Äî</span>
                  <span class="service-code">GEN01</span>
                </div>
                <div class="booking-status">
                  <span class="status-badge completed">Completed</span>
                </div>
              </div>
              
              <div class="booking-details">
                <div class="booking-datetime">
                  <span class="booking-date">üìÖ Jun 20, 2025</span>
                </div>
                <div class="booking-meta">
                  <span class="service-name">Genetic Test Panel</span>
                  <span class="booking-price">‚Çπ4,500</span>
                </div>
              </div>
              
              <div class="booking-actions">
                <button class="btn-secondary booking-action-btn" onclick="rebookService('book-past-001')" aria-label="Rebook this service">
                  <span class="action-icon">üîÑ</span>
                  <span>Rebook</span>
                </button>
                <button class="btn booking-action-btn primary" onclick="viewReport('book-past-001')" aria-label="View test report">
                  <span class="action-icon">üìÑ</span>
                  <span>View Report</span>
                </button>
              </div>
            </div>
            
            <!-- Past Booking Card 2 -->
            <div class="booking-card past" data-booking-id="book-past-002">
              <div class="booking-header">
                <div class="booking-index">2.</div>
                <div class="booking-lab-service">
                  <span class="lab-name">QuickTest Labs</span>
                  <span class="service-separator">‚Äî</span>
                  <span class="service-code">SEM01</span>
                </div>
                <div class="booking-status">
                  <span class="status-badge no-show">No-Show</span>
                </div>
              </div>
              
              <div class="booking-details">
                <div class="booking-datetime">
                  <span class="booking-date">üìÖ Jun 15, 2025</span>
                </div>
                <div class="booking-meta">
                  <span class="service-name">Semen Analysis</span>
                  <span class="booking-price">‚Çπ1,200</span>
                </div>
              </div>
              
              <div class="booking-actions">
                <button class="btn-secondary booking-action-btn" onclick="rebookService('book-past-002')" aria-label="Rebook this service">
                  <span class="action-icon">üîÑ</span>
                  <span>Rebook</span>
                </button>
                <button class="btn booking-action-btn primary" onclick="openFeedbackModal('book-past-002')" aria-label="Provide feedback">
                  <span class="action-icon">‚≠ê</span>
                  <span>Feedback</span>
                </button>
              </div>
            </div>
            
            <!-- Past Booking Card 3 -->
            <div class="booking-card past" data-booking-id="book-past-003">
              <div class="booking-header">
                <div class="booking-index">3.</div>
                <div class="booking-lab-service">
                  <span class="lab-name">CityLab Diagnostics</span>
                  <span class="service-separator">‚Äî</span>
                  <span class="service-code">BLD01</span>
                </div>
                <div class="booking-status">
                  <span class="status-badge cancelled">Cancelled</span>
                </div>
              </div>
              
              <div class="booking-details">
                <div class="booking-datetime">
                  <span class="booking-date">üìÖ Jun 10, 2025</span>
                </div>
                <div class="booking-meta">
                  <span class="service-name">Blood Test Panel</span>
                  <span class="booking-price">‚Çπ800</span>
                </div>
              </div>
              
              <div class="booking-actions">
                <button class="btn-secondary booking-action-btn" onclick="rebookService('book-past-003')" aria-label="Rebook this service">
                  <span class="action-icon">üîÑ</span>
                  <span>Rebook</span>
                </button>
                <button class="btn booking-action-btn primary" onclick="openFeedbackModal('book-past-003')" aria-label="Provide feedback">
                  <span class="action-icon">‚≠ê</span>
                  <span>Feedback</span>
                </button>
              </div>
            </div>
            
            <!-- Past Booking Card 4 -->
            <div class="booking-card past" data-booking-id="book-past-004">
              <div class="booking-header">
                <div class="booking-index">4.</div>
                <div class="booking-lab-service">
                  <span class="lab-name">Advanced Diagnostics</span>
                  <span class="service-separator">‚Äî</span>
                  <span class="service-code">THY01</span>
                </div>
                <div class="booking-status">
                  <span class="status-badge expired">Expired</span>
                </div>
              </div>
              
              <div class="booking-details">
                <div class="booking-datetime">
                  <span class="booking-date">üìÖ May 28, 2025</span>
                </div>
                <div class="booking-meta">
                  <span class="service-name">Thyroid Profile</span>
                  <span class="booking-price">‚Çπ650</span>
                </div>
              </div>
              
              <div class="booking-actions">
                <button class="btn-secondary booking-action-btn" onclick="rebookService('book-past-004')" aria-label="Rebook this service">
                  <span class="action-icon">üîÑ</span>
                  <span>Rebook</span>
                </button>
                <button class="btn booking-action-btn primary disabled" disabled aria-label="Feedback not available">
                  <span class="action-icon">‚≠ê</span>
                  <span>Feedback</span>
                </button>
              </div>
            </div>
          </div>
          
          <!-- Load More Button -->
          <div class="load-more-container">
            <button class="btn-secondary load-more-btn" onclick="loadMoreBookings('past')">
              <span>Load More Past</span>
              <span class="load-icon">‚¨áÔ∏è</span>
            </button>
          </div>
          
          <!-- Empty State for Past -->
          <div class="empty-state booking-empty" id="pastEmpty" style="display:none;">
            <div class="empty-icon">üìã</div>
            <h3 class="empty-title">No past bookings found</h3>
            <p class="empty-text">No past bookings found.<br>Book a test to get started.</p>
            <button class="btn" onclick="showPatientTab('searchTab')">Book a Test</button>
          </div>
        </div>
      </div>

      <div id="supportTab" class="patientTab screen">
        <div class="tabs"><div class="tab active">Support</div></div>
        <div class="grid grid-2">
          <!-- Ticket List -->
          <div class="card">
            <div style="display:flex;justify-content:space-between;align-items:center;">
              <h3>Support Tickets</h3>
              <button class="btn" onclick="openModal('patientNewTicketModal')">New Ticket</button>
            </div>
            <input type="text" placeholder="Search tickets..." />
            <select>
              <option value="all">All Status</option>
              <option value="open">Open</option>
              <option value="closed">Closed</option>
            </select>
            <div class="card" style="margin-top:8px;cursor:pointer;" onclick="openSupportConversation('1234')">
              <h4>#1234 - Issue Booking</h4>
              <span class="badge">Open</span>
            </div>
          </div>
          <!-- Conversation Pane -->
          <div class="card" id="supportConversation" style="display:none;flex-direction:column;">
            <div style="display:flex;justify-content:space-between;align-items:center;">
              <h3>Ticket #1234</h3>
              <button class="btn-secondary" onclick="closeSupportConversation()">Back</button>
            </div>
            <div id="supportMessages" style="flex:1;overflow-y:auto;border:1px solid #ddd;padding:8px;border-radius:4px;margin:8px 0;">
              <div style="margin-bottom:8px;"><strong>Support:</strong> Hello, how can we help?</div>
            </div>
            <textarea id="supportInput" rows="2" placeholder="Type your message..." style="width:100%;padding:8px;border:1px solid #ddd;border-radius:4px;"></textarea>
            <div style="text-align:right;margin-top:8px;"><button class="btn" onclick="sendSupportMessage()">Send</button></div>
          </div>
        </div>
      </div>
      <!-- Patient New Ticket Modal -->
      <div id="patientNewTicketModal" class="modal">
        <h3>New Support Ticket</h3>
        <label>Subject</label>
        <input type="text" id="patientTicketSubject" />
        <label>Category</label>
        <select id="patientTicketCategory">
          <option>Booking</option>
          <option>Payment</option>
          <option>General</option>
        </select>
        <label>Description</label>
        <textarea id="patientTicketDescription" rows="4"></textarea>
        <div class="modal-footer">
          <button class="btn-secondary" onclick="closeModal('patientNewTicketModal')">Cancel</button>
          <button class="btn" onclick="submitNewTicket()">Submit</button>
        </div>
      </div>

      <div id="profileTab" class="patientTab screen">
        <div class="tabs"><div class="tab active">Profile</div></div>
        
        <!-- Profile View Mode -->
        <div id="profileView" style="padding-bottom:80px;">
          <!-- Profile Information -->
          <div class="card" style="margin-bottom:24px;">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;">
              <h3 style="font-size:20px;font-weight:600;margin:0;">My Profile</h3>
              <button class="btn-secondary" onclick="toggleEditProfile()" style="min-width:32px;min-height:32px;padding:8px 12px;">‚úé Edit</button>
            </div>
            <div style="font-size:14px;line-height:1.6;">
              <div style="margin-bottom:8px;"><strong style="font-weight:600;">Name:</strong> Sarah</div>
              <div style="margin-bottom:8px;"><strong style="font-weight:600;">Email:</strong> sarah@example.com</div>
              <div style="margin-bottom:8px;"><strong style="font-weight:600;">Phone:</strong> +91 9876543210</div>
              <div style="margin-bottom:8px;"><strong style="font-weight:600;">DOB:</strong> Jan 1, 1990</div>
              <div><strong style="font-weight:600;">Address:</strong><br>123 Main St, City, Country</div>
            </div>
          </div>

          <!-- Payment Methods -->
          <div class="card" style="margin-bottom:24px;">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;">
              <h3 style="font-size:18px;font-weight:600;margin:0;">Payment Methods</h3>
              <button class="btn" onclick="openModal('addPaymentModal')" style="padding:8px 12px;height:36px;">+ Add New</button>
            </div>
            
            <!-- Payment Card 1 -->
            <div class="payment-card card" tabindex="0" style="margin-bottom:12px;position:relative;padding:12px;background:#f9f9f9;cursor:pointer;">
              <div style="display:flex;align-items:center;margin-bottom:8px;">
                <span style="margin-right:12px;font-size:24px;">üí≥</span>
                <div style="flex:1;">
                  <div style="font-weight:600;font-size:14px;">Visa ‚Ä¢‚Ä¢‚Ä¢‚Ä¢ 4242</div>
                  <div style="font-size:12px;color:var(--muted);margin-top:2px;">Exp: 12/25</div>
                </div>
                <span style="background:var(--accent);color:#fff;padding:4px 8px;font-size:10px;border-radius:12px;">Default</span>
              </div>
              <div style="display:flex;gap:8px;">
                <button class="btn-secondary" style="padding:6px 12px;font-size:12px;" onclick="openEditPaymentModal('visa4242')" title="Edit payment method">‚úé Edit</button>
                <button class="btn-secondary" style="padding:6px 12px;font-size:12px;" onclick="openDeletePaymentModal('visa4242')" title="Delete payment method">üóë Delete</button>
              </div>
            </div>

            <!-- Payment Card 2 -->
            <div class="payment-card card" tabindex="0" style="position:relative;padding:12px;background:#f9f9f9;cursor:pointer;">
              <div style="display:flex;align-items:center;margin-bottom:8px;">
                <span style="margin-right:12px;font-size:24px;">üí≥</span>
                <div style="flex:1;">
                  <div style="font-weight:600;font-size:14px;">MasterCard ‚Ä¢‚Ä¢‚Ä¢‚Ä¢ 1111</div>
                  <div style="font-size:12px;color:var(--muted);margin-top:2px;">Exp: 03/24</div>
                </div>
              </div>
              <div style="display:flex;gap:8px;">
                <button class="btn-secondary" style="padding:6px 12px;font-size:12px;" onclick="openEditPaymentModal('master1111')" title="Edit payment method">‚úé Edit</button>
                <button class="btn-secondary" style="padding:6px 12px;font-size:12px;" onclick="openDeletePaymentModal('master1111')" title="Delete payment method">üóë Delete</button>
              </div>
            </div>
          </div>

          <!-- Account Settings -->
          <div class="card" style="margin-bottom:24px;">
            <h3 style="font-size:18px;font-weight:600;margin:0 0 16px 0;">Account Settings</h3>
            <div style="font-size:14px;">
              <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;">
                <span>Email Notifications</span>
                <label class="toggle-switch">
                  <input type="checkbox" checked onchange="toggleSetting('email', this.checked)">
                  <span class="slider"></span>
                </label>
              </div>
              <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;">
                <span>SMS Reminders</span>
                <label class="toggle-switch">
                  <input type="checkbox" checked onchange="toggleSetting('sms', this.checked)">
                  <span class="slider"></span>
                </label>
              </div>
              <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;">
                <span>Marketing Opt-In</span>
                <label class="toggle-switch">
                  <input type="checkbox" onchange="toggleSetting('marketing', this.checked)">
                  <span class="slider"></span>
                </label>
              </div>
              <button style="background:none;border:none;color:var(--primary);text-decoration:underline;cursor:pointer;font-size:14px;padding:0;" onclick="openModal('patientChangePasswordModal')">Change Password</button>
            </div>
          </div>

          <!-- Logout -->
          <button class="btn-secondary" style="width:100%;padding:12px;font-size:16px;font-weight:600;" onclick="confirmLogout()">Logout</button>
        </div>

        <!-- Profile Edit Mode -->
        <div id="profileEdit" style="display:none;padding-bottom:80px;">
          <div class="card">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;">
              <h3 style="font-size:20px;font-weight:600;margin:0;">Edit Profile</h3>
              <button onclick="toggleEditProfile()" style="background:none;border:none;font-size:18px;cursor:pointer;padding:4px;">‚úï</button>
            </div>
            
            <form onsubmit="saveProfile(); return false;">
              <div style="margin-bottom:16px;">
                <label for="editName" style="display:block;font-weight:600;margin-bottom:4px;font-size:14px;">Name</label>
                <input type="text" id="editName" value="Sarah" required style="width:100%;padding:10px;border:1px solid #ddd;border-radius:var(--radius);" />
              </div>
              
              <div style="margin-bottom:16px;">
                <label for="editEmail" style="display:block;font-weight:600;margin-bottom:4px;font-size:14px;">Email</label>
                <input type="email" id="editEmail" value="sarah@example.com" required style="width:100%;padding:10px;border:1px solid #ddd;border-radius:var(--radius);" />
              </div>
              
              <div style="margin-bottom:16px;">
                <label for="editPhone" style="display:block;font-weight:600;margin-bottom:4px;font-size:14px;">Phone</label>
                <input type="tel" id="editPhone" value="+91 9876543210" required style="width:100%;padding:10px;border:1px solid #ddd;border-radius:var(--radius);" />
              </div>
              
              <div style="margin-bottom:16px;">
                <label for="editDob" style="display:block;font-weight:600;margin-bottom:4px;font-size:14px;">DOB</label>
                <input type="date" id="editDob" value="1990-01-01" required style="width:100%;padding:10px;border:1px solid #ddd;border-radius:var(--radius);" />
              </div>
              
              <div style="margin-bottom:24px;">
                <label for="editAddress" style="display:block;font-weight:600;margin-bottom:4px;font-size:14px;">Address</label>
                <textarea id="editAddress" rows="3" required style="width:100%;padding:10px;border:1px solid #ddd;border-radius:var(--radius);resize:vertical;">123 Main St, City, Country</textarea>
              </div>
              
              <div style="display:flex;justify-content:flex-end;gap:12px;">
                <button type="button" class="btn-secondary" onclick="toggleEditProfile()">Cancel</button>
                <button type="submit" class="btn">Save Changes</button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </section>

    <!-- Doctor Dashboard -->
    <section id="doctorDash" class="screen">
      <h1>Doctor Dashboard</h1>
      
      <!-- Welcome Banner -->
      <div class="card banner" style="background:linear-gradient(135deg,var(--primary),var(--accent));color:#fff;position:relative;">
        <h2>Hello, Dr. Smith!</h2>
        <p>Manage your patients and bookings efficiently</p>
        <button class="btn" onclick="showDoctorTab('bookForPatientTab')">Book for Patient</button>
      </div>

      <!-- Key Actions -->
      <div class="grid grid-3" style="margin-bottom:var(--gap)">
        <div class="card" onclick="showDoctorTab('bookForPatientTab')"><h3>Book for Patient</h3><span class="icon">üìÖ</span></div>
        <div class="card" onclick="showDoctorTab('myPatientsTab')"><h3>My Patients</h3><span class="badge">12</span></div>
        <div class="card" onclick="showDoctorTab('doctorBookingsTab')"><h3>Bookings</h3><span class="badge">8</span></div>
        <div class="card" onclick="showDoctorTab('invoicesTab')"><h3>Invoices</h3><span class="badge">3</span></div>
        <div class="card" onclick="showDoctorTab('doctorSupportTab')"><h3>Support</h3></div>
        <div class="card" onclick="showDoctorTab('doctorProfileTab')"><h3>Profile</h3></div>
      </div>

      <!-- Book for Patient Tab -->
      <div id="bookForPatientTab" class="doctorTab active">
        <div class="tabs"><div class="tab active">Book for Patient</div></div>
        
        <div class="doctor-content">
          <div class="search-section">
            <div class="section-header">
              <h2 class="section-title">üìã Book Appointment for Patient</h2>
              <p class="section-subtitle">Search and book tests for your patients</p>
            </div>
            
            <!-- Patient Selection -->
            <div class="patient-selection-card">
              <h3>Select Patient</h3>
              <div class="patient-search-container">
                <input type="text" id="patientSearchInput" placeholder="Search patient by name or ID..." class="patient-search-input" oninput="searchPatients()" />
                <button class="btn-secondary" onclick="openModal('addPatientModal')">+ Add New Patient</button>
              </div>
              
              <div id="selectedPatientInfo" class="selected-patient-info" style="display:none;">
                <div class="patient-card">
                  <div class="patient-avatar">üë§</div>
                  <div class="patient-details">
                    <h4 id="selectedPatientName">John Doe</h4>
                    <p id="selectedPatientDetails">Age: 35, ID: P001</p>
                    <p id="selectedPatientContact">+91 9876543210</p>
                  </div>
                  <button class="btn-secondary" onclick="clearSelectedPatient()">Change</button>
                </div>
              </div>
            </div>
            
            <!-- Service Selection -->
            <div class="service-selection-card">
              <h3>Select Service</h3>
              <div class="service-categories">
                <div class="service-category active" onclick="selectServiceCategory('blood-tests')">
                  <span class="category-icon">ü©∏</span>
                  <span>Blood Tests</span>
                </div>
                <div class="service-category" onclick="selectServiceCategory('radiology')">
                  <span class="category-icon">üì°</span>
                  <span>Radiology</span>
                </div>
                <div class="service-category" onclick="selectServiceCategory('pathology')">
                  <span class="category-icon">üî¨</span>
                  <span>Pathology</span>
                </div>
                <div class="service-category" onclick="selectServiceCategory('cardiology')">
                  <span class="category-icon">‚ù§Ô∏è</span>
                  <span>Cardiology</span>
                </div>
              </div>
              
              <div class="services-grid" id="servicesGrid">
                <div class="service-item" onclick="selectService('CBC', 'Complete Blood Count', 500)">
                  <h4>Complete Blood Count (CBC)</h4>
                  <p>Comprehensive blood analysis</p>
                  <span class="service-price">‚Çπ500</span>
                </div>
                <div class="service-item" onclick="selectService('LFT', 'Liver Function Test', 800)">
                  <h4>Liver Function Test (LFT)</h4>
                  <p>Liver health assessment</p>
                  <span class="service-price">‚Çπ800</span>
                </div>
                <div class="service-item" onclick="selectService('KFT', 'Kidney Function Test', 700)">
                  <h4>Kidney Function Test (KFT)</h4>
                  <p>Kidney health evaluation</p>
                  <span class="service-price">‚Çπ700</span>
                </div>
              </div>
            </div>
            
            <!-- Lab Selection -->
            <div class="lab-selection-card">
              <h3>Select Lab</h3>
              <div class="labs-grid" id="labsGrid">
                <div class="lab-item" onclick="selectLab('City Lab', 'Downtown', 4.5)">
                  <div class="lab-info">
                    <h4>City Lab</h4>
                    <p>üìç Downtown ‚Ä¢ 2.5 km away</p>
                    <div class="lab-rating">‚≠ê 4.5 (120 reviews)</div>
                  </div>
                  <div class="lab-price">‚Çπ500</div>
                </div>
                <div class="lab-item" onclick="selectLab('Metro Diagnostics', 'Central Mall', 4.2)">
                  <div class="lab-info">
                    <h4>Metro Diagnostics</h4>
                    <p>üìç Central Mall ‚Ä¢ 3.2 km away</p>
                    <div class="lab-rating">‚≠ê 4.2 (89 reviews)</div>
                  </div>
                  <div class="lab-price">‚Çπ520</div>
                </div>
              </div>
            </div>
            
            <!-- Booking Summary -->
            <div class="booking-summary-card" id="bookingSummaryCard" style="display:none;">
              <h3>Booking Summary</h3>
              <div class="summary-details">
                <div class="summary-row">
                  <span>Patient:</span>
                  <span id="summaryPatient">-</span>
                </div>
                <div class="summary-row">
                  <span>Service:</span>
                  <span id="summaryService">-</span>
                </div>
                <div class="summary-row">
                  <span>Lab:</span>
                  <span id="summaryLab">-</span>
                </div>
                <div class="summary-row">
                  <span>Date:</span>
                  <input type="date" id="bookingDate" class="summary-input" />
                </div>
                <div class="summary-row">
                  <span>Time:</span>
                  <select id="bookingTime" class="summary-input">
                    <option value="09:00">09:00 AM</option>
                    <option value="10:00">10:00 AM</option>
                    <option value="11:00">11:00 AM</option>
                    <option value="14:00">02:00 PM</option>
                    <option value="15:00">03:00 PM</option>
                    <option value="16:00">04:00 PM</option>
                  </select>
                </div>
                <div class="summary-row total">
                  <span>Total:</span>
                  <span id="summaryTotal">‚Çπ0</span>
                </div>
              </div>
              <button class="btn" onclick="confirmPatientBooking()" style="width:100%;margin-top:16px;">Confirm Booking</button>
            </div>
          </div>
        </div>
      </div>

      <!-- My Patients Tab -->
      <div id="myPatientsTab" class="doctorTab">
        <div class="tabs"><div class="tab active">My Patients</div></div>
        
        <div class="doctor-content">
          <div class="patients-header">
            <h2>My Patients</h2>
            <div class="patients-actions">
              <input type="text" id="patientsSearchInput" placeholder="Search patients..." class="search-input" oninput="searchMyPatients()" />
              <button class="btn" onclick="openModal('addPatientModal')">+ Add Patient</button>
            </div>
          </div>
          
          <div class="patients-grid" id="patientsGrid">
            <div class="patient-card-detailed">
              <div class="patient-header">
                <div class="patient-avatar">üë§</div>
                <div class="patient-info">
                  <h4>John Doe</h4>
                  <p>ID: P001 ‚Ä¢ Age: 35 ‚Ä¢ Male</p>
                  <p>üìû +91 9876543210</p>
                </div>
                <div class="patient-actions">
                  <button class="btn-icon" onclick="editPatient('P001')" title="Edit">‚úèÔ∏è</button>
                  <button class="btn-icon" onclick="deletePatient('P001')" title="Delete">üóëÔ∏è</button>
                </div>
              </div>
              <div class="patient-stats">
                <div class="stat-item">
                  <span class="stat-label">Total Bookings</span>
                  <span class="stat-value">12</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Last Visit</span>
                  <span class="stat-value">2024-03-15</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Status</span>
                  <span class="stat-value status-active">Active</span>
                </div>
              </div>
            </div>
            
            <div class="patient-card-detailed">
              <div class="patient-header">
                <div class="patient-avatar">üë§</div>
                <div class="patient-info">
                  <h4>Jane Smith</h4>
                  <p>ID: P002 ‚Ä¢ Age: 28 ‚Ä¢ Female</p>
                  <p>üìû +91 9876543211</p>
                </div>
                <div class="patient-actions">
                  <button class="btn-icon" onclick="editPatient('P002')" title="Edit">‚úèÔ∏è</button>
                  <button class="btn-icon" onclick="deletePatient('P002')" title="Delete">üóëÔ∏è</button>
                </div>
              </div>
              <div class="patient-stats">
                <div class="stat-item">
                  <span class="stat-label">Total Bookings</span>
                  <span class="stat-value">8</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Last Visit</span>
                  <span class="stat-value">2024-03-20</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Status</span>
                  <span class="stat-value status-active">Active</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Doctor Bookings Tab -->
      <div id="doctorBookingsTab" class="doctorTab">
        <div class="tabs"><div class="tab active">Bookings</div></div>
        
        <div class="doctor-content">
          <div class="bookings-header">
            <h2>Patient Bookings</h2>
            <div class="bookings-filter">
              <select id="bookingsFilter" onchange="filterDoctorBookings()">
                <option value="all">All Bookings</option>
                <option value="upcoming">Upcoming</option>
                <option value="completed">Completed</option>
                <option value="cancelled">Cancelled</option>
              </select>
            </div>
          </div>
          
          <div class="doctor-bookings-list">
            <div class="doctor-booking-card">
              <div class="booking-info">
                <div class="booking-patient">
                  <div class="patient-avatar">üë§</div>
                  <div>
                    <h4>John Doe</h4>
                    <p>ID: P001</p>
                  </div>
                </div>
                <div class="booking-details">
                  <p><strong>Service:</strong> Complete Blood Count (CBC)</p>
                  <p><strong>Lab:</strong> City Lab</p>
                  <p><strong>Date:</strong> March 25, 2024</p>
                  <p><strong>Time:</strong> 10:00 AM</p>
                </div>
              </div>
              <div class="booking-status">
                <span class="status-badge confirmed">Confirmed</span>
                <div class="booking-actions">
                  <button class="btn-secondary" onclick="viewDoctorBooking('B001')">View</button>
                  <button class="btn-secondary" onclick="cancelDoctorBooking('B001')">Cancel</button>
                </div>
              </div>
            </div>
            
            <div class="doctor-booking-card">
              <div class="booking-info">
                <div class="booking-patient">
                  <div class="patient-avatar">üë§</div>
                  <div>
                    <h4>Jane Smith</h4>
                    <p>ID: P002</p>
                  </div>
                </div>
                <div class="booking-details">
                  <p><strong>Service:</strong> Liver Function Test (LFT)</p>
                  <p><strong>Lab:</strong> Metro Diagnostics</p>
                  <p><strong>Date:</strong> March 26, 2024</p>
                  <p><strong>Time:</strong> 2:00 PM</p>
                </div>
              </div>
              <div class="booking-status">
                <span class="status-badge pending">Pending</span>
                <div class="booking-actions">
                  <button class="btn-secondary" onclick="viewDoctorBooking('B002')">View</button>
                  <button class="btn-secondary" onclick="cancelDoctorBooking('B002')">Cancel</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Invoices Tab -->
      <div id="invoicesTab" class="doctorTab">
        <div class="tabs"><div class="tab active">Invoices</div></div>
        
        <div class="doctor-content">
          <div class="invoices-header">
            <h2>Invoices</h2>
            <div class="invoices-actions">
              <input type="text" id="invoicesSearchInput" placeholder="Search invoices..." class="search-input" />
              <select id="invoicesStatusFilter">
                <option value="all">All Status</option>
                <option value="paid">Paid</option>
                <option value="pending">Pending</option>
                <option value="overdue">Overdue</option>
              </select>
            </div>
          </div>
          
          <div class="invoices-list">
            <div class="invoice-card">
              <div class="invoice-header">
                <div class="invoice-number">
                  <h4>Invoice #INV001</h4>
                  <p>Patient: John Doe</p>
                </div>
                <div class="invoice-status">
                  <span class="status-badge completed">Paid</span>
                </div>
              </div>
              <div class="invoice-details">
                <div class="invoice-row">
                  <span>Service:</span>
                  <span>Complete Blood Count (CBC)</span>
                </div>
                <div class="invoice-row">
                  <span>Date:</span>
                  <span>March 20, 2024</span>
                </div>
                <div class="invoice-row">
                  <span>Amount:</span>
                  <span class="invoice-amount">‚Çπ500</span>
                </div>
              </div>
              <div class="invoice-actions">
                <button class="btn-secondary" onclick="viewInvoice('INV001')">View</button>
                <button class="btn-secondary" onclick="downloadInvoice('INV001')">Download</button>
              </div>
            </div>
            
            <div class="invoice-card">
              <div class="invoice-header">
                <div class="invoice-number">
                  <h4>Invoice #INV002</h4>
                  <p>Patient: Jane Smith</p>
                </div>
                <div class="invoice-status">
                  <span class="status-badge pending">Pending</span>
                </div>
              </div>
              <div class="invoice-details">
                <div class="invoice-row">
                  <span>Service:</span>
                  <span>Liver Function Test (LFT)</span>
                </div>
                <div class="invoice-row">
                  <span>Date:</span>
                  <span>March 22, 2024</span>
                </div>
                <div class="invoice-row">
                  <span>Amount:</span>
                  <span class="invoice-amount">‚Çπ800</span>
                </div>
              </div>
              <div class="invoice-actions">
                <button class="btn-secondary" onclick="viewInvoice('INV002')">View</button>
                <button class="btn" onclick="payInvoice('INV002')">Pay Now</button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Support Tab -->
      <div id="doctorSupportTab" class="doctorTab">
        <div class="tabs"><div class="tab active">Support Tickets</div></div>
        
        <div class="doctor-content">
          <div class="support-header">
            <h2>Support Tickets</h2>
            <button class="btn" onclick="openModal('newTicketModal')">+ New Ticket</button>
          </div>
          
          <div class="support-search">
            <div class="search-container">
              <input type="text" id="ticketSearchInput" placeholder="Ticket ID or Subject..." class="search-input" />
              <button class="search-icon-btn" onclick="searchTickets()">üîç</button>
            </div>
          </div>
          
          <div class="tickets-table-container">
            <table class="tickets-table">
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Subject</th>
                  <th>Status</th>
                  <th>Updated</th>
                  <th>Action</th>
                </tr>
              </thead>
              <tbody id="ticketsTableBody">
                <tr onclick="viewTicket('T3005')" class="ticket-row">
                  <td><strong>T3005</strong></td>
                  <td>Lab Access Issue</td>
                  <td><span class="status-badge pending">Open</span></td>
                  <td>Jul 1, 10:15</td>
                  <td><button class="btn-secondary" onclick="event.stopPropagation(); viewTicket('T3005')">View</button></td>
                </tr>
                <tr onclick="viewTicket('T2980')" class="ticket-row">
                  <td><strong>T2980</strong></td>
                  <td>Billing Query</td>
                  <td><span class="status-badge completed">Closed</span></td>
                  <td>Jun 25, 14:45</td>
                  <td><button class="btn-secondary" onclick="event.stopPropagation(); viewTicket('T2980')">View</button></td>
                </tr>
                <tr onclick="viewTicket('T2955')" class="ticket-row">
                  <td><strong>T2955</strong></td>
                  <td>Patient Booking Error</td>
                  <td><span class="status-badge pending">Open</span></td>
                  <td>Jun 20, 09:30</td>
                  <td><button class="btn-secondary" onclick="event.stopPropagation(); viewTicket('T2955')">View</button></td>
                </tr>
                <tr onclick="viewTicket('T2888')" class="ticket-row">
                  <td><strong>T2888</strong></td>
                  <td>Invoice Generation Issue</td>
                  <td><span class="status-badge completed">Closed</span></td>
                  <td>Jun 15, 16:20</td>
                  <td><button class="btn-secondary" onclick="event.stopPropagation(); viewTicket('T2888')">View</button></td>
                </tr>
              </tbody>
            </table>
          </div>
          
          <div class="load-more-container">
            <button class="btn-secondary load-more-btn" onclick="loadMoreTickets()">
              <span class="load-icon">‚ü≥</span>
              Load More Tickets
            </button>
          </div>
        </div>
      </div>

      <!-- Profile Tab -->
      <div id="doctorProfileTab" class="doctorTab">
        <div class="tabs"><div class="tab active">My Profile</div></div>
        
        <div class="doctor-content">
          <div class="profile-overview-card">
            <h2 style="text-align:center;margin:0 0 24px 0;font-size:24px;color:var(--primary);">My Profile</h2>
            
            <div class="profile-details-grid">
              <div class="profile-detail-row">
                <span class="profile-label">Name:</span>
                <span class="profile-value" id="profileName">Dr. Sarah Patel</span>
              </div>
              <div class="profile-detail-row">
                <span class="profile-label">Specialty:</span>
                <span class="profile-value" id="profileSpecialty">Reproductive Endocrinology</span>
              </div>
              <div class="profile-detail-row">
                <span class="profile-label">Registration No.:</span>
                <span class="profile-value" id="profileRegistration">MCI-123456</span>
              </div>
              <div class="profile-detail-row">
                <span class="profile-label">Clinic:</span>
                <span class="profile-value" id="profileClinic">City Fertility Clinic</span>
              </div>
              <div class="profile-detail-row">
                <span class="profile-label">Email:</span>
                <span class="profile-value" id="profileEmail">sarah.patel@clinic.com</span>
              </div>
              <div class="profile-detail-row">
                <span class="profile-label">Phone:</span>
                <span class="profile-value" id="profilePhone">+91 98765 43210</span>
              </div>
              <div class="profile-detail-row">
                <span class="profile-label">Years of Exp.:</span>
                <span class="profile-value" id="profileExperience">12 years</span>
              </div>
            </div>
            
            <div class="profile-actions">
              <button class="btn" onclick="openEditProfileModal()">Edit Profile</button>
              <button class="btn-secondary" onclick="openChangePasswordModal()">Change Password</button>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Admin Dashboard -->
    <section id="adminDash" class="screen">
      <!-- Lab Admin Header -->
      <div class="admin-header">
        <div class="admin-header-content">
          <h1>Lab Admin Dashboard</h1>
          <div class="admin-header-actions">
            <span class="admin-welcome">Welcome, <span id="labAdminUserName">Lab Admin</span></span>
            <button class="btn-secondary" onclick="logout()">Logout</button>
          </div>
        </div>
      </div>

      <!-- Lab Admin Main Content -->
      <div class="admin-main">
        <!-- Sidebar Navigation -->
        <div class="admin-sidebar">
          <div class="admin-nav-tabs">
            <button class="admin-nav-tab active" onclick="showLabTab('labOverview')" id="labOverviewNavTab">Lab Overview</button>
            <button class="admin-nav-tab" onclick="showLabTab('sampleManagement')" id="sampleManagementNavTab">Sample Management</button>
            <button class="admin-nav-tab" onclick="showLabTab('labBookings')" id="labBookingsNavTab">Lab Bookings</button>
            <button class="admin-nav-tab" onclick="showLabTab('labReports')" id="labReportsNavTab">Lab Reports</button>
            <button class="admin-nav-tab" onclick="showLabTab('labStaff')" id="labStaffNavTab">Lab Staff</button>
            <button class="admin-nav-tab" onclick="showLabTab('labSettings')" id="labSettingsNavTab">Lab Settings</button>
          </div>
        </div>

        <!-- Content Area -->
        <div class="admin-content-area">
          
          <!-- Lab Overview Tab -->
          <div id="labOverview" class="admin-tab-content active">
            <div class="admin-welcome-banner">
              <h2>Welcome to Lab Admin Dashboard!</h2>
              <p>Manage your lab operations, samples, and results efficiently</p>
            </div>
            
            <div class="admin-stats-grid">
              <div class="admin-stat-card">
                <div class="stat-icon">üß™</div>
                <h3 class="stat-number">142</h3>
                <p class="stat-label">Samples Today</p>
              </div>
              <div class="admin-stat-card">
                <div class="stat-icon">‚è≥</div>
                <h3 class="stat-number">28</h3>
                <p class="stat-label">Pending Results</p>
              </div>
              <div class="admin-stat-card">
                <div class="stat-icon">‚úÖ</div>
                <h3 class="stat-number">114</h3>
                <p class="stat-label">Completed Today</p>
              </div>
              <div class="admin-stat-card">
                <div class="stat-icon">‚ö†Ô∏è</div>
                <h3 class="stat-number">3</h3>
                <p class="stat-label">Urgent Samples</p>
              </div>
            </div>

            <div class="admin-quick-actions" style="margin-top: 2rem;">
              <h3>Quick Actions</h3>
              <div class="quick-actions-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-top: 1rem;">
                <button class="quick-action-btn" onclick="showLabTab('sampleManagement')" style="padding: 1rem; background: #007bff; color: white; border: none; border-radius: 8px; cursor: pointer;">
                  <div style="font-size: 1.5rem;">üß™</div>
                  <div>Process Samples</div>
                </button>
                <button class="quick-action-btn" onclick="showLabTab('labBookings')" style="padding: 1rem; background: #28a745; color: white; border: none; border-radius: 8px; cursor: pointer;">
                  <div style="font-size: 1.5rem;">üìÖ</div>
                  <div>View Bookings</div>
                </button>
                <button class="quick-action-btn" onclick="showLabTab('labReports')" style="padding: 1rem; background: #17a2b8; color: white; border: none; border-radius: 8px; cursor: pointer;">
                  <div style="font-size: 1.5rem;">üìä</div>
                  <div>Generate Reports</div>
                </button>
                <button class="quick-action-btn" onclick="showLabTab('labStaff')" style="padding: 1rem; background: #6f42c1; color: white; border: none; border-radius: 8px; cursor: pointer;">
                  <div style="font-size: 1.5rem;">üë•</div>
                  <div>Manage Staff</div>
                </div>
              </div>
            </div>
          </div>

          <!-- Sample Management Tab -->
          <div id="sampleManagement" class="admin-tab-content">
            <div class="admin-content">
              <div class="admin-tab-header">
                <h2 class="admin-tab-title">Sample Management</h2>
                <div class="admin-tab-actions">
                  <button class="btn" onclick="openModal('receiveSampleModal')">+ Receive Sample</button>
                  <button class="btn-secondary" onclick="refreshSampleList()">üîÑ Refresh</button>
                </div>
              </div>
              
              <div class="admin-filters">
                <div class="filter-group">
                  <label>Status:</label>
                  <select id="sampleStatusFilter" onchange="filterSamples()">
                    <option value="">All Statuses</option>
                    <option value="received">Received</option>
                    <option value="processing">Processing</option>
                    <option value="completed">Completed</option>
                    <option value="urgent">Urgent</option>
                  </select>
                </div>
                <div class="filter-group">
                  <label>Test Type:</label>
                  <select id="testTypeFilter" onchange="filterSamples()">
                    <option value="">All Tests</option>
                    <option value="genetic">Genetic Testing</option>
                    <option value="blood">Blood Work</option>
                    <option value="hormone">Hormone Panel</option>
                  </select>
                </div>
                <div class="filter-group">
                  <label>Search:</label>
                  <input type="text" id="sampleSearch" placeholder="Search by sample ID or patient..." onkeyup="filterSamples()">
                </div>
              </div>

              <div class="admin-table-container">
                <table class="admin-table">
                  <thead>
                    <tr>
                      <th>Sample ID</th>
                      <th>Patient Name</th>
                      <th>Test Type</th>
                      <th>Received Date</th>
                      <th>Status</th>
                      <th>Priority</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody id="samplesTableBody">
                    <tr>
                      <td>SMB001</td>
                      <td>Sarah Johnson</td>
                      <td>Genetic Testing</td>
                      <td>2024-01-15 09:30</td>
                      <td><span class="status-badge processing">Processing</span></td>
                      <td><span class="priority-badge urgent">Urgent</span></td>
                      <td>
                        <button class="admin-action-btn process" onclick="processSample('SMB001')">Process</button>
                        <button class="admin-action-btn view" onclick="viewSampleDetails('SMB001')">Details</button>
                      </td>
                    </tr>
                    <tr>
                      <td>SMB002</td>
                      <td>Michael Chen</td>
                      <td>Blood Work</td>
                      <td>2024-01-15 10:45</td>
                      <td><span class="status-badge completed">Completed</span></td>
                      <td><span class="priority-badge normal">Normal</span></td>
                      <td>
                        <button class="admin-action-btn view" onclick="viewSampleDetails('SMB002')">Details</button>
                        <button class="admin-action-btn results" onclick="viewResults('SMB002')">Results</button>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>

          <!-- Lab Bookings Tab -->
          <div id="labBookings" class="admin-tab-content">
            <div class="admin-content">
              <div class="admin-tab-header">
                <h2 class="admin-tab-title">Lab Bookings</h2>
                <div class="admin-tab-actions">
                  <button class="btn-secondary" onclick="exportBookings()">üìä Export</button>
                </div>
              </div>

              <div class="admin-table-container">
                <table class="admin-table">
                  <thead>
                    <tr>
                      <th>Booking ID</th>
                      <th>Patient</th>
                      <th>Test(s)</th>
                      <th>Scheduled Date</th>
                      <th>Status</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody id="labBookingsTableBody">
                    <tr>
                      <td>LB001</td>
                      <td>Emma Wilson</td>
                      <td>Hormone Panel, Genetic Test</td>
                      <td>2024-01-16 14:00</td>
                      <td><span class="status-badge confirmed">Confirmed</span></td>
                      <td>
                        <button class="admin-action-btn edit" onclick="editLabBooking('LB001')">Edit</button>
                        <button class="admin-action-btn cancel" onclick="cancelLabBooking('LB001')">Cancel</button>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>

          <!-- Lab Reports Tab -->
          <div id="labReports" class="admin-tab-content">
            <div class="admin-content">
              <div class="admin-tab-header">
                <h2 class="admin-tab-title">Lab Reports & Analytics</h2>
                <div class="admin-tab-actions">
                  <button class="btn" onclick="generateReport()">üìä Generate Report</button>
                </div>
              </div>

              <div class="reports-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem;">
                <div class="report-card" style="background: #fff; padding: 1.5rem; border-radius: 8px; border: 1px solid #e9ecef;">
                  <h3>Daily Processing Report</h3>
                  <p>Samples processed today: <strong>114</strong></p>
                  <p>Average TAT: <strong>2.3 hours</strong></p>
                  <button class="btn-secondary" onclick="viewDetailedReport('daily')">View Details</button>
                </div>
                <div class="report-card" style="background: #fff; padding: 1.5rem; border-radius: 8px; border: 1px solid #e9ecef;">
                  <h3>Quality Metrics</h3>
                  <p>Accuracy Rate: <strong>99.2%</strong></p>
                  <p>Error Rate: <strong>0.8%</strong></p>
                  <button class="btn-secondary" onclick="viewDetailedReport('quality')">View Details</button>
                </div>
              </div>
            </div>
          </div>

          <!-- Lab Staff Tab -->
          <div id="labStaff" class="admin-tab-content">
            <div class="admin-content">
              <div class="admin-tab-header">
                <h2 class="admin-tab-title">Lab Staff Management</h2>
                <div class="admin-tab-actions">
                  <button class="btn" onclick="openModal('addStaffModal')">+ Add Staff</button>
                </div>
              </div>

              <div class="admin-table-container">
                <table class="admin-table">
                  <thead>
                    <tr>
                      <th>Staff ID</th>
                      <th>Name</th>
                      <th>Role</th>
                      <th>Shift</th>
                      <th>Status</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody id="labStaffTableBody">
                    <tr>
                      <td>ST001</td>
                      <td>Dr. James Miller</td>
                      <td>Lab Supervisor</td>
                      <td>Morning (8 AM - 4 PM)</td>
                      <td><span class="status-badge active">Active</span></td>
                      <td>
                        <button class="admin-action-btn edit" onclick="editStaff('ST001')">Edit</button>
                        <button class="admin-action-btn schedule" onclick="viewSchedule('ST001')">Schedule</button>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>

          <!-- Lab Settings Tab -->
          <div id="labSettings" class="admin-tab-content">
            <div class="admin-content">
              <div class="admin-tab-header">
                <h2 class="admin-tab-title">Lab Settings</h2>
                <div class="admin-tab-actions">
                  <button class="btn" onclick="saveLabSettings()">Save Settings</button>
                </div>
              </div>

              <div class="settings-sections">
                <div class="settings-section" style="background: #fff; padding: 1.5rem; border-radius: 8px; border: 1px solid #e9ecef; margin-bottom: 1.5rem;">
                  <h3>Lab Information</h3>
                  <div class="form-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem;">
                    <div>
                      <label>Lab Name:</label>
                      <input type="text" id="labName" value="Embrion IVF Lab - Central" style="width: 100%; padding: 0.5rem;">
                    </div>
                    <div>
                      <label>Lab Code:</label>
                      <input type="text" id="labCode" value="EMB-CNT-001" style="width: 100%; padding: 0.5rem;">
                    </div>
                  </div>
                </div>

                <div class="settings-section" style="background: #fff; padding: 1.5rem; border-radius: 8px; border: 1px solid #e9ecef;">
                  <h3>Operating Hours</h3>
                  <div class="form-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                    <div>
                      <label>Opening Time:</label>
                      <input type="time" id="labOpenTime" value="08:00" style="width: 100%; padding: 0.5rem;">
                    </div>
                    <div>
                      <label>Closing Time:</label>
                      <input type="time" id="labCloseTime" value="18:00" style="width: 100%; padding: 0.5rem;">
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Tab: Bookings Overview -->
        <div id="bookingsOverview" class="admin-tab-content">
          <div class="admin-tab-header">
            <h2 class="admin-tab-title">Bookings Overview</h2>
            <div class="admin-tab-actions">
              <button class="btn-secondary" onclick="exportBookings()">Export CSV</button>
              <button class="btn" onclick="openModal('addBookingModal')">+ Add Booking</button>
            </div>
          </div>
          
          <!-- Booking Status Tabs -->
          <div class="sub-tabs-container">
            <div class="sub-tabs">
              <button class="sub-tab active" data-status="all" onclick="switchBookingTab('all')">All Bookings</button>
              <button class="sub-tab" data-status="upcoming" onclick="switchBookingTab('upcoming')">Upcoming</button>
              <button class="sub-tab" data-status="completed" onclick="switchBookingTab('completed')">Completed</button>
              <button class="sub-tab" data-status="cancelled" onclick="switchBookingTab('cancelled')">Cancelled</button>
            </div>
          </div>
          
          <!-- Advanced Filters -->
          <div class="filters-container">
            <div class="filters-row">
              <div class="filter-group">
                <label>Date Range</label>
                <div class="date-range-inputs">
                  <input type="date" id="bookingDateFrom" onchange="filterBookings()" placeholder="From">
                  <span class="date-separator">to</span>
                  <input type="date" id="bookingDateTo" onchange="filterBookings()" placeholder="To">
                </div>
              </div>
              
              <div class="filter-group">
                <label>Status</label>
                <select id="bookingStatusFilter" onchange="filterBookings()">
                  <option value="">All Status</option>
                  <option value="confirmed">Confirmed</option>
                  <option value="pending">Pending</option>
                  <option value="completed">Completed</option>
                  <option value="cancelled">Cancelled</option>
                </select>
              </div>
              
              <div class="filter-group">
                <label>Lab</label>
                <select id="bookingLabFilter" onchange="filterBookings()">
                  <option value="">All Labs</option>
                  <option value="ivf1">IVF Center Mumbai</option>
                  <option value="ivf2">Advanced Fertility Delhi</option>
                  <option value="ivf3">Fertility Plus Bangalore</option>
                </select>
              </div>
              
              <div class="filter-group">
                <label>Doctor</label>
                <select id="bookingDoctorFilter" onchange="filterBookings()">
                  <option value="">All Doctors</option>
                  <option value="dr-verma">Dr. Anand Verma</option>
                  <option value="dr-sharma">Dr. Priya Sharma</option>
                  <option value="dr-gupta">Dr. Rahul Gupta</option>
                </select>
              </div>
              
              <div class="filter-group search-group">
                <label>Search</label>
                <div class="search-input-container">
                  <input type="text" id="bookingSearchInput" placeholder="Patient name, email, ID..." onkeyup="searchBookings()">
                  <span class="search-icon">üîç</span>
                </div>
              </div>
            </div>
            
            <div class="filters-actions">
              <button class="btn-secondary" onclick="clearBookingFilters()">Clear Filters</button>
              <button class="btn-secondary" onclick="toggleAdvancedFilters()">Advanced</button>
            </div>
          </div>
          
          <!-- Bookings Table -->
          <div class="bookings-table-container">
            <table class="admin-table bookings-table">
              <thead>
                <tr>
                  <th>Booking ID</th>
                  <th>Patient</th>
                  <th>Doctor</th>
                  <th>Lab</th>
                  <th>Date & Time</th>
                  <th>Service</th>
                  <th>Status</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="bookingsTableBody">
                <!-- Dynamic content will be inserted here -->
              </tbody>
            </table>
          </div>
          
          <!-- Pagination -->
          <div class="pagination-container">
            <div class="pagination-info">
              Showing <span id="bookingsPaginationInfo">1-10 of 50</span> bookings
            </div>
            <div class="pagination-controls">
              <button class="pagination-btn" onclick="changeBookingPage('prev')" id="prevBookingPageBtn">Previous</button>
              <div class="pagination-numbers" id="bookingPaginationNumbers">
                <!-- Dynamic page numbers will be inserted here -->
              </div>
              <button class="pagination-btn" onclick="changeBookingPage('next')" id="nextBookingPageBtn">Next</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Tab: Reports -->
      <div id="reportsTab" class="adminTab">
        <div class="admin-content">
          <div class="admin-header">
            <h2>Reports</h2>
            <div class="header-actions">
              <button class="btn" onclick="generateReport('all')">Generate All</button>
              <button class="btn-secondary" onclick="exportAllReports()">Export PDF</button>
            </div>
          </div>
          
          <div class="reports-grid">
            <div class="report-card" onclick="openReportModal('revenue')">
              <div class="report-icon">üí∞</div>
              <h3>Revenue Report</h3>
              <p>Track income and financial performance</p>
              <button class="btn-secondary" onclick="event.stopPropagation(); generateReport('revenue')">Generate</button>
            </div>
            
            <div class="report-card" onclick="openReportModal('utilization')">
              <div class="report-icon">üìä</div>
              <h3>Utilization Report</h3>
              <p>Monitor capacity and slot usage</p>
              <button class="btn-secondary" onclick="event.stopPropagation(); generateReport('utilization')">Generate</button>
            </div>
            
            <div class="report-card" onclick="openReportModal('noshow')">
              <div class="report-icon">‚ùå</div>
              <h3>No-show Rate</h3>
              <p>Track missed appointments</p>
              <button class="btn-secondary" onclick="event.stopPropagation(); generateReport('noshow')">Generate</button>
            </div>
            
            <div class="report-card" onclick="openReportModal('performance')">
              <div class="report-icon">üìà</div>
              <h3>Performance Report</h3>
              <p>Overall lab performance metrics</p>
              <button class="btn-secondary" onclick="event.stopPropagation(); generateReport('performance')">Generate</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Tab: User Roles -->
      <div id="userRolesTab" class="adminTab">
        <div class="admin-content">
          <div class="admin-header">
            <h2>User Roles</h2>
            <button class="btn" onclick="openModal('addRoleModal')">+ Add Role</button>
          </div>
          
          <div class="roles-table-container">
            <table class="admin-table roles-table">
              <thead>
                <tr>
                  <th>Role Name</th>
                  <th>Users Count</th>
                  <th>Permissions</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>Super Admin</td>
                  <td>2</td>
                  <td>All Permissions</td>
                  <td>
                    <button class="btn-icon" onclick="editRole('super-admin')" title="Edit Role">‚úé</button>
                  </td>
                </tr>
                <tr>
                  <td>Lab Staff</td>
                  <td>5</td>
                  <td>Manage Bookings, View Reports</td>
                  <td>
                    <button class="btn-icon" onclick="editRole('lab-staff')" title="Edit Role">‚úé</button>
                    <button class="btn-icon danger" onclick="deleteRole('lab-staff')" title="Delete Role">üóë</button>
                  </td>
                </tr>
                <tr>
                  <td>Billing</td>
                  <td>1</td>
                  <td>View Reports, Manage Invoices</td>
                  <td>
                    <button class="btn-icon" onclick="editRole('billing')" title="Edit Role">‚úé</button>
                    <button class="btn-icon danger" onclick="deleteRole('billing')" title="Delete Role">üóë</button>
                  </td>
                </tr>
                <tr>
                  <td>Receptionist</td>
                  <td>3</td>
                  <td>Manage Bookings</td>
                  <td>
                    <button class="btn-icon" onclick="editRole('receptionist')" title="Edit Role">‚úé</button>
                    <button class="btn-icon danger" onclick="deleteRole('receptionist')" title="Delete Role">üóë</button>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Tab: Support Tickets -->
      <div id="adminSupportTab" class="adminTab">
        <div class="admin-content">
          <div class="admin-header">
            <h2>Support Tickets</h2>
            <button class="btn" onclick="openModal('newTicketModal')">+ New Ticket</button>
          </div>
          
          <div class="support-filters">
            <select id="ticketStatusFilter" onchange="filterTickets()">
              <option value="all">All Status</option>
              <option value="open">Open</option>
              <option value="in-progress">In Progress</option>
              <option value="closed">Closed</option>
            </select>
            <select id="ticketCategoryFilter" onchange="filterTickets()">
              <option value="all">All Categories</option>
              <option value="booking">Booking</option>
              <option value="billing">Billing</option>
              <option value="technical">Technical</option>
              <option value="general">General</option>
            </select>
          </div>
          
          <div class="tickets-table-container">
            <table class="admin-table tickets-table">
              <thead>
                <tr>
                  <th>Ticket ID</th>
                  <th>Subject</th>
                  <th>Category</th>
                  <th>Status</th>
                  <th>Created</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                <tr onclick="viewAdminTicket('T1001')">
                  <td>T1001</td>
                  <td>Booking Issue - Cannot reschedule</td>
                  <td>Booking</td>
                  <td><span class="status-badge pending">Open</span></td>
                  <td>Jun 29, 2025</td>
                  <td>
                    <button class="btn-icon" onclick="event.stopPropagation(); viewAdminTicket('T1001')" title="View Ticket">üëÅ</button>
                    <button class="btn-icon" onclick="event.stopPropagation(); closeTicket('T1001')" title="Close Ticket">‚úÖ</button>
                  </td>
                </tr>
                <tr onclick="viewAdminTicket('T0998')">
                  <td>T0998</td>
                  <td>Invoice Query - Missing details</td>
                  <td>Billing</td>
                  <td><span class="status-badge completed">Closed</span></td>
                  <td>Jun 25, 2025</td>
                  <td>
                    <button class="btn-icon" onclick="event.stopPropagation(); viewAdminTicket('T0998')" title="View Ticket">üëÅ</button>
                    <button class="btn-icon disabled" disabled title="Already closed">‚úÖ</button>
                  </td>
                </tr>
                <tr onclick="viewAdminTicket('T0995')">
                  <td>T0995</td>
                  <td>Technical Issue - App not loading</td>
                  <td>Technical</td>
                  <td><span class="status-badge pending">In Progress</span></td>
                  <td>Jun 24, 2025</td>
                  <td>
                    <button class="btn-icon" onclick="event.stopPropagation(); viewAdminTicket('T0995')" title="View Ticket">üëÅ</button>
                    <button class="btn-icon" onclick="event.stopPropagation(); closeTicket('T0995')" title="Close Ticket">‚úÖ</button>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
      
        </div> <!-- End admin-content-area -->
      </div> <!-- End admin-main -->
    </section>

    <!-- Modals -->
    <div id="modalBackdrop" class="modal-backdrop"></div>
    
    <!-- User Management Modals -->
    <!-- View User Modal -->
    <div id="viewUserModal" class="user-modal">
      <div class="user-modal-content">
        <div class="user-modal-header">
          <h3>üë§ User Profile</h3>
          <button class="user-modal-close" onclick="closeUserModal('viewUserModal')">&times;</button>
        </div>
        <div class="user-modal-body" id="viewUserContent">
          <!-- Content populated by JavaScript -->
        </div>
        <div class="user-modal-actions">
          <button class="user-modal-btn secondary" onclick="closeUserModal('viewUserModal')">Close</button>
        </div>
      </div>
    </div>
    
    <!-- Edit User Modal -->
    <div id="editUserModal" class="user-modal">
      <div class="user-modal-content">
        <div class="user-modal-header">
          <h3>‚úèÔ∏è Edit User</h3>
          <button class="user-modal-close" onclick="closeUserModal('editUserModal')">&times;</button>
        </div>
        <div class="user-modal-body">
          <form id="editUserForm">
            <div class="form-group">
              <label>Full Name:</label>
              <input type="text" id="editUserName" required />
            </div>
            <div class="form-group">
              <label>Email:</label>
              <input type="email" id="editUserEmail" required />
            </div>
            <div class="form-group">
              <label>Mobile:</label>
              <input type="tel" id="editUserMobile" required />
            </div>
            <div class="form-group">
              <label>Role:</label>
              <select id="editUserRole">
                <option value="patient">Patient</option>
                <option value="doctor">Doctor</option>
                <option value="lab">IVF Lab</option>
              </select>
            </div>
            <div class="form-group">
              <label>Status:</label>
              <select id="editUserStatus">
                <option value="active">Active</option>
                <option value="inactive">Inactive</option>
                <option value="suspended">Suspended</option>
                <option value="pending">Pending</option>
              </select>
            </div>
          </form>
        </div>
        <div class="user-modal-actions">
          <button class="user-modal-btn secondary" onclick="closeUserModal('editUserModal')">Cancel</button>
          <button class="user-modal-btn primary" onclick="saveUserChanges()">Update</button>
        </div>
      </div>
    </div>
    
    <!-- Suspend/Reactivate Confirmation Modal -->
    <div id="suspendUserModal" class="user-modal">
      <div class="user-modal-content">
        <div class="user-modal-header">
          <h3>‚ö†Ô∏è Confirm Action</h3>
          <button class="user-modal-close" onclick="closeUserModal('suspendUserModal')">&times;</button>
        </div>
        <div class="user-modal-body">
          <p id="suspendUserMessage">Are you sure you want to suspend this user?</p>
        </div>
        <div class="user-modal-actions">
          <button class="user-modal-btn secondary" onclick="closeUserModal('suspendUserModal')">Cancel</button>
          <button class="user-modal-btn warning" id="suspendUserConfirm" onclick="confirmSuspendUser()">Suspend</button>
        </div>
      </div>
    </div>
    
    <!-- Delete User Confirmation Modal -->
    <div id="deleteUserModal" class="user-modal">
      <div class="user-modal-content">
        <div class="user-modal-header">
          <h3>üóëÔ∏è Delete User Permanently</h3>
          <button class="user-modal-close" onclick="closeUserModal('deleteUserModal')">&times;</button>
        </div>
        <div class="user-modal-body">
          <p>This action cannot be undone. Confirm deletion?</p>
        </div>
        <div class="user-modal-actions">
          <button class="user-modal-btn secondary" onclick="closeUserModal('deleteUserModal')">Cancel</button>
          <button class="user-modal-btn danger" onclick="confirmDeleteUser()">Delete</button>
        </div>
      </div>
    </div>
    
    <!-- Approve/Reject Lab Modal -->
    <div id="approveLabModal" class="user-modal">
      <div class="user-modal-content">
        <div class="user-modal-header">
          <h3 id="approveLabTitle">‚úÖ Approve IVF Lab Request</h3>
          <button class="user-modal-close" onclick="closeUserModal('approveLabModal')">&times;</button>
        </div>
        <div class="user-modal-body" id="approveLabContent">
          <!-- Content populated by JavaScript -->
        </div>
        <div class="user-modal-actions" id="approveLabActions">
          <button class="user-modal-btn secondary" onclick="closeUserModal('approveLabModal')">Cancel</button>
          <button class="user-modal-btn danger" onclick="showRejectLabForm()">Reject</button>
          <button class="user-modal-btn primary" onclick="confirmApproveLab()">Approve</button>
        </div>
      </div>
    </div>
    
    <!-- Reject Lab Form (within approve modal) -->
    <div id="rejectLabForm" style="display: none;">
      <div class="form-group">
        <label>Reason for rejection:</label>
        <textarea id="rejectLabReason" rows="4" placeholder="Enter reason for rejection..." style="width: 100%; padding: 8px; border: 1px solid #dee2e6; border-radius: 4px;"></textarea>
      </div>
    </div>
    
    <!-- Booking Management Modals -->
    <!-- Booking Details Modal -->
    <div id="bookingDetailsModal" class="user-modal">
      <div class="user-modal-content" style="max-width: 600px;">
        <div class="user-modal-header">
          <h3>üìã Booking Details</h3>
          <button class="user-modal-close" onclick="closeUserModal('bookingDetailsModal')">&times;</button>
        </div>
        <div class="user-modal-body" id="bookingDetailsContent">
          <!-- Content populated by JavaScript -->
        </div>
        <div class="user-modal-actions" id="bookingDetailsActions">
          <!-- Actions populated by JavaScript -->
        </div>
      </div>
    </div>
    
    <!-- Reschedule Booking Modal -->
    <div id="rescheduleBookingModal" class="user-modal">
      <div class="user-modal-content">
        <div class="user-modal-header">
          <h3>üîÅ Reschedule Booking</h3>
          <button class="user-modal-close" onclick="closeUserModal('rescheduleBookingModal')">&times;</button>
        </div>
        <div class="user-modal-body">
          <div class="form-group">
            <label>Select New Date & Time:</label>
            <div style="display: flex; gap: 12px; margin-top: 8px;">
              <input type="date" id="rescheduleNewDate" style="flex: 1;" />
              <input type="time" id="rescheduleNewTime" style="flex: 1;" />
            </div>
          </div>
          <div class="form-group">
            <label>Reason (Optional):</label>
            <textarea id="rescheduleReason" rows="3" placeholder="Enter reason for rescheduling..."></textarea>
          </div>
        </div>
        <div class="user-modal-actions">
          <button class="user-modal-btn secondary" onclick="closeUserModal('rescheduleBookingModal')">Cancel</button>
          <button class="user-modal-btn primary" onclick="confirmRescheduleBooking()">Confirm</button>
        </div>
      </div>
    </div>
    
    <!-- Cancel Booking Modal -->
    <div id="cancelBookingModal" class="user-modal">
      <div class="user-modal-content">
        <div class="user-modal-header">
          <h3>‚ùå Cancel Booking</h3>
          <button class="user-modal-close" onclick="closeUserModal('cancelBookingModal')">&times;</button>
        </div>
        <div class="user-modal-body">
          <div class="form-group">
            <label>Reason for Cancellation:</label>
            <textarea id="cancelBookingReason" rows="4" placeholder="Enter reason for cancellation..." required></textarea>
          </div>
        </div>
        <div class="user-modal-actions">
          <button class="user-modal-btn secondary" onclick="closeUserModal('cancelBookingModal')">Back</button>
          <button class="user-modal-btn danger" onclick="confirmCancelBooking()">Confirm Cancel</button>
        </div>
      </div>
    </div>
    
    <!-- Chat Log Modal -->
    <div id="chatLogModal" class="user-modal">
      <div class="user-modal-content" style="max-width: 600px;">
        <div class="user-modal-header">
          <h3>üí¨ Booking Chat Log</h3>
          <button class="user-modal-close" onclick="closeUserModal('chatLogModal')">&times;</button>
        </div>
        <div class="user-modal-body">
          <div id="chatLogContent" style="max-height: 400px; overflow-y: auto; border: 1px solid #dee2e6; padding: 16px; border-radius: 8px; background: #f8f9fa;">
            <!-- Chat messages populated by JavaScript -->
          </div>
        </div>
        <div class="user-modal-actions">
          <button class="user-modal-btn secondary" onclick="closeUserModal('chatLogModal')">Close</button>
        </div>
      </div>
    </div>
    
    <!-- Invoice Details Modal -->
    <div id="invoiceDetailsModal" class="user-modal">
      <div class="user-modal-content">
        <div class="user-modal-header">
          <h3>üßæ Invoice Details</h3>
          <button class="user-modal-close" onclick="closeUserModal('invoiceDetailsModal')">&times;</button>
        </div>
        <div class="user-modal-body" id="invoiceDetailsContent">
          <!-- Content populated by JavaScript -->
        </div>
        <div class="user-modal-actions">
          <button class="user-modal-btn secondary" onclick="closeUserModal('invoiceDetailsModal')">Close</button>
          <button class="user-modal-btn primary" onclick="downloadInvoicePDF()">Download PDF</button>
        </div>
      </div>
    </div>
    
    <!-- Enhanced Reschedule Modal -->
    <div id="rescheduleModal" class="modal">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;">
        <h3 style="margin:0;">Reschedule Booking</h3>
        <button onclick="closeModal('rescheduleModal')" style="background:none;border:none;font-size:18px;cursor:pointer;padding:4px;">‚úï</button>
      </div>
      
      <div class="reschedule-content">
        <div style="margin-bottom:16px;">
          <label style="display:block;font-weight:600;margin-bottom:8px;">New Date & Time</label>
          <div style="display:flex;gap:12px;">
            <input type="date" id="rescheduleDate" style="flex:1;" />
            <input type="time" id="rescheduleTime" style="flex:1;" />
          </div>
        </div>
        
        <div class="emergency-toggle" style="margin:16px 0;">
          <label class="toggle-switch">
            <input type="checkbox" id="emergencyReschedule" onchange="toggleEmergencyReschedule(this)">
            <span class="slider"></span>
          </label>
          <div style="flex:1;">
            <strong>Emergency Booking</strong>
            <div style="font-size:12px;color:var(--muted);">Additional charges may apply for bookings within 4 hours</div>
          </div>
        </div>
        
        <div id="rescheduleWarning" style="display:none;padding:12px;background:#fff3cd;border:1px solid #ffeaa7;border-radius:6px;margin:16px 0;">
          <strong>‚ö†Ô∏è Note:</strong> Rescheduling within 4 hours of appointment requires emergency booking.
        </div>
      </div>
      
      <footer>
        <button class="btn-secondary" onclick="closeModal('rescheduleModal')">Cancel</button>
        <button class="btn" onclick="confirmReschedule()" id="confirmRescheduleBtn">Confirm</button>
      </footer>
    </div>
    <!-- Enhanced Cancel Modal -->
    <div id="cancelModal" class="modal">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;">
        <h3 style="margin:0;">Cancel Booking</h3>
        <button onclick="closeModal('cancelModal')" style="background:none;border:none;font-size:18px;cursor:pointer;padding:4px;">‚úï</button>
      </div>
      
      <div class="cancel-content">
        <div style="margin-bottom:16px;">
          <label style="display:block;font-weight:600;margin-bottom:8px;">Reason for Cancellation</label>
          <textarea id="cancelReason" rows="3" placeholder="Please provide a reason for cancellation..." style="width:100%;padding:12px;border:1px solid #ddd;border-radius:6px;font-family:inherit;font-size:14px;"></textarea>
        </div>
        
        <div id="cancelWarning" style="padding:12px;background:#fff3cd;border:1px solid #ffeaa7;border-radius:6px;margin:16px 0;">
          <strong>‚ö†Ô∏è Warning:</strong> Cancellations within 4 hours of appointment require operator assistance and may incur charges.
        </div>
      </div>
      
      <footer>
        <button class="btn-secondary" onclick="closeModal('cancelModal')">Back</button>
        <button class="btn" onclick="confirmCancel()" id="confirmCancelBtn" style="background:#dc3545;">Submit</button>
      </footer>
    </div>
    <!-- Enhanced Chat Modal -->
    <div id="chatModal" class="modal" style="max-width:500px;">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;">
        <h3 style="margin:0;" id="chatModalTitle">Chat with Lab</h3>
        <button onclick="closeModal('chatModal')" style="background:none;border:none;font-size:18px;cursor:pointer;padding:4px;">‚úï</button>
      </div>
      
      <div id="chatMessages" style="height:300px;overflow-y:auto;border:1px solid #ddd;padding:16px;border-radius:6px;background:#f8f9fa;margin-bottom:16px;">
        <div style="margin-bottom:12px;padding:8px 12px;background:#e3f2fd;border-radius:12px 12px 12px 4px;max-width:80%;">
          <strong style="color:var(--primary);">Lab:</strong> Hello! We're looking forward to your appointment. Do you have any questions?
        </div>
        <div style="margin-bottom:12px;padding:8px 12px;background:var(--primary);color:#fff;border-radius:12px 12px 4px 12px;max-width:80%;margin-left:auto;">
          <strong>You:</strong> What time should I arrive?
        </div>
        <div style="margin-bottom:12px;padding:8px 12px;background:#e3f2fd;border-radius:12px 12px 12px 4px;max-width:80%;">
          <strong style="color:var(--primary);">Lab:</strong> Please arrive 15 minutes before your scheduled time. Don't forget to bring your ID!
        </div>
      </div>
      
      <div style="display:flex;gap:8px;">
        <textarea id="chatInput" rows="2" placeholder="Type your message..." style="flex:1;padding:12px;border:1px solid #ddd;border-radius:6px;font-family:inherit;font-size:14px;resize:vertical;"></textarea>
        <button class="btn" onclick="sendChatMessage()" style="align-self:flex-end;padding:12px 16px;height:fit-content;">
          <span>Send</span>
          <span style="margin-left:6px;">üì§</span>
        </button>
      </div>
    </div>

    <!-- View Report Modal -->
    <div id="viewReportModal" class="modal" style="max-width:700px;">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;">
        <h3 style="margin:0;" id="reportModalTitle">Test Report</h3>
        <button onclick="closeModal('viewReportModal')" style="background:none;border:none;font-size:18px;cursor:pointer;padding:4px;">‚úï</button>
      </div>
      
      <div id="reportContent" style="text-align:center;padding:40px 20px;">
        <div style="font-size:48px;margin-bottom:16px;">üìÑ</div>
        <h4 style="margin:0 0 8px 0;">Report Available</h4>
        <p style="color:var(--muted);margin:0 0 20px 0;">Your test report is ready for download.</p>
        <div style="display:flex;gap:12px;justify-content:center;">
          <button class="btn" onclick="downloadReport()">
            <span>üì•</span>
            <span style="margin-left:6px;">Download PDF</span>
          </button>
          <button class="btn-secondary" onclick="emailReport()">
            <span>üìß</span>
            <span style="margin-left:6px;">Email Report</span>
          </button>
        </div>
      </div>
      
      <footer>
        <button class="btn-secondary" onclick="closeModal('viewReportModal')">Close</button>
      </footer>
    </div>

    <!-- Feedback Modal -->
    <div id="feedbackModal" class="modal" style="max-width:500px;">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;">
        <h3 style="margin:0;">Provide Feedback</h3>
        <button onclick="closeModal('feedbackModal')" style="background:none;border:none;font-size:18px;cursor:pointer;padding:4px;">‚úï</button>
      </div>
      
      <div class="feedback-content">
        <div style="margin-bottom:20px;">
          <label style="display:block;font-weight:600;margin-bottom:8px;">Rate your experience</label>
          <div class="rating-stars" style="display:flex;gap:4px;font-size:24px;">
            <span class="star-rating-btn" data-rating="1" onclick="setRating(1)">‚≠ê</span>
            <span class="star-rating-btn" data-rating="2" onclick="setRating(2)">‚≠ê</span>
            <span class="star-rating-btn" data-rating="3" onclick="setRating(3)">‚≠ê</span>
            <span class="star-rating-btn" data-rating="4" onclick="setRating(4)">‚≠ê</span>
            <span class="star-rating-btn" data-rating="5" onclick="setRating(5)">‚≠ê</span>
          </div>
          <div id="ratingText" style="margin-top:8px;font-size:14px;color:var(--muted);"></div>
        </div>
        
        <div style="margin-bottom:16px;">
          <label style="display:block;font-weight:600;margin-bottom:8px;">Comments (optional)</label>
          <textarea id="feedbackComments" rows="4" placeholder="Share your experience with this lab..." style="width:100%;padding:12px;border:1px solid #ddd;border-radius:6px;font-family:inherit;font-size:14px;"></textarea>
        </div>
        
        <div style="margin-bottom:16px;">
          <label style="display:flex;align-items:center;gap:8px;font-size:14px;">
            <input type="checkbox" id="recommendLab" style="width:auto;margin:0;">
            <span>I would recommend this lab to others</span>
          </label>
        </div>
      </div>
      
      <footer>
        <button class="btn-secondary" onclick="closeModal('feedbackModal')">Cancel</button>
        <button class="btn" onclick="submitFeedback()" id="submitFeedbackBtn">Submit Feedback</button>
      </footer>
    </div>

    <!-- Add Payment Method Modal -->
    <div id="addPaymentModal" class="modal">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;">
        <h3 style="margin:0;">Add Payment Method</h3>
        <button onclick="closeModal('addPaymentModal')" style="background:none;border:none;font-size:18px;cursor:pointer;padding:4px;">‚úï</button>
      </div>
      <label for="addCardNumber" style="display:block;font-weight:600;margin-bottom:4px;">Card Number</label>
      <input type="text" id="addCardNumber" placeholder="1234 5678 9012 3456" maxlength="19" style="margin-bottom:12px;" />
      
      <label for="addCardholderName" style="display:block;font-weight:600;margin-bottom:4px;">Name on Card</label>
      <input type="text" id="addCardholderName" placeholder="John Doe" style="margin-bottom:12px;" />
      
      <div style="display:flex;gap:12px;margin-bottom:12px;">
        <div style="flex:1;">
          <label for="addExpiryDate" style="display:block;font-weight:600;margin-bottom:4px;">Expiry (MM/YY)</label>
          <input type="text" id="addExpiryDate" placeholder="12/25" maxlength="5" />
        </div>
        <div style="flex:1;">
          <label for="addCvv" style="display:block;font-weight:600;margin-bottom:4px;">CVV</label>
          <input type="password" id="addCvv" placeholder="123" maxlength="3" />
        </div>
      </div>
      <p style="font-size:12px;color:var(--muted);margin:8px 0 16px 0;">We never store your CVV.</p>
      
      <footer>
        <button class="btn-secondary" onclick="closeModal('addPaymentModal')">Cancel</button>
        <button class="btn" onclick="addPaymentMethod()">Save</button>
      </footer>
    </div>

    <!-- Edit Payment Method Modal -->
    <div id="editPaymentModal" class="modal">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;">
        <h3 style="margin:0;">Edit Payment Method</h3>
        <button onclick="closeModal('editPaymentModal')" style="background:none;border:none;font-size:18px;cursor:pointer;padding:4px;">‚úï</button>
      </div>
      <label for="editCardNumber" style="display:block;font-weight:600;margin-bottom:4px;">Card Number</label>
      <input type="text" id="editCardNumber" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢ 4242" maxlength="19" style="margin-bottom:12px;" />
      
      <label for="editCardholderName" style="display:block;font-weight:600;margin-bottom:4px;">Name on Card</label>
      <input type="text" id="editCardholderName" placeholder="Sarah Doe" style="margin-bottom:12px;" />
      
      <div style="display:flex;gap:12px;margin-bottom:12px;">
        <div style="flex:1;">
          <label for="editExpiryDate" style="display:block;font-weight:600;margin-bottom:4px;">Expiry (MM/YY)</label>
          <input type="text" id="editExpiryDate" placeholder="12/25" maxlength="5" />
        </div>
        <div style="flex:1;">
          <label for="editCvv" style="display:block;font-weight:600;margin-bottom:4px;">CVV</label>
          <input type="password" id="editCvv" placeholder="***" maxlength="3" />
        </div>
      </div>
      <p style="font-size:12px;color:var(--muted);margin:8px 0 16px 0;">We never store your CVV.</p>
      
      <footer>
        <button class="btn-secondary" onclick="closeModal('editPaymentModal')">Cancel</button>
        <button class="btn" onclick="saveEditedPaymentMethod()">Save</button>
      </footer>
    </div>

    <!-- Delete Payment Method Confirmation -->
    <div id="deletePaymentModal" class="modal" style="max-width:350px;">
      <h3>Confirm Delete</h3>
      <p id="deletePaymentText">Are you sure you want to delete this payment method? This action cannot be undone.</p>
      <footer>
        <button class="btn-secondary" onclick="closeModal('deletePaymentModal')">Cancel</button>
        <button class="btn" onclick="confirmDeletePayment()" style="background:#dc3545;">Delete Card</button>
      </footer>
    </div>

    <!-- Patient Change Password Modal -->
    <div id="patientChangePasswordModal" class="modal">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;">
        <h3 style="margin:0;">Change Password</h3>
        <button onclick="closeModal('patientChangePasswordModal')" style="background:none;border:none;font-size:18px;cursor:pointer;padding:4px;">‚úï</button>
      </div>
      <label for="currentPassword" style="display:block;font-weight:600;margin-bottom:4px;">Current Password</label>
      <input type="password" id="currentPassword" style="margin-bottom:12px;" />
      
      <label for="newPassword" style="display:block;font-weight:600;margin-bottom:4px;">New Password</label>
      <input type="password" id="newPassword" oninput="checkPasswordStrength()" style="margin-bottom:4px;" />
      <div id="passwordStrength" class="strength-indicator"></div>
      
      <label for="confirmPassword" style="display:block;font-weight:600;margin-bottom:4px;margin-top:12px;">Confirm Password</label>
      <input type="password" id="confirmPassword" oninput="checkPasswordMatch()" style="margin-bottom:12px;" />
      <div id="passwordMatch" class="strength-indicator"></div>
      
      <footer>
        <button class="btn-secondary" onclick="closeModal('patientChangePasswordModal')">Cancel</button>
        <button class="btn" onclick="changePassword()">Update</button>
      </footer>
    </div>

    <!-- Logout Confirmation Modal -->
    <div id="logoutModal" class="modal">
      <h3>Confirm Logout?</h3>
      <p>Are you sure you want to logout? You will need to sign in again to access your account.</p>
      <footer>
        <button class="btn-secondary" onclick="closeModal('logoutModal')">Cancel</button>
        <button class="btn" onclick="performLogout()" style="background:#dc3545;">Logout</button>
      </footer>
    </div>

    <!-- View Details Modal -->
    <div id="viewDetailsModal" class="modal" style="max-width:600px;">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;">
        <h3 style="margin:0;" id="detailsTitle">Service Details</h3>
        <button onclick="closeModal('viewDetailsModal')" style="background:none;border:none;font-size:18px;cursor:pointer;padding:4px;">‚úï</button>
      </div>
      <div id="detailsContent">
        <div class="lab-overview" style="display:flex;align-items:center;gap:16px;margin-bottom:16px;">
          <div class="lab-logo" id="detailsLogo">üè•</div>
          <div class="lab-info" style="flex:1;">
            <h4 style="margin:0;" id="detailsLabName">PathLab Diagnostics</h4>
            <div class="lab-rating" id="detailsRating">‚≠ê 4.5 (245 reviews)</div>
            <p style="margin:4px 0;color:var(--muted);" id="detailsAddress">üìç 123 Medical Center, Downtown</p>
          </div>
          <button class="favorite-btn" onclick="toggleFavorite(this)">ü§ç</button>
        </div>
        
        <div class="service-overview" style="margin-bottom:20px;">
          <h4 style="margin:0;color:var(--primary);" id="detailsServiceName">Complete Blood Count (CBC)</h4>
          <p style="font-size:18px;font-weight:600;color:var(--accent);margin:4px 0;" id="detailsPrice">‚Çπ299</p>
          <div class="service-meta" style="display:flex;gap:16px;font-size:14px;color:var(--muted);">
            <span>‚è±Ô∏è 30 mins</span>
            <span>üöó 2.3 km</span>
            <span>üìÖ Available Today</span>
          </div>
        </div>

        <div class="collapsible active">
          <div class="collapsible-header" onclick="toggleCollapsible(this)">
            <span>üìã Test Details</span>
            <span class="chevron">‚ñº</span>
          </div>
          <div class="collapsible-content">
            <p><strong>Description:</strong> A complete blood count (CBC) is a blood test used to evaluate your overall health and detect a wide range of disorders.</p>
            <p><strong>Parameters Tested:</strong></p>
            <ul>
              <li>Red Blood Cell Count</li>
              <li>White Blood Cell Count</li>
              <li>Hemoglobin Level</li>
              <li>Hematocrit</li>
              <li>Platelet Count</li>
            </ul>
            <p><strong>Report Timeline:</strong> 24-48 hours</p>
          </div>
        </div>

        <div class="collapsible">
          <div class="collapsible-header" onclick="toggleCollapsible(this)">
            <span>üìù Pre-test Instructions</span>
            <span class="chevron">‚ñ∂</span>
          </div>
          <div class="collapsible-content">
            <h5>Before Your Test:</h5>
            <ul>
              <li>No fasting required for this test</li>
              <li>Stay hydrated - drink plenty of water</li>
              <li>Wear comfortable clothing with sleeves that can be rolled up</li>
              <li>Inform the technician of any medications you're taking</li>
            </ul>
            <h5>What to Bring:</h5>
            <ul>
              <li>Valid photo ID</li>
              <li>Doctor's prescription (if applicable)</li>
              <li>Previous test reports for comparison</li>
            </ul>
          </div>
        </div>

        <div class="collapsible">
          <div class="collapsible-header" onclick="toggleCollapsible(this)">
            <span>üè• Lab Information</span>
            <span class="chevron">‚ñ∂</span>
          </div>
          <div class="collapsible-content">
            <p><strong>Address:</strong> 123 Medical Center, Downtown, City - 400001</p>
            <p><strong>Phone:</strong> +91 9876543210</p>
            <p><strong>Timings:</strong> Mon-Sat: 8:00 AM - 8:00 PM, Sun: 9:00 AM - 5:00 PM</p>
            <p><strong>Facilities:</strong></p>
            <ul>
              <li>‚úÖ Home Sample Collection</li>
              <li>‚úÖ Online Reports</li>
              <li>‚úÖ Parking Available</li>
              <li>‚úÖ AC Waiting Room</li>
            </ul>
          </div>
        </div>
      </div>
      <footer style="display:flex;justify-content:space-between;align-items:center;margin-top:20px;">
        <label class="compare-checkbox" style="display:flex;align-items:center;gap:8px;">
          <input type="checkbox" onchange="toggleCompare('lab1-cbc')"> Add to Compare
        </label>
        <div style="display:flex;gap:8px;">
          <button class="btn-secondary" onclick="closeModal('viewDetailsModal')">Close</button>
          <button class="btn" onclick="openBookingModal()">Book Now</button>
        </div>
      </footer>
    </div>

    <!-- Comparison Results Modal -->
    <div id="comparisonModal" class="modal" style="max-width:800px;">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;">
        <h3 style="margin:0;">Lab Comparison</h3>
        <button onclick="closeModal('comparisonModal')" style="background:none;border:none;font-size:18px;cursor:pointer;padding:4px;">‚úï</button>
      </div>
      <div id="comparisonTable" style="overflow-x:auto;">
        <!-- Comparison table will be generated here -->
      </div>
      <footer>
        <button class="btn-secondary" onclick="closeModal('comparisonModal')">Close</button>
      </footer>
    </div>

    <!-- Booking Modal -->
    <div id="bookingModal" class="modal" style="max-width:700px;">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;">
        <button onclick="goBackToDetails()" style="background:none;border:none;font-size:16px;cursor:pointer;display:flex;align-items:center;gap:4px;color:var(--primary);">‚Üê Back</button>
        <h3 style="margin:0;">Select Appointment</h3>
        <button onclick="closeModal('bookingModal')" style="background:none;border:none;font-size:18px;cursor:pointer;padding:4px;">‚úï</button>
      </div>
      
      <div id="bookingContent">
        <!-- Service Summary -->
        <div class="service-summary" style="background:#f8f9fa;padding:16px;border-radius:8px;margin-bottom:20px;">
          <div style="display:flex;align-items:center;gap:12px;">
            <div class="lab-logo">üè•</div>
            <div>
              <h4 style="margin:0;">Complete Blood Count (CBC)</h4>
              <p style="margin:4px 0;color:var(--muted);">PathLab Diagnostics</p>
              <p style="margin:0;font-weight:600;color:var(--accent);">‚Çπ299</p>
            </div>
          </div>
        </div>

        <!-- Date Selection -->
        <div style="margin-bottom:20px;">
          <h5 style="margin-bottom:12px;">üìÖ Select Date</h5>
          <div class="date-carousel">
            <button class="date-nav" onclick="navigateDate(-1)">‚Äπ</button>
            <div class="date-item active" onclick="selectDate(this, '2025-07-03')">
              <div style="font-size:12px;color:var(--muted);">Today</div>
              <div style="font-weight:600;">Jul 3</div>
            </div>
            <div class="date-item" onclick="selectDate(this, '2025-07-04')">
              <div style="font-size:12px;color:var(--muted);">Tomorrow</div>
              <div style="font-weight:600;">Jul 4</div>
            </div>
            <div class="date-item" onclick="selectDate(this, '2025-07-05')">
              <div style="font-size:12px;color:var(--muted);">Wed</div>
              <div style="font-weight:600;">Jul 5</div>
            </div>
            <div class="date-item" onclick="selectDate(this, '2025-07-06')">
              <div style="font-size:12px;color:var(--muted);">Thu</div>
              <div style="font-weight:600;">Jul 6</div>
            </div>
            <button class="date-nav" onclick="navigateDate(1)">‚Ä∫</button>
          </div>
        </div>

        <!-- Time Slot Selection -->
        <div class="time-slots-container" style="margin-bottom:20px;">
          <h5 style="margin-bottom:12px;">‚è∞ Available Slots (15 min intervals)</h5>
          <div class="time-slots">
            <div class="time-slot" onclick="selectTimeSlot(this, '08:00')">08:00</div>
            <div class="time-slot" onclick="selectTimeSlot(this, '08:15')">08:15</div>
            <div class="time-slot" onclick="selectTimeSlot(this, '08:30')">08:30</div>
            <div class="time-slot" onclick="selectTimeSlot(this, '08:45')">08:45</div>
            <div class="time-slot" onclick="selectTimeSlot(this, '09:00')">09:00</div>
            <div class="time-slot" onclick="selectTimeSlot(this, '09:15')">09:15</div>
            <div class="time-slot disabled">12:00</div>
            <div class="time-slot disabled">12:30</div>
            <div class="time-slot" onclick="selectTimeSlot(this, '14:00')">14:00</div>
            <div class="time-slot" onclick="selectTimeSlot(this, '14:15')">14:15</div>
            <div class="time-slot" onclick="selectTimeSlot(this, '14:30')">14:30</div>
            <div class="time-slot" onclick="selectTimeSlot(this, '14:45')">14:45</div>
          </div>
        </div>

        <!-- Emergency Toggle -->
        <div class="emergency-toggle">
          <input type="checkbox" id="emergencyBooking" onchange="toggleEmergency(this)">
          <label for="emergencyBooking" style="cursor:pointer;">
            <span style="font-weight:600;">üö® Emergency Booking</span>
            <p style="margin:4px 0 0 0;font-size:14px;color:var(--muted);">Additional charges may apply for urgent processing (bypass 4-hr cutoff)</p>
          </label>
        </div>
      </div>
      
      <footer style="display:flex;gap:8px;margin-top:20px;">
        <button class="btn-secondary" onclick="closeModal('bookingModal')">Cancel</button>
        <button class="btn" onclick="openConfirmPayModal()" id="proceedBookingBtn" disabled>Proceed to Payment</button>
      </footer>
    </div>

    <!-- Confirm & Pay Modal -->
    <div id="confirmPayModal" class="modal" style="max-width:600px;">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;">
        <h3 style="margin:0;">Confirm & Pay</h3>
        <button onclick="closeModal('confirmPayModal')" style="background:none;border:none;font-size:18px;cursor:pointer;padding:4px;">‚úï</button>
      </div>
      
      <div id="confirmPayContent">
        <!-- Booking Summary -->
        <div class="booking-summary">
          <h5 style="margin-top:0;">üìã Booking Summary</h5>
          <div style="display:flex;justify-content:space-between;margin:8px 0;">
            <span>Service:</span>
            <span>Complete Blood Count (CBC)</span>
          </div>
          <div style="display:flex;justify-content:space-between;margin:8px 0;">
            <span>Lab:</span>
            <span>PathLab Diagnostics</span>
          </div>
          <div style="display:flex;justify-content:space-between;margin:8px 0;">
            <span>Date & Time:</span>
            <span id="selectedDateTime">Dec 15, 9:00 AM</span>
          </div>
          <div style="display:flex;justify-content:space-between;margin:8px 0;">
            <span>Base Price:</span>
            <span>‚Çπ299</span>
          </div>
          <div style="display:flex;justify-content:space-between;margin:8px 0;" id="emergencyCharges" style="display:none;">
            <span>Emergency Charges:</span>
            <span>‚Çπ50</span>
          </div>
          <hr>
          <div style="display:flex;justify-content:space-between;font-weight:600;font-size:16px;">
            <span>Total Amount:</span>
            <span id="totalAmount">‚Çπ299</span>
          </div>
        </div>

        <!-- Payment Method -->
        <div class="payment-selector">
          <h5>üí≥ Payment Method</h5>
          <select class="payment-dropdown" onchange="selectPaymentMethod(this)">
            <option value="">Select Payment Method</option>
            <option value="card">Credit/Debit Card</option>
            <option value="upi">UPI</option>
            <option value="wallet">Digital Wallet</option>
            <option value="netbanking">Net Banking</option>
          </select>
        </div>

        <!-- Terms & Conditions -->
        <div style="margin:16px 0;">
          <label style="display:flex;align-items:flex-start;gap:8px;font-size:14px;">
            <input type="checkbox" id="acceptTerms" onchange="toggleConfirmButton()">
            <span>I agree to the <a href="#" style="color:var(--primary);">Terms & Conditions</a> and <a href="#" style="color:var(--primary);">Privacy Policy</a></span>
          </label>
        </div>
      </div>
      
      <footer style="display:flex;gap:8px;margin-top:20px;">
        <button class="btn-secondary" onclick="goBackToBooking()">Back</button>
        <button class="btn" onclick="confirmBooking()" id="confirmPayBtn" disabled>Confirm & Pay</button>
      </footer>
    </div>

    <!-- Doctor Dashboard Modals -->
    
    <!-- Add Patient Modal -->
    <div id="addPatientModal" class="modal">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;">
        <h3 style="margin:0;">Add New Patient</h3>
        <button onclick="closeModal('addPatientModal')" style="background:none;border:none;font-size:18px;cursor:pointer;padding:4px;">‚úï</button>
      </div>
      
      <div class="patient-form">
        <div style="display:flex;gap:12px;margin-bottom:16px;">
          <div style="flex:1;">
            <label style="display:block;margin-bottom:4px;font-weight:500;">First Name *</label>
            <input type="text" id="patientFirstName" placeholder="Enter first name" style="width:100%;" />
          </div>
          <div style="flex:1;">
            <label style="display:block;margin-bottom:4px;font-weight:500;">Last Name *</label>
            <input type="text" id="patientLastName" placeholder="Enter last name" style="width:100%;" />
          </div>
        </div>
        
        <div style="display:flex;gap:12px;margin-bottom:16px;">
          <div style="flex:1;">
            <label style="display:block;margin-bottom:4px;font-weight:500;">Age *</label>
            <input type="number" id="patientAge" placeholder="Age" min="1" max="120" style="width:100%;" />
          </div>
          <div style="flex:1;">
            <label style="display:block;margin-bottom:4px;font-weight:500;">Gender *</label>
            <select id="patientGender" style="width:100%;">
              <option value="">Select Gender</option>
              <option value="male">Male</option>
              <option value="female">Female</option>
              <option value="other">Other</option>
            </select>
          </div>
        </div>
        
        <div style="margin-bottom:16px;">
          <label style="display:block;margin-bottom:4px;font-weight:500;">Phone Number *</label>
          <input type="tel" id="patientPhone" placeholder="+91 9876543210" style="width:100%;" />
        </div>
        
        <div style="margin-bottom:16px;">
          <label style="display:block;margin-bottom:4px;font-weight:500;">Email</label>
          <input type="email" id="patientEmail" placeholder="patient@email.com" style="width:100%;" />
        </div>
        
        <div style="margin-bottom:16px;">
          <label style="display:block;margin-bottom:4px;font-weight:500;">Address</label>
          <textarea id="patientAddress" rows="3" placeholder="Enter patient address" style="width:100%;resize:vertical;"></textarea>
        </div>
      </div>
      
      <footer>
        <button class="btn-secondary" onclick="closeModal('addPatientModal')">Cancel</button>
        <button class="btn" onclick="saveNewPatient()">Add Patient</button>
      </footer>
    </div>

    <!-- Edit Patient Modal -->
    <div id="editPatientModal" class="modal">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;">
        <h3 style="margin:0;">Edit Patient</h3>
        <button onclick="closeModal('editPatientModal')" style="background:none;border:none;font-size:18px;cursor:pointer;padding:4px;">‚úï</button>
      </div>
      
      <div class="patient-form">
        <div style="display:flex;gap:12px;margin-bottom:16px;">
          <div style="flex:1;">
            <label style="display:block;margin-bottom:4px;font-weight:500;">First Name *</label>
            <input type="text" id="editPatientFirstName" placeholder="Enter first name" style="width:100%;" />
          </div>
          <div style="flex:1;">
            <label style="display:block;margin-bottom:4px;font-weight:500;">Last Name *</label>
            <input type="text" id="editPatientLastName" placeholder="Enter last name" style="width:100%;" />
          </div>
        </div>
        
        <div style="display:flex;gap:12px;margin-bottom:16px;">
          <div style="flex:1;">
            <label style="display:block;margin-bottom:4px;font-weight:500;">Age *</label>
            <input type="number" id="editPatientAge" placeholder="Age" min="1" max="120" style="width:100%;" />
          </div>
          <div style="flex:1;">
            <label style="display:block;margin-bottom:4px;font-weight:500;">Gender *</label>
            <select id="editPatientGender" style="width:100%;">
              <option value="">Select Gender</option>
              <option value="male">Male</option>
              <option value="female">Female</option>
              <option value="other">Other</option>
            </select>
          </div>
        </div>
        
        <div style="margin-bottom:16px;">
          <label style="display:block;margin-bottom:4px;font-weight:500;">Phone Number *</label>
          <input type="tel" id="editPatientPhone" placeholder="+91 9876543210" style="width:100%;" />
        </div>
        
        <div style="margin-bottom:16px;">
          <label style="display:block;margin-bottom:4px;font-weight:500;">Email</label>
          <input type="email" id="editPatientEmail" placeholder="patient@email.com" style="width:100%;" />
        </div>
        
        <div style="margin-bottom:16px;">
          <label style="display:block;margin-bottom:4px;font-weight:500;">Address</label>
          <textarea id="editPatientAddress" rows="3" placeholder="Enter patient address" style="width:100%;resize:vertical;"></textarea>
        </div>
      </div>
      
      <footer>
        <button class="btn-secondary" onclick="closeModal('editPatientModal')">Cancel</button>
        <button class="btn" onclick="updatePatient()">Update Patient</button>
      </footer>
    </div>

    <!-- View Doctor Booking Modal -->
    <div id="viewDoctorBookingModal" class="modal">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;">
        <h3 style="margin:0;">Booking Details</h3>
        <button onclick="closeModal('viewDoctorBookingModal')" style="background:none;border:none;font-size:18px;cursor:pointer;padding:4px;">‚úï</button>
      </div>
      
      <div class="booking-details-content">
        <div class="detail-section">
          <h4>Patient Information</h4>
          <p><strong>Name:</strong> <span id="viewBookingPatientName">John Doe</span></p>
          <p><strong>ID:</strong> <span id="viewBookingPatientId">P001</span></p>
          <p><strong>Phone:</strong> <span id="viewBookingPatientPhone">+91 9876543210</span></p>
        </div>
        
        <div class="detail-section">
          <h4>Service Information</h4>
          <p><strong>Service:</strong> <span id="viewBookingService">Complete Blood Count (CBC)</span></p>
          <p><strong>Lab:</strong> <span id="viewBookingLab">City Lab</span></p>
          <p><strong>Price:</strong> <span id="viewBookingPrice">‚Çπ500</span></p>
        </div>
        
        <div class="detail-section">
          <h4>Appointment Details</h4>
          <p><strong>Date:</strong> <span id="viewBookingDate">March 25, 2024</span></p>
          <p><strong>Time:</strong> <span id="viewBookingTime">10:00 AM</span></p>
          <p><strong>Status:</strong> <span id="viewBookingStatus" class="status-badge confirmed">Confirmed</span></p>
        </div>
      </div>
      
      <footer>
        <button class="btn-secondary" onclick="closeModal('viewDoctorBookingModal')">Close</button>
      </footer>
    </div>

    <!-- Cancel Doctor Booking Modal -->
    <div id="cancelDoctorBookingModal" class="modal">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;">
        <h3 style="margin:0;">Cancel Booking</h3>
        <button onclick="closeModal('cancelDoctorBookingModal')" style="background:none;border:none;font-size:18px;cursor:pointer;padding:4px;">‚úï</button>
      </div>
      
      <div style="margin-bottom:20px;">
        <p>Are you sure you want to cancel this booking?</p>
        <div style="background:#fff3cd;border:1px solid #ffeaa7;border-radius:var(--radius);padding:12px;margin:12px 0;">
          <p style="margin:0;font-size:14px;color:#856404;">
            <strong>‚ö†Ô∏è Note:</strong> Cancelling less than 24 hours before the appointment may incur charges.
          </p>
        </div>
        
        <div style="margin-top:16px;">
          <label style="display:block;margin-bottom:8px;font-weight:500;">Reason for cancellation:</label>
          <select id="cancellationReason" style="width:100%;margin-bottom:12px;">
            <option value="">Select reason</option>
            <option value="patient-request">Patient requested</option>
            <option value="schedule-conflict">Schedule conflict</option>
            <option value="medical-reason">Medical reason</option>
            <option value="emergency">Emergency</option>
            <option value="other">Other</option>
          </select>
          
          <textarea id="cancellationNotes" rows="3" placeholder="Additional notes (optional)" style="width:100%;resize:vertical;"></textarea>
        </div>
      </div>
      
      <footer>
        <button class="btn-secondary" onclick="closeModal('cancelDoctorBookingModal')">Keep Booking</button>
        <button class="btn" onclick="confirmDoctorBookingCancellation()" style="background:#dc3545;">Cancel Booking</button>
      </footer>
    </div>

    <!-- View Invoice Modal -->
    <div id="viewInvoiceModal" class="modal">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;">
        <h3 style="margin:0;">Invoice Details</h3>
        <button onclick="closeModal('viewInvoiceModal')" style="background:none;border:none;font-size:18px;cursor:pointer;padding:4px;">‚úï</button>
      </div>
      
      <div class="invoice-content">
        <div class="invoice-header-info">
          <h4 id="viewInvoiceNumber">Invoice #INV001</h4>
          <p>Date: <span id="viewInvoiceDate">March 20, 2024</span></p>
        </div>
        
        <div class="invoice-patient-info">
          <h5>Patient Details</h5>
          <p><strong>Name:</strong> <span id="viewInvoicePatientName">John Doe</span></p>
          <p><strong>ID:</strong> <span id="viewInvoicePatientId">P001</span></p>
        </div>
        
        <div class="invoice-service-info">
          <h5>Service Details</h5>
          <p><strong>Service:</strong> <span id="viewInvoiceService">Complete Blood Count (CBC)</span></p>
          <p><strong>Lab:</strong> <span id="viewInvoiceLab">City Lab</span></p>
          <p><strong>Amount:</strong> <span id="viewInvoiceAmount">‚Çπ500</span></p>
        </div>
        
        <div class="invoice-status-info">
          <h5>Payment Status</h5>
          <p><span id="viewInvoiceStatus" class="status-badge completed">Paid</span></p>
        </div>
      </div>
      
      <footer>
        <button class="btn-secondary" onclick="closeModal('viewInvoiceModal')">Close</button>
        <button class="btn-secondary" onclick="downloadInvoice()">Download PDF</button>
      </footer>
    </div>

    <!-- Pay Invoice Modal -->
    <div id="payInvoiceModal" class="modal">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;">
        <h3 style="margin:0;">Pay Invoice</h3>
        <button onclick="closeModal('payInvoiceModal')" style="background:none;border:none;font-size:18px;cursor:pointer;padding:4px;">‚úï</button>
      </div>
      
      <div class="payment-info">
        <div class="invoice-summary">
          <h4 id="payInvoiceNumber">Invoice #INV002</h4>
          <p>Patient: <span id="payInvoicePatient">Jane Smith</span></p>
          <p>Service: <span id="payInvoiceService">Liver Function Test (LFT)</span></p>
          <p class="amount">Amount: <span id="payInvoiceAmount">‚Çπ800</span></p>
        </div>
        
        <div style="margin:16px 0;">
          <label style="display:block;margin-bottom:8px;font-weight:500;">Payment Method:</label>
          <select id="invoicePaymentMethod" style="width:100%;">
            <option value="card">Credit/Debit Card</option>
            <option value="upi">UPI</option>
            <option value="wallet">Digital Wallet</option>
            <option value="netbanking">Net Banking</option>
          </select>
        </div>
      </div>
      
      <footer>
        <button class="btn-secondary" onclick="closeModal('payInvoiceModal')">Cancel</button>
        <button class="btn" onclick="processInvoicePayment()">Pay Now</button>
      </footer>
    </div>

    <!-- New Support Ticket Modal -->
    <div id="newTicketModal" class="modal">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;">
        <h3 style="margin:0;">New Support Ticket</h3>
        <button onclick="closeModal('newTicketModal')" style="background:none;border:none;font-size:18px;cursor:pointer;padding:4px;">‚úï</button>
      </div>
      
      <div class="ticket-form">
        <div style="margin-bottom:16px;">
          <label style="display:block;margin-bottom:4px;font-weight:500;">Subject *</label>
          <input type="text" id="ticketSubject" placeholder="Booking Issue" style="width:100%;" />
        </div>
        
        <div style="margin-bottom:16px;">
          <label style="display:block;margin-bottom:4px;font-weight:500;">Category *</label>
          <select id="ticketCategory" style="width:100%;">
            <option value="booking">Booking</option>
            <option value="billing">Billing</option>
            <option value="technical">Technical Issues</option>
            <option value="account">Account Access</option>
            <option value="other">Other</option>
          </select>
        </div>
        
        <div style="margin-bottom:16px;">
          <label style="display:block;margin-bottom:4px;font-weight:500;">Description *</label>
          <textarea id="ticketDescription" rows="4" placeholder="Please describe your issue in detail..." style="width:100%;resize:vertical;"></textarea>
        </div>
      </div>
      
      <footer>
        <button class="btn-secondary" onclick="closeModal('newTicketModal')">Cancel</button>
        <button class="btn" onclick="createSupportTicket()">Submit Ticket</button>
      </footer>
    </div>

    <!-- View Ticket Conversation Modal -->
    <div id="viewTicketModal" class="modal" style="max-width:600px;">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;">
        <h3 style="margin:0;">Ticket Conversation</h3>
        <button onclick="closeModal('viewTicketModal')" style="background:none;border:none;font-size:18px;cursor:pointer;padding:4px;">‚úï</button>
      </div>
      
      <div class="ticket-conversation">
        <div class="ticket-header-info">
          <h4 id="conversationTicketId">Ticket #T3005</h4>
          <p id="conversationTicketSubject">Lab Access Issue</p>
          <div style="display:flex;gap:12px;margin:8px 0;">
            <span id="conversationTicketStatus" class="status-badge pending">Open</span>
          </div>
        </div>
        
        <div class="conversation-messages" style="max-height:300px;overflow-y:auto;border:1px solid #e1e5e9;border-radius:var(--radius);padding:12px;margin:16px 0;" id="conversationMessages">
          <div class="message support-message">
            <div class="message-header">
              <strong>Support Team</strong>
              <span class="message-time">July 1, 2025 - 09:30 AM</span>
            </div>
            <p>We are checking your account access. Please provide your registration number for verification.</p>
          </div>
          
          <div class="message user-message">
            <div class="message-header">
              <strong>Dr. Sarah Patel</strong>
              <span class="message-time">July 1, 2025 - 10:15 AM</span>
            </div>
            <p>Please expedite, as patient needs test. My registration is MCI-123456.</p>
          </div>
        </div>
        
        <div class="reply-section">
          <div style="display:flex;gap:8px;margin-bottom:8px;">
            <button class="btn-secondary" onclick="triggerFileUpload()" style="display:flex;align-items:center;gap:4px;padding:8px 12px;">
              üìé Attach File
            </button>
            <input type="file" id="ticketFileUpload" accept=".pdf,.jpg,.jpeg,.png" style="display:none;" onchange="handleFileUpload(this)" />
            <span id="attachedFileName" style="font-size:12px;color:var(--muted);line-height:32px;"></span>
          </div>
          <textarea id="ticketReply" rows="3" placeholder="Type your reply..." style="width:100%;resize:vertical;margin-bottom:12px;"></textarea>
          <button class="btn" onclick="sendTicketReply()" style="float:right;">Send</button>
          <div style="clear:both;"></div>
        </div>
      </div>
      
      <footer style="margin-top:20px;">
        <button class="btn-secondary" onclick="closeModal('viewTicketModal')">Close</button>
      </footer>
    </div>

    <!-- Edit Profile Modal -->
    <div id="editProfileModal" class="modal" style="max-width:500px;">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;">
        <h3 style="margin:0;">Edit Profile</h3>
        <button onclick="closeModal('editProfileModal')" style="background:none;border:none;font-size:18px;cursor:pointer;padding:4px;">‚úï</button>
      </div>
      
      <div class="edit-profile-form">
        <div style="margin-bottom:16px;">
          <label style="display:block;margin-bottom:4px;font-weight:500;">Full Name *</label>
          <input type="text" id="editProfileName" placeholder="Dr. Sarah Patel" style="width:100%;" />
        </div>
        
        <div style="margin-bottom:16px;">
          <label style="display:block;margin-bottom:4px;font-weight:500;">Specialty *</label>
          <input type="text" id="editProfileSpecialty" placeholder="Reproductive Endocrinology" style="width:100%;" />
        </div>
        
        <div style="margin-bottom:16px;">
          <label style="display:block;margin-bottom:4px;font-weight:500;">Registration No *</label>
          <input type="text" id="editProfileRegistration" placeholder="MCI-123456" style="width:100%;" />
        </div>
        
        <div style="margin-bottom:16px;">
          <label style="display:block;margin-bottom:4px;font-weight:500;">Clinic *</label>
          <input type="text" id="editProfileClinic" placeholder="City Fertility Clinic" style="width:100%;" />
        </div>
        
        <div style="margin-bottom:16px;">
          <label style="display:block;margin-bottom:4px;font-weight:500;">Email *</label>
          <input type="email" id="editProfileEmail" placeholder="sarah.patel@clinic.com" style="width:100%;" />
        </div>
        
        <div style="margin-bottom:16px;">
          <label style="display:block;margin-bottom:4px;font-weight:500;">Phone *</label>
          <input type="tel" id="editProfilePhone" placeholder="+91 98765 43210" style="width:100%;" />
        </div>
        
        <div style="margin-bottom:16px;">
          <label style="display:block;margin-bottom:4px;font-weight:500;">Years of Experience *</label>
          <input type="number" id="editProfileExperience" placeholder="12" min="0" max="50" style="width:100%;" />
        </div>
      </div>
      
      <footer>
        <button class="btn-secondary" onclick="closeModal('editProfileModal')">Cancel</button>
        <button class="btn" onclick="saveProfileChanges()">Save Changes</button>
      </footer>
    </div>

    <!-- Change Password Modal -->
    <div id="changePasswordModal" class="modal" style="max-width:450px;">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;">
        <h3 style="margin:0;">Change Password</h3>
        <button onclick="closeModal('changePasswordModal')" style="background:none;border:none;font-size:18px;cursor:pointer;padding:4px;">‚úï</button>
      </div>
      
      <div class="change-password-form">
        <div style="margin-bottom:16px;">
          <label style="display:block;margin-bottom:4px;font-weight:500;">Current Password *</label>
          <input type="password" id="currentPasswordInput" placeholder="Enter current password" style="width:100%;" />
        </div>
        
        <div style="margin-bottom:16px;">
          <label style="display:block;margin-bottom:4px;font-weight:500;">New Password *</label>
          <input type="password" id="newPasswordInput" placeholder="Enter new password" oninput="checkNewPasswordStrength()" style="width:100%;" />
          <div id="newPasswordStrength" class="password-strength-indicator"></div>
        </div>
        
        <div style="margin-bottom:16px;">
          <label style="display:block;margin-bottom:4px;font-weight:500;">Confirm Password *</label>
          <input type="password" id="confirmPasswordInput" placeholder="Confirm new password" oninput="checkNewPasswordMatch()" style="width:100%;" />
          <div id="confirmPasswordMatch" class="password-strength-indicator"></div>
        </div>
      </div>
      
      <footer>
        <button class="btn-secondary" onclick="closeModal('changePasswordModal')">Cancel</button>
        <button class="btn" onclick="updatePassword()">Update Password</button>
      </footer>
    </div>

  <!-- Doctor Footer Navigation -->
  <nav class="doctor-footer" id="doctorFooterNav" style="display:none;">
    <div class="doctor-footer-item active" onclick="showDoctorTab('bookForPatientTab')">üìÖ<br>Book</div>
    <div class="doctor-footer-item" onclick="showDoctorTab('myPatientsTab')">üë•<br>Patients</div>
    <div class="doctor-footer-item" onclick="showDoctorTab('doctorBookingsTab')">üìã<br>Bookings</div>
    <div class="doctor-footer-item" onclick="showDoctorTab('invoicesTab')">üí∞<br>Invoices</div>
    <div class="doctor-footer-item" onclick="showDoctorTab('doctorSupportTab')">üí¨<br>Support</div>
    <div class="doctor-footer-item" onclick="showDoctorTab('doctorProfileTab')">üë§<br>Profile</div>
  </nav>

    <!-- Admin Dashboard Modals -->
    
    <!-- Add Service Modal -->
    <div id="addServiceModal" class="modal" style="max-width:600px;">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;">
        <h3 style="margin:0;">Add Service</h3>
        <button onclick="closeModal('addServiceModal')" style="background:none;border:none;font-size:18px;cursor:pointer;padding:4px;">‚úï</button>
      </div>
      
      <form id="addServiceForm" onsubmit="addService(); return false;">
        <div style="margin-bottom:16px;">
          <label style="display:block;margin-bottom:4px;font-weight:500;">Service Code *</label>
          <input type="text" name="serviceCode" placeholder="e.g., HP01" required style="width:100%;" />
        </div>
        
        <div style="margin-bottom:16px;">
          <label style="display:block;margin-bottom:4px;font-weight:500;">Service Name *</label>
          <input type="text" name="serviceName" placeholder="e.g., Health Panel" required style="width:100%;" />
        </div>
        
        <div style="display:flex;gap:12px;margin-bottom:16px;">
          <div style="flex:2;">
            <label style="display:block;margin-bottom:4px;font-weight:500;">Base Price *</label>
            <input type="number" name="servicePrice" placeholder="2000" min="0" required style="width:100%;" />
          </div>
          <div style="flex:1;">
            <label style="display:block;margin-bottom:4px;font-weight:500;">Currency</label>
            <select name="serviceCurrency" style="width:100%;">
              <option value="INR">INR</option>
              <option value="USD">USD</option>
              <option value="EUR">EUR</option>
            </select>
          </div>
        </div>
        
        <div style="display:flex;gap:12px;margin-bottom:16px;">
          <div style="flex:1;">
            <label style="display:block;margin-bottom:4px;font-weight:500;">Turnaround Time (hrs) *</label>
            <input type="number" name="serviceTat" placeholder="24" min="1" required style="width:100%;" />
          </div>
          <div style="flex:1;">
            <label style="display:block;margin-bottom:4px;font-weight:500;">Duration (min)</label>
            <input type="number" name="serviceDuration" placeholder="30" min="5" style="width:100%;" />
          </div>
        </div>
        
        <div style="margin-bottom:16px;">
          <label style="display:block;margin-bottom:4px;font-weight:500;">Sample Type</label>
          <select name="sampleType" style="width:100%;">
            <option value="">Select Sample Type</option>
            <option value="blood">Blood</option>
            <option value="urine">Urine</option>
            <option value="saliva">Saliva</option>
            <option value="tissue">Tissue</option>
            <option value="other">Other</option>
          </select>
        </div>
        
        <div style="margin-bottom:16px;">
          <label style="display:block;margin-bottom:4px;font-weight:500;">Pre-test Instructions</label>
          <textarea name="preTestInstructions" rows="2" placeholder="Any special instructions for the patient" style="width:100%;resize:vertical;"></textarea>
        </div>
        
        <div style="margin-bottom:16px;">
          <label style="display:flex;align-items:center;gap:8px;">
            <input type="checkbox" name="enableBundles" />
            <span>Enable Bundle Options</span>
          </label>
        </div>
        
        <footer>
          <button type="button" class="btn-secondary" onclick="closeModal('addServiceModal')">Cancel</button>
          <button type="submit" class="btn">Save Service</button>
        </footer>
      </form>
    </div>

    <!-- Edit Service Modal -->
    <div id="editServiceModal" class="modal" style="max-width:600px;">>
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;">
        <h3 style="margin:0;">Edit Service</h3>
        <button onclick="closeModal('editServiceModal')" style="background:none;border:none;font-size:18px;cursor:pointer;padding:4px;">‚úï</button>
      </div>
      
      <form id="editServiceForm" onsubmit="updateService(); return false;">
        <input type="hidden" name="serviceCode" id="editServiceCode" />
        
        <div style="margin-bottom:16px;">
          <label style="display:block;margin-bottom:4px;font-weight:500;">Service Code</label>
          <input type="text" id="editServiceCodeDisplay" disabled style="width:100%;background:#f8f9fa;" />
        </div>
        
        <div style="margin-bottom:16px;">
          <label style="display:block;margin-bottom:4px;font-weight:500;">Service Name *</label>
          <input type="text" name="serviceName" id="editServiceName" required style="width:100%;" />
        </div>
        
        <div style="display:flex;gap:12px;margin-bottom:16px;">
          <div style="flex:2;">
            <label style="display:block;margin-bottom:4px;font-weight:500;">Base Price *</label>
            <input type="number" name="servicePrice" id="editServicePrice" min="0" required style="width:100%;" />
          </div>
          <div style="flex:1;">
            <label style="display:block;margin-bottom:4px;font-weight:500;">Currency</label>
            <select name="serviceCurrency" id="editServiceCurrency" style="width:100%;">
              <option value="INR">INR</option>
              <option value="USD">USD</option>
              <option value="EUR">EUR</option>
            </select>
          </div>
        </div>
        
        <div style="margin-bottom:16px;">
          <label style="display:block;margin-bottom:4px;font-weight:500;">Turnaround Time (hrs) *</label>
          <input type="number" name="serviceTat" id="editServiceTat" min="1" required style="width:100%;" />
        </div>
        
        <footer>
          <button type="button" class="btn-secondary" onclick="closeModal('editServiceModal')">Cancel</button>
          <button type="submit" class="btn">Update Service</button>
        </footer>
      </form>
    </div>

    <!-- Booking Details Modal -->
    <div id="bookingDetailsModal" class="modal" style="max-width:500px;">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;">
        <h3 style="margin:0;">Booking Details</h3>
        <button onclick="closeModal('bookingDetailsModal')" style="background:none;border:none;font-size:18px;cursor:pointer;padding:4px;">‚úï</button>
      </div>
      
      <div id="bookingDetailsContent">
        <!-- Content will be populated by JavaScript -->
      </div>
      
      <footer>
        <button class="btn-secondary" onclick="closeModal('bookingDetailsModal')">Close</button>
        <button class="btn" onclick="cancelBookingFromDetails()" style="background:#dc3545;">Cancel Booking</button>
      </footer>
    </div>

    <!-- Report Modal -->
    <div id="reportModal" class="modal" style="max-width:700px;">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;">
        <h3 style="margin:0;" id="reportTitle">Report</h3>
        <button onclick="closeModal('reportModal')" style="background:none;border:none;font-size:18px;cursor:pointer;padding:4px;">‚úï</button>
      </div>
      
      <div id="reportContent">
        <!-- Report content will be populated by JavaScript -->
      </div>
      
      <footer>
        <button class="btn-secondary" onclick="closeModal('reportModal')">Close</button>
        <button class="btn" onclick="downloadReport()">üì• Download</button>
      </footer>
    </div>

    <!-- Add Role Modal -->
    <div id="addRoleModal" class="modal">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;">
        <h3 style="margin:0;">Add Role</h3>
        <button onclick="closeModal('addRoleModal')" style="background:none;border:none;font-size:18px;cursor:pointer;padding:4px;">‚úï</button>
      </div>
      
      <form id="addRoleForm" onsubmit="addRole(); return false;">
        <div style="margin-bottom:16px;">
          <label style="display:block;margin-bottom:4px;font-weight:500;">Role Name *</label>
          <input type="text" name="roleName" placeholder="e.g., Lab Technician" required style="width:100%;" />
        </div>
        
        <div style="margin-bottom:16px;">
          <label style="display:block;margin-bottom:4px;font-weight:500;">Description</label>
          <textarea name="roleDescription" rows="2" placeholder="Brief description of the role" style="width:100%;resize:vertical;"></textarea>
        </div>
        
        <div style="margin-bottom:16px;">
          <label style="display:block;margin-bottom:8px;font-weight:500;">Permissions</label>
          <div style="display:grid;grid-template-columns:repeat(2,1fr);gap:8px;">
            <label style="display:flex;align-items:center;gap:6px;">
              <input type="checkbox" value="manage_bookings" />
              <span>Manage Bookings</span>
            </label>
            <label style="display:flex;align-items:center;gap:6px;">
              <input type="checkbox" value="process_samples" />
              <span>Process Samples</span>
            </label>
            <label style="display:flex;align-items:center;gap:6px;">
              <input type="checkbox" value="update_results" />
              <span>Update Results</span>
            </label>
            <label style="display:flex;align-items:center;gap:6px;">
              <input type="checkbox" value="view_reports" />
              <span>View Reports</span>
            </label>
            <label style="display:flex;align-items:center;gap:6px;">
              <input type="checkbox" value="manage_staff" />
              <span>Manage Staff</span>
            </label>
            <label style="display:flex;align-items:center;gap:6px;">
              <input type="checkbox" value="customer_service" />
              <span>Customer Service</span>
            </label>
          </div>
        </div>
        
        <footer>
          <button type="button" class="btn-secondary" onclick="closeModal('addRoleModal')">Cancel</button>
          <button type="submit" class="btn">Add Role</button>
        </footer>
      </form>
    </div>

    <!-- Edit Role Modal -->
    <div id="editRoleModal" class="modal">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;">
        <h3 style="margin:0;">Edit Role</h3>
        <button onclick="closeModal('editRoleModal')" style="background:none;border:none;font-size:18px;cursor:pointer;padding:4px;">‚úï</button>
      </div>
      
      <form id="editRoleForm" onsubmit="updateRole(); return false;">
        <input type="hidden" name="roleId" id="editRoleId" />
        
        <div style="margin-bottom:16px;">
          <label style="display:block;margin-bottom:4px;font-weight:500;">Role Name *</label>
          <input type="text" name="roleName" id="editRoleName" required style="width:100%;" />
        </div>
        
        <div style="margin-bottom:16px;">
          <label style="display:block;margin-bottom:4px;font-weight:500;">Description</label>
          <textarea name="roleDescription" id="editRoleDescription" rows="2" style="width:100%;resize:vertical;"></textarea>
        </div>
        
        <div style="margin-bottom:16px;">
          <label style="display:block;margin-bottom:8px;font-weight:500;">Permissions</label>
          <div style="display:grid;grid-template-columns:repeat(2,1fr);gap:8px;">
            <label style="display:flex;align-items:center;gap:6px;">
              <input type="checkbox" value="manage_bookings" />
              <span>Manage Bookings</span>
            </label>
            <label style="display:flex;align-items:center;gap:6px;">
              <input type="checkbox" value="process_samples" />
              <span>Process Samples</span>
            </label>
            <label style="display:flex;align-items:center;gap:6px;">
              <input type="checkbox" value="update_results" />
              <span>Update Results</span>
            </label>
            <label style="display:flex;align-items:center;gap:6px;">
              <input type="checkbox" value="view_reports" />
              <span>View Reports</span>
            </label>
            <label style="display:flex;align-items:center;gap:6px;">
              <input type="checkbox" value="manage_staff" />
              <span>Manage Staff</span>
            </label>
            <label style="display:flex;align-items:center;gap:6px;">
              <input type="checkbox" value="customer_service" />
              <span>Customer Service</span>
            </label>
          </div>
        </div>
        
        <footer>
          <button type="button" class="btn-secondary" onclick="closeModal('editRoleModal')">Cancel</button>
          <button type="submit" class="btn">Update Role</button>
        </footer>
      </form>
    </div>

    <!-- New Ticket Modal -->
    <div id="newTicketModal" class="modal">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;">
        <h3 style="margin:0;">New Support Ticket</h3>
        <button onclick="closeModal('newTicketModal')" style="background:none;border:none;font-size:18px;cursor:pointer;padding:4px;">‚úï</button>
      </div>
      
      <form id="newTicketForm" onsubmit="createNewTicket(); return false;">
        <div style="margin-bottom:16px;">
          <label style="display:block;margin-bottom:4px;font-weight:500;">Subject *</label>
          <input type="text" name="newTicketSubject" placeholder="Brief description of the issue" required style="width:100%;" />
        </div>
        
        <div style="display:flex;gap:12px;margin-bottom:16px;">
          <div style="flex:1;">
            <label style="display:block;margin-bottom:4px;font-weight:500;">Category</label>
            <select name="newTicketCategory" style="width:100%;">
              <option value="technical">Technical Issue</option>
              <option value="booking">Booking Related</option>
              <option value="billing">Billing & Payment</option>
              <option value="general">General Inquiry</option>
              <option value="urgent">Urgent</option>
            </select>
          </div>
          <div style="flex:1;">
            <label style="display:block;margin-bottom:4px;font-weight:500;">Priority</label>
            <select name="newTicketPriority" style="width:100%;">
              <option value="low">Low</option>
              <option value="medium" selected>Medium</option>
              <option value="high">High</option>
            </select>
          </div>
        </div>
        
        <div style="margin-bottom:16px;">
          <label style="display:block;margin-bottom:4px;font-weight:500;">Description *</label>
          <textarea name="newTicketDescription" rows="4" placeholder="Please provide detailed information about the issue" required style="width:100%;resize:vertical;"></textarea>
        </div>
        
        <footer>
          <button type="button" class="btn-secondary" onclick="closeModal('newTicketModal')">Cancel</button>
          <button type="submit" class="btn">Submit Ticket</button>
        </footer>
      </form>
    </div>

    <!-- Ticket Conversation Modal -->
    <div id="ticketConversationModal" class="modal" style="max-width:600px;">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;">
        <div>
          <h3 style="margin:0;">Ticket <span id="ticketConversationId">#T001</span></h3>
          <p style="margin:4px 0 0 0;color:var(--muted);" id="ticketConversationSubject">Subject</p>
        </div>
        <button onclick="closeModal('ticketConversationModal')" style="background:none;border:none;font-size:18px;cursor:pointer;padding:4px;">‚úï</button>
      </div>
      
      <div style="display:flex;gap:12px;margin-bottom:16px;">
        <div>
          <strong>Status:</strong> <span id="ticketConversationStatus">Open</span>
        </div>
        <div>
          <strong>Priority:</strong> <span id="ticketConversationPriority">Medium</span>
        </div>
      </div>
      
      <div id="ticketMessages" style="height:300px;overflow-y:auto;border:1px solid #ddd;padding:16px;border-radius:6px;background:#f8f9fa;margin-bottom:16px;">
        <!-- Messages will be populated by JavaScript -->
      </div>
      
      <div style="display:flex;gap:8px;margin-bottom:16px;">
        <textarea id="adminTicketReply" rows="2" placeholder="Type your reply..." style="flex:1;padding:12px;border:1px solid #ddd;border-radius:6px;font-family:inherit;font-size:14px;resize:vertical;"></textarea>
        <button class="btn" onclick="addTicketReply()" style="align-self:flex-end;padding:12px 16px;height:fit-content;">Send</button>
      </div>
      
      <div style="display:flex;gap:8px;">
        <select onchange="updateTicketStatus(document.getElementById('ticketConversationId').textContent.replace('#', ''), this.value)" style="flex:1;">
          <option value="">Change Status</option>
          <option value="Open">Open</option>
          <option value="In Progress">In Progress</option>
          <option value="Resolved">Resolved</option>
          <option value="Closed">Closed</option>
        </select>
      </div>
      
      <footer>
        <button class="btn-secondary" onclick="closeModal('ticketConversationModal')">Close</button>
      </footer>
    </div>

  <nav class="footer" id="footerNav" style="display:none;">
    <div class="footer-item active" onclick="showPatientTab('searchTab')">üîç<br>Search</div>
    <div class="footer-item" onclick="showPatientTab('bookingsTab')">üìÖ<br>Bookings</div>
    <div class="footer-item" onclick="showPatientTab('supportTab')">üí¨<br>Support</div>
    <div class="footer-item" onclick="showPatientTab('profileTab')">üë§<br>Profile</div>
  </nav>

  <script>
    // Tab switching for Lab Admin Dashboard
    function showLabTab(tabId) {
      document.querySelectorAll('.labTab').forEach(tab => tab.style.display = 'none');
      document.getElementById(tabId).style.display = 'block';
      document.querySelectorAll('.admin-nav-tab').forEach(tab => tab.classList.remove('active'));
      const navTabs = Array.from(document.querySelectorAll('.admin-nav-tab'));
      const tabIndex = ['overviewTab','scheduleTab','servicesTab','doctorAccessTab','bookingsTab','invoicesTab','supportTab','profileTab'].indexOf(tabId);
      if (navTabs[tabIndex]) navTabs[tabIndex].classList.add('active');
    }
    // Blocked Slot Modal
    function openAddBlockedSlotModal() { document.getElementById('blockedSlotModal').style.display = 'block'; }
    function closeAddBlockedSlotModal() { document.getElementById('blockedSlotModal').style.display = 'none'; }
    function saveBlockedSlot() { alert('Blocked slot saved!'); closeAddBlockedSlotModal(); }
    // Add Service Modal
    function openAddServiceModal() { document.getElementById('addServiceModalLab').style.display = 'block'; }
    function closeAddServiceModal() { document.getElementById('addServiceModalLab').style.display = 'none'; }
    function saveNewService() { alert('Service added!'); closeAddServiceModal(); }
    // Edit/Deactivate Service
    function editService() { alert('Edit service (not implemented)'); }
    function deactivateService() { alert('Service deactivated!'); }
    // Doctor Access
    function approveDoctor(id) { alert('Doctor approved: ' + id); }
    function revokeDoctor(id) { alert('Doctor revoked: ' + id); }
    function viewDoctorDetails(id) { alert('Viewing details for: ' + id); }
    // Bookings
    function openRescheduleModal(id) { alert('Open reschedule modal for ' + id); }
    function openCancelModal(id) { alert('Open cancel modal for ' + id); }
    function openChatModal(id) { alert('Open chat modal for ' + id); }
    function viewBookingDetails(id) { alert('View booking details for ' + id); }
    // Invoices
    function downloadInvoice(month) { alert('Download invoice for ' + month); }
    // Support
    function replySupport(id) { alert('Reply to support ticket ' + id); }
    function viewSupport(id) { alert('View support ticket ' + id); }
    function openRaiseTicketModal() { document.getElementById('raiseTicketModal').style.display = 'block'; }
    function closeRaiseTicketModal() { document.getElementById('raiseTicketModal').style.display = 'none'; }
    function submitSupportTicket() { alert('Support ticket submitted!'); closeRaiseTicketModal(); }
    // Profile
    function saveLabProfile() { alert('Lab profile saved!'); }
    // Overview
    function viewLabReports() { alert('Viewing lab reports...'); }
    function downloadLabSummary() { alert('Lab summary downloaded!'); }
    function editSlots() { alert('Edit slots (not implemented)'); }

    // Note: showAdminLoginFromMain and showAdminLogin are defined in an earlier script block
    
    function doLogin(){
      console.log('doLogin called');
      const selectedRole = document.getElementById('roleSelect').value;
      console.log('Selected role:', selectedRole);
      
      // Hide login screen
      const loginScreen = document.getElementById('login');
      console.log('Login screen found:', !!loginScreen);
      loginScreen.classList.remove('active');
      
      // Show logout button
      document.getElementById('logoutBtn').style.display = 'block';
      
      // Store current user session
      localStorage.setItem('userSession', JSON.stringify({
        role: selectedRole,
        loginTime: new Date().toISOString()
      }));
      
      // Show appropriate dashboard based on role
      if (selectedRole === 'patient') {
        const patientDash = document.getElementById('patientDash');
        console.log('Patient dash found:', !!patientDash);
        if (patientDash) {
          patientDash.classList.add('active');
          console.log('Patient dash activated');
        }
        document.getElementById('footerNav').style.display = 'flex';
        document.getElementById('doctorFooterNav').style.display = 'none';
      } else if (selectedRole === 'doctor') {
        const doctorDash = document.getElementById('doctorDash');
        console.log('Doctor dash found:', !!doctorDash);
        if (doctorDash) {
          doctorDash.classList.add('active');
          console.log('Doctor dash activated');
        }
        document.getElementById('doctorFooterNav').style.display = 'flex';
        document.getElementById('footerNav').style.display = 'none';
      } else if (selectedRole === 'admin') {
        const adminDash = document.getElementById('adminDash');
        console.log('Admin dash found:', !!adminDash);
        if (adminDash) {
          adminDash.classList.add('active');
          console.log('Admin dash activated');
        }
        document.getElementById('footerNav').style.display = 'none';
        document.getElementById('doctorFooterNav').style.display = 'none';
        // Initialize Lab Admin dashboard
        try {
          initializeLabAdmin();
        } catch (e) {
          console.error('Error initializing Lab Admin:', e);
        }
      }
    }
    
    function logout(){
      // Check if admin is logged in
      const adminSession = localStorage.getItem('adminSession');
      const userSession = localStorage.getItem('userSession');
      
      // Clear sessions
      localStorage.removeItem('userSession');
      localStorage.removeItem('adminSession');
      
      // Hide logout button
      document.getElementById('logoutBtn').style.display = 'none';
      
      // Hide all dashboard screens
      document.querySelectorAll('.screen').forEach(screen => {
        screen.classList.remove('active');
      });
      
      // Hide footer navigation
      document.getElementById('footerNav').style.display = 'none';
      document.getElementById('doctorFooterNav').style.display = 'none';
      
      // Show appropriate login screen
      if (adminSession) {
        // If admin was logged in, show admin login
        document.getElementById('adminLogin').classList.add('active');
      } else {
        // If regular user was logged in, show main login
        document.getElementById('login').classList.add('active');
        
        // Clear login form
        document.getElementById('emailInput').value = '';
        document.getElementById('passInput').value = '';
      }
      
      // Show logout confirmation
      alert('Successfully logged out!');
    }
    
    function showPatientTab(id){
      ['searchTab','bookingsTab','supportTab','profileTab'].forEach(t=>document.getElementById(t).classList.remove('active'));
      document.getElementById(id).classList.add('active');
      document.querySelectorAll('#footerNav .footer-item').forEach(el=>el.classList.remove('active'));
      const idx={'searchTab':0,'bookingsTab':1,'supportTab':2,'profileTab':3}[id];
      document.querySelectorAll('#footerNav .footer-item')[idx].classList.add('active');
    }

    // File Upload Functions for Support Tickets
    function triggerFileUpload() {
      document.getElementById('ticketFileUpload').click();
    }
    
    function handleFileUpload(input) {
      const file = input.files[0];
      if (!file) return;
      
      // Validate file size (5MB limit)
      const maxSize = 5 * 1024 * 1024; // 5MB in bytes
      if (file.size > maxSize) {
        alert('File size exceeds 5MB limit. Please choose a smaller file.');
        input.value = '';
        document.getElementById('attachedFileName').textContent = '';
        return;
      }
      
      // Validate file type
      const allowedTypes = ['application/pdf', 'image/jpeg', 'image/jpg', 'image/png'];
      if (!allowedTypes.includes(file.type)) {
        alert('Invalid file type. Please upload PDF, JPG, or PNG files only.');
        input.value = '';
        document.getElementById('attachedFileName').textContent = '';
        return;
      }
      
      // Show selected file name
      document.getElementById('attachedFileName').textContent = `Selected: ${file.name}`;
    }
    
    function openModal(id){
      document.getElementById('modalBackdrop').style.display='block';
      document.getElementById(id).style.display='block';
    }
    
    function closeModal(id){
      document.getElementById('modalBackdrop').style.display='none';
      document.getElementById(id).style.display='none';
    }
    
    function submitReschedule(){
      alert('Rescheduled!');
      closeModal('rescheduleModal');
    }
    
    function submitCancel(){
      alert('Cancelled');
      closeModal('cancelModal');
    }
    
    // Enhanced My Bookings Tab Functions
    function showBookingTab(tab) {
      // Remove active class from all nav tabs
      document.querySelectorAll('.booking-nav-tab').forEach(t => t.classList.remove('active'));
      document.querySelectorAll('.booking-content').forEach(c => c.classList.remove('active'));
      
      // Add active class to selected tab
      document.getElementById(tab + 'NavTab').classList.add('active');
      document.getElementById(tab + 'Bookings').classList.add('active');
    }
    
    function openRescheduleModal(bookingId) {
      // Store current booking ID for processing
      window.currentBookingId = bookingId;
      
      // Set minimum date to today
      const today = new Date();
      const dateInput = document.getElementById('rescheduleDate');
      dateInput.min = today.toISOString().split('T')[0];
      dateInput.value = '';
      
      document.getElementById('rescheduleTime').value = '';
      document.getElementById('emergencyReschedule').checked = false;
      document.getElementById('rescheduleWarning').style.display = 'none';
      
      openModal('rescheduleModal');
    }
    
    function openCancelModal(bookingId) {
      // Store current booking ID for processing
      window.currentBookingId = bookingId;
      
      document.getElementById('cancelReason').value = '';
      openModal('cancelModal');
    }
    
    function openChatModal(bookingId) {
      // Store current booking ID and update modal title
      window.currentBookingId = bookingId;
      
      // Get lab name from booking card
      const bookingCard = document.querySelector(`[data-booking-id="${bookingId}"]`);
      const labName = bookingCard.querySelector('.lab-name').textContent;
      document.getElementById('chatModalTitle').textContent = `Chat with ${labName}`;
      
      openModal('chatModal');
    }
    
    function toggleEmergencyReschedule(checkbox) {
      const warning = document.getElementById('rescheduleWarning');
      warning.style.display = checkbox.checked ? 'block' : 'none';
    }
    
    function confirmReschedule() {
      const date = document.getElementById('rescheduleDate').value;
      const time = document.getElementById('rescheduleTime').value;
      const isEmergency = document.getElementById('emergencyReschedule').checked;
      
      if (!date || !time) {
        alert('Please select both date and time for rescheduling.');
        return;
      }
      
      // Check if rescheduling within 4 hours
      const selectedDateTime = new Date(`${date}T${time}`);
      const now = new Date();
      const hoursDiff = (selectedDateTime - now) / (1000 * 60 * 60);
      
      if (hoursDiff < 4 && !isEmergency) {
        alert('Rescheduling within 4 hours requires emergency booking. Please enable emergency booking option.');
        return;
      }
      
      // Process reschedule
      const formattedDate = new Date(`${date}T${time}`).toLocaleDateString('en-US', {
        year: 'numeric',
        month: 'short',
        day: 'numeric',
        hour: '2-digit',
        minute: '2-digit'
      });
      
      alert(`Booking rescheduled successfully to ${formattedDate}${isEmergency ? ' (Emergency booking)' : ''}`);
      closeModal('rescheduleModal');
    }
    
    function confirmCancel() {
      const reason = document.getElementById('cancelReason').value.trim();
      
      if (!reason) {
        alert('Please provide a reason for cancellation.');
        return;
      }
      
      alert('Booking cancelled successfully. You will receive a confirmation email shortly.');
      closeModal('cancelModal');
    }
    
    function sendChatMessage() {
      const messageInput = document.getElementById('chatInput');
      const message = messageInput.value.trim();
      
      if (!message) return;
      
      const messagesContainer = document.getElementById('chatMessages');
      const messageElement = document.createElement('div');
      messageElement.style.cssText = 'margin-bottom:12px;padding:8px 12px;background:var(--primary);color:#fff;border-radius:12px 12px 4px 12px;max-width:80%;margin-left:auto;';
      messageElement.innerHTML = `<strong>You:</strong> ${message}`;
      
      messagesContainer.appendChild(messageElement);
      messagesContainer.scrollTop = messagesContainer.scrollHeight;
      messageInput.value = '';
      
      // Simulate lab response after 1 second
      setTimeout(() => {
        const responseElement = document.createElement('div');
        responseElement.style.cssText = 'margin-bottom:12px;padding:8px 12px;background:#e3f2fd;border-radius:12px 12px 12px 4px;max-width:80%;';
        responseElement.innerHTML = `<strong style="color:var(--primary);">Lab:</strong> Thank you for your message. We'll get back to you shortly.`;
        messagesContainer.appendChild(responseElement);
        messagesContainer.scrollTop = messagesContainer.scrollHeight;
      }, 1000);
    }
    
    function rebookService(bookingId) {
      // Get service details from the booking card
      const bookingCard = document.querySelector(`[data-booking-id="${bookingId}"]`);
      const labName = bookingCard.querySelector('.lab-name').textContent;
      const serviceCode = bookingCard.querySelector('.service-code').textContent;
      
      alert(`Rebooking ${serviceCode} at ${labName}. You'll be redirected to the booking flow.`);
      
      // Switch to search tab and pre-fill search
      showPatientTab('searchTab');
      document.getElementById('searchInput').value = `${labName} ${serviceCode}`;
      performSearch();
    }
    
    function viewReport(bookingId) {
      // Get service details for the modal title
      const bookingCard = document.querySelector(`[data-booking-id="${bookingId}"]`);
      const labName = bookingCard.querySelector('.lab-name').textContent;
      const serviceCode = bookingCard.querySelector('.service-code').textContent;
      
      document.getElementById('reportModalTitle').textContent = `${serviceCode} Report - ${labName}`;
      openModal('viewReportModal');
    }
    
    function downloadReport() {
      alert('Report download started. The PDF will be saved to your downloads folder.');
      closeModal('viewReportModal');
    }
    
    function emailReport() {
      const email = prompt('Enter email address to send the report:', 'sarah@example.com');
      if (email) {
        alert(`Report will be emailed to ${email} within 5 minutes.`);
        closeModal('viewReportModal');
      }
    }
    
    function openFeedbackModal(bookingId) {
      // Store current booking ID and reset form
      window.currentBookingId = bookingId;
      
      // Reset rating
      document.querySelectorAll('.star-rating-btn').forEach(star => {
        star.style.opacity = '0.3';
      });
      document.getElementById('ratingText').textContent = '';
      document.getElementById('feedbackComments').value = '';
      document.getElementById('recommendLab').checked = false;
      
      openModal('feedbackModal');
    }
    
    function setRating(rating) {
      window.selectedRating = rating;
      const stars = document.querySelectorAll('.star-rating-btn');
      const ratingTexts = ['', 'Poor', 'Fair', 'Good', 'Very Good', 'Excellent'];
      
      stars.forEach((star, index) => {
        star.style.opacity = index < rating ? '1' : '0.3';
      });
      
      document.getElementById('ratingText').textContent = `${rating}/5 - ${ratingTexts[rating]}`;
    }
    
    function submitFeedback() {
      if (!window.selectedRating) {
        alert('Please select a rating before submitting feedback.');
        return;
      }
      
      const comments = document.getElementById('feedbackComments').value;
      const recommend = document.getElementById('recommendLab').checked;
      
      alert(`Thank you for your feedback! Your ${window.selectedRating}-star rating has been submitted.`);
      closeModal('feedbackModal');
    }
    
    function loadMoreBookings(type) {
      alert(`Loading more ${type} bookings...`);
      // In a real application, this would load more data from the server
    }
    
    function sendMessage(){
      var m=document.getElementById('chatInput').value; 
      if(m){
        var d=document.createElement('div');
        d.textContent='You: '+m;
        d.style.textAlign='right';
        d.style.marginBottom='8px';
        document.getElementById('chatMessages').appendChild(d);
        document.getElementById('chatInput').value='';
      }
    }
    
    function toggleEditProfile(){
      const view=document.getElementById('profileView');
      const edit=document.getElementById('profileEdit');
      if(view.style.display==='none'){
        view.style.display='block';
        edit.style.display='none';
      }else{
        view.style.display='none';
        edit.style.display='block';
      }
    }
    
    function saveProfile(){
      const name=document.getElementById('editName').value;
      const email=document.getElementById('editEmail').value;
      const phone=document.getElementById('editPhone').value;
      const dob=document.getElementById('editDob').value;
      const address=document.getElementById('editAddress').value;
      
      // Update profile view with new values
      const profileView = document.getElementById('profileView');
      const fields = profileView.querySelectorAll('div div');
      fields[0].innerHTML = '<strong style="font-weight:600;">Name:</strong> ' + name;
      fields[1].innerHTML = '<strong style="font-weight:600;">Email:</strong> ' + email;
      fields[2].innerHTML = '<strong style="font-weight:600;">Phone:</strong> ' + phone;
      fields[3].innerHTML = '<strong style="font-weight:600;">DOB:</strong> ' + new Date(dob).toLocaleDateString();
      fields[4].innerHTML = '<strong style="font-weight:600;">Address:</strong><br>' + address;
      
      toggleEditProfile();
      alert('Profile updated successfully!');
    }
    
    function confirmLogout(){
      openModal('logoutModal');
    }
    
    function performLogout(){
      closeModal('logoutModal');
      location.reload();
    }
    
    function addPaymentMethod(){
      const cardNumber = document.getElementById('addCardNumber').value;
      const expiryDate = document.getElementById('addExpiryDate').value;
      const cardholderName = document.getElementById('addCardholderName').value;
      const cvv = document.getElementById('addCvv').value;
      
      if(!cardNumber || !expiryDate || !cardholderName || !cvv){
        alert('Please fill in all required fields.');
        return;
      }
      
      if(cardNumber.replace(/\s/g, '').length < 13){
        alert('Please enter a valid card number.');
        return;
      }
      
      if(!/^\d{2}\/\d{2}$/.test(expiryDate)){
        alert('Please enter a valid expiry date (MM/YY).');
        return;
      }
      
      alert('Payment method added successfully!');
      closeModal('addPaymentModal');
      // Clear form
      document.getElementById('addCardNumber').value = '';
      document.getElementById('addExpiryDate').value = '';
      document.getElementById('addCvv').value = '';
      document.getElementById('addCardholderName').value = '';
    }
    
    function openEditPaymentModal(cardId){
      // Pre-populate form based on cardId
      if(cardId === 'visa4242'){
        document.getElementById('editCardNumber').value = '‚Ä¢‚Ä¢‚Ä¢‚Ä¢ 4242';
        document.getElementById('editCardholderName').value = 'Sarah Doe';
        document.getElementById('editExpiryDate').value = '12/25';
      } else if(cardId === 'master1111'){
        document.getElementById('editCardNumber').value = '‚Ä¢‚Ä¢‚Ä¢‚Ä¢ 1111';
        document.getElementById('editCardholderName').value = 'Sarah Doe';
        document.getElementById('editExpiryDate').value = '03/24';
      }
      document.getElementById('editPaymentModal').dataset.cardId = cardId;
      openModal('editPaymentModal');
    }
    
    function saveEditedPaymentMethod(){
      const cardId = document.getElementById('editPaymentModal').dataset.cardId;
      alert('Payment method updated: ' + cardId);
      closeModal('editPaymentModal');
    }
    
    function openDeletePaymentModal(cardId){
      let cardName = '';
      if(cardId === 'visa4242'){
        cardName = 'Visa ‚Ä¢‚Ä¢‚Ä¢‚Ä¢ 4242';
      } else if(cardId === 'master1111'){
        cardName = 'MasterCard ‚Ä¢‚Ä¢‚Ä¢‚Ä¢ 1111';
      }
      document.getElementById('deletePaymentText').textContent = 
        `Are you sure you want to delete the ${cardName} card? This action cannot be undone.`;
      document.getElementById('deletePaymentModal').dataset.cardId = cardId;
      openModal('deletePaymentModal');
    }
    
    function confirmDeletePayment(){
      const cardId = document.getElementById('deletePaymentModal').dataset.cardId;
      alert('Payment method deleted: ' + cardId);
      closeModal('deletePaymentModal');
    }
    
    function toggleSetting(setting, enabled){
      console.log(`${setting} notifications ${enabled ? 'enabled' : 'disabled'}`);
      // Here you would typically send this to your backend
    }
    
    function checkPasswordStrength(){
      const password = document.getElementById('newPassword').value;
      const strengthDiv = document.getElementById('passwordStrength');
      
      if(password.length === 0){
        strengthDiv.textContent = '';
        return;
      }
      
      let strength = 0;
      if(password.length >= 8) strength++;
      if(/[a-z]/.test(password)) strength++;
      if(/[A-Z]/.test(password)) strength++;
      if(/\d/.test(password)) strength++;
      if(/[^a-zA-Z\d]/.test(password)) strength++;
      
      if(strength < 3){
        strengthDiv.textContent = 'Strength: Weak üîì';
        strengthDiv.className = 'strength-indicator strength-weak';
      } else if(strength < 4){
        strengthDiv.textContent = 'Strength: Medium üîí';
        strengthDiv.className = 'strength-indicator strength-medium';
      } else {
        strengthDiv.textContent = 'Strength: Strong üîí';
        strengthDiv.className = 'strength-indicator strength-strong';
      }
    }
    
    function checkPasswordMatch(){
      const newPassword = document.getElementById('newPassword').value;
      const confirmPassword = document.getElementById('confirmPassword').value;
      const matchDiv = document.getElementById('passwordMatch');
      
      if(confirmPassword.length === 0){
        matchDiv.textContent = '';
        return;
      }
      
      if(newPassword === confirmPassword){
        matchDiv.textContent = 'Passwords match ‚úì';
        matchDiv.className = 'strength-indicator strength-strong';
      } else {
        matchDiv.textContent = 'Passwords do not match ‚úó';
        matchDiv.className = 'strength-indicator strength-weak';
      }
    }
    
    function changePassword(){
      const current = document.getElementById('currentPassword').value;
      const newPass = document.getElementById('newPassword').value;
      const confirm = document.getElementById('confirmPassword').value;
      
      if(!current || !newPass || !confirm){
        alert('Please fill in all password fields.');
        return;
      }
      
      if(newPass !== confirm){
        alert('New passwords do not match.');
        return;
      }
      
      if(newPass.length < 6){
        alert('Password must be at least 6 characters long.');
        return;
      }
      
      alert('Password changed successfully!');
      closeModal('patientChangePasswordModal');
      // Clear form
      document.getElementById('currentPassword').value = '';
      document.getElementById('newPassword').value = '';
      document.getElementById('confirmPassword').value = '';
    }
    
    function openSupportConversation(id){
      document.getElementById('supportConversation').style.display='flex';
    }
    
    function closeSupportConversation(){
      document.getElementById('supportConversation').style.display='none';
    }
    
    function sendSupportMessage(){
      const m=document.getElementById('supportInput').value;
      if(m){
        const d=document.createElement('div');
        d.textContent='You: '+m;
        d.style.textAlign='right';
        d.style.marginBottom='8px';
        document.getElementById('supportMessages').appendChild(d);
        document.getElementById('supportInput').value='';
      }
    }
    
    function submitNewTicket(){
      // Get patient form values
      const subject = document.getElementById('patientTicketSubject').value;
      const category = document.getElementById('patientTicketCategory').value;
      const description = document.getElementById('patientTicketDescription').value;
      
      if (!subject.trim() || !description.trim()) {
        alert('Please fill in all required fields');
        return;
      }
      
      closeModal('patientNewTicketModal');
      alert('Ticket submitted successfully');
      
      // Clear form
      document.getElementById('patientTicketSubject').value = '';
      document.getElementById('patientTicketDescription').value = '';
    }
    
    // Search functionality
    let comparisonItems = [];
    let currentDetailsLab = null;
    
    function performSearch(){
      const query = document.getElementById('searchInput').value.toLowerCase();
      const cards = document.querySelectorAll('.service-card');
      let visibleCount = 0;
      
      cards.forEach(card => {
        const labName = card.querySelector('.lab-name').textContent.toLowerCase();
        const serviceName = card.querySelector('.service-name').textContent.toLowerCase();
        const isVisible = labName.includes(query) || serviceName.includes(query);
        
        card.style.display = isVisible ? 'block' : 'none';
        if(isVisible) visibleCount++;
      });
      
      document.getElementById('resultsCount').textContent = `Results (${visibleCount})`;
    }
    
    function updateDistance(value){
      document.getElementById('distanceValue').textContent = value;
    }
    
    function applyFilters(){
      const minPrice = parseInt(document.getElementById('minPrice').value) || 0;
      const maxPrice = parseInt(document.getElementById('maxPrice').value) || 999999;
      const selectedRating = document.querySelector('input[name="rating"]:checked')?.value || 0;
      const cards = document.querySelectorAll('.service-card');
      let visibleCount = 0;
      
      cards.forEach(card => {
        const price = parseInt(card.dataset.price);
        const rating = parseFloat(card.dataset.rating);
        const matchesPrice = price >= minPrice && price <= maxPrice;
        const matchesRating = rating >= selectedRating;
        const isVisible = matchesPrice && matchesRating;
        
        card.style.display = isVisible ? 'block' : 'none';
        if(isVisible) visibleCount++;
      });
      
      document.getElementById('resultsCount').textContent = `Results (${visibleCount})`;
    }
    
    function clearFilters(){
      document.getElementById('locationFilter').value = '';
      document.getElementById('distanceSlider').value = '25';
      document.getElementById('distanceValue').textContent = '25';
      document.getElementById('minPrice').value = '';
      document.getElementById('maxPrice').value = '';
      document.querySelectorAll('input[name="rating"]').forEach(r => r.checked = false);
      document.getElementById('availableDate').value = '';
      document.getElementById('servicesFilter').value = '';
      
      // Show all cards
      document.querySelectorAll('.service-card').forEach(card => {
        card.style.display = 'block';
      });
      document.getElementById('resultsCount').textContent = 'Results (6)';
    }
    
    function sortResults(){
      const sortBy = document.getElementById('sortBy').value;
      const grid = document.getElementById('resultsGrid');
      const cards = Array.from(grid.querySelectorAll('.service-card:not([style*="display: none"])'));
      
      cards.sort((a, b) => {
        switch(sortBy){
          case 'price-low':
            return parseInt(a.dataset.price) - parseInt(b.dataset.price);
          case 'price-high':
            return parseInt(b.dataset.price) - parseInt(a.dataset.price);
          case 'rating':
            return parseFloat(b.dataset.rating) - parseFloat(a.dataset.rating);
          default:
            return 0;
        }
      });
      
      // Re-append sorted cards
      cards.forEach(card => grid.appendChild(card));
    }
    
    function toggleFavorite(btn){
      btn.classList.toggle('active');
      btn.textContent = btn.classList.contains('active') ? '‚ô•' : '‚ô°';
    }
    
    function toggleCompare(checkbox, labId){
      if(checkbox.checked){
        addToComparison(labId);
      } else {
        removeFromComparison(labId);
      }
    }
    
    function addToComparison(labId){
      if(comparisonItems.includes(labId)) return;
      
      comparisonItems.push(labId);
      updateComparisonUI();
    }
    
    function removeFromComparison(labId){
      comparisonItems = comparisonItems.filter(id => id !== labId);
      updateComparisonUI();
      
      // Uncheck the checkbox
      const checkbox = document.querySelector(`input[onchange*="${labId}"]`);
      if(checkbox) checkbox.checked = false;
    }
    
    function updateComparisonUI(){
      const count = comparisonItems.length;
      document.getElementById('compareCount').textContent = count;
      document.getElementById('comparisonCount').textContent = count;
      document.getElementById('compareBtn').disabled = count === 0;
      document.getElementById('compareSelectedBtn').disabled = count < 2;
      
      // Update comparison list
      const list = document.getElementById('comparisonList');
      list.innerHTML = '';
      
      comparisonItems.forEach(labId => {
        const card = document.querySelector(`[data-lab="${labId}"]`);
        const labName = card.querySelector('.lab-name').textContent;
        const price = card.querySelector('.service-price').textContent;
        const tat = card.querySelector('.service-details span').textContent;
        
        const item = document.createElement('div');
        item.className = 'comparison-item';
        item.innerHTML = `
          <div>
            <div style="font-weight:600;">${labName}</div>
            <div style="font-size:12px;color:var(--muted);">${price} ‚Äî ${tat}</div>
          </div>
          <button onclick="removeFromComparison('${labId}')" style="background:none;border:none;cursor:pointer;">‚úï</button>
        `;
        list.appendChild(item);
      });
    }
    
    function toggleComparison(){
      const panel = document.getElementById('comparisonPanel');
      panel.classList.toggle('active');
    }
    
    function closeComparison(){
      document.getElementById('comparisonPanel').classList.remove('active');
    }
    
    function removeAllFromComparison(){
      comparisonItems = [];
      document.querySelectorAll('.compare-checkbox input').forEach(cb => cb.checked = false);
      updateComparisonUI();
    }
    
    function compareSelected(){
      if(comparisonItems.length < 2) return;
      generateComparisonTable();
      openModal('comparisonModal');
    }
    
    function generateComparisonTable(){
      const table = document.getElementById('comparisonTable');
      let html = '<table style="width:100%;border-collapse:collapse;"><thead><tr><th>Feature</th>';
      
      // Add headers for each lab
      comparisonItems.forEach(labId => {
        const card = document.querySelector(`[data-lab="${labId}"]`);
        const labName = card.querySelector('.lab-name').textContent;
        html += `<th>${labName}</th>`;
      });
      html += '</tr></thead><tbody>';
      
      // Add comparison rows
      const features = ['Service', 'Price', 'Rating', 'TAT', 'Next Slot'];
      features.forEach(feature => {
        html += `<tr><td style="font-weight:600;padding:8px;border:1px solid #ddd;">${feature}</td>`;
        
        comparisonItems.forEach(labId => {
          const card = document.querySelector(`[data-lab="${labId}"]`);
          let value = '';
          
          switch(feature){
            case 'Service':
              value = card.querySelector('.service-name').textContent;
              break;
            case 'Price':
              value = card.querySelector('.service-price').textContent;
              break;
            case 'Rating':
              value = card.querySelector('.lab-rating span:last-child').textContent;
              break;
            case 'TAT':
              value = card.querySelector('.service-details span').textContent;
              break;
            case 'Next Slot':
              value = card.querySelector('.service-details span:last-child').textContent;
              break;
          }
          
          html += `<td style="padding:8px;border:1px solid #ddd;">${value}</td>`;
        });
        html += '</tr>';
      });
      
      html += '</tbody></table>';
      table.innerHTML = html;
    }
    
    function viewDetails(labId, serviceCode){
      currentDetailsLab = labId;
      const card = document.querySelector(`[data-lab="${labId}"]`);
      
      // Populate modal with lab details
      document.getElementById('detailsTitle').textContent = 
        `${card.querySelector('.lab-name').textContent} ‚Äî ${card.querySelector('.service-name').textContent}`;
      document.getElementById('detailsLogo').textContent = card.querySelector('.lab-logo').textContent;
      document.getElementById('detailsLabName').textContent = card.querySelector('.lab-name').textContent;
      document.getElementById('detailsAddress').textContent = 'Address details here';
      document.getElementById('detailsRating').innerHTML = card.querySelector('.lab-rating').innerHTML;
      document.getElementById('detailsPrice').textContent = card.querySelector('.service-price').textContent;
      document.getElementById('detailsTAT').textContent = card.querySelector('.service-details span').textContent.replace('TAT: ', '');
      
      openModal('viewDetailsModal');
    }
    
    function toggleCompareFromDetails(){
      if(currentDetailsLab){
        const checkbox = document.querySelector(`input[onchange*="${currentDetailsLab}"]`);
        checkbox.checked = !checkbox.checked;
        toggleCompare(checkbox, currentDetailsLab);
      }
    }
    
    function viewDetails(labId, serviceCode) {
      // Sample data - in real app this would come from API
      const labData = {
        'lab-a': {
          name: 'MediCore Labs',
          logo: 'üè•',
          address: '12 Health St, Metropolis',
          rating: '‚òÖ‚òÖ‚òÖ‚òÖ‚òÜ (128 reviews)',
          service: 'Comprehensive Health Panel (HP01)',
          price: '‚Çπ2,000',
          tat: '24 hrs',
          serviceDetails: [
            'Comprehensive Health Panel (30+ biomarkers)',
            'Includes CBC, lipid profile, thyroid, vitamin D',
            'Liver function tests and kidney profile',
            'Blood sugar levels and HbA1c'
          ],
          preTestInstructions: [
            'Fast for 8 hrs before sample',
            'Avoid caffeine & heavy exercise',
            'Bring valid photo ID',
            'Wear comfortable clothing'
          ]
        },
        'lab-b': {
          name: 'HealthFirst Diagnostics',
          logo: 'üî¨',
          address: '45 Medical Plaza, Downtown',
          rating: '‚òÖ‚òÖ‚òÖ‚òÖ‚òÜ (95 reviews)',
          service: 'Basic Health Checkup (BHC01)',
          price: '‚Çπ1,800',
          tat: '48 hrs',
          serviceDetails: [
            'Basic Health Checkup (15+ biomarkers)',
            'Includes CBC, basic metabolic panel',
            'Lipid profile and blood glucose',
            'Essential vitamin screening'
          ],
          preTestInstructions: [
            'Fast for 10 hrs before sample',
            'Avoid alcohol 24 hrs prior',
            'Bring prescription if applicable',
            'Stay hydrated'
          ]
        }
      };

      const data = labData[labId] || labData['lab-a'];
      
      // Update modal content
      document.getElementById('detailsTitle').textContent = `${data.name} ‚Äî ${data.service}`;
      document.getElementById('detailsLogo').textContent = data.logo;
      document.getElementById('detailsLabName').textContent = data.name;
      document.getElementById('detailsAddress').textContent = `üìç ${data.address}`;
      document.getElementById('detailsRating').textContent = data.rating;
      document.getElementById('detailsServiceName').textContent = data.service;
      document.getElementById('detailsPrice').textContent = data.price;
      
      // Update service meta
      const serviceMeta = document.querySelector('.service-meta');
      serviceMeta.innerHTML = `
        <span>‚è±Ô∏è ${data.tat}</span>
        <span>üöó 2.3 km</span>
        <span>üìÖ Available Today</span>
      `;

      // Update service details
      const serviceDetailsContent = document.querySelector('.collapsible.active .collapsible-content');
      serviceDetailsContent.innerHTML = `
        <p><strong>Service Includes:</strong></p>
        <ul>
          ${data.serviceDetails.map(detail => `<li>${detail}</li>`).join('')}
        </ul>
        <p><strong>Report Timeline:</strong> ${data.tat}</p>
      `;

      // Update pre-test instructions
      const preTestContent = document.querySelectorAll('.collapsible')[1].querySelector('.collapsible-content');
      preTestContent.innerHTML = `
        <h5>Before Your Test:</h5>
        <ul>
          ${data.preTestInstructions.map(instruction => `<li>${instruction}</li>`).join('')}
        </ul>
        <h5>What to Bring:</h5>
        <ul>
          <li>Valid photo ID</li>
          <li>Doctor's prescription (if applicable)</li>
          <li>Previous test reports for comparison</li>
        </ul>
      `;

      // Store current lab data for booking
      window.currentLabData = data;
      window.currentLabId = labId;
      window.currentServiceCode = serviceCode;

      openModal('viewDetailsModal');
    }

    function bookNow(labId, serviceCode) {
      // If called directly, get lab data first
      if (!window.currentLabData) {
        viewDetails(labId, serviceCode);
        setTimeout(() => {
          closeModal('viewDetailsModal');
          openBookingModal();
        }, 100);
      } else {
        openBookingModal();
      }
    }

    function openBookingModal() {
      const data = window.currentLabData;
      if (!data) return;

      // Update service summary in booking modal
      const serviceSummary = document.querySelector('#bookingModal .service-summary');
      if (serviceSummary) {
        serviceSummary.innerHTML = `
          <div style="display:flex;align-items:center;gap:12px;">
            <div class="lab-logo">${data.logo}</div>
            <div>
              <h4 style="margin:0;">${data.service}</h4>
              <p style="margin:4px 0;color:var(--muted);">${data.name}</p>
              <p style="margin:0;font-weight:600;color:var(--accent);">${data.price}</p>
            </div>
          </div>
        `;
      }

      closeModal('viewDetailsModal');
      openModal('bookingModal');
      initializeDateCarousel();
      initializeTimeSlots();
    }

    function initializeDateCarousel() {
      const dateCarousel = document.querySelector('#bookingModal .date-carousel');
      if (!dateCarousel) return;

      const today = new Date();
      const dates = [];
      
      for (let i = 0; i < 7; i++) {
        const date = new Date(today);
        date.setDate(today.getDate() + i);
        dates.push({
          label: i === 0 ? 'Today' : i === 1 ? 'Tomorrow' : date.toLocaleDateString('en-US', { weekday: 'short' }),
          day: date.getDate(),
          month: date.toLocaleDateString('en-US', { month: 'short' }),
          fullDate: date.toISOString().split('T')[0],
          available: i < 5 // First 5 days available
        });
      }

      dateCarousel.innerHTML = `
        <button class="date-nav" onclick="navigateDate(-1)">‚Äπ</button>
        ${dates.map((date, index) => `
          <div class="date-item ${index === 0 ? 'active' : ''} ${!date.available ? 'disabled' : ''}" 
               onclick="selectDate(this, '${date.fullDate}')" 
               data-date="${date.fullDate}">
            <div style="font-size:12px;color:var(--muted);">${date.label}</div>
            <div style="font-weight:600;">${date.month} ${date.day}</div>
          </div>
        `).join('')}
        <button class="date-nav" onclick="navigateDate(1)">‚Ä∫</button>
      `;
    }

    function initializeTimeSlots() {
      const timeSlots = document.querySelector('#bookingModal .time-slots-container');
      if (!timeSlots) return;

      const slots = [
        '08:00', '08:15', '08:30', '08:45', '09:00', '09:15', '09:30', '09:45',
        '10:00', '10:15', '10:30', '10:45', '11:00', '11:15', '11:30', '11:45',
        '14:00', '14:15', '14:30', '14:45', '15:00', '15:15', '15:30', '15:45',
        '16:00', '16:15', '16:30', '16:45', '17:00', '17:15', '17:30', '17:45'
      ];

      const currentHour = new Date().getHours();
      const cutoffTime = currentHour + 4; // 4 hour cutoff

      timeSlots.innerHTML = `
        <h5 style="margin-bottom:12px;">‚è∞ Available Slots (15 min intervals)</h5>
        <div class="time-slots">
          ${slots.map(slot => {
            const slotHour = parseInt(slot.split(':')[0]);
            const isDisabled = slotHour < cutoffTime && !document.getElementById('emergencyBooking')?.checked;
            const isBooked = Math.random() < 0.2; // Randomly some slots are booked
            
            return `
              <div class="time-slot ${isDisabled || isBooked ? 'disabled' : ''}" 
                   onclick="selectTimeSlot(this, '${slot}')"
                   data-time="${slot}">
                ${slot}
              </div>
            `;
          }).join('')}
        </div>
      `;
    }

    function selectDate(dateElement, fullDate) {
      if (dateElement.classList.contains('disabled')) return;
      
      document.querySelectorAll('.date-item').forEach(item => item.classList.remove('active'));
      dateElement.classList.add('active');
      
      // Refresh time slots for new date
      initializeTimeSlots();
      updateProceedButton();
    }

    function selectTimeSlot(timeElement, time) {
      if (timeElement.classList.contains('disabled')) return;
      
      document.querySelectorAll('.time-slot').forEach(slot => slot.classList.remove('active'));
      timeElement.classList.add('active');
      updateProceedButton();
    }

    function toggleEmergency(checkbox) {
      const emergencyCharges = document.getElementById('emergencyCharges');
      const totalAmount = document.getElementById('totalAmount');
      
      if (checkbox.checked) {
        // Refresh time slots to show emergency slots
        initializeTimeSlots();
        if (emergencyCharges) emergencyCharges.style.display = 'flex';
        if (totalAmount) totalAmount.textContent = '‚Çπ2,050';
      } else {
        initializeTimeSlots();
        if (emergencyCharges) emergencyCharges.style.display = 'none';
        if (totalAmount) totalAmount.textContent = '‚Çπ2,000';
      }
    }

    function updateProceedButton() {
      const selectedDate = document.querySelector('.date-item.active');
      const selectedTime = document.querySelector('.time-slot.active');
      const proceedBtn = document.getElementById('proceedBookingBtn');
      
      if (proceedBtn) {
        proceedBtn.disabled = !(selectedDate && selectedTime);
      }
    }

    function openConfirmPayModal() {
      const selectedDate = document.querySelector('.date-item.active');
      const selectedTime = document.querySelector('.time-slot.active');
      const data = window.currentLabData;
      
      if (selectedDate && selectedTime && data) {
        const dateText = selectedDate.querySelector('div:last-child').textContent;
        const timeText = selectedTime.textContent;
        const isEmergency = document.getElementById('emergencyBooking')?.checked || false;
        
        // Update booking summary
        updateConfirmPayModal(data, dateText, timeText, isEmergency);
        
        closeModal('bookingModal');
        openModal('confirmPayModal');
      }
    }

    function updateConfirmPayModal(data, dateText, timeText, isEmergency) {
      const confirmPayContent = document.getElementById('confirmPayContent');
      const basePrice = parseInt(data.price.replace('‚Çπ', '').replace(',', ''));
      const emergencyFee = isEmergency ? 50 : 0;
      const totalAmount = basePrice + emergencyFee;

      confirmPayContent.innerHTML = `
        <!-- Booking Summary -->
        <div class="booking-summary">
          <h5 style="margin-top:0;">üìã Booking Summary</h5>
          <div style="display:flex;justify-content:space-between;margin:8px 0;">
            <span>Service:</span>
            <span>${data.service}</span>
          </div>
          <div style="display:flex;justify-content:space-between;margin:8px 0;">
            <span>Lab:</span>
            <span>${data.name}</span>
          </div>
          <div style="display:flex;justify-content:space-between;margin:8px 0;">
            <span>Date & Time:</span>
            <span>${dateText}, ${timeText}</span>
          </div>
          <div style="display:flex;justify-content:space-between;margin:8px 0;">
            <span>Service Fee:</span>
            <span>${data.price}</span>
          </div>
          ${emergencyFee > 0 ? `
          <div style="display:flex;justify-content:space-between;margin:8px 0;" id="emergencyCharges">
            <span>Emergency Charges:</span>
            <span>‚Çπ${emergencyFee}</span>
          </div>
          ` : ''}
          <hr>
          <div style="display:flex;justify-content:space-between;font-weight:600;font-size:16px;">
            <span>Total Amount:</span>
            <span id="totalAmount">‚Çπ${totalAmount.toLocaleString()}</span>
          </div>
        </div>

        <!-- Payment Method -->
        <div class="payment-selector">
          <h5>üí≥ Payment Method</h5>
          <select class="payment-dropdown" onchange="selectPaymentMethod(this)">
            <option value="">Select Payment Method</option>
            <option value="visa4242">Visa ‚Ä¢‚Ä¢‚Ä¢‚Ä¢ 4242</option>
            <option value="master1111">MasterCard ‚Ä¢‚Ä¢‚Ä¢‚Ä¢ 1111</option>
            <option value="upi">UPI Payment</option>
            <option value="netbanking">Net Banking</option>
          </select>
        </div>

        <!-- Terms & Conditions -->
        <div style="margin:16px 0;">
          <label style="display:flex;align-items:flex-start;gap:8px;font-size:14px;">
            <input type="checkbox" id="acceptTerms" onchange="toggleConfirmButton()">
            <span>I agree to the <a href="#" style="color:var(--primary);">Terms & Conditions</a> and <a href="#" style="color:var(--primary);">Privacy Policy</a></span>
          </label>
        </div>
      `;

      // Update footer
      const footer = document.querySelector('#confirmPayModal footer');
      footer.innerHTML = `
        <button class="btn-secondary" onclick="goBackToBooking()">‚Üê Back</button>
        <button class="btn" onclick="confirmBooking()" id="confirmPayBtn" disabled>Confirm & Pay</button>
      `;
    }

    function goBackToBooking() {
      closeModal('confirmPayModal');
      openModal('bookingModal');
    }

    function selectPaymentMethod(select) {
      toggleConfirmButton();
    }

    function toggleConfirmButton() {
      const paymentMethod = document.querySelector('.payment-dropdown')?.value;
      const acceptTerms = document.getElementById('acceptTerms')?.checked;
      const confirmBtn = document.getElementById('confirmPayBtn');
      
      if (confirmBtn) {
        confirmBtn.disabled = !(paymentMethod && acceptTerms);
      }
    }

    function confirmBooking() {
      const data = window.currentLabData;
      const selectedDate = document.querySelector('.date-item.active');
      const selectedTime = document.querySelector('.time-slot.active');
      
      if (data && selectedDate && selectedTime) {
        alert(`Booking confirmed! 
        
Lab: ${data.name}
Service: ${data.service}
Date: ${selectedDate.querySelector('div:last-child').textContent}
Time: ${selectedTime.textContent}

You will receive a confirmation SMS and email shortly.`);
        
        closeModal('confirmPayModal');
        
        // Reset booking state
        window.currentLabData = null;
        window.currentLabId = null;
        window.currentServiceCode = null;
        
        // Optionally redirect to bookings tab
        showPatientTab('bookingsTab');
      }
    }

    function goBackToDetails() {
      closeModal('bookingModal');
      openModal('viewDetailsModal');
    }

    function navigateDate(direction) {
      // Logic to navigate between dates - could implement carousel sliding
      console.log('Navigate date:', direction);
    }
    
    // Format card number input
    document.addEventListener('DOMContentLoaded', function() {
      // Add card number formatting
      const cardInputs = ['addCardNumber', 'editCardNumber'];
      cardInputs.forEach(id => {
        const input = document.getElementById(id);
        if(input) {
          input.addEventListener('input', function(e) {
            let value = e.target.value.replace(/\s/g, '');
            let formattedValue = value.match(/.{1,4}/g)?.join(' ') || value;
            e.target.value = formattedValue;
          });
        }
      });
      
      // Add expiry date formatting
      const expiryInputs = ['addExpiryDate', 'editExpiryDate'];
      expiryInputs.forEach(id => {
        const input = document.getElementById(id);
        if(input) {
          input.addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if(value.length >= 2) {
              value = value.substring(0,2) + '/' + value.substring(2,4);
            }
            e.target.value = value;
          });
        }
      });
      
      // Add CVV number-only formatting
      const cvvInputs = ['addCvv', 'editCvv'];
      cvvInputs.forEach(id => {
        const input = document.getElementById(id);
        if(input) {
          input.addEventListener('input', function(e) {
            e.target.value = e.target.value.replace(/\D/g, '');
          });
        }
      });
      
      // Clear password strength indicators when modals close
      document.getElementById('modalBackdrop').addEventListener('click', function() {
        document.getElementById('passwordStrength').textContent = '';
        document.getElementById('passwordMatch').textContent = '';
      });
    });

    // Collapsible functionality
    function toggleCollapsible(header) {
      const collapsible = header.parentElement;
      const chevron = header.querySelector('.chevron');
      
      collapsible.classList.toggle('active');
      chevron.textContent = collapsible.classList.contains('active') ? '‚ñº' : '‚ñ∂';
    }

    // Booking flow functions
    function openBookingModal() {
      closeModal('viewDetailsModal');
      openModal('bookingModal');
    }

    function selectDate(dateElement) {
      document.querySelectorAll('.date-item').forEach(item => item.classList.remove('active'));
      dateElement.classList.add('active');
      updateProceedButton();
    }

    function selectTimeSlot(timeElement) {
      if (timeElement.classList.contains('disabled')) return;
      
      document.querySelectorAll('.time-slot').forEach(slot => slot.classList.remove('active'));
      timeElement.classList.add('active');
      updateProceedButton();
    }

    function navigateDate(direction) {
      // Logic to navigate between dates
      console.log('Navigate date:', direction);
    }

    function toggleEmergency(checkbox) {
      const emergencyCharges = document.getElementById('emergencyCharges');
      const totalAmount = document.getElementById('totalAmount');
      
      if (checkbox.checked) {
        emergencyCharges.style.display = 'flex';
        totalAmount.textContent = '‚Çπ349';
      } else {
        emergencyCharges.style.display = 'none';
        totalAmount.textContent = '‚Çπ299';
      }
    }

    function updateProceedButton() {
      const selectedDate = document.querySelector('.date-item.active');
      const selectedTime = document.querySelector('.time-slot.active');
      const proceedBtn = document.getElementById('proceedBookingBtn');
      
      proceedBtn.disabled = !(selectedDate && selectedTime);
    }

    function openConfirmPayModal() {
      const selectedDate = document.querySelector('.date-item.active');
      const selectedTime = document.querySelector('.time-slot.active');
      
      if (selectedDate && selectedTime) {
        const dateText = selectedDate.querySelector('div:last-child').textContent;
        const timeText = selectedTime.textContent;
        document.getElementById('selectedDateTime').textContent = `${dateText}, ${timeText}`;
        
        closeModal('bookingModal');
        openModal('confirmPayModal');
      }
    }

    function goBackToBooking() {
      closeModal('confirmPayModal');
      openModal('bookingModal');
    }

    function selectPaymentMethod(select) {
      toggleConfirmButton();
    }

    function toggleConfirmButton() {
      const paymentMethod = document.querySelector('.payment-dropdown').value;
      const acceptTerms = document.getElementById('acceptTerms').checked;
      const confirmBtn = document.getElementById('confirmPayBtn');
      
      confirmBtn.disabled = !(paymentMethod && acceptTerms);
    }

    function confirmBooking() {
      // Here you would process the payment and create the booking
      alert('Booking confirmed! You will receive a confirmation SMS and email shortly.');
      closeModal('confirmPayModal');
      
      // Optionally redirect to bookings tab
      showPatientTab('bookingsTab');
    }

    // Enhanced search and filter functions
    function updateDualRangeValues(rangeType) {
      const min = document.getElementById(`${rangeType}Min`);
      const max = document.getElementById(`${rangeType}Max`);
      const display = document.getElementById(`${rangeType}Display`);
      
      if (min && max && display) {
        const minVal = parseInt(min.value);
        const maxVal = parseInt(max.value);
        
        if (minVal > maxVal) {
          min.value = maxVal;
        }
        
        if (rangeType === 'price') {
          display.textContent = `‚Çπ${min.value} - ‚Çπ${max.value}`;
        } else if (rangeType === 'distance') {
          display.textContent = `${min.value} - ${max.value} km`;
        }
        
        updateRangeFill(rangeType);
      }
    }

    function updateRangeFill(rangeType) {
      const min = document.getElementById(`${rangeType}Min`);
      const max = document.getElementById(`${rangeType}Max`);
      const fill = document.querySelector(`#${rangeType}Range .dual-range-fill`);
      
      if (min && max && fill) {
        const minVal = parseInt(min.value);
        const maxVal = parseInt(max.value);
        const minPercent = ((minVal - min.min) / (min.max - min.min)) * 100;
        const maxPercent = ((maxVal - min.min) / (min.max - min.min)) * 100;
        
        fill.style.left = minPercent + '%';
        fill.style.width = (maxPercent - minPercent) + '%';
      }
    }

    function toggleServiceChip(chip) {
      chip.classList.toggle('active');
      applyFilters();
    }

    function toggleStarFilter(star) {
      const rating = star.getAttribute('data-rating');
      const currentActive = document.querySelector('.star-filter.active');
      
      // Remove active from all stars
      document.querySelectorAll('.star-filter').forEach(s => s.classList.remove('active'));
      
      // If clicking the same star, toggle off; otherwise, activate
      if (currentActive !== star) {
        star.classList.add('active');
      }
      
      applyFilters();
    }

    // Initialize dual range sliders
    document.addEventListener('DOMContentLoaded', function() {
      updateDualRangeValues('price');
      updateDualRangeValues('distance');
      
      // Add event listeners for dual range inputs
      ['price', 'distance'].forEach(type => {
        const min = document.getElementById(`${type}Min`);
        const max = document.getElementById(`${type}Max`);
        
        if (min && max) {
          min.addEventListener('input', () => updateDualRangeValues(type));
          max.addEventListener('input', () => updateDualRangeValues(type));
        }
      });
    });

    // ==============================================
    // DOCTOR DASHBOARD FUNCTIONS
    // ==============================================

    // Global variables for doctor dashboard
    let selectedPatient = null;
    let selectedService = null;
    let selectedLab = null;
    let currentEditingPatientId = null;

    // Doctor Dashboard Navigation
    function showDoctorTab(tabId) {
      console.log('Showing doctor tab:', tabId); // Debug log
      
      // Hide all doctor tabs
      const doctorTabs = ['bookForPatientTab', 'myPatientsTab', 'doctorBookingsTab', 'invoicesTab', 'doctorSupportTab', 'doctorProfileTab'];
      doctorTabs.forEach(tab => {
        const element = document.getElementById(tab);
        if (element) {
          element.classList.remove('active');
          console.log('Hiding tab:', tab); // Debug log
        }
      });
      
      // Show selected tab
      const selectedTab = document.getElementById(tabId);
      if (selectedTab) {
        selectedTab.classList.add('active');
        console.log('Showing tab:', tabId, 'Element found:', !!selectedTab); // Debug log
      } else {
        console.error('Tab element not found:', tabId); // Debug log
      }
      
      // Update footer navigation
      document.querySelectorAll('#doctorFooterNav .doctor-footer-item').forEach(el => el.classList.remove('active'));
      const tabMapping = {
        'bookForPatientTab': 0,
        'myPatientsTab': 1,
        'doctorBookingsTab': 2,
        'invoicesTab': 3,
        'doctorSupportTab': 4,
        'doctorProfileTab': 5
      };
      
      const footerItems = document.querySelectorAll('#doctorFooterNav .doctor-footer-item');
      if (footerItems[tabMapping[tabId]]) {
        footerItems[tabMapping[tabId]].classList.add('active');
      }
    }

    // Patient Search and Selection Functions
    function searchPatients() {
      const query = document.getElementById('patientSearchInput').value.toLowerCase();
      // In a real application, this would search your patient database
      console.log('Searching patients with query:', query);
      
      // For demo purposes, show a simplified patient selector
      if (query.length > 0) {
        showPatientSuggestions(query);
      }
    }

    function showPatientSuggestions(query) {
      // Demo patient data - in real app this would come from API
      const patients = [
        { id: 'P001', name: 'John Doe', age: 35, phone: '+91 9876543210' },
        { id: 'P002', name: 'Jane Smith', age: 28, phone: '+91 9876543211' },
        { id: 'P003', name: 'Robert Johnson', age: 42, phone: '+91 9876543212' }
      ];
      
      const filtered = patients.filter(p => 
        p.name.toLowerCase().includes(query) || p.id.toLowerCase().includes(query)
      );
      
      if (filtered.length > 0) {
        // For demo, auto-select first matching patient
        selectPatient(filtered[0]);
      }
    }

    function selectPatient(patient) {
      selectedPatient = patient;
      
      // Update UI
      document.getElementById('selectedPatientName').textContent = patient.name;
      document.getElementById('selectedPatientDetails').textContent = `Age: ${patient.age}, ID: ${patient.id}`;
      document.getElementById('selectedPatientContact').textContent = patient.phone;
      document.getElementById('selectedPatientInfo').style.display = 'block';
      
      updateBookingSummary();
    }

    function clearSelectedPatient() {
      selectedPatient = null;
      document.getElementById('selectedPatientInfo').style.display = 'none';
      document.getElementById('patientSearchInput').value = '';
      updateBookingSummary();
    }

    // Service Selection Functions
    function selectServiceCategory(category) {
      // Update active category
      document.querySelectorAll('.service-category').forEach(cat => cat.classList.remove('active'));
      event.target.classList.add('active');
      
      // Update services grid based on category
      updateServicesGrid(category);
    }

    function updateServicesGrid(category) {
      const servicesGrid = document.getElementById('servicesGrid');
      
      // Demo services by category
      const servicesByCategory = {
        'blood-tests': [
          { code: 'CBC', name: 'Complete Blood Count', description: 'Comprehensive blood analysis', price: 500 },
          { code: 'LFT', name: 'Liver Function Test', description: 'Liver health assessment', price: 800 },
          { code: 'KFT', name: 'Kidney Function Test', description: 'Kidney health evaluation', price: 700 },
          { code: 'TFT', name: 'Thyroid Function Test', description: 'Thyroid hormone levels', price: 600 }
        ],
        'radiology': [
          { code: 'XRAY', name: 'X-Ray', description: 'Digital X-Ray imaging', price: 400 },
          { code: 'CT', name: 'CT Scan', description: 'Computed tomography scan', price: 2500 },
          { code: 'MRI', name: 'MRI Scan', description: 'Magnetic resonance imaging', price: 4000 }
        ],
        'pathology': [
          { code: 'BIOPSY', name: 'Tissue Biopsy', description: 'Tissue sample analysis', price: 1200 },
          { code: 'CULTURE', name: 'Culture Test', description: 'Bacterial culture and sensitivity', price: 600 }
        ],
        'cardiology': [
          { code: 'ECG', name: 'ECG', description: 'Electrocardiogram', price: 300 },
          { code: 'ECHO', name: 'Echocardiogram', description: 'Heart ultrasound', price: 1500 },
          { code: 'STRESS', name: 'Stress Test', description: 'Cardiac stress testing', price: 2000 }
        ]
      };
      
      const services = servicesByCategory[category] || servicesByCategory['blood-tests'];
      
      servicesGrid.innerHTML = services.map(service => `
        <div class="service-item" onclick="selectService('${service.code}', '${service.name}', ${service.price})">
          <h4>${service.name} (${service.code})</h4>
          <p>${service.description}</p>
          <span class="service-price">‚Çπ${service.price}</span>
        </div>
      `).join('');
    }

    function selectService(code, name, price) {
      selectedService = { code, name, price };
      
      // Update UI
      document.querySelectorAll('.service-item').forEach(item => item.classList.remove('selected'));
      event.target.classList.add('selected');
      
      updateBookingSummary();
    }

    function selectLab(name, location, rating) {
      selectedLab = { name, location, rating };
      
      // Update UI
      document.querySelectorAll('.lab-item').forEach(item => item.classList.remove('selected'));
      event.target.classList.add('selected');
      
      updateBookingSummary();
    }

    function updateBookingSummary() {
      const summaryCard = document.getElementById('bookingSummaryCard');
      
      if (selectedPatient && selectedService && selectedLab) {
        document.getElementById('summaryPatient').textContent = selectedPatient.name;
        document.getElementById('summaryService').textContent = `${selectedService.name} (${selectedService.code})`;
        document.getElementById('summaryLab').textContent = selectedLab.name;
        document.getElementById('summaryTotal').textContent = `‚Çπ${selectedService.price}`;
        
        // Set minimum date to today
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('bookingDate').min = today;
        
        summaryCard.style.display = 'block';
      } else {
        summaryCard.style.display = 'none';
      }
    }

    function confirmPatientBooking() {
      const date = document.getElementById('bookingDate').value;
      const time = document.getElementById('bookingTime').value;
      
      if (!date || !time) {
        alert('Please select both date and time for the appointment.');
        return;
      }
      
      // Create booking
      const bookingData = {
        patient: selectedPatient,
        service: selectedService,
        lab: selectedLab,
        date: date,
        time: time,
        total: selectedService.price
      };
      
      // In a real application, this would send data to the server
      console.log('Creating booking:', bookingData);
      
      // Show success message
      const formattedDate = new Date(date).toLocaleDateString('en-US', {
        year: 'numeric',
        month: 'short',
        day: 'numeric'
      });
      
      alert(`‚úÖ Booking confirmed for ${selectedPatient.name}!
      
Service: ${selectedService.name}
Lab: ${selectedLab.name}
Date: ${formattedDate} at ${time}
Total: ‚Çπ${selectedService.price}

Reference: #DR-${Date.now()}`);
      
      // Reset form
      resetBookingForm();
    }

    function resetBookingForm() {
      selectedPatient = null;
      selectedService = null;
      selectedLab = null;
      
      document.getElementById('selectedPatientInfo').style.display = 'none';
      document.getElementById('patientSearchInput').value = '';
      document.getElementById('bookingSummaryCard').style.display = 'none';
      document.querySelectorAll('.service-item.selected').forEach(item => item.classList.remove('selected'));
      document.querySelectorAll('.lab-item.selected').forEach(item => item.classList.remove('selected'));
    }

    // Patient Management Functions
    function searchMyPatients() {
      const query = document.getElementById('patientsSearchInput').value.toLowerCase();
      // In a real application, this would filter the patient list
      console.log('Searching my patients with query:', query);
    }

    function saveNewPatient() {
      const firstName = document.getElementById('patientFirstName').value;
      const lastName = document.getElementById('patientLastName').value;
      const age = document.getElementById('patientAge').value;
      const gender = document.getElementById('patientGender').value;
      const phone = document.getElementById('patientPhone').value;
      const email = document.getElementById('patientEmail').value;
      const address = document.getElementById('patientAddress').value;
      
      // Validation
      if (!firstName || !lastName || !age || !gender || !phone) {
        alert('Please fill in all required fields (marked with *)');
        return;
      }
      
      // In a real application, this would save to the server
      const newPatient = {
        id: 'P' + String(Date.now()).slice(-3),
        name: `${firstName} ${lastName}`,
        age: parseInt(age),
        gender: gender,
        phone: phone,
        email: email,
        address: address
      };
      
      console.log('Saving new patient:', newPatient);
      alert(`Patient ${newPatient.name} added successfully!`);
      
      // Reset form and close modal
      resetPatientForm();
      closeModal('addPatientModal');
      
      // Refresh patients list (in real app)
      // refreshPatientsList();
    }

    function editPatient(patientId) {
      // In a real application, this would fetch patient data from server
      currentEditingPatientId = patientId;
      
      // Demo data for editing
      const patientData = {
        'P001': { firstName: 'John', lastName: 'Doe', age: 35, gender: 'male', phone: '+91 9876543210', email: 'john@email.com', address: '123 Main St' },
        'P002': { firstName: 'Jane', lastName: 'Smith', age: 28, gender: 'female', phone: '+91 9876543211', email: 'jane@email.com', address: '456 Oak Ave' }
      };
      
      const patient = patientData[patientId];
      if (patient) {
        // Populate edit form
        document.getElementById('editPatientFirstName').value = patient.firstName;
        document.getElementById('editPatientLastName').value = patient.lastName;
        document.getElementById('editPatientAge').value = patient.age;
        document.getElementById('editPatientGender').value = patient.gender;
        document.getElementById('editPatientPhone').value = patient.phone;
        document.getElementById('editPatientEmail').value = patient.email;
        document.getElementById('editPatientAddress').value = patient.address;
        
        openModal('editPatientModal');
      }
    }

    function updatePatient() {
      const firstName = document.getElementById('editPatientFirstName').value;
      const lastName = document.getElementById('editPatientLastName').value;
      const age = document.getElementById('editPatientAge').value;
      const gender = document.getElementById('editPatientGender').value;
      const phone = document.getElementById('editPatientPhone').value;
      const email = document.getElementById('editPatientEmail').value;
      const address = document.getElementById('editPatientAddress').value;
      
      // Validation
      if (!firstName || !lastName || !age || !gender || !phone) {
        alert('Please fill in all required fields (marked with *)');
        return;
      }
      
      // In a real application, this would update the server
      console.log('Updating patient:', currentEditingPatientId, {
        firstName, lastName, age, gender, phone, email, address
      });
      
      alert(`Patient ${firstName} ${lastName} updated successfully!`);
      closeModal('editPatientModal');
    }

    function deletePatient(patientId) {
      if (confirm('Are you sure you want to delete this patient? This action cannot be undone.')) {
        // In a real application, this would delete from server
        console.log('Deleting patient:', patientId);
        alert('Patient deleted successfully.');
        
        // Refresh patients list (in real app)
        // refreshPatientsList();
      }
    }

    function resetPatientForm() {
      const fields = ['patientFirstName', 'patientLastName', 'patientAge', 'patientGender', 'patientPhone', 'patientEmail', 'patientAddress'];
      fields.forEach(field => {
        const element = document.getElementById(field);
        if (element) element.value = '';
      });
    }

    // Doctor Bookings Functions
    function filterDoctorBookings() {
      const filter = document.getElementById('bookingsFilter').value;
      console.log('Filtering bookings by:', filter);
      // In a real application, this would filter the bookings list
    }

    function viewDoctorBooking(bookingId) {
      // In a real application, this would fetch booking details from server
      const bookingData = {
        'B001': {
          patientName: 'John Doe',
          patientId: 'P001',
          patientPhone: '+91 9876543210',
          service: 'Complete Blood Count (CBC)',
          lab: 'City Lab',
          price: '‚Çπ500',
          date: 'March 25, 2024',
          time: '10:00 AM',
          status: 'Confirmed'
        },
        'B002': {
          patientName: 'Jane Smith',
          patientId: 'P002',
          patientPhone: '+91 9876543211',
          service: 'Liver Function Test (LFT)',
          lab: 'Metro Diagnostics',
          price: '‚Çπ800',
          date: 'March 26, 2024',
          time: '2:00 PM',
          status: 'Pending'
        }
      };
      
      const booking = bookingData[bookingId];
      if (booking) {
        // Populate modal with booking data
        document.getElementById('viewBookingPatientName').textContent = booking.patientName;
        document.getElementById('viewBookingPatientId').textContent = booking.patientId;
        document.getElementById('viewBookingPatientPhone').textContent = booking.patientPhone;
        document.getElementById('viewBookingService').textContent = booking.service;
        document.getElementById('viewBookingLab').textContent = booking.lab;
        document.getElementById('viewBookingPrice').textContent = booking.price;
        document.getElementById('viewBookingDate').textContent = booking.date;
        document.getElementById('viewBookingTime').textContent = booking.time;
        document.getElementById('viewBookingStatus').textContent = booking.status;
        document.getElementById('viewBookingStatus').className = `status-badge ${booking.status.toLowerCase()}`;
        
        openModal('viewDoctorBookingModal');
      }
    }

    function cancelDoctorBooking(bookingId) {
      // Store the booking ID for the cancellation process
      window.currentCancellingBookingId = bookingId;
      openModal('cancelDoctorBookingModal');
    }

    function confirmDoctorBookingCancellation() {
      const reason = document.getElementById('cancellationReason').value;
      const notes = document.getElementById('cancellationNotes').value;
      
      if (!reason) {
        alert('Please select a reason for cancellation.');
        return;
      }
      
      // In a real application, this would cancel the booking on the server
      console.log('Cancelling booking:', window.currentCancellingBookingId, { reason, notes });
      
      alert('Booking cancelled successfully. The patient will be notified.');
      closeModal('cancelDoctorBookingModal');
      
      // Reset form
      document.getElementById('cancellationReason').value = '';
      document.getElementById('cancellationNotes').value = '';
    }

    // Invoice Functions
    function viewInvoice(invoiceId) {
      // In a real application, this would fetch invoice details from server
      const invoiceData = {
        'INV001': {
          number: 'INV001',
          date: 'March 20, 2024',
          patientName: 'John Doe',
          patientId: 'P001',
          service: 'Complete Blood Count (CBC)',
          lab: 'City Lab',
          amount: '‚Çπ500',
          status: 'Paid'
        },
        'INV002': {
          number: 'INV002',
          date: 'March 22, 2024',
          patientName: 'Jane Smith',
          patientId: 'P002',
          service: 'Liver Function Test (LFT)',
          lab: 'Metro Diagnostics',
          amount: '‚Çπ800',
          status: 'Pending'
        }
      };
      
      const invoice = invoiceData[invoiceId];
      if (invoice) {
        // Populate modal with invoice data
        document.getElementById('viewInvoiceNumber').textContent = invoice.number;
        document.getElementById('viewInvoiceDate').textContent = invoice.date;
        document.getElementById('viewInvoicePatientName').textContent = invoice.patientName;
        document.getElementById('viewInvoicePatientId').textContent = invoice.patientId;
        document.getElementById('viewInvoiceService').textContent = invoice.service;
        document.getElementById('viewInvoiceLab').textContent = invoice.lab;
        document.getElementById('viewInvoiceAmount').textContent = invoice.amount;
        document.getElementById('viewInvoiceStatus').textContent = invoice.status;
        document.getElementById('viewInvoiceStatus').className = `status-badge ${invoice.status.toLowerCase() === 'paid' ? 'completed' : 'pending'}`;
        
        openModal('viewInvoiceModal');
      }
    }

    function downloadInvoice(invoiceId) {
      // In a real application, this would generate and download the PDF
      alert(`Downloading invoice ${invoiceId || 'PDF'}...`);
      if (invoiceId) {
        closeModal('viewInvoiceModal');
      }
    }

    function payInvoice(invoiceId) {
      // In a real application, this would fetch invoice details for payment
      const invoiceData = {
        'INV002': {
          number: 'INV002',
          patient: 'Jane Smith',
          service: 'Liver Function Test (LFT)',
          amount: '‚Çπ800'
        }
      };
      
      const invoice = invoiceData[invoiceId];
      if (invoice) {
        // Populate payment modal
        document.getElementById('payInvoiceNumber').textContent = invoice.number;
        document.getElementById('payInvoicePatient').textContent = invoice.patient;
        document.getElementById('payInvoiceService').textContent = invoice.service;
        document.getElementById('payInvoiceAmount').textContent = invoice.amount;
        
        // Store invoice ID for payment processing
        window.currentPayingInvoiceId = invoiceId;
        
        openModal('payInvoiceModal');
      }
    }

    function processInvoicePayment() {
      const paymentMethod = document.getElementById('invoicePaymentMethod').value;
      
      // In a real application, this would process the payment
      console.log('Processing payment for invoice:', window.currentPayingInvoiceId, 'with method:', paymentMethod);
      
      alert('Payment processed successfully! Invoice has been marked as paid.');
      closeModal('payInvoiceModal');
    }

    function viewTicket(ticketId) {
      // In a real application, this would fetch ticket conversation from server
      const ticketData = {
        'T001': {
          id: 'T001',
          subject: 'Patient booking issue',
          status: 'Open',
          priority: 'High'
        },
        'T002': {
          id: 'T002',
          subject: 'Invoice generation problem',
          status: 'Resolved',
          priority: 'Medium'
        }
      };
      
      const ticket = ticketData[ticketId];
      if (ticket) {
        // Populate modal with ticket data
        document.getElementById('conversationTicketId').textContent = `Ticket #${ticket.id}`;
        document.getElementById('conversationTicketSubject').textContent = ticket.subject;
        document.getElementById('conversationTicketStatus').textContent = ticket.status;
        document.getElementById('conversationTicketStatus').className = `status-badge ${ticket.status.toLowerCase() === 'resolved' ? 'completed' : 'pending'}`;
        document.getElementById('conversationTicketPriority').textContent = ticket.priority;
        
        // Store ticket ID for replies
        window.currentViewingTicketId = ticketId;
        
        openModal('viewTicketModal');
      }
    }

    function sendTicketReply() {
      const reply = document.getElementById('ticketReply').value;
      
      if (!reply.trim()) {
        alert('Please enter a reply message.');
        return;
      }
      
      // In a real application, this would send the reply to the server
      console.log('Sending reply to ticket:', window.currentViewingTicketId, 'Reply:', reply);
      
      // Add the reply to the conversation (in real app, this would be handled by the server)
      const messagesContainer = document.querySelector('.conversation-messages');
      const newMessage = document.createElement('div');
      newMessage.className = 'message user-message';
      newMessage.innerHTML = `
        <div class="message-header">
          <strong>Dr. Smith</strong>
          <span class="message-time">${new Date().toLocaleDateString()} - ${new Date().toLocaleTimeString()}</span>
        </div>
        <p>${reply}</p>
      `;
      messagesContainer.appendChild(newMessage);
      messagesContainer.scrollTop = messagesContainer.scrollHeight;
      
      // Reset reply field
      document.getElementById('ticketReply').value = '';
      
      alert('Reply sent successfully!');
    }

    // Profile Functions
    function openEditProfileModal() {
      // Pre-populate form with current profile data
      document.getElementById('editProfileName').value = document.getElementById('profileName').textContent;
      document.getElementById('editProfileSpecialty').value = document.getElementById('profileSpecialty').textContent;
      document.getElementById('editProfileRegistration').value = document.getElementById('profileRegistration').textContent;
      document.getElementById('editProfileClinic').value = document.getElementById('profileClinic').textContent;
      document.getElementById('editProfileEmail').value = document.getElementById('profileEmail').textContent;
      document.getElementById('editProfilePhone').value = document.getElementById('profilePhone').textContent;
      document.getElementById('editProfileExperience').value = document.getElementById('profileExperience').textContent.replace(' years', '');
      
      openModal('editProfileModal');
    }

    function saveProfileChanges() {
      const name = document.getElementById('editProfileName').value.trim();
      const specialty = document.getElementById('editProfileSpecialty').value.trim();
      const registration = document.getElementById('editProfileRegistration').value.trim();
      const clinic = document.getElementById('editProfileClinic').value.trim();
      const email = document.getElementById('editProfileEmail').value.trim();
      const phone = document.getElementById('editProfilePhone').value.trim();
      const experience = document.getElementById('editProfileExperience').value.trim();
      
      // Clear any existing errors
      clearEditProfileErrors();
      
      let hasErrors = false;
      
      // Field validation
      if (!name) {
        showEditProfileError('editProfileName', 'Name is required');
        hasErrors = true;
      }
      
      if (!specialty) {
        showEditProfileError('editProfileSpecialty', 'Specialty is required');
        hasErrors = true;
      }
      
      if (!registration) {
        showEditProfileError('editProfileRegistration', 'Registration number is required');
        hasErrors = true;
      }
      
      if (!clinic) {
        showEditProfileError('editProfileClinic', 'Clinic name is required');
        hasErrors = true;
      }
      
      if (!email) {
        showEditProfileError('editProfileEmail', 'Email is required');
        hasErrors = true;
      } else {
        // Email validation
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!emailRegex.test(email)) {
          showEditProfileError('editProfileEmail', 'Please enter a valid email address');
          hasErrors = true;
        }
      }
      
      if (!phone) {
        showEditProfileError('editProfilePhone', 'Phone number is required');
        hasErrors = true;
      } else {
        // Phone validation (basic pattern for Indian phone numbers)
        const phoneRegex = /^(\+91[\s-]?)?[0]?(91)?[789]\d{9}$/;
        if (!phoneRegex.test(phone.replace(/[\s-]/g, ''))) {
          showEditProfileError('editProfilePhone', 'Please enter a valid phone number');
          hasErrors = true;
        }
      }
      
      if (!experience) {
        showEditProfileError('editProfileExperience', 'Years of experience is required');
        hasErrors = true;
      } else if (isNaN(experience) || parseInt(experience) < 0) {
        showEditProfileError('editProfileExperience', 'Please enter a valid number of years');
        hasErrors = true;
      }
      
      if (hasErrors) {
        return;
      }
      
      // Update profile display
      document.getElementById('profileName').textContent = name;
      document.getElementById('profileSpecialty').textContent = specialty;
      document.getElementById('profileRegistration').textContent = registration;
      document.getElementById('profileClinic').textContent = clinic;
      document.getElementById('profileEmail').textContent = email;
      document.getElementById('profilePhone').textContent = phone;
      document.getElementById('profileExperience').textContent = experience + ' years';
      
      // In a real application, this would save to the server
      console.log('Saving profile changes:', {
        name, specialty, registration, clinic, email, phone, experience
      });
      
      closeModal('editProfileModal');
      showSuccessBanner('Profile updated successfully!');
    }
    
    function clearEditProfileErrors() {
      const errorElements = document.querySelectorAll('#editProfileModal .field-error');
      errorElements.forEach(el => el.remove());
      
      const inputElements = document.querySelectorAll('#editProfileModal input');
      inputElements.forEach(el => el.classList.remove('error'));
    }
    
    function showEditProfileError(fieldId, message) {
      const field = document.getElementById(fieldId);
      field.classList.add('error');
      
      // Create error message element
      const errorDiv = document.createElement('div');
      errorDiv.className = 'field-error';
      errorDiv.textContent = message;
      field.parentNode.appendChild(errorDiv);
    }

    function openChangePasswordModal() {
      // Clear form
      document.getElementById('currentPasswordInput').value = '';
      document.getElementById('newPasswordInput').value = '';
      document.getElementById('confirmPasswordInput').value = '';
      document.getElementById('newPasswordStrength').textContent = '';
      document.getElementById('confirmPasswordMatch').textContent = '';
      
      openModal('changePasswordModal');
    }

    function checkNewPasswordStrength() {
      const password = document.getElementById('newPasswordInput').value;
      const strengthDiv = document.getElementById('newPasswordStrength');
      
      if (password.length === 0) {
        strengthDiv.textContent = '';
        strengthDiv.className = 'password-strength-indicator';
        return;
      }
      
      let strength = 0;
      if (password.length >= 8) strength++;
      if (/[a-z]/.test(password)) strength++;
      if (/[A-Z]/.test(password)) strength++;
      if (/\d/.test(password)) strength++;
      if (/[^a-zA-Z\d]/.test(password)) strength++;
      
      if (strength < 3) {
        strengthDiv.textContent = 'Strength: Weak üîì';
        strengthDiv.className = 'password-strength-indicator password-strength-weak';
      } else if (strength < 4) {
        strengthDiv.textContent = 'Strength: Medium üîí';
        strengthDiv.className = 'password-strength-indicator password-strength-medium';
      } else {
        strengthDiv.textContent = 'Strength: Strong üîí';
        strengthDiv.className = 'password-strength-indicator password-strength-strong';
      }
      
      // Re-check password match when strength changes
      checkNewPasswordMatch();
    }

    function checkNewPasswordMatch() {
      const newPassword = document.getElementById('newPasswordInput').value;
      const confirmPassword = document.getElementById('confirmPasswordInput').value;
      const matchDiv = document.getElementById('confirmPasswordMatch');
      
      if (confirmPassword.length === 0) {
        matchDiv.textContent = '';
        matchDiv.className = 'password-strength-indicator';
        return;
      }
      
      if (newPassword === confirmPassword) {
        matchDiv.textContent = 'Passwords match ‚úì';
        matchDiv.className = 'password-strength-indicator password-strength-strong';
      } else {
        matchDiv.textContent = 'Passwords do not match ‚úó';
        matchDiv.className = 'password-strength-indicator password-strength-weak';
      }
    }

    function updatePassword() {
      const currentPassword = document.getElementById('currentPasswordInput').value.trim();
      const newPassword = document.getElementById('newPasswordInput').value.trim();
      const confirmPassword = document.getElementById('confirmPasswordInput').value.trim();
      
      // Clear any existing errors
      clearChangePasswordErrors();
      
      let hasErrors = false;
      
      // Validation
      if (!currentPassword) {
        showChangePasswordError('currentPasswordInput', 'Current password is required');
        hasErrors = true;
      }
      
      if (!newPassword) {
        showChangePasswordError('newPasswordInput', 'New password is required');
        hasErrors = true;
      } else if (newPassword.length < 8) {
        showChangePasswordError('newPasswordInput', 'Password must be at least 8 characters long');
        hasErrors = true;
      } else {
        // Check password strength
        let strength = 0;
        if (/[a-z]/.test(newPassword)) strength++;
        if (/[A-Z]/.test(newPassword)) strength++;
        if (/\d/.test(newPassword)) strength++;
        if (/[^a-zA-Z\d]/.test(newPassword)) strength++;
        
        if (strength < 3) {
          showChangePasswordError('newPasswordInput', 'Password is too weak. Include uppercase, lowercase, numbers, and special characters');
          hasErrors = true;
        }
      }
      
      if (!confirmPassword) {
        showChangePasswordError('confirmPasswordInput', 'Please confirm your new password');
        hasErrors = true;
      } else if (newPassword !== confirmPassword) {
        showChangePasswordError('confirmPasswordInput', 'Passwords do not match');
        hasErrors = true;
      }
      
      // Simulate current password verification (in real app, this would be server-side)
      if (currentPassword && currentPassword !== 'currentpass123') {
        showChangePasswordError('currentPasswordInput', 'Current password is incorrect');
        hasErrors = true;
      }
      
      if (hasErrors) {
        return;
      }
      
      // In a real application, this would verify current password and update on server
      console.log('Updating password for user');
      
      closeModal('changePasswordModal');
      showSuccessBanner('Password updated successfully! Please use your new password for future logins.');
    }
    
    function clearChangePasswordErrors() {
      const errorElements = document.querySelectorAll('#changePasswordModal .field-error');
      errorElements.forEach(el => el.remove());
      
      const inputElements = document.querySelectorAll('#changePasswordModal input');
      inputElements.forEach(el => el.classList.remove('error'));
    }
    
    function showChangePasswordError(fieldId, message) {
      const field = document.getElementById(fieldId);
      field.classList.add('error');
      
      // Create error message element
      const errorDiv = document.createElement('div');
      errorDiv.className = 'field-error';
      errorDiv.textContent = message;
      field.parentNode.appendChild(errorDiv);
    }

    // Support Functions (Updated)
    function searchTickets() {
      const query = document.getElementById('ticketSearchInput').value.toLowerCase();
      const rows = document.querySelectorAll('.ticket-row');
      
      rows.forEach(row => {
        const ticketId = row.querySelector('td:first-child').textContent.toLowerCase();
        const subject = row.querySelector('td:nth-child(2)').textContent.toLowerCase();
        const isVisible = ticketId.includes(query) || subject.includes(query);
        row.style.display = isVisible ? 'table-row' : 'none';
      });
    }

    function loadMoreTickets() {
      // In a real application, this would load more tickets from the server
      alert('Loading more tickets... (This would fetch additional tickets from the server)');
    }

    function createSupportTicket() {
      const subject = document.getElementById('ticketSubject').value.trim();
      const category = document.getElementById('ticketCategory').value;
      const description = document.getElementById('ticketDescription').value.trim();
      
      // Clear any existing errors
      clearNewTicketErrors();
      
      let hasErrors = false;
      
      // Field validation
      if (!subject) {
        showNewTicketError('ticketSubject', 'Subject is required');
        hasErrors = true;
      }
      
      if (!description) {
        showNewTicketError('ticketDescription', 'Description is required');
        hasErrors = true;
      } else if (description.length < 10) {
        showNewTicketError('ticketDescription', 'Please provide a more detailed description (minimum 10 characters)');
        hasErrors = true;
      }
      
      if (hasErrors) {
        return;
      }
      
      // In a real application, this would create the ticket on the server
      const ticketData = {
        id: 'T' + String(Date.now()).slice(-4),
        subject: subject,
        category: category,
        description: description,
        status: 'Open',
        created: new Date().toLocaleDateString() + ', ' + new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})
      };
      
      console.log('Creating support ticket:', ticketData);
      
      // Add new ticket to the table (in real app, this would be handled by server response)
      const tableBody = document.getElementById('ticketsTableBody');
      const newRow = document.createElement('tr');
      newRow.className = 'ticket-row';
      newRow.onclick = () => viewTicket(ticketData.id);
      newRow.innerHTML = `
        <td><strong>${ticketData.id}</strong></td>
        <td>${ticketData.subject}</td>
        <td><span class="status-badge pending">Open</span></td>
        <td>${ticketData.created}</td>
        <td><button class="btn-secondary" onclick="event.stopPropagation(); viewTicket('${ticketData.id}')">View</button></td>
      `;
      tableBody.insertBefore(newRow, tableBody.firstChild);
      
      // Reset form and close modal
      resetTicketForm();
      closeModal('newTicketModal');
      showSuccessBanner(`Support ticket created successfully! Ticket ID: ${ticketData.id}. You will receive email notifications for updates.`);
    }
    
    function clearNewTicketErrors() {
      const errorElements = document.querySelectorAll('#newTicketModal .field-error');
      errorElements.forEach(el => el.remove());
      
      const inputElements = document.querySelectorAll('#newTicketModal input, #newTicketModal textarea');
      inputElements.forEach(el => el.classList.remove('error'));
    }
    
    function showNewTicketError(fieldId, message) {
      const field = document.getElementById(fieldId);
      field.classList.add('error');
      
      // Create error message element
      const errorDiv = document.createElement('div');
      errorDiv.className = 'field-error';
      errorDiv.textContent = message;
      field.parentNode.appendChild(errorDiv);
    }

    function viewTicket(ticketId) {
      // In a real application, this would fetch ticket conversation from server
      const ticketData = {
        'T3005': {
          id: 'T3005',
          subject: 'Lab Access Issue',
          status: 'Open',
          messages: [
            {
              sender: 'Support Team',
              time: 'July 1, 2025 - 09:30 AM',
              message: 'We are checking your account access. Please provide your registration number for verification.',
              isSupport: true
            },
            {
              sender: 'Dr. Sarah Patel',
              time: 'July 1, 2025 - 10:15 AM',
              message: 'Please expedite, as patient needs test. My registration is MCI-123456.',
              isSupport: false
            }
          ]
        },
        'T2980': {
          id: 'T2980',
          subject: 'Billing Query',
          status: 'Closed',
          messages: [
            {
              sender: 'Dr. Sarah Patel',
              time: 'June 25, 2025 - 14:00 PM',
              message: 'I have a question about the billing for patient consultation fees.',
              isSupport: false
            },
            {
              sender: 'Support Team',
              time: 'June 25, 2025 - 14:45 PM',
              message: 'Thank you for your query. Consultation fees are automatically calculated based on your clinic settings. The issue has been resolved.',
              isSupport: true
            }
          ]
        },
        'T2955': {
          id: 'T2955',
          subject: 'Patient Booking Error',
          status: 'Open',
          messages: [
            {
              sender: 'Dr. Sarah Patel',
              time: 'June 20, 2025 - 09:30 AM',
              message: 'Getting error when trying to book appointments for patients. Error code: BK_001',
              isSupport: false
            },
            {
              sender: 'Support Team',
              time: 'June 20, 2025 - 10:15 AM',
              message: 'We are investigating this booking error. Our technical team is working on a fix.',
              isSupport: true
            }
          ]
        },
        'T2888': {
          id: 'T2888',
          subject: 'Invoice Generation Issue',
          status: 'Closed',
          messages: [
            {
              sender: 'Dr. Sarah Patel',
              time: 'June 15, 2025 - 16:00 PM',
              message: 'Invoices are not generating properly for completed appointments.',
              isSupport: false
            },
            {
              sender: 'Support Team',
              time: 'June 15, 2025 - 16:20 PM',
              message: 'Issue has been resolved. Invoice generation is now working normally.',
              isSupport: true
            }
          ]
        }
      };
      
      const ticket = ticketData[ticketId] || {
        id: ticketId,
        subject: 'General Inquiry',
        status: 'Open',
        messages: [
          {
            sender: 'Support Team',
            time: new Date().toLocaleDateString() + ' - ' + new Date().toLocaleTimeString(),
            message: 'Thank you for contacting support. How can we help you today?',
            isSupport: true
          }
        ]
      };
      
      // Populate modal with ticket data
      document.getElementById('conversationTicketId').textContent = `Ticket #${ticket.id}`;
      document.getElementById('conversationTicketSubject').textContent = ticket.subject;
      document.getElementById('conversationTicketStatus').textContent = ticket.status;
      document.getElementById('conversationTicketStatus').className = `status-badge ${ticket.status.toLowerCase() === 'closed' ? 'completed' : 'pending'}`;
      
      // Populate conversation messages
      const messagesContainer = document.getElementById('conversationMessages');
      messagesContainer.innerHTML = '';
      
      ticket.messages.forEach(msg => {
        const messageDiv = document.createElement('div');
        messageDiv.className = `message ${msg.isSupport ? 'support-message' : 'user-message'}`;
        messageDiv.innerHTML = `
          <div class="message-header">
            <strong>${msg.sender}</strong>
            <span class="message-time">${msg.time}</span>
          </div>
          <p>${msg.message}</p>
        `;
        messagesContainer.appendChild(messageDiv);
      });
      
      // Scroll to bottom of messages
      messagesContainer.scrollTop = messagesContainer.scrollHeight;
      
      // Store ticket ID for replies
      window.currentViewingTicketId = ticketId;
      
      // Clear reply field
      document.getElementById('ticketReply').value = '';
      
      openModal('viewTicketModal');
    }

    function sendTicketReply() {
      const reply = document.getElementById('ticketReply').value.trim();
      const fileInput = document.getElementById('ticketFileUpload');
      const attachedFile = fileInput.files[0];
      
      if (!reply && !attachedFile) {
        alert('Please enter a reply message or attach a file');
        return;
      }
      
      // In a real application, this would send the reply to the server
      console.log('Sending reply to ticket:', window.currentViewingTicketId, 'Reply:', reply);
      
      // Add the reply to the conversation
      const messagesContainer = document.getElementById('conversationMessages');
      const newMessage = document.createElement('div');
      newMessage.className = 'message user-message';
      
      let messageContent = '';
      if (reply) {
        messageContent += `<p>${reply}</p>`;
      }
      
      if (attachedFile) {
        messageContent += `<div class="attachment" style="margin-top:8px;padding:8px;background:rgba(255,255,255,0.1);border-radius:4px;font-size:12px;">
          üìé ${attachedFile.name} (${(attachedFile.size / 1024).toFixed(1)} KB)
        </div>`;
      }
      
      newMessage.innerHTML = `
        <div class="message-header">
          <strong>Dr. Sarah Patel</strong>
          <span class="message-time">${new Date().toLocaleDateString()} - ${new Date().toLocaleTimeString()}</span>
        </div>
        ${messageContent}
      `;
      messagesContainer.appendChild(newMessage);
      messagesContainer.scrollTop = messagesContainer.scrollHeight;
      
      // Reset reply field and file upload
      document.getElementById('ticketReply').value = '';
      fileInput.value = '';
      document.getElementById('attachedFileName').textContent = '';
      
      // Show success message
      showSuccessBanner('Message sent successfully!');
      
      // Simulate support response after 2 seconds (only for demo)
      setTimeout(() => {
        const supportResponse = document.createElement('div');
        supportResponse.className = 'message support-message';
        supportResponse.innerHTML = `
          <div class="message-header">
            <strong>Support Team</strong>
            <span class="message-time">${new Date().toLocaleDateString()} - ${new Date().toLocaleTimeString()}</span>
          </div>
          <p>Thank you for your message. We are reviewing your request and will update you shortly.</p>
        `;
        messagesContainer.appendChild(supportResponse);
        messagesContainer.scrollTop = messagesContainer.scrollHeight;
      }, 2000);
    }

    function resetTicketForm() {
      const fields = ['ticketSubject', 'ticketCategory', 'ticketDescription'];
      fields.forEach(field => {
        const element = document.getElementById(field);
        if (element) element.value = '';
      });
      // Reset category to default
      document.getElementById('ticketCategory').value = 'booking';
    }

    function editProfile() {
      openEditProfileModal();
    }

    // Initialize service categories and labs on page load
    document.addEventListener('DOMContentLoaded', function() {
      // Initialize default services
      updateServicesGrid('blood-tests');
    });

    // Admin Dashboard Functions
    // Clean up any unwanted footer pollution
    function cleanupFooterPollution() {
      try {
        // Remove any elements that might contain unwanted content
        const bodyChildren = document.body.children;
        for (let i = bodyChildren.length - 1; i >= 0; i--) {
          const child = bodyChildren[i];
          // Remove any loose div elements that might contain unwanted content
          if (child.tagName === 'DIV' && 
              !child.id && 
              !child.classList.contains('modal') && 
              !child.classList.contains('modal-backdrop') && 
              !child.classList.contains('container') && 
              child.textContent && child.textContent.includes('INR')) {
            child.remove();
          }
        }
      } catch (e) {
        console.log('Cleanup function error:', e);
      }
    }

    function showAdminTab(tabId) {
      // Clean up any unwanted content in DOM
      cleanupFooterPollution();
      
      // Hide all admin tab content
      const tabContents = document.querySelectorAll('.admin-tab-content');
      tabContents.forEach(tab => tab.classList.remove('active'));
      
      // Hide all admin tab buttons
      const tabButtons = document.querySelectorAll('.admin-tab');
      tabButtons.forEach(tab => tab.classList.remove('active'));
      
      // Show selected tab content
      const selectedTab = document.getElementById(tabId);
      if (selectedTab) {
        selectedTab.classList.add('active');
      }
      
      // Highlight selected tab button
      const navTabMap = {
        'manageServices': 'manageServicesTab',
        'scheduleCapacity': 'scheduleCapacityTab', 
        'bookingsOverview': 'bookingsOverviewTab',
        'reports': 'reportsTab',
        'manageUsers': 'manageUsersTab',
        'userRoles': 'userRolesTab',
        'supportTickets': 'supportTicketsTab'
      };
      
      const selectedNavTab = document.querySelector(`[onclick="showAdminTab('${tabId}')"]`);
      if (selectedNavTab) {
        selectedNavTab.classList.add('active');
      }
      
      // Initialize specific tab functionality
      if (tabId === 'manageUsers') {
        initializeUserManagement();
      } else if (tabId === 'bookingsOverview') {
        initializeBookingManagement();
      }
    }

    // Service Management Functions
    function editService(serviceCode) {
      // Populate edit service modal with existing data
      const serviceData = getServiceData(serviceCode);
      if (serviceData) {
        document.getElementById('editServiceCode').value = serviceData.code;
        document.getElementById('editServiceCodeDisplay').value = serviceData.code;
        document.getElementById('editServiceName').value = serviceData.name;
        document.getElementById('editServicePrice').value = serviceData.price;
        document.getElementById('editServiceCurrency').value = serviceData.currency;
        document.getElementById('editServiceTat').value = serviceData.tat;
        
        openModal('editServiceModal');
      }
    }

    function deleteService(serviceCode) {
      if (confirm(`Are you sure you want to delete service ${serviceCode}?`)) {
        // Remove from table
        const rows = document.querySelectorAll('#servicesTableBody tr');
        rows.forEach(row => {
          if (row.cells[0].textContent === serviceCode) {
            row.remove();
          }
        });
        showSuccessBanner(`Service ${serviceCode} deleted successfully!`);
      }
    }

    function getServiceData(serviceCode) {
      // Mock data - in real implementation, this would fetch from backend
      const services = {
        'HP01': { code: 'HP01', name: 'Comprehensive Health Panel', price: '2000', currency: 'INR', tat: '24' },
        'GNT01': { code: 'GNT01', name: 'Genetic Testing Panel', price: '5500', currency: 'INR', tat: '72' },
        'BLD01': { code: 'BLD01', name: 'Complete Blood Count', price: '500', currency: 'INR', tat: '12' },
        'THY01': { code: 'THY01', name: 'Thyroid Profile', price: '800', currency: 'INR', tat: '24' },
        'LIV01': { code: 'LIV01', name: 'Liver Function Test', price: '650', currency: 'INR', tat: '18' }
      };
      return services[serviceCode];
    }

    function addService() {
      const form = document.getElementById('addServiceForm');
      if (form.checkValidity()) {
        const formData = new FormData(form);
        const serviceData = {
          code: formData.get('serviceCode'),
          name: formData.get('serviceName'),
          price: formData.get('servicePrice'),
          currency: formData.get('serviceCurrency'),
          tat: formData.get('serviceTat')
        };
        
        // Add to table
        addServiceToTable(serviceData);
        
        // Close modal and reset form
        closeModal('addServiceModal');
        form.reset();
        showSuccessBanner('Service added successfully!');
      }
    }

    function updateService() {
      const form = document.getElementById('editServiceForm');
      if (form.checkValidity()) {
        const formData = new FormData(form);
        const serviceData = {
          code: formData.get('serviceCode'),
          name: formData.get('serviceName'),
          price: formData.get('servicePrice'),
          currency: formData.get('serviceCurrency'),
          tat: formData.get('serviceTat')
        };
        
        // Update table row
        updateServiceInTable(serviceData);
        
        // Close modal
        closeModal('editServiceModal');
        showSuccessBanner('Service updated successfully!');
      }
    }

    function addServiceToTable(serviceData) {
      const tbody = document.getElementById('servicesTableBody');
      const row = document.createElement('tr');
      row.innerHTML = `
        <td>${serviceData.code}</td>
        <td>${serviceData.name}</td>
        <td>${serviceData.price}</td>
        <td>${serviceData.currency}</td>
        <td>${serviceData.tat}</td>
        <td>
          <button class="btn-icon" onclick="editService('${serviceData.code}')" title="Edit Service">‚úé</button>
          <button class="btn-icon danger" onclick="deleteService('${serviceData.code}')" title="Delete Service">üóë</button>
        </td>
      `;
      tbody.appendChild(row);
    }

    function updateServiceInTable(serviceData) {
      const rows = document.querySelectorAll('#servicesTableBody tr');
      rows.forEach(row => {
        if (row.cells[0].textContent === serviceData.code) {
          row.cells[1].textContent = serviceData.name;
          row.cells[2].textContent = serviceData.price;
          row.cells[3].textContent = serviceData.currency;
          row.cells[4].textContent = serviceData.tat;
        }
      });
    }

    // Schedule Management Functions
    function updateSchedule(day, shift) {
      const scheduleKey = `${day}-${shift}`;
      const capacity = document.getElementById(`capacity-${scheduleKey}`).value;
      const booked = document.getElementById(`booked-${scheduleKey}`).textContent;
      
      if (capacity && parseInt(capacity) >= parseInt(booked)) {
        showSuccessBanner(`Schedule updated for ${day} ${shift} shift!`);
      } else {
        alert('Capacity cannot be less than already booked appointments!');
      }
    }

    // Booking Management Functions
    function viewBookingDetails(bookingId) {
      // Populate booking details modal with mock data
      const bookingData = getBookingData(bookingId);
      if (bookingData) {
        document.getElementById('bookingDetailsContent').innerHTML = `
          <div class="booking-details">
            <div class="detail-row">
              <strong>Booking ID:</strong> ${bookingData.id}
            </div>
            <div class="detail-row">
              <strong>Patient:</strong> ${bookingData.patient}
            </div>
            <div class="detail-row">
              <strong>Service:</strong> ${bookingData.service}
            </div>
            <div class="detail-row">
              <strong>Date & Time:</strong> ${bookingData.datetime}
            </div>
            <div class="detail-row">
              <strong>Status:</strong> <span class="badge ${bookingData.status.toLowerCase()}">${bookingData.status}</span>
            </div>
            <div class="detail-row">
              <strong>Amount:</strong> ‚Çπ${bookingData.amount}
            </div>
            <div class="detail-row">
              <strong>Payment Status:</strong> <span class="badge ${bookingData.paymentStatus.toLowerCase().replace(' ', '-')}">${bookingData.paymentStatus}</span>
            </div>
          </div>
        `;
        openModal('bookingDetailsModal');
      }
    }

    function getBookingData(bookingId) {
      // Mock booking data
      const bookings = {
        'BK001': {
          id: 'BK001',
          patient: 'Sarah Johnson',
          service: 'Comprehensive Health Panel',
          datetime: '2024-01-20 10:00 AM',
          status: 'Confirmed',
          amount: '2,000',
          paymentStatus: 'Paid'
        },
        'BK002': {
          id: 'BK002',
          patient: 'Michael Brown',
          service: 'Genetic Testing Panel',
          datetime: '2024-01-20 02:00 PM',
          status: 'Pending',
          amount: '5,500',
          paymentStatus: 'Pending'
        }
      };
      return bookings[bookingId];
    }

    // Report Functions
    function generateReport(reportType) {
      // Mock report generation
      const reportData = {
        'revenue': {
          title: 'Revenue Report - ' + new Date().toLocaleDateString(),
          content: `
            <div class="report-section">
              <h3>Revenue Analysis</h3>
              <div class="report-stats">
                <div class="stat-item">
                  <span class="stat-label">Total Revenue:</span>
                  <span class="stat-value">‚Çπ2,85,000</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Monthly Growth:</span>
                  <span class="stat-value">+12.5%</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Average Order Value:</span>
                  <span class="stat-value">‚Çπ1,695</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Top Service:</span>
                  <span class="stat-value">Health Panel</span>
                </div>
              </div>
            </div>
          `
        },
        'utilization': {
          title: 'Utilization Report - ' + new Date().toLocaleDateString(),
          content: `
            <div class="report-section">
              <h3>Capacity Utilization</h3>
              <div class="report-stats">
                <div class="stat-item">
                  <span class="stat-label">Overall Utilization:</span>
                  <span class="stat-value">78.5%</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Peak Hours:</span>
                  <span class="stat-value">9 AM - 11 AM</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Busiest Day:</span>
                  <span class="stat-value">Monday</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Available Slots:</span>
                  <span class="stat-value">45/210</span>
                </div>
              </div>
            </div>
          `
        },
        'noshow': {
          title: 'No-Show Rate Report - ' + new Date().toLocaleDateString(),
          content: `
            <div class="report-section">
              <h3>No-Show Analysis</h3>
              <div class="report-stats">
                <div class="stat-item">
                  <span class="stat-label">No-Show Rate:</span>
                  <span class="stat-value">8.2%</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Total No-Shows:</span>
                  <span class="stat-value">14</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Revenue Impact:</span>
                  <span class="stat-value">‚Çπ23,800</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Highest Risk Day:</span>
                  <span class="stat-value">Friday</span>
                </div>
              </div>
            </div>
          `
        },
        'performance': {
          title: 'Performance Report - ' + new Date().toLocaleDateString(),
          content: `
            <div class="report-section">
              <h3>Lab Performance</h3>
              <div class="report-stats">
                <div class="stat-item">
                  <span class="stat-label">Customer Satisfaction:</span>
                  <span class="stat-value">4.7/5</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Average TAT:</span>
                  <span class="stat-value">28 hours</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Quality Score:</span>
                  <span class="stat-value">95.8%</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Staff Efficiency:</span>
                  <span class="stat-value">87.3%</span>
                </div>
              </div>
            </div>
          `
        },
        'all': {
          title: 'Comprehensive Report - ' + new Date().toLocaleDateString(),
          content: `
            <div class="report-section">
              <h3>Lab Overview</h3>
              <div class="report-stats">
                <div class="stat-item">
                  <span class="stat-label">Total Tests:</span>
                  <span class="stat-value">168</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Total Revenue:</span>
                  <span class="stat-value">‚Çπ2,85,000</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Utilization:</span>
                  <span class="stat-value">78.5%</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">No-Show Rate:</span>
                  <span class="stat-value">8.2%</span>
                </div>
              </div>
            </div>
          `
        }
      };

      const report = reportData[reportType];
      if (report) {
        document.getElementById('reportTitle').textContent = report.title;
        document.getElementById('reportContent').innerHTML = report.content;
        openModal('reportModal');
      }
    }

    function downloadReport() {
      // Mock download functionality
      const reportTitle = document.getElementById('reportTitle').textContent;
      showSuccessBanner(`${reportTitle} downloaded successfully!`);
      closeModal('reportModal');
    }

    // User Role Management Functions
    function editRole(roleId) {
      const roleData = getRoleData(roleId);
      if (roleData) {
        document.getElementById('editRoleId').value = roleData.id;
        document.getElementById('editRoleName').value = roleData.name;
        document.getElementById('editRoleDescription').value = roleData.description;
        
        // Set permissions checkboxes
        const permissionCheckboxes = document.querySelectorAll('#editRoleModal input[type="checkbox"]');
        permissionCheckboxes.forEach(checkbox => {
          checkbox.checked = roleData.permissions.includes(checkbox.value);
        });
        
        openModal('editRoleModal');
      }
    }

    function deleteRole(roleId) {
      if (confirm(`Are you sure you want to delete this role?`)) {
        const rows = document.querySelectorAll('.roles-table tbody tr');
        rows.forEach(row => {
          const editButton = row.querySelector('button[onclick*="editRole"]');
          if (editButton && editButton.getAttribute('onclick').includes(roleId)) {
            row.remove();
          }
        });
        showSuccessBanner(`Role deleted successfully!`);
      }
    }

    function getRoleData(roleId) {
      // Mock role data
      const roles = {
        'R001': {
          id: 'R001',
          name: 'Lab Technician',
          description: 'Can process samples and update test results',
          permissions: ['process_samples', 'update_results', 'view_bookings']
        },
        'R002': {
          id: 'R002',
          name: 'Reception',
          description: 'Can manage bookings and customer service',
          permissions: ['manage_bookings', 'customer_service', 'view_reports']
        },
        'R003': {
          id: 'R003',
          name: 'Manager',
          description: 'Can oversee operations and manage staff',
          permissions: ['manage_staff', 'view_reports', 'manage_bookings', 'process_samples']
        }
      };
      return roles[roleId];
    }

    function addRole() {
      const form = document.getElementById('addRoleForm');
      if (form.checkValidity()) {
        const formData = new FormData(form);
        const permissions = Array.from(form.querySelectorAll('input[type="checkbox"]:checked')).map(cb => cb.value);
        
        const roleData = {
          id: 'R' + String(Date.now()).slice(-3), // Generate simple ID
          name: formData.get('roleName'),
          description: formData.get('roleDescription'),
          permissions: permissions
        };
        
        addRoleToTable(roleData);
        closeModal('addRoleModal');
        form.reset();
        showSuccessBanner('Role added successfully!');
      }
    }

    function updateRole() {
      const form = document.getElementById('editRoleForm');
      if (form.checkValidity()) {
        const formData = new FormData(form);
        const permissions = Array.from(form.querySelectorAll('input[type="checkbox"]:checked')).map(cb => cb.value);
        
        const roleData = {
          id: formData.get('roleId'),
          name: formData.get('roleName'),
          description: formData.get('roleDescription'),
          permissions: permissions
        };
        
        updateRoleInTable(roleData);
        closeModal('editRoleModal');
        showSuccessBanner('Role updated successfully!');
      }
    }

    function addRoleToTable(roleData) {
      const tbody = document.querySelector('.roles-table tbody');
      const row = document.createElement('tr');
      row.innerHTML = `
        <td>${roleData.name}</td>
        <td>0</td>
        <td>${roleData.permissions.length > 3 ? roleData.permissions.slice(0,3).join(', ') + '...' : roleData.permissions.join(', ')}</td>
        <td>
          <button class="btn-icon" onclick="editRole('${roleData.id}')" title="Edit Role">‚úé</button>
          <button class="btn-icon danger" onclick="deleteRole('${roleData.id}')" title="Delete Role">üóë</button>
        </td>
      `;
      tbody.appendChild(row);
    }

    function updateRoleInTable(roleData) {
      const rows = document.querySelectorAll('.roles-table tbody tr');
      rows.forEach(row => {
        const roleNameCell = row.cells[0];
        // Find row by checking if edit button has matching role ID
        const editButton = row.querySelector('button[onclick*="editRole"]');
        if (editButton && editButton.getAttribute('onclick').includes(roleData.id)) {
          row.cells[0].textContent = roleData.name;
          row.cells[2].textContent = roleData.permissions.length > 3 ? 
            roleData.permissions.slice(0,3).join(', ') + '...' : 
            roleData.permissions.join(', ');
        }
      });
    }

    // Support Ticket Functions
    function viewTicket(ticketId) {
      const ticketData = getTicketData(ticketId);
      if (ticketData) {
        document.getElementById('ticketConversationId').textContent = ticketData.id;
        document.getElementById('ticketConversationSubject').textContent = ticketData.subject;
        document.getElementById('ticketConversationStatus').innerHTML = `<span class="badge ${ticketData.status.toLowerCase()}">${ticketData.status}</span>`;
        document.getElementById('ticketConversationPriority').innerHTML = `<span class="badge priority-${ticketData.priority.toLowerCase()}">${ticketData.priority}</span>`;
        
        // Load conversation messages
        const messagesContainer = document.getElementById('ticketMessages');
        messagesContainer.innerHTML = ticketData.messages.map(msg => `
          <div class="message ${msg.type}-message">
            <div class="message-header">
              <strong>${msg.sender}</strong>
              <span class="message-time">${msg.time}</span>
            </div>
            <p>${msg.content}</p>
          </div>
        `).join('');
        
        openModal('ticketConversationModal');
      }
    }

    function getTicketData(ticketId) {
      // Mock ticket data
      const tickets = {
        'T001': {
          id: 'T001',
          subject: 'Booking System Issue',
          status: 'Open',
          priority: 'High',
          messages: [
            {
              type: 'user',
              sender: 'Dr. Smith',
              time: '2024-01-20 09:30 AM',
              content: 'I am unable to book appointments for my patients. The system shows an error when I try to select a time slot.'
            },
            {
              type: 'support',
              sender: 'Support Team',
              time: '2024-01-20 10:15 AM',
              content: 'Thank you for reporting this issue. We are investigating the booking system problem and will update you shortly.'
            }
          ]
        },
        'T002': {
          id: 'T002',
          subject: 'Report Generation Delay',
          status: 'In Progress',
          priority: 'Medium',
          messages: [
            {
              type: 'user',
              sender: 'Lab Manager',
              time: '2024-01-19 02:30 PM',
              content: 'The monthly reports are taking too long to generate. Can this be optimized?'
            },
            {
              type: 'support',
              sender: 'Support Team',
              time: '2024-01-19 03:45 PM',
              content: 'We are working on optimizing the report generation process. Expected completion by end of week.'
            }
          ]
        }
      };
      return tickets[ticketId];
    }

    function updateTicketStatus(ticketId, newStatus) {
      const statusCell = document.querySelector(`#supportTicketsTable tbody tr td:first-child`);
      // Find the row with matching ticket ID and update status
      const rows = document.querySelectorAll('#supportTicketsTable tbody tr');
      rows.forEach(row => {
        if (row.cells[0].textContent === ticketId) {
          row.cells[2].innerHTML = `<span class="badge ${newStatus.toLowerCase()}">${newStatus}</span>`;
        }
      });
      
      closeModal('ticketConversationModal');
      showSuccessBanner(`Ticket ${ticketId} status updated to ${newStatus}!`);
    }

    function addTicketReply() {
      const replyText = document.getElementById('adminTicketReply').value.trim();
      if (replyText) {
        const messagesContainer = document.getElementById('ticketMessages');
        const newMessage = document.createElement('div');
        newMessage.className = 'message support-message';
        newMessage.innerHTML = `
          <div class="message-header">
            <strong>Admin</strong>
            <span class="message-time">${new Date().toLocaleDateString()} - ${new Date().toLocaleTimeString()}</span>
          </div>
          <p>${replyText}</p>
        `;
        messagesContainer.appendChild(newMessage);
        messagesContainer.scrollTop = messagesContainer.scrollHeight;
        
        document.getElementById('adminTicketReply').value = '';
        showSuccessBanner('Reply sent successfully!');
      }
    }

    function createNewTicket() {
      const form = document.getElementById('newTicketForm');
      if (form.checkValidity()) {
        const formData = new FormData(form);
        const ticketData = {
          id: 'T' + String(Date.now()).slice(-3),
          subject: formData.get('newTicketSubject'),
          category: formData.get('newTicketCategory'),
          priority: formData.get('newTicketPriority'),
          description: formData.get('newTicketDescription'),
          status: 'Open'
        };
        
        addTicketToTable(ticketData);
        closeModal('newTicketModal');
        form.reset();
        showSuccessBanner('Support ticket created successfully!');
      }
    }

    function addTicketToTable(ticketData) {
      const tbody = document.querySelector('.tickets-table tbody');
      if (tbody) {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${ticketData.id}</td>
          <td>${ticketData.subject}</td>
          <td>${ticketData.category}</td>
          <td><span class="status-badge ${ticketData.status.toLowerCase()}">${ticketData.status}</span></td>
          <td>${new Date().toLocaleDateString()}</td>
          <td>
            <button class="btn-icon" onclick="event.stopPropagation(); viewAdminTicket('${ticketData.id}')" title="View Ticket">üëÅ</button>
            <button class="btn-icon" onclick="event.stopPropagation(); closeTicket('${ticketData.id}')" title="Close Ticket">‚úÖ</button>
          </td>
        `;
        tbody.appendChild(row);
      }
    }

    // Additional Admin Functions
    function cancelBookingFromDetails() {
      if (confirm('Are you sure you want to cancel this booking?')) {
        closeModal('bookingDetailsModal');
        showSuccessBanner('Booking cancelled successfully!');
      }
    }

    // Admin Support Ticket Functions
    function viewAdminTicket(ticketId) {
      // This is the same as viewTicket but for admin interface
      viewTicket(ticketId);
    }

    function closeTicket(ticketId) {
      if (confirm(`Are you sure you want to close ticket ${ticketId}?`)) {
        const rows = document.querySelectorAll('.tickets-table tbody tr');
        rows.forEach(row => {
          if (row.cells[0].textContent === ticketId) {
            row.cells[3].innerHTML = '<span class="status-badge completed">Closed</span>';
          }
        });
        showSuccessBanner(`Ticket ${ticketId} closed successfully!`);
      }
    }

    function filterTickets() {
      const statusFilter = document.getElementById('ticketStatusFilter').value;
      const categoryFilter = document.getElementById('ticketCategoryFilter').value;
      const rows = document.querySelectorAll('.tickets-table tbody tr');
      
      rows.forEach(row => {
        const status = row.cells[3].textContent.toLowerCase();
        const category = row.cells[2].textContent.toLowerCase();
        
        const statusMatch = statusFilter === 'all' || status.includes(statusFilter);
        const categoryMatch = categoryFilter === 'all' || category.includes(categoryFilter);
        
        row.style.display = (statusMatch && categoryMatch) ? '' : 'none';
      });
    }

    // Admin Booking Functions
    function cancelAdminBooking(bookingId) {
      if (confirm(`Are you sure you want to cancel booking ${bookingId}?`)) {
        const rows = document.querySelectorAll('.bookings-table tbody tr');
        rows.forEach(row => {
          if (row.cells[0].textContent === bookingId) {
            row.cells[5].innerHTML = '<span class="status-badge cancelled">Cancelled</span>';
            // Disable cancel button
            const cancelBtn = row.querySelector('button[title="Cancel Booking"]');
            if (cancelBtn) {
              cancelBtn.disabled = true;
              cancelBtn.classList.add('disabled');
              cancelBtn.title = 'Already cancelled';
            }
          }
        });
        showSuccessBanner(`Booking ${bookingId} cancelled successfully!`);
      }
    }

    // Report Generation Functions
    function openReportModal(reportType) {
      generateReport(reportType);
    }

    function exportAllReports() {
      showSuccessBanner('All reports exported successfully!');
    }

    // Schedule and Capacity Functions  
    function saveScheduleChanges() {
      showSuccessBanner('Schedule settings saved successfully!');
    }

    // Enhanced Modal Functions
    function openModal(modalId) {
      const backdrop = document.getElementById('modalBackdrop');
      const modal = document.getElementById(modalId);
      
      if (backdrop && modal) {
        backdrop.style.display = 'block';
        modal.style.display = 'block';
        
        // Ensure modal is centered and within viewport
        modal.style.top = '50%';
        modal.style.left = '50%';
        modal.style.transform = 'translate(-50%, -50%)';
        
        // Add backdrop click to close
        backdrop.onclick = function(e) {
          if (e.target === backdrop) {
            closeModal(modalId);
          }
        };
        
        // Add escape key to close
        document.addEventListener('keydown', function escapeHandler(e) {
          if (e.key === 'Escape') {
            closeModal(modalId);
            document.removeEventListener('keydown', escapeHandler);
          }
        });
      }
    }

    function closeModal(modalId) {
      const backdrop = document.getElementById('modalBackdrop');
      const modal = document.getElementById(modalId);
      
      if (backdrop) {
        backdrop.style.display = 'none';
        backdrop.onclick = null;
      }
      
      if (modal) {
        modal.style.display = 'none';
      }
    }

    // Chart initialization for reports (mock implementation)
    function initializeCharts() {
      // This would typically initialize actual charts using a library like Chart.js
      // For now, we'll just ensure the placeholders are visible
      console.log('Charts initialized');
    }

    // Call chart initialization when reports tab is shown
    function showReportsTab() {
      showAdminTab('reportsTab');
      setTimeout(initializeCharts, 100);
    }

    // Success Banner Function
    function showSuccessBanner(message) {
      // Remove existing banner if any
      const existingBanner = document.querySelector('.success-banner');
      if (existingBanner) {
        existingBanner.remove();
      }
      
      // Create new banner
      const banner = document.createElement('div');
      banner.className = 'success-banner';
      banner.textContent = message;
      document.body.appendChild(banner);
      
      // Show banner
      setTimeout(() => banner.classList.add('show'), 100);
      
      // Hide banner after 3 seconds
      setTimeout(() => {
        banner.classList.remove('show');
        setTimeout(() => banner.remove(), 300);
      }, 3000);
    }

    // Registration Functions
    function showRegister(role) {
      // Hide all screens
      document.querySelectorAll('.screen').forEach(screen => {
        screen.classList.remove('active');
      });
      
      // Show appropriate registration screen
      if (role === 'patient') {
        document.getElementById('patientRegister').classList.add('active');
      } else if (role === 'doctor') {
        document.getElementById('doctorRegister').classList.add('active');
      } else if (role === 'lab') {
        document.getElementById('labRegister').classList.add('active');
      }
    }

    function showLogin() {
      // Hide all screens
      document.querySelectorAll('.screen').forEach(screen => {
        screen.classList.remove('active');
      });
      
      // Show login screen
      document.getElementById('login').classList.add('active');
    }

    function showTerms() {
      alert('Terms & Conditions:\n\n1. By registering, you agree to use this platform responsibly.\n2. Patient data will be handled securely and confidentially.\n3. All medical information is subject to privacy regulations.\n4. Lab results and medical advice should be confirmed with healthcare providers.\n5. This platform is for educational and booking purposes.\n\nFull terms available on our website.');
    }

    // Password Strength Validation
    function checkPasswordStrength(role) {
      const password = document.getElementById(role + 'Password').value;
      const strengthDiv = document.getElementById(role + 'PasswordStrength');
      
      if (!password) {
        strengthDiv.innerHTML = '';
        return;
      }
      
      let strength = 0;
      let feedback = [];
      
      // Length check
      if (password.length >= 8) strength += 1;
      else feedback.push('at least 8 characters');
      
      // Uppercase check
      if (/[A-Z]/.test(password)) strength += 1;
      else feedback.push('uppercase letter');
      
      // Lowercase check
      if (/[a-z]/.test(password)) strength += 1;
      else feedback.push('lowercase letter');
      
      // Number check
      if (/\d/.test(password)) strength += 1;
      else feedback.push('number');
      
      // Special character check
      if (/[!@#$%^&*(),.?":{}|<>]/.test(password)) strength += 1;
      else feedback.push('special character');
      
      let strengthText = '';
      let strengthClass = '';
      
      if (strength <= 2) {
        strengthText = 'Weak - Need: ' + feedback.slice(0, 2).join(', ');
        strengthClass = 'strength-weak';
      } else if (strength <= 4) {
        strengthText = 'Medium - Consider adding: ' + feedback.slice(0, 1).join(', ');
        strengthClass = 'strength-medium';
      } else {
        strengthText = 'Strong - Great password!';
        strengthClass = 'strength-strong';
      }
      
      strengthDiv.innerHTML = `<span class="${strengthClass}">${strengthText}</span>`;
    }

    // Password Match Validation
    function checkPasswordMatch(role) {
      const password = document.getElementById(role + 'Password').value;
      const confirmPassword = document.getElementById(role + 'ConfirmPassword').value;
      const errorSpan = document.getElementById(role + 'ConfirmPasswordError');
      const confirmField = document.getElementById(role + 'ConfirmPassword');
      
      if (!confirmPassword) {
        errorSpan.textContent = '';
        confirmField.classList.remove('error');
        return;
      }
      
      if (password !== confirmPassword) {
        errorSpan.textContent = 'Passwords do not match';
        confirmField.classList.add('error');
      } else {
        errorSpan.textContent = '';
        confirmField.classList.remove('error');
      }
    }

    // Email Validation
    function validateEmail(email) {
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      return emailRegex.test(email);
    }

    // Phone Validation
    function validatePhone(phone) {
      const phoneRegex = /^\+91[0-9]{10}$/;
      return phoneRegex.test(phone);
    }

    // Clear Field Errors
    function clearFieldErrors(role) {
      const form = document.getElementById(role + 'RegisterForm');
      const errorElements = form.querySelectorAll('.field-error');
      const inputElements = form.querySelectorAll('input, select, textarea');
      
      errorElements.forEach(error => error.textContent = '');
      inputElements.forEach(input => input.classList.remove('error'));
    }

    // Set Field Error
    function setFieldError(fieldId, message) {
      const field = document.getElementById(fieldId);
      const errorSpan = document.getElementById(fieldId + 'Error');
      
      if (field) field.classList.add('error');
      if (errorSpan) errorSpan.textContent = message;
    }

    // Patient Registration
    function registerPatient() {
      clearFieldErrors('patient');
      
      const form = document.getElementById('patientRegisterForm');
      const formData = new FormData(form);
      let isValid = true;
      
      // Validate required fields
      const requiredFields = [
        'fullName', 'email', 'mobile', 'dob', 'password', 
        'confirmPassword', 'address', 'city', 'pincode', 'state'
      ];
      
      requiredFields.forEach(field => {
        const value = formData.get(field);
        if (!value || value.trim() === '') {
          setFieldError('patient' + field.charAt(0).toUpperCase() + field.slice(1), 'This field is required');
          isValid = false;
        }
      });
      
      // Validate gender
      if (!formData.get('gender')) {
        setFieldError('patientGender', 'Please select gender');
        isValid = false;
      }
      
      // Validate email format
      const email = formData.get('email');
      if (email && !validateEmail(email)) {
        setFieldError('patientEmail', 'Please enter a valid email address');
        isValid = false;
      }
      
      // Validate phone format
      const mobile = formData.get('mobile');
      if (mobile && !validatePhone(mobile)) {
        setFieldError('patientMobile', 'Please enter phone in format: +91XXXXXXXXXX');
        isValid = false;
      }
      
      // Validate pincode
      const pincode = formData.get('pincode');
      if (pincode && !/^[0-9]{6}$/.test(pincode)) {
        setFieldError('patientPincode', 'Please enter a valid 6-digit pincode');
        isValid = false;
      }
      
      // Validate password strength
      const password = formData.get('password');
      if (password && password.length < 8) {
        setFieldError('patientPassword', 'Password must be at least 8 characters long');
        isValid = false;
      }
      
      // Validate password match
      const confirmPassword = formData.get('confirmPassword');
      if (password !== confirmPassword) {
        setFieldError('patientConfirmPassword', 'Passwords do not match');
        isValid = false;
      }
      
      // Validate terms acceptance
      if (!formData.get('terms')) {
        setFieldError('patientTerms', 'You must agree to the Terms & Conditions');
        isValid = false;
      }
      
      // Age validation (must be 18+)
      const dob = new Date(formData.get('dob'));
      const today = new Date();
      const age = today.getFullYear() - dob.getFullYear();
      if (age < 18) {
        setFieldError('patientDob', 'You must be at least 18 years old to register');
        isValid = false;
      }
      
      if (isValid) {
        // Show success message
        showRegistrationSuccess('patient', formData.get('fullName'), formData.get('email'));
      }
      
      return false; // Prevent form submission
    }

    // Doctor Registration
    function registerDoctor() {
      clearFieldErrors('doctor');
      
      const form = document.getElementById('doctorRegisterForm');
      const formData = new FormData(form);
      let isValid = true;
      
      // Validate required fields
      const requiredFields = [
        'fullName', 'email', 'mobile', 'license', 'specialization', 
        'experience', 'clinicName', 'clinicAddress', 'city', 'pincode', 
        'state', 'password', 'confirmPassword'
      ];
      
      requiredFields.forEach(field => {
        const value = formData.get(field);
        if (!value || value.trim() === '') {
          setFieldError('doctor' + field.charAt(0).toUpperCase() + field.slice(1), 'This field is required');
          isValid = false;
        }
      });
      
      // Validate email format
      const email = formData.get('email');
      if (email && !validateEmail(email)) {
        setFieldError('doctorEmail', 'Please enter a valid email address');
        isValid = false;
      }
      
      // Validate phone format
      const mobile = formData.get('mobile');
      if (mobile && !validatePhone(mobile)) {
        setFieldError('doctorMobile', 'Please enter phone in format: +91XXXXXXXXXX');
        isValid = false;
      }
      
      // Validate pincode
      const pincode = formData.get('pincode');
      if (pincode && !/^[0-9]{6}$/.test(pincode)) {
        setFieldError('doctorPincode', 'Please enter a valid 6-digit pincode');
        isValid = false;
      }
      
      // Validate experience
      const experience = parseInt(formData.get('experience'));
      if (experience !== undefined && (experience < 0 || experience > 50)) {
        setFieldError('doctorExperience', 'Experience must be between 0 and 50 years');
        isValid = false;
      }
      
      // Validate password strength
      const password = formData.get('password');
      if (password && password.length < 8) {
        setFieldError('doctorPassword', 'Password must be at least 8 characters long');
        isValid = false;
      }
      
      // Validate password match
      const confirmPassword = formData.get('confirmPassword');
      if (password !== confirmPassword) {
        setFieldError('doctorConfirmPassword', 'Passwords do not match');
        isValid = false;
      }
      
      // Validate terms acceptance
      if (!formData.get('terms')) {
        setFieldError('doctorTerms', 'You must agree to the Terms & Conditions');
        isValid = false;
      }
      
      // Validate license number format (basic validation)
      const license = formData.get('license');
      if (license && license.length < 5) {
        setFieldError('doctorLicense', 'Please enter a valid medical license number');
        isValid = false;
      }
      
      if (isValid) {
        // Show success message
        showRegistrationSuccess('doctor', formData.get('fullName'), formData.get('email'));
      }
      
      return false; // Prevent form submission
    }

    // Lab Registration
    function registerLab() {
      clearFieldErrors('lab');
      
      const form = document.getElementById('labRegisterForm');
      const formData = new FormData(form);
      let isValid = true;
      
      // Validate required fields
      const requiredFields = [
        'labName', 'email', 'contactNumber', 'labLicense', 'labAddress', 
        'city', 'pincode', 'state', 'contactPerson', 'contactRole', 
        'password', 'confirmPassword'
      ];
      
      requiredFields.forEach(field => {
        const value = formData.get(field);
        if (!value || value.trim() === '') {
          let fieldId = field;
          if (field === 'contactNumber') fieldId = 'labContact';
          else if (field === 'labAddress') fieldId = 'labAddress';
          else if (field === 'contactPerson') fieldId = 'labContactPerson';
          else if (field === 'contactRole') fieldId = 'labContactRole';
          else if (!field.startsWith('lab')) fieldId = 'lab' + field.charAt(0).toUpperCase() + field.slice(1);
          
          setFieldError(fieldId, 'This field is required');
          isValid = false;
        }
      });
      
      // Validate lab type selection
      if (!formData.get('labType')) {
        setFieldError('labType', 'Please select a lab type');
        isValid = false;
      }
      
      // Validate email format
      const email = formData.get('email');
      if (email && !validateEmail(email)) {
        setFieldError('labEmail', 'Please enter a valid email address');
        isValid = false;
      }
      
      // Validate phone format
      const contactNumber = formData.get('contactNumber');
      if (contactNumber && !validatePhone(contactNumber)) {
        setFieldError('labContact', 'Please enter phone in format: +91XXXXXXXXXX');
        isValid = false;
      }
      
      // Validate pincode
      const pincode = formData.get('pincode');
      if (pincode && !/^[0-9]{6}$/.test(pincode)) {
        setFieldError('labPincode', 'Please enter a valid 6-digit pincode');
        isValid = false;
      }
      
      // Validate password strength
      const password = formData.get('password');
      if (password && password.length < 8) {
        setFieldError('labPassword', 'Password must be at least 8 characters long');
        isValid = false;
      }
      
      // Validate password match
      const confirmPassword = formData.get('confirmPassword');
      if (password !== confirmPassword) {
        setFieldError('labConfirmPassword', 'Passwords do not match');
        isValid = false;
      }
      
      // Validate terms acceptance
      if (!formData.get('terms')) {
        setFieldError('labTerms', 'You must agree to the Terms & Conditions');
        isValid = false;
      }
      
      // Validate license number format (basic validation)
      const labLicense = formData.get('labLicense');
      if (labLicense && labLicense.length < 5) {
        setFieldError('labLicense', 'Please enter a valid lab license number');
        isValid = false;
      }
      
      if (isValid) {
        // Show success message
        showRegistrationSuccess('lab', formData.get('labName'), formData.get('email'));
      }
      
      return false; // Prevent form submission
    }

    // Show Registration Success
    function showRegistrationSuccess(role, name, email) {
      // Hide the registration form
      const screens = ['patientRegister', 'doctorRegister', 'labRegister'];
      screens.forEach(screen => {
        document.getElementById(screen).classList.remove('active');
      });
      
      // Create and show success screen
      const successDiv = document.createElement('div');
      successDiv.className = 'screen active';
      successDiv.innerHTML = `
        <div class="card" style="max-width:500px;margin:40px auto;">
          <div class="registration-confirmation">
            <div class="confirmation-icon">‚úÖ</div>
            <h2 class="confirmation-title">Registration Successful!</h2>
            <p class="confirmation-message">
              Thank you, <strong>${name}</strong>!<br>
              Your ${role} account has been created successfully.<br><br>
              A confirmation email has been sent to <strong>${email}</strong>.<br>
              Please check your email and verify your account.
            </p>
            <div style="display:flex;gap:12px;justify-content:center;flex-wrap:wrap;">
              <button class="btn" onclick="showLogin()">Login Now</button>
              <button class="btn-secondary" onclick="location.reload()">Home</button>
            </div>
          </div>
        </div>
      `;
      
      document.body.appendChild(successDiv);
      
      // Remove the success screen after showing login
      setTimeout(() => {
        if (successDiv.parentNode) {
          successDiv.parentNode.removeChild(successDiv);
        }
      }, 10000); // Remove after 10 seconds
    }

    // Handle URL-based navigation for registration
    function handleRegistrationNavigation() {
      const urlParams = new URLSearchParams(window.location.search);
      const role = urlParams.get('role');
      
      if (role && ['patient', 'doctor', 'lab'].includes(role)) {
        showRegister(role);
      }
    }

    // Doctor Onboarding Functions
    function showDoctorOnboarding(doctorName) {
      // Hide all screens
      document.querySelectorAll('.screen').forEach(screen => {
        screen.classList.remove('active');
      });
      
      // Set doctor name
      document.getElementById('doctorOnboardingName').textContent = doctorName || 'Doctor';
      
      // Show onboarding screen
      document.getElementById('doctorOnboarding').classList.add('active');
      
      // Reset to welcome step
      document.querySelectorAll('#doctorOnboarding .onboarding-step').forEach(step => {
        step.classList.remove('active');
      });
      document.getElementById('doctorOnboardingWelcome').classList.add('active');
    }

    function startDoctorOnboarding() {
      document.getElementById('doctorOnboardingWelcome').classList.remove('active');
      document.getElementById('doctorOnboardingStep1').classList.add('active');
    }

    function nextDoctorStep(stepNumber) {
      // Validate current step
      const currentStep = document.querySelector('#doctorOnboarding .onboarding-step.active');
      const currentForm = currentStep.querySelector('form');
      
      if (currentForm && !validateOnboardingForm(currentForm)) {
        return; // Don't proceed if validation fails
      }
      
      // Hide current step
      currentStep.classList.remove('active');
      
      // Show next step
      document.getElementById('doctorOnboardingStep' + stepNumber).classList.add('active');
    }

    function previousDoctorStep(stepNumber) {
      // Hide current step
      document.querySelector('#doctorOnboarding .onboarding-step.active').classList.remove('active');
      
      // Show previous step
      document.getElementById('doctorOnboardingStep' + stepNumber).classList.add('active');
    }

    function toggleLabSearch(show) {
      const labSearchSection = document.getElementById('labSearchSection');
      if (show) {
        labSearchSection.style.display = 'block';
      } else {
        labSearchSection.style.display = 'none';
      }
    }

    function skipDoctorOnboarding() {
      completeDoctorOnboarding();
    }

    function completeDoctorOnboarding() {
      // Collect all onboarding data
      const onboardingData = {
        step1: new FormData(document.getElementById('doctorOnboardingForm1')),
        step2: new FormData(document.getElementById('doctorOnboardingForm2')),
        step3: new FormData(document.getElementById('doctorOnboardingForm3'))
      };
      
      // Here you would typically send the data to your backend
      console.log('Doctor onboarding data:', onboardingData);
      
      // Show completion screen
      showOnboardingComplete();
    }

    // Lab Onboarding Functions
    function showLabOnboarding(labName) {
      // Hide all screens
      document.querySelectorAll('.screen').forEach(screen => {
        screen.classList.remove('active');
      });
      
      // Set lab name
      document.getElementById('labOnboardingName').textContent = labName || 'Lab';
      
      // Show onboarding screen
      document.getElementById('labOnboarding').classList.add('active');
      
      // Reset to welcome step
      document.querySelectorAll('#labOnboarding .onboarding-step').forEach(step => {
        step.classList.remove('active');
      });
      document.getElementById('labOnboardingWelcome').classList.add('active');
    }

    function startLabOnboarding() {
      document.getElementById('labOnboardingWelcome').classList.remove('active');
      document.getElementById('labOnboardingStep1').classList.add('active');
    }

    function nextLabStep(stepNumber) {
      // Validate current step
      const currentStep = document.querySelector('#labOnboarding .onboarding-step.active');
      const currentForm = currentStep.querySelector('form');
      
      if (currentForm && !validateOnboardingForm(currentForm)) {
        return; // Don't proceed if validation fails
      }
      
      // Hide current step
      currentStep.classList.remove('active');
      
      // Show next step
      document.getElementById('labOnboardingStep' + stepNumber).classList.add('active');
    }

    function previousLabStep(stepNumber) {
      // Hide current step
      document.querySelector('#labOnboarding .onboarding-step.active').classList.remove('active');
      
      // Show previous step
      document.getElementById('labOnboardingStep' + stepNumber).classList.add('active');
    }

    function addServiceRow(listId) {
      const servicesList = document.getElementById(listId);
      const newRow = document.createElement('div');
      newRow.className = 'service-row';
      
      if (listId === 'patientServicesList') {
        newRow.innerHTML = `
          <input type="text" placeholder="Service Name" name="patientServiceName[]" style="flex:2;" />
          <input type="number" placeholder="Price (‚Çπ)" name="patientServicePrice[]" style="flex:1;" />
          <input type="number" placeholder="TAT (hrs)" name="patientServiceTAT[]" style="flex:1;" />
          <button type="button" class="btn-icon remove-service" onclick="removeServiceRow(this)">üóë</button>
        `;
      } else {
        newRow.innerHTML = `
          <input type="text" placeholder="Service Name" name="doctorServiceName[]" style="flex:2;" />
          <input type="number" placeholder="Price (‚Çπ)" name="doctorServicePrice[]" style="flex:1;" />
          <input type="number" placeholder="TAT (hrs)" name="doctorServiceTAT[]" style="flex:1;" />
          <button type="button" class="btn-icon remove-service" onclick="removeServiceRow(this)">üóë</button>
        `;
      }
      
      servicesList.appendChild(newRow);
    }

    function removeServiceRow(button) {
      const serviceRow = button.parentElement;
      const servicesList = serviceRow.parentElement;
      
      // Don't allow removing the last row
      if (servicesList.children.length > 1) {
        serviceRow.remove();
      } else {
        alert('At least one service is required.');
      }
    }

    function completeLabOnboarding() {
      // Collect all onboarding data
      const onboardingData = {
        step1: new FormData(document.getElementById('labOnboardingForm1')),
        step2: new FormData(document.getElementById('labOnboardingForm2')),
        step3: new FormData(document.getElementById('labOnboardingForm3')),
        step4: new FormData(document.getElementById('labOnboardingForm4'))
      };
      
      // Here you would typically send the data to your backend
      console.log('Lab onboarding data:', onboardingData);
      
      // Show completion screen
      showOnboardingComplete();
    }

    // Common Onboarding Functions
    function validateOnboardingForm(form) {
      const requiredFields = form.querySelectorAll('[required]');
      let isValid = true;
      
      requiredFields.forEach(field => {
        if (!field.value.trim()) {
          field.style.borderColor = '#dc3545';
          isValid = false;
        } else {
          field.style.borderColor = '#e1e5e9';
        }
      });
      
      // Check for radio button groups
      const radioGroups = {};
      form.querySelectorAll('input[type="radio"][required]').forEach(radio => {
        if (!radioGroups[radio.name]) {
          radioGroups[radio.name] = [];
        }
        radioGroups[radio.name].push(radio);
      });
      
      Object.keys(radioGroups).forEach(groupName => {
        const hasChecked = radioGroups[groupName].some(radio => radio.checked);
        if (!hasChecked) {
          radioGroups[groupName].forEach(radio => {
            const parent = radio.closest('.form-group');
            if (parent) {
              parent.style.borderColor = '#dc3545';
            }
          });
          isValid = false;
        }
      });
      
      if (!isValid) {
        alert('Please fill in all required fields.');
      }
      
      return isValid;
    }

    function showOnboardingComplete() {
      // Hide all screens
      document.querySelectorAll('.screen').forEach(screen => {
        screen.classList.remove('active');
      });
      
      // Show completion screen
      document.getElementById('onboardingComplete').classList.add('active');
    }

    function goToDashboard() {
      // This would typically determine which dashboard to show based on user role
      // For now, let's show the login screen
      showLogin();
    }

    // Update the registration success function to trigger onboarding
    function showRegistrationSuccess(role, name, email) {
      // Hide the registration form
      const screens = ['patientRegister', 'doctorRegister', 'labRegister'];
      screens.forEach(screen => {
        document.getElementById(screen).classList.remove('active');
      });
      
      // For patients, show success message and go to login
      if (role === 'patient') {
        // Create and show success screen
        const successDiv = document.createElement('div');
        successDiv.className = 'screen active';
        successDiv.innerHTML = `
          <div class="card" style="max-width:500px;margin:40px auto;">
            <div class="registration-confirmation">
              <div class="confirmation-icon">‚úÖ</div>
              <h2 class="confirmation-title">Registration Successful!</h2>
              <p class="confirmation-message">
                Thank you, <strong>${name}</strong>!<br>
                Your ${role} account has been created successfully.<br><br>
                A confirmation email has been sent to <strong>${email}</strong>.<br>
                Please check your email and verify your account.
              </p>
              <div style="display:flex;gap:12px;justify-content:center;flex-wrap:wrap;">
                <button class="btn" onclick="showLogin()">Login Now</button>
                <button class="btn-secondary" onclick="location.reload()">Home</button>
              </div>
            </div>
          </div>
        `;
        
        document.body.appendChild(successDiv);
        
        // Remove the success screen after showing login
        setTimeout(() => {
          if (successDiv.parentNode) {
            successDiv.parentNode.removeChild(successDiv);
          }
        }, 10000); // Remove after 10 seconds
      } else {
        // For doctors and labs, start onboarding
        if (role === 'doctor') {
          showDoctorOnboarding(name);
        } else if (role === 'lab') {
          showLabOnboarding(name);
        }
      }
    }

    // Admin Authentication Functions
    function showAdminRegister() {
      // Hide all screens
      document.querySelectorAll('.screen').forEach(screen => {
        screen.classList.remove('active');
      });
      
      // Show admin registration screen
      document.getElementById('adminRegister').classList.add('active');
    }

    function registerAdmin() {
      const form = document.getElementById('adminRegisterForm');
      const formData = new FormData(form);
      
      // Clear previous errors
      document.querySelectorAll('#adminRegisterForm .field-error').forEach(error => {
        error.textContent = '';
      });
      document.querySelectorAll('#adminRegisterForm input').forEach(input => {
        input.classList.remove('error');
      });
      
      let isValid = true;
      
      // Validate required fields
      const fullName = formData.get('fullName');
      const email = formData.get('email');
      const password = formData.get('password');
      
      if (!fullName || fullName.trim() === '') {
        setFieldError('adminFullName', 'Full name is required');
        isValid = false;
      }
      
      if (!email || !validateEmail(email)) {
        setFieldError('adminEmail', 'Please enter a valid email address');
        isValid = false;
      }
      
      if (!password || password.length < 8) {
        setFieldError('adminPassword', 'Password must be at least 8 characters long');
        isValid = false;
      }
      
      if (isValid) {
        // Store admin data (in a real app, this would be sent to the server)
        localStorage.setItem('adminData', JSON.stringify({
          fullName: fullName,
          email: email,
          password: password, // In real app, this would be hashed
          registrationDate: new Date().toISOString()
        }));
        
        // Show success alert
        alert('Admin registration successful! You can now login with your credentials.');
        
        // Redirect to login screen
        showAdminLogin();
        
        // Pre-fill login form
        document.getElementById('adminLoginEmail').value = email;
      }
      
      return false; // Prevent form submission
    }

    function loginAdmin() {
      const form = document.getElementById('adminLoginForm');
      const formData = new FormData(form);
      
      // Clear previous errors
      document.querySelectorAll('#adminLoginForm .field-error').forEach(error => {
        error.textContent = '';
      });
      document.querySelectorAll('#adminLoginForm input').forEach(input => {
        input.classList.remove('error');
      });
      
      const email = formData.get('email');
      const password = formData.get('password');
      let isValid = true;
      
      if (!email) {
        setFieldError('adminLoginEmail', 'Email is required');
        isValid = false;
      }
      
      if (!password) {
        setFieldError('adminLoginPassword', 'Password is required');
        isValid = false;
      }
      
      if (isValid) {
        // Check credentials (in a real app, this would be verified by the server)
        const adminData = JSON.parse(localStorage.getItem('adminData') || '{}');
        
        if (adminData.email === email && adminData.password === password) {
          // Store login session
          localStorage.setItem('adminSession', JSON.stringify({
            email: email,
            name: adminData.fullName,
            loginTime: new Date().toISOString()
          }));
          
          // Show admin dashboard
          showAdminDashboard();
        } else {
          // Default credentials for demo
          if (email === 'admin@embrion.com' && password === 'admin123') {
            localStorage.setItem('adminSession', JSON.stringify({
              email: email,
              name: 'Platform Admin',
              loginTime: new Date().toISOString()
            }));
            showAdminDashboard();
          } else {
            alert('Invalid credentials. Try admin@embrion.com / admin123 for demo.');
          }
        }
      }
      
      return false; // Prevent form submission
    }

    function showAdminDashboard() {
      console.log('showAdminDashboard called');
      
      // Clean up any unwanted content
      cleanupFooterPollution();
      
      // Hide all screens
      document.querySelectorAll('.screen').forEach(screen => {
        screen.classList.remove('active');
      });
      
      // Show PLATFORM admin dashboard (the main one with full functionality)
      const adminDashElement = document.getElementById('adminDashboard');
      console.log('Platform Admin dashboard element found:', !!adminDashElement);
      
      if (adminDashElement) {
        adminDashElement.classList.add('active');
        console.log('Platform Admin dashboard shown successfully');
      } else {
        console.error('Platform Admin dashboard element not found!');
        alert('Platform Admin dashboard not found. Please refresh the page.');
        return;
      }
      
      // Hide both footer menus (admin dashboard shouldn't show footer)
      document.getElementById('footerNav').style.display = 'none';
      document.getElementById('doctorFooterNav').style.display = 'none';
      
      // Show logout button for admin
      document.getElementById('logoutBtn').style.display = 'block';
      
      // Update admin name in navigation
      const adminSession = JSON.parse(localStorage.getItem('adminSession') || '{}');
      if (adminSession.name) {
        document.getElementById('adminUserName').textContent = adminSession.name;
      }
      
      // Update dashboard stats (in a real app, this would come from the server)
      console.log('Updating dashboard stats...');
      try {
        updateDashboardStats();
        console.log('Dashboard stats updated successfully');
      } catch (e) {
        console.error('Error updating dashboard stats:', e);
      }
      
      // Initialize user management
      console.log('Initializing user management...');
      try {
        initializeUserManagement();
        console.log('User management initialized successfully');
      } catch (e) {
        console.error('Error initializing user management:', e);
      }
      
      console.log('Admin dashboard setup completed');
    }

    function logoutAdmin() {
      // Use the unified logout function
      logout();
    }

    // Dashboard Functions
    function updateDashboardStats() {
      // In a real app, these would be fetched from the server
      // For demo purposes, we'll use static data with some randomization
      const stats = {
        patients: 120 + Math.floor(Math.random() * 20),
        doctors: 45 + Math.floor(Math.random() * 10),
        labs: 12 + Math.floor(Math.random() * 5),
        pendingLabApprovals: 3,
        pendingDoctorApprovals: 2,
        openTickets: 5
      };
      
      // Update overview stats (only if elements exist)
      const statItems = document.querySelectorAll('.stat-item');
      if (statItems.length >= 3) {
        const statNumbers = document.querySelectorAll('.stat-number');
        if (statNumbers.length >= 3) {
          statNumbers[0].textContent = stats.patients;
          statNumbers[1].textContent = stats.doctors;
          statNumbers[2].textContent = stats.labs;
        }
      }
      
      // Update approval counts (only if elements exist)
      const approvalItems = document.querySelectorAll('.approval-item');
      if (approvalItems.length >= 2) {
        const approvalCounts = document.querySelectorAll('.approval-count');
        if (approvalCounts.length >= 2) {
          approvalCounts[0].textContent = stats.pendingLabApprovals;
          approvalCounts[1].textContent = stats.pendingDoctorApprovals;
        }
      }
      
      // Update ticket count (only if elements exist)
      const ticketItem = document.querySelector('.ticket-item');
      if (ticketItem) {
        const ticketCount = ticketItem.querySelector('.ticket-count');
        if (ticketCount) {
          ticketCount.textContent = stats.openTickets;
        }
      }
      
      console.log('Dashboard stats updated (or skipped if elements not found)');
    }

    function showApprovalManagement() {
      // Hide all screens
      document.querySelectorAll('.screen').forEach(screen => {
        screen.classList.remove('active');
      });
      
      // Show approval management screen
      document.getElementById('approvalManagement').classList.add('active');
      
      // Hide both footer menus (admin screens shouldn't show footer)
      document.getElementById('footerNav').style.display = 'none';
      document.getElementById('doctorFooterNav').style.display = 'none';
    }

    function showSupportManagement() {
      // For now, we'll reuse the existing admin support functionality
      // Hide all screens
      document.querySelectorAll('.screen').forEach(screen => {
        screen.classList.remove('active');
      });
      
      // Show the admin dashboard but focus on support
      document.getElementById('adminDash').classList.add('active');
      showAdminTab('supportTab');
    }

    function manageUsers(userType) {
      // Hide all screens
      document.querySelectorAll('.screen').forEach(screen => {
        screen.classList.remove('active');
      });
      
      // Show user management screen
      document.getElementById('userManagement').classList.add('active');
      
      // Hide both footer menus (admin screens shouldn't show footer)
      document.getElementById('footerNav').style.display = 'none';
      document.getElementById('doctorFooterNav').style.display = 'none';
      
      // Update the screen title
      document.getElementById('userManagementType').textContent = 
        userType.charAt(0).toUpperCase() + userType.slice(1);
      
      // Load user data based on type using the correct function
      showUserTypeTab(userType);
    }

    // User Management Functions
    let currentUserType = 'patients';
    let currentUserData = {};
    let currentUserIndex = -1;
    
    // Sample user data
    const sampleUsers = {
      patients: [
        { name: 'Priya Shah', email: 'priya@example.com', mobile: '+91-98765-43210', status: 'active', joinedDate: '12-Jun-2025', role: 'Patient' },
        { name: 'Rahul Kumar', email: 'rahul@example.com', mobile: '+91-87654-32109', status: 'active', joinedDate: '10-Jun-2025', role: 'Patient' },
        { name: 'Anjali Patel', email: 'anjali@example.com', mobile: '+91-76543-21098', status: 'suspended', joinedDate: '08-Jun-2025', role: 'Patient' }
      ],
      doctors: [
        { name: 'Dr. Verma', email: 'verma@clinic.com', mobile: '+91-98765-43211', status: 'active', joinedDate: '15-May-2025', role: 'Doctor', specialization: 'Fertility Specialist', experience: '12 years', license: 'MED123456' },
        { name: 'Dr. Sharma', email: 'sharma@clinic.com', mobile: '+91-87654-32110', status: 'pending', joinedDate: '20-May-2025', role: 'Doctor', specialization: 'Embryologist', experience: '8 years', license: 'MED789012' }
      ],
      labs: [
        { name: 'IVF Labs 1', email: 'contact@ivflabs1.com', mobile: '+91-98765-43212', status: 'pending', joinedDate: '22-Jun-2025', role: 'IVF Lab', location: 'Mumbai, MH', license: 'LAB123456', services: 'Full Service' },
        { name: 'Advanced Fertility Center', email: 'info@afc.com', mobile: '+91-87654-32111', status: 'active', joinedDate: '18-Jun-2025', role: 'IVF Lab', location: 'Delhi, DL', license: 'LAB789012', services: 'Embryology Only' }
      ]
    };
    
    function showUserTypeTab(userType) {
      currentUserType = userType;
      
      // Update tab active state
      document.querySelectorAll('.user-type-tab').forEach(tab => {
        tab.classList.remove('active');
      });
      document.querySelector(`[data-user-type="${userType}"]`).classList.add('active');
      
      // Load user data for the selected type
      loadUserData(userType);
    }
    
    function loadUserData(userType) {
      const tableHeader = document.getElementById('userTableHeader');
      const tableBody = document.getElementById('userTableBody');
      
      // Check if elements exist before proceeding
      if (!tableHeader || !tableBody) {
        console.log('User table elements not found, skipping loadUserData');
        return;
      }
      
      // Clear existing content
      tableHeader.innerHTML = '';
      tableBody.innerHTML = '';
      
      // Get user data based on type
      const users = sampleUsers[userType] || [];
      
      // Define table structure based on user type
      let headers = [];
      
      if (userType === 'patients') {
        headers = ['Name', 'Email', 'Status', 'Actions'];
      } else if (userType === 'doctors') {
        headers = ['Name', 'Email', 'Status', 'Actions'];
      } else if (userType === 'labs') {
        headers = ['Name', 'Email', 'Status', 'Actions'];
      }
      
      // Create table header
      headers.forEach(header => {
        const th = document.createElement('th');
        th.textContent = header;
        tableHeader.appendChild(th);
      });
      
      // Create table rows
      users.forEach((user, index) => {
        const tr = document.createElement('tr');
        
        // Add basic cells
        const nameCell = document.createElement('td');
        nameCell.textContent = user.name;
        tr.appendChild(nameCell);
        
        const emailCell = document.createElement('td');
        emailCell.textContent = user.email;
        tr.appendChild(emailCell);
        
        // Add status cell with badge
        const statusCell = document.createElement('td');
        statusCell.innerHTML = `<span class="user-status ${user.status}">${user.status.charAt(0).toUpperCase() + user.status.slice(1)}</span>`;
        tr.appendChild(statusCell);
        
        // Add actions cell
        const actionsCell = document.createElement('td');
        let actionButtons = `
          <div class="user-actions">
            <button class="user-action-btn view" data-action="view" data-user-type="${userType}" data-user-index="${index}">View</button>
            <button class="user-action-btn edit" data-action="edit" data-user-type="${userType}" data-user-index="${index}">Edit</button>
        `;
        
        // Add different actions based on status and user type
        if (user.status === 'active') {
          actionButtons += `<button class="user-action-btn warning" data-action="suspend" data-user-type="${userType}" data-user-index="${index}">Suspend</button>`;
        } else if (user.status === 'suspended') {
          actionButtons += `<button class="user-action-btn primary" data-action="reactivate" data-user-type="${userType}" data-user-index="${index}">Reactivate</button>`;
        } else if (user.status === 'pending' && userType === 'labs') {
          actionButtons += `<button class="user-action-btn primary" data-action="approve" data-user-type="${userType}" data-user-index="${index}">Approve</button>`;
          actionButtons += `<button class="user-action-btn danger" data-action="reject" data-user-type="${userType}" data-user-index="${index}">Reject</button>`;
        }
        
        actionButtons += `<button class="user-action-btn delete" data-action="delete" data-user-type="${userType}" data-user-index="${index}">Delete</button>`;
        actionButtons += `</div>`;
        
        actionsCell.innerHTML = actionButtons;
        tr.appendChild(actionsCell);
        
        tableBody.appendChild(tr);
      });
    }

    function searchUsers() {
      const searchTerm = document.getElementById('userSearchInput').value.toLowerCase();
      const tableRows = document.querySelectorAll('#userTableBody tr');
      
      tableRows.forEach(row => {
        const text = row.textContent.toLowerCase();
        if (text.includes(searchTerm)) {
          row.style.display = '';
        } else {
          row.style.display = 'none';
        }
      });
    }

    function filterUsers() {
      const statusFilter = document.getElementById('userStatusFilter').value;
      const tableRows = document.querySelectorAll('#userTableBody tr');
      
      tableRows.forEach(row => {
        if (!statusFilter) {
          row.style.display = '';
        } else {
          const statusSpan = row.querySelector('.user-status');
          if (statusSpan && statusSpan.classList.contains(statusFilter)) {
            row.style.display = '';
          } else {
            row.style.display = 'none';
          }
        }
      });
    }

    function viewUser(userType, userIndex) {
      console.log('=== DEBUG: viewUser function called ===');
      console.log('viewUser called with:', userType, userIndex, 'type:', typeof userIndex);
      console.log('sampleUsers:', sampleUsers);
      console.log('Available user types:', Object.keys(sampleUsers));
      
      // Convert string index to number if needed
      const index = parseInt(userIndex);
      console.log('Parsed index:', index);
      
      const user = sampleUsers[userType] && sampleUsers[userType][index];
      console.log('Found user:', user);
      
      if (!user) {
        console.error('User not found:', userType, index, 'Available users:', sampleUsers[userType]);
        alert('User not found');
        return;
      }
      
      const content = document.getElementById('viewUserContent');
      console.log('viewUserContent element:', content);
      
      if (!content) {
        alert('viewUserContent element not found');
        return;
      }
      
      let userDetails = `
        <div class="user-detail-row">
          <span class="user-detail-label">Name:</span>
          <span class="user-detail-value">${user.name}</span>
        </div>
        <div class="user-detail-row">
          <span class="user-detail-label">Email:</span>
          <span class="user-detail-value">${user.email}</span>
        </div>
        <div class="user-detail-row">
          <span class="user-detail-label">Mobile:</span>
          <span class="user-detail-value">${user.mobile}</span>
        </div>
        <div class="user-detail-row">
          <span class="user-detail-label">Role:</span>
          <span class="user-detail-value">${user.role}</span>
        </div>
        <div class="user-detail-row">
          <span class="user-detail-label">Status:</span>
          <span class="user-detail-value"><span class="user-status ${user.status}">${user.status.charAt(0).toUpperCase() + user.status.slice(1)}</span></span>
        </div>
        <div class="user-detail-row">
          <span class="user-detail-label">Joined On:</span>
          <span class="user-detail-value">${user.joinedDate}</span>
        </div>
      `;
      
      // Add additional details based on user type
      if (userType === 'doctors') {
        userDetails += `
          <div class="user-detail-row">
            <span class="user-detail-label">Specialization:</span>
            <span class="user-detail-value">${user.specialization}</span>
          </div>
          <div class="user-detail-row">
            <span class="user-detail-label">Experience:</span>
            <span class="user-detail-value">${user.experience}</span>
          </div>
          <div class="user-detail-row">
            <span class="user-detail-label">License:</span>
            <span class="user-detail-value">${user.license}</span>
          </div>
        `;
      } else if (userType === 'labs') {
        userDetails += `
          <div class="user-detail-row">
            <span class="user-detail-label">Location:</span>
            <span class="user-detail-value">${user.location}</span>
          </div>
          <div class="user-detail-row">
            <span class="user-detail-label">License:</span>
            <span class="user-detail-value">${user.license}</span>
          </div>
          <div class="user-detail-row">
            <span class="user-detail-label">Services:</span>
            <span class="user-detail-value">${user.services}</span>
          </div>
        `;
      }
      
      content.innerHTML = userDetails;
      openUserModal('viewUserModal');
    }

    function editUser(userType, userIndex) {
      const index = parseInt(userIndex);
      const user = sampleUsers[userType][index];
      currentUserData = { userType, userIndex: index, ...user };
      
      // Populate edit form
      document.getElementById('editUserName').value = user.name;
      document.getElementById('editUserEmail').value = user.email;
      document.getElementById('editUserMobile').value = user.mobile;
      document.getElementById('editUserRole').value = userType === 'patients' ? 'patient' : userType === 'doctors' ? 'doctor' : 'lab';
      document.getElementById('editUserStatus').value = user.status;
      
      openUserModal('editUserModal');
    }

    function suspendUser(userType, userIndex) {
      const index = parseInt(userIndex);
      currentUserData = { userType, userIndex: index };
      document.getElementById('suspendUserMessage').textContent = 'Are you sure you want to suspend this user?';
      document.getElementById('suspendUserConfirm').textContent = 'Suspend';
      document.getElementById('suspendUserConfirm').className = 'user-modal-btn warning';
      openUserModal('suspendUserModal');
    }

    function reactivateUser(userType, userIndex) {
      const index = parseInt(userIndex);
      currentUserData = { userType, userIndex: index };
      document.getElementById('suspendUserMessage').textContent = 'Are you sure you want to reactivate this user?';
      document.getElementById('suspendUserConfirm').textContent = 'Reactivate';
      document.getElementById('suspendUserConfirm').className = 'user-modal-btn primary';
      openUserModal('suspendUserModal');
    }

    function deleteUser(userType, userIndex) {
      const index = parseInt(userIndex);
      currentUserData = { userType, userIndex: index };
      openUserModal('deleteUserModal');
    }

    function approveUser(userType, userIndex) {
      const index = parseInt(userIndex);
      const user = sampleUsers[userType][index];
      currentUserData = { userType, userIndex: index };
      
      document.getElementById('approveLabTitle').innerHTML = '‚úÖ Approve IVF Lab Request';
      document.getElementById('approveLabContent').innerHTML = `
        <div class="user-detail-row">
          <span class="user-detail-label">Lab Name:</span>
          <span class="user-detail-value">${user.name}</span>
        </div>
        <div class="user-detail-row">
          <span class="user-detail-label">Email:</span>
          <span class="user-detail-value">${user.email}</span>
        </div>
        <div class="user-detail-row">
          <span class="user-detail-label">Submitted On:</span>
          <span class="user-detail-value">${user.joinedDate}</span>
        </div>
      `;
      
      // Show approve/reject buttons
      document.getElementById('approveLabActions').innerHTML = `
        <button class="user-modal-btn secondary" onclick="closeUserModal('approveLabModal')">Cancel</button>
        <button class="user-modal-btn danger" onclick="showRejectLabForm()">Reject</button>
        <button class="user-modal-btn primary" onclick="confirmApproveLab()">Approve</button>
      `;
      
      // Hide reject form initially
      document.getElementById('rejectLabForm').style.display = 'none';
      
      openUserModal('approveLabModal');
    }

    function rejectUser(userType, userIndex) {
      const index = parseInt(userIndex);
      const user = sampleUsers[userType][index];
      currentUserData = { userType, userIndex: index };
      
      document.getElementById('approveLabTitle').innerHTML = '‚ùå Reject Lab Request';
      document.getElementById('approveLabContent').innerHTML = `
        <div class="user-detail-row">
          <span class="user-detail-label">Lab Name:</span>
          <span class="user-detail-value">${user.name}</span>
        </div>
        <div class="user-detail-row">
          <span class="user-detail-label">Email:</span>
          <span class="user-detail-value">${user.email}</span>
        </div>
        <div class="user-detail-row">
          <span class="user-detail-label">Submitted On:</span>
          <span class="user-detail-value">${user.joinedDate}</span>
        </div>
        <div id="rejectLabForm">
          <div class="form-group">
            <label>Reason for rejection:</label>
            <textarea id="rejectLabReason" rows="4" placeholder="Enter reason for rejection..." style="width: 100%; padding: 8px; border: 1px solid #dee2e6; border-radius: 4px;"></textarea>
          </div>
        </div>
      `;
      
      // Show only cancel and reject buttons
      document.getElementById('approveLabActions').innerHTML = `
        <button class="user-modal-btn secondary" onclick="closeUserModal('approveLabModal')">Cancel</button>
        <button class="user-modal-btn danger" onclick="confirmRejectLab()">Reject</button>
      `;
      
      openUserModal('approveLabModal');
    }

    // Modal Functions
    function openUserModal(modalId) {
      const modal = document.getElementById(modalId);
      const backdrop = document.getElementById('modalBackdrop');
      
      if (modal && backdrop) {
        modal.style.display = 'block';
        backdrop.style.display = 'block';
        document.body.style.overflow = 'hidden';
        
        // Add click outside to close
        backdrop.onclick = () => closeUserModal(modalId);
      }
    }

    function closeUserModal(modalId) {
      const modal = document.getElementById(modalId);
      const backdrop = document.getElementById('modalBackdrop');
      
      if (modal && backdrop) {
        modal.style.display = 'none';
        backdrop.style.display = 'none';
        document.body.style.overflow = 'auto';
        
        backdrop.onclick = null;
      }
    }

    // Action confirmation functions
    function saveUserChanges() {
      const name = document.getElementById('editUserName').value;
      const email = document.getElementById('editUserEmail').value;
      const mobile = document.getElementById('editUserMobile').value;
      const status = document.getElementById('editUserStatus').value;
      
      // Update the user data
      const { userType, userIndex } = currentUserData;
      sampleUsers[userType][userIndex].name = name;
      sampleUsers[userType][userIndex].email = email;
      sampleUsers[userType][userIndex].mobile = mobile;
      sampleUsers[userType][userIndex].status = status;
      
      // Refresh the table
      loadUserData(userType);
      
      closeUserModal('editUserModal');
      showSuccessBanner('User updated successfully!');
    }

    function confirmSuspendUser() {
      const { userType, userIndex } = currentUserData;
      const action = document.getElementById('suspendUserConfirm').textContent.toLowerCase();
      
      if (action === 'suspend') {
        sampleUsers[userType][userIndex].status = 'suspended';
        showSuccessBanner('User suspended successfully!');
      } else {
        sampleUsers[userType][userIndex].status = 'active';
        showSuccessBanner('User reactivated successfully!');
      }
      
      // Refresh the table
      loadUserData(userType);
      
      closeUserModal('suspendUserModal');
    }

    function confirmDeleteUser() {
      const { userType, userIndex } = currentUserData;
      
      // Remove user from data
      sampleUsers[userType].splice(userIndex, 1);
      
      // Refresh the table
      loadUserData(userType);
      
      closeUserModal('deleteUserModal');
      showSuccessBanner('User deleted successfully!');
    }

    function confirmApproveLab() {
      const { userType, userIndex } = currentUserData;
      sampleUsers[userType][userIndex].status = 'active';
      
      // Refresh the table
      loadUserData(userType);
      
      closeUserModal('approveLabModal');
      showSuccessBanner('Lab approved successfully!');
    }

    function showRejectLabForm() {
      document.getElementById('rejectLabForm').style.display = 'block';
      document.getElementById('approveLabActions').innerHTML = `
        <button class="user-modal-btn secondary" onclick="closeUserModal('approveLabModal')">Cancel</button>
        <button class="user-modal-btn danger" onclick="confirmRejectLab()">Reject</button>
      `;
    }

    function confirmRejectLab() {
      const reason = document.getElementById('rejectLabReason').value;
      const { userType, userIndex } = currentUserData;
      
      if (!reason.trim()) {
        alert('Please provide a reason for rejection.');
        return;
      }
      
      // Remove the lab from pending list (in real app, would update status)
      sampleUsers[userType].splice(userIndex, 1);
      
      // Refresh the table
      loadUserData(userType);
      
      closeUserModal('approveLabModal');
      showSuccessBanner('Lab request rejected successfully!');
    }

    // Initialize user management on admin dashboard load
    function initializeUserManagement() {
      // Only initialize if the user table elements exist
      const tableHeader = document.getElementById('userTableHeader');
      const tableBody = document.getElementById('userTableBody');
      
      if (tableHeader && tableBody) {
        loadUserData('patients');
      }
    }
    
    // Booking Management Functions
    let currentBookingStatus = 'all';
    let currentBookingPage = 1;
    let bookingsPerPage = 10;
    
    // Sample booking data
    const sampleBookings = [
      {
        id: 'BK1023',
        patient: { name: 'Priya Shah', email: 'priya@example.com', phone: '+91-98765-43210' },
        doctor: { name: 'Dr. Anand Verma', email: 'verma@clinic.com' },
        lab: { name: 'IVF Center Mumbai', location: 'Mumbai, MH' },
        date: '2025-07-02',
        time: '10:00',
        service: 'IUI Panel',
        status: 'confirmed',
        paymentStatus: 'paid',
        amount: 12000,
        mode: 'Online',
        createdOn: '2025-06-28',
        chatLog: [
          { sender: 'Dr. Anand', message: 'Please prepare for the IUI panel test', timestamp: '2025-06-29 09:00', type: 'doctor' },
          { sender: 'Lab', message: 'Confirmed for 10AM on July 2nd', timestamp: '2025-06-29 09:15', type: 'lab' },
          { sender: 'Patient', message: 'Thanks! What should I bring?', timestamp: '2025-06-29 09:30', type: 'patient' },
          { sender: 'Lab', message: 'Please bring your ID and previous reports', timestamp: '2025-06-29 09:35', type: 'lab' }
        ]
      },
      {
        id: 'BK1024',
        patient: { name: 'Nikhil Sharma', email: 'nikhil@example.com', phone: '+91-87654-32109' },
        doctor: { name: 'Dr. Priya Sharma', email: 'sharma@clinic.com' },
        lab: { name: 'Advanced Fertility Delhi', location: 'Delhi, DL' },
        date: '2025-07-05',
        time: '15:00',
        service: 'Sperm Analysis',
        status: 'pending',
        paymentStatus: 'paid',
        amount: 3500,
        mode: 'In-person',
        createdOn: '2025-06-25',
        chatLog: [
          { sender: 'Dr. Priya', message: 'Scheduled for sperm analysis', timestamp: '2025-06-25 14:00', type: 'doctor' },
          { sender: 'Lab', message: 'Please arrive 15 minutes early', timestamp: '2025-06-25 14:30', type: 'lab' }
        ]
      },
      {
        id: 'BK1025',
        patient: { name: 'Anjali Patel', email: 'anjali@example.com', phone: '+91-76543-21098' },
        doctor: { name: 'Dr. Rahul Gupta', email: 'gupta@clinic.com' },
        lab: { name: 'Fertility Plus Bangalore', location: 'Bangalore, KA' },
        date: '2025-06-25',
        time: '11:30',
        service: 'Hormone Panel',
        status: 'completed',
        paymentStatus: 'paid',
        amount: 4500,
        mode: 'Online',
        createdOn: '2025-06-20',
        chatLog: [
          { sender: 'Lab', message: 'Test completed successfully', timestamp: '2025-06-25 12:00', type: 'lab' },
          { sender: 'Patient', message: 'When will results be available?', timestamp: '2025-06-25 12:30', type: 'patient' },
          { sender: 'Lab', message: 'Results will be ready in 24-48 hours', timestamp: '2025-06-25 12:35', type: 'lab' }
        ]
      },
      {
        id: 'BK1026',
        patient: { name: 'Rahul Kumar', email: 'rahul@example.com', phone: '+91-65432-10987' },
        doctor: { name: 'Dr. Anand Verma', email: 'verma@clinic.com' },
        lab: { name: 'IVF Center Mumbai', location: 'Mumbai, MH' },
        date: '2025-06-22',
        time: '14:00',
        service: 'Blood Test Panel',
        status: 'cancelled',
        paymentStatus: 'refunded',
        amount: 2800,
        mode: 'In-person',
        createdOn: '2025-06-18',
        chatLog: [
          { sender: 'Patient', message: 'Need to cancel due to emergency', timestamp: '2025-06-21 16:00', type: 'patient' },
          { sender: 'Admin', message: 'Booking cancelled and refund processed', timestamp: '2025-06-21 16:30', type: 'admin' }
        ]
      },
      {
        id: 'BK1027',
        patient: { name: 'Deepika Singh', email: 'deepika@example.com', phone: '+91-54321-09876' },
        doctor: { name: 'Dr. Priya Sharma', email: 'sharma@clinic.com' },
        lab: { name: 'Advanced Fertility Delhi', location: 'Delhi, DL' },
        date: '2025-07-08',
        time: '09:00',
        service: 'Genetic Screening',
        status: 'confirmed',
        paymentStatus: 'paid',
        amount: 8500,
        mode: 'Online',
        createdOn: '2025-06-30',
        chatLog: [
          { sender: 'Dr. Priya', message: 'Genetic screening appointment confirmed', timestamp: '2025-06-30 10:00', type: 'doctor' }
        ]
      }
    ];
    
    // Current booking management state
    let currentBookingData = {};
    let filteredBookings = [...sampleBookings];
    
    // Switch booking status tabs
    function switchBookingTab(status) {
      currentBookingStatus = status;
      currentBookingPage = 1;
      
      // Update active tab
      document.querySelectorAll('.sub-tab').forEach(tab => {
        tab.classList.remove('active');
      });
      document.querySelector(`[data-status="${status}"]`).classList.add('active');
      
      // Filter and display bookings
      filterBookings();
    }
    
    // Filter bookings based on status and other criteria
    function filterBookings() {
      let filtered = [...sampleBookings];
      
      // Filter by status tab (map tab status to booking status)
      if (currentBookingStatus !== 'all') {
        const statusMap = {
          'upcoming': ['confirmed', 'pending'],
          'completed': ['completed'],
          'cancelled': ['cancelled']
        };
        
        if (statusMap[currentBookingStatus]) {
          filtered = filtered.filter(booking => statusMap[currentBookingStatus].includes(booking.status));
        } else {
          filtered = filtered.filter(booking => booking.status === currentBookingStatus);
        }
      }
      
      // Filter by additional criteria from dropdowns
      const statusFilter = document.getElementById('bookingStatusFilter')?.value;
      const dateFrom = document.getElementById('bookingDateFrom')?.value;
      const dateTo = document.getElementById('bookingDateTo')?.value;
      const labFilter = document.getElementById('bookingLabFilter')?.value;
      const doctorFilter = document.getElementById('bookingDoctorFilter')?.value;
      
      if (statusFilter) {
        filtered = filtered.filter(booking => booking.status === statusFilter);
      }
      
      if (dateFrom) {
        filtered = filtered.filter(booking => booking.date >= dateFrom);
      }
      
      if (dateTo) {
        filtered = filtered.filter(booking => booking.date <= dateTo);
      }
      
      if (labFilter) {
        filtered = filtered.filter(booking => {
          const labMap = {
            'ivf1': 'IVF Center Mumbai',
            'ivf2': 'Advanced Fertility Delhi', 
            'ivf3': 'Fertility Plus Bangalore'
          };
          return booking.lab.name === labMap[labFilter];
        });
      }
      
      if (doctorFilter) {
        filtered = filtered.filter(booking => {
          const doctorMap = {
            'dr-verma': 'Dr. Anand Verma',
            'dr-sharma': 'Dr. Priya Sharma',
            'dr-gupta': 'Dr. Rahul Gupta'
          };
          return booking.doctor.name === doctorMap[doctorFilter];
        });
      }
      
      filteredBookings = filtered;
      displayBookings();
    }
    
    // Search bookings
    function searchBookings() {
      const searchTerm = document.getElementById('bookingSearchInput').value.toLowerCase();
      
      if (!searchTerm) {
        filterBookings();
        return;
      }
      
      // First apply filters, then search within filtered results
      let searchResults = filteredBookings.filter(booking => 
        booking.id.toLowerCase().includes(searchTerm) ||
        booking.patient.name.toLowerCase().includes(searchTerm) ||
        booking.patient.email.toLowerCase().includes(searchTerm) ||
        booking.doctor.name.toLowerCase().includes(searchTerm) ||
        booking.lab.name.toLowerCase().includes(searchTerm)
      );
      
      // Temporarily update display without changing filteredBookings
      const originalFiltered = [...filteredBookings];
      filteredBookings = searchResults;
      displayBookings();
      filteredBookings = originalFiltered;
    }
    
    // Clear all filters
    function clearBookingFilters() {
      document.getElementById('bookingStatusFilter').value = '';
      document.getElementById('bookingDateFrom').value = '';
      document.getElementById('bookingDateTo').value = '';
      document.getElementById('bookingLabFilter').value = '';
      document.getElementById('bookingDoctorFilter').value = '';
      document.getElementById('bookingSearchInput').value = '';
      
      currentBookingPage = 1;
      filterBookings();
    }
    
    // Display bookings in the table
    function displayBookings() {
      const tableBody = document.getElementById('bookingsTableBody');
      if (!tableBody) return;
      
      tableBody.innerHTML = '';
      
      // Calculate pagination
      const startIndex = (currentBookingPage - 1) * bookingsPerPage;
      const endIndex = startIndex + bookingsPerPage;
      const paginatedBookings = filteredBookings.slice(startIndex, endIndex);
      
      if (paginatedBookings.length === 0) {
        tableBody.innerHTML = `
          <tr>
            <td colspan="8" style="text-align: center; padding: 40px; color: var(--muted);">
              <div style="font-size: 48px; margin-bottom: 16px;">üìÖ</div>
              <div>No bookings found</div>
              <div style="font-size: 14px; margin-top: 8px;">Try adjusting your filters or search criteria</div>
            </td>
          </tr>
        `;
        return;
      }
      
      // Create table rows
      paginatedBookings.forEach(booking => {
        const row = document.createElement('tr');
        row.style.cursor = 'pointer';
        row.onclick = () => viewBookingDetails(booking.id);
        
        const formatDate = (date) => {
          const d = new Date(date);
          return d.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
        };
        
        row.innerHTML = `
          <td><strong>${booking.id}</strong></td>
          <td>
            <div>
              <strong>${booking.patient.name}</strong><br>
              <small style="color: var(--muted);">${booking.patient.email}</small>
            </div>
          </td>
          <td>
            <div>
              <strong>${booking.doctor.name}</strong><br>
              <small style="color: var(--muted);">${booking.doctor.email}</small>
            </div>
          </td>
          <td>
            <div>
              <strong>${booking.lab.name}</strong><br>
              <small style="color: var(--muted);">${booking.lab.location}</small>
            </div>
          </td>
          <td>
            <div>
              <strong>${formatDate(booking.date)}</strong><br>
              <small style="color: var(--muted);">${booking.time}</small>
            </div>
          </td>
          <td>${booking.service}</td>
          <td><span class="status-badge ${booking.status}">${booking.status.charAt(0).toUpperCase() + booking.status.slice(1)}</span></td>
          <td>
            <div class="action-buttons">
              <button class="action-btn view" onclick="event.stopPropagation(); viewBookingDetails('${booking.id}')" title="View Details">üëÅ</button>
              ${booking.status !== 'completed' && booking.status !== 'cancelled' ? 
                `<button class="action-btn edit" onclick="event.stopPropagation(); openRescheduleModal('${booking.id}')" title="Reschedule">üîÅ</button>
                 <button class="action-btn cancel" onclick="event.stopPropagation(); openCancelBookingModal('${booking.id}')" title="Cancel">‚ùå</button>` : 
                `<button class="action-btn view" onclick="event.stopPropagation(); openChatLogModal('${booking.id}')" title="Chat Log">üí¨</button>
                 <button class="action-btn view" onclick="event.stopPropagation(); openInvoiceModal('${booking.id}')" title="Invoice">üßæ</button>`
              }
            </div>
          </td>
        `;
        tableBody.appendChild(row);
      });
      
      // Update pagination
      updateBookingsPagination();
    }
    
    // Update pagination controls
    function updateBookingsPagination() {
      const totalBookings = filteredBookings.length;
      const startIndex = (currentBookingPage - 1) * bookingsPerPage + 1;
      const endIndex = Math.min(currentBookingPage * bookingsPerPage, totalBookings);
      const totalPages = Math.ceil(totalBookings / bookingsPerPage);
      
      // Update pagination info
      const paginationInfo = document.getElementById('bookingsPaginationInfo');
      if (paginationInfo) {
        paginationInfo.textContent = totalBookings > 0 ? 
          `${startIndex}-${endIndex} of ${totalBookings}` : 
          '0 of 0';
      }
      
      // Update pagination controls
      const prevBtn = document.getElementById('prevBookingPageBtn');
      const nextBtn = document.getElementById('nextBookingPageBtn');
      
      if (prevBtn) prevBtn.disabled = currentBookingPage === 1;
      if (nextBtn) nextBtn.disabled = currentBookingPage === totalPages || totalPages === 0;
      
      // Update page numbers
      const paginationNumbers = document.getElementById('bookingPaginationNumbers');
      if (paginationNumbers) {
        let numbersHtml = '';
        const startPage = Math.max(1, currentBookingPage - 2);
        const endPage = Math.min(totalPages, startPage + 4);
        
        for (let i = startPage; i <= endPage; i++) {
          numbersHtml += `
            <button class="pagination-number ${i === currentBookingPage ? 'active' : ''}" 
                    onclick="changeBookingPage(${i})">${i}</button>
          `;
        }
        paginationNumbers.innerHTML = numbersHtml;
      }
    }
    
    // Change booking page
    function changeBookingPage(action) {
      const totalPages = Math.ceil(filteredBookings.length / bookingsPerPage);
      
      if (typeof action === 'number') {
        currentBookingPage = action;
      } else if (action === 'prev' && currentBookingPage > 1) {
        currentBookingPage--;
      } else if (action === 'next' && currentBookingPage < totalPages) {
        currentBookingPage++;
      }
      
      displayBookings();
    }
    
    function previousBookingsPage() {
      if (currentBookingPage > 1) {
        currentBookingPage--;
        displayBookings();
      }
    }
    
    function nextBookingsPage() {
      const totalPages = Math.ceil(filteredBookings.length / bookingsPerPage);
      if (currentBookingPage < totalPages) {
        currentBookingPage++;
        displayBookings();
      }
    }
    
    function goToBookingPage(page) {
      currentBookingPage = page;
      displayBookings();
    }
    
    function viewBookingDetails(bookingId) {
      const booking = sampleBookings.find(b => b.id === bookingId);
      if (!booking) return;
      
      currentBookingData = booking;
      
      const content = document.getElementById('bookingDetailsContent');
      content.innerHTML = `
        <div class="user-detail-row">
          <span class="user-detail-label">Booking ID:</span>
          <span class="user-detail-value">${booking.id}</span>
        </div>
        <div class="user-detail-row">
          <span class="user-detail-label">Status:</span>
          <span class="user-detail-value">
            <span class="booking-status ${booking.status}">${booking.status.charAt(0).toUpperCase() + booking.status.slice(1)}</span>
          </span>
        </div>
        <div class="user-detail-row">
          <span class="user-detail-label">Patient:</span>
          <span class="user-detail-value">${booking.patient.name}</span>
        </div>
        <div class="user-detail-row">
          <span class="user-detail-label">Doctor:</span>
          <span class="user-detail-value">${booking.doctor.name}</span>
        </div>
        <div class="user-detail-row">
          <span class="user-detail-label">Lab:</span>
          <span class="user-detail-value">${booking.lab.name}</span>
        </div>
        <div class="user-detail-row">
          <span class="user-detail-label">Date:</span>
          <span class="user-detail-value">${booking.date}</span>
        </div>
        <div class="user-detail-row">
          <span class="user-detail-label">Time:</span>
          <span class="user-detail-value">${booking.time} IST+5:30</span>
        </div>
        <div class="user-detail-row">
          <span class="user-detail-label">Payment Status:</span>
          <span class="user-detail-value">${booking.paymentStatus.charAt(0).toUpperCase() + booking.paymentStatus.slice(1)}</span>
        </div>
        <div class="user-detail-row">
          <span class="user-detail-label">Service:</span>
          <span class="user-detail-value">${booking.service}</span>
        </div>
        <div class="user-detail-row">
          <span class="user-detail-label">Mode:</span>
          <span class="user-detail-value">${booking.mode}</span>
        </div>
        <div class="user-detail-row">
          <span class="user-detail-label">Created On:</span>
          <span class="user-detail-value">${booking.createdOn}</span>
        </div>
      `;
      
      // Update actions based on booking status
      const actions = document.getElementById('bookingDetailsActions');
      let actionsHtml = '';
      
      if (booking.status === 'upcoming') {
        actionsHtml += `<button class="user-modal-btn primary" onclick="openRescheduleBooking('${booking.id}')">Reschedule</button>`;
        actionsHtml += `<button class="user-modal-btn danger" onclick="openCancelBooking('${booking.id}')">Cancel</button>`;
      }
      
      actionsHtml += `<button class="user-modal-btn secondary" onclick="openChatLog('${booking.id}')">Chat Log</button>`;
      actionsHtml += `<button class="user-modal-btn secondary" onclick="openInvoiceDetails('${booking.id}')">Invoice</button>`;
      actionsHtml += `<button class="user-modal-btn secondary" onclick="closeUserModal('bookingDetailsModal')">Close</button>`;
      
      actions.innerHTML = actionsHtml;
      
      openUserModal('bookingDetailsModal');
    }
    
    function openRescheduleBooking(bookingId) {
      closeUserModal('bookingDetailsModal');
      
      // Pre-fill current booking date
      const booking = sampleBookings.find(b => b.id === bookingId);
      if (booking) {
        document.getElementById('rescheduleNewDate').value = booking.date;
        document.getElementById('rescheduleNewTime').value = booking.time;
        document.getElementById('rescheduleReason').value = '';
        
        currentBookingData = booking;
        openUserModal('rescheduleBookingModal');
      }
    }
    
    function confirmRescheduleBooking() {
      const newDate = document.getElementById('rescheduleNewDate').value;
      const newTime = document.getElementById('rescheduleNewTime').value;
      const reason = document.getElementById('rescheduleReason').value;
      
      if (!newDate || !newTime) {
        alert('Please select both date and time');
        return;
      }
      
      // Update booking data
      const booking = sampleBookings.find(b => b.id === currentBookingData.id);
      if (booking) {
        booking.date = newDate;
        booking.time = newTime;
        
        // Add to chat log
        booking.chatLog.push({
          sender: 'Admin',
          message: `Booking rescheduled to ${newDate} at ${newTime}${reason ? '. Reason: ' + reason : ''}`,
          timestamp: new Date().toISOString().slice(0, 16).replace('T', ' '),
          type: 'admin'
        });
      }
      
      closeUserModal('rescheduleBookingModal');
      showSuccessBanner('Booking rescheduled successfully!');
      displayBookings();
    }
    
    function openCancelBooking(bookingId) {
      closeUserModal('bookingDetailsModal');
      
      const booking = sampleBookings.find(b => b.id === bookingId);
      if (booking) {
        currentBookingData = booking;
        document.getElementById('cancelBookingReason').value = '';
        openUserModal('cancelBookingModal');
      }
    }
    
    function confirmCancelBooking() {
      const reason = document.getElementById('cancelBookingReason').value.trim();
      
      if (!reason) {
        alert('Please provide a reason for cancellation');
        return;
      }
      
      // Update booking status
      const booking = sampleBookings.find(b => b.id === currentBookingData.id);
      if (booking) {
        booking.status = 'cancelled';
        booking.paymentStatus = 'refunded';
        
        // Add to chat log
        booking.chatLog.push({
          sender: 'Admin',
          message: `Booking cancelled. Reason: ${reason}`,
          timestamp: new Date().toISOString().slice(0, 16).replace('T', ' '),
          type: 'admin'
        });
      }
      
      closeUserModal('cancelBookingModal');
      showSuccessBanner('Booking cancelled successfully!');
      displayBookings();
    }
    
    function openChatLog(bookingId) {
      const booking = sampleBookings.find(b => b.id === bookingId);
      if (!booking) return;
      
      const chatContent = document.getElementById('chatLogContent');
      let chatHtml = '';
      
      booking.chatLog.forEach(message => {
        chatHtml += `
          <div class="chat-message ${message.type}">
            <div class="chat-sender">${message.sender}:</div>
            <div class="chat-content">${message.message}</div>
            <div class="chat-timestamp">${message.timestamp}</div>
          </div>
        `;
      });
      
      if (booking.chatLog.length === 0) {
        chatHtml = '<p style="text-align: center; color: var(--muted); font-style: italic;">No chat messages for this booking.</p>';
      }
      
      chatContent.innerHTML = chatHtml;
      openUserModal('chatLogModal');
    }
    
    function openInvoiceDetails(bookingId) {
      const booking = sampleBookings.find(b => b.id === bookingId);
      if (!booking) return;
      
      const content = document.getElementById('invoiceDetailsContent');
      content.innerHTML = `
        <div class="user-detail-row">
          <span class="user-detail-label">Booking ID:</span>
          <span class="user-detail-value">${booking.id}</span>
        </div>
        <div class="user-detail-row">
          <span class="user-detail-label">Amount:</span>
          <span class="user-detail-value">‚Çπ${booking.amount.toLocaleString()}</span>
        </div>
        <div class="user-detail-row">
          <span class="user-detail-label">Tax (GST):</span>
          <span class="user-detail-value">‚Çπ${(booking.amount * 0.18).toLocaleString()}</span>
        </div>
        <div class="user-detail-row">
          <span class="user-detail-label">Total Paid:</span>
          <span class="user-detail-value"><strong>‚Çπ${(booking.amount * 1.18).toLocaleString()}</strong></span>
        </div>
        <div class="user-detail-row">
          <span class="user-detail-label">Date:</span>
          <span class="user-detail-value">${booking.createdOn}</span>
        </div>
        <div class="user-detail-row">
          <span class="user-detail-label">Payment Method:</span>
          <span class="user-detail-value">UPI</span>
        </div>
        <div class="user-detail-row">
          <span class="user-detail-label">Transaction ID:</span>
          <span class="user-detail-value">TXN${booking.id}${Math.floor(Math.random() * 1000)}</span>
        </div>
      `;
      
      openUserModal('invoiceDetailsModal');
    }
    
    function downloadInvoicePDF() {
      showSuccessBanner('Invoice PDF downloaded successfully!');
      closeUserModal('invoiceDetailsModal');
    }
    
    function exportBookings() {
      showSuccessBanner('Bookings exported to CSV successfully!');
    }
    
    function refreshBookings() {
      // Reset filters
      document.getElementById('bookingDateFrom').value = '';
      document.getElementById('bookingDateTo').value = '';
      document.getElementById('bookingStatusFilter').value = '';
      document.getElementById('bookingLabFilter').value = '';
      document.getElementById('bookingDoctorFilter').value = '';
      document.getElementById('bookingSearchInput').value = '';
      
      // Reset to all bookings
      currentBookingStatus = 'all';
      currentBookingPage = 1;
      
      // Update tab state
      document.querySelectorAll('.booking-status-tab').forEach(tab => {
        tab.classList.remove('active');
      });
      document.querySelector('[data-status="all"]').classList.add('active');
      
      // Reload data
      filterBookings();
      showSuccessBanner('Bookings refreshed!');
    }
    
    // Initialize booking management
    function initializeBookingManagement() {
      currentBookingStatus = 'all';
      currentBookingPage = 1;
      filteredBookings = [...sampleBookings];
      
      // Ensure active tab is set
      document.querySelectorAll('.sub-tab').forEach(tab => {
        tab.classList.remove('active');
      });
      document.querySelector('[data-status="all"]').classList.add('active');
      
      displayBookings();
    }

    function viewAllBookings() {
      // Hide all screens and show admin dashboard with manage bookings tab
      document.querySelectorAll('.screen').forEach(screen => {
        screen.classList.remove('active');
      });
      document.getElementById('adminDash').classList.add('active');
      showAdminTab('manageBookingsTab');
    }

    function openBookingFilters() {
      // Open the booking filters modal
      openModal('bookingFiltersModal');
    }

    function downloadReports() {
      // Open the reports modal
      openModal('reportsModal');
    }

    function viewLogs() {
      // Hide all screens and show admin dashboard with reports tab
      document.querySelectorAll('.screen').forEach(screen => {
        screen.classList.remove('active');
      });
      document.getElementById('adminDash').classList.add('active');
      showAdminTab('reportsTab');
    }

    // Approval Management Functions
    function approveRegistration(type, id) {
      if (confirm(`Approve this ${type} registration?`)) {
        alert(`${type} registration approved successfully!`);
        // In a real app, this would update the server and refresh the table
        updateApprovalCounts(-1, type);
      }
    }

    function rejectRegistration(type, id) {
      const reason = prompt('Enter reason for rejection (optional):');
      if (reason !== null) { // User didn't cancel
        alert(`${type} registration rejected. Notification sent to applicant.`);
        // In a real app, this would update the server and refresh the table
        updateApprovalCounts(-1, type);
      }
    }

    function viewRegistrationDetails(type, id) {
      // This should open a modal with registration details
      // For now, redirect to user management for the specific type
      manageUsers(type + 's');
    }

    function updateApprovalCounts(change, type) {
      // Update the dashboard counts
      const approvalItems = document.querySelectorAll('.approval-item');
      if (type === 'lab' && approvalItems[0]) {
        const countElement = approvalItems[0].querySelector('.approval-count');
        const currentCount = parseInt(countElement.textContent);
        countElement.textContent = Math.max(0, currentCount + change);
      } else if (type === 'doctor' && approvalItems[1]) {
        const countElement = approvalItems[1].querySelector('.approval-count');
        const currentCount = parseInt(countElement.textContent);
        countElement.textContent = Math.max(0, currentCount + change);
      }
    }

    // Add admin login option to main login screen
    // Call on page load
    document.addEventListener('DOMContentLoaded', function() {
      handleRegistrationNavigation();
      
      // Ensure functions are available globally
      window.viewUser = viewUser;
      window.editUser = editUser;
      window.suspendUser = suspendUser;
      window.reactivateUser = reactivateUser;
      window.deleteUser = deleteUser;
      window.approveUser = approveUser;
      window.rejectUser = rejectUser;
      window.showAdminLogin = showAdminLogin;
      window.showAdminLoginFromMain = showAdminLoginFromMain;
      
      console.log('=== USER MANAGEMENT FUNCTIONS REGISTERED IN DOM READY ===');
      console.log('window.viewUser:', typeof window.viewUser);
      console.log('window.editUser:', typeof window.editUser);
      
      // Add event delegation for user management buttons
      document.addEventListener('click', function(e) {
        console.log('=== CLICK EVENT DETECTED ===');
        console.log('Target element:', e.target);
        console.log('Target classes:', e.target.className);
        console.log('Is user-action-btn?', e.target.classList.contains('user-action-btn'));
        
        if (e.target.classList.contains('user-action-btn')) {
          e.preventDefault();
          console.log('=== USER MANAGEMENT BUTTON CLICKED ===');
          console.log('Button clicked:', e.target);
          console.log('Button class:', e.target.className);
          console.log('Button text:', e.target.textContent);
          
          const action = e.target.getAttribute('data-action');
          const userType = e.target.getAttribute('data-user-type');
          const userIndex = e.target.getAttribute('data-user-index');
          
          console.log('Action:', action, 'UserType:', userType, 'UserIndex:', userIndex);
          
          if (!action || !userType || userIndex === null) {
            console.error('Missing data attributes:', { action, userType, userIndex });
            alert('Missing data attributes on button');
            return;
          }
          
          try {
            switch (action) {
              case 'view':
                console.log('Calling viewUser...');
                viewUser(userType, userIndex);
                break;
              case 'edit':
                console.log('Calling editUser...');
                editUser(userType, userIndex);
                break;
              case 'suspend':
                console.log('Calling suspendUser...');
                suspendUser(userType, userIndex);
                break;
              case 'reactivate':
                console.log('Calling reactivateUser...');
                reactivateUser(userType, userIndex);
                break;
              case 'approve':
                console.log('Calling approveUser...');
                approveUser(userType, userIndex);
                break;
              case 'reject':
                console.log('Calling rejectUser...');
                rejectUser(userType, userIndex);
                break;
              case 'delete':
                console.log('Calling deleteUser...');
                deleteUser(userType, userIndex);
                break;
              default:
                console.log('Unknown action:', action);
                alert('Unknown action: ' + action);
            }
          } catch (error) {
            console.error('Error executing action:', error);
            alert('Error: ' + error.message);
          }
        }
      });
      
      // Check if user is already logged in
      const adminSession = localStorage.getItem('adminSession');
      const userSession = localStorage.getItem('userSession');
      
      if (adminSession || userSession) {
        // Show logout button if any session exists
        document.getElementById('logoutBtn').style.display = 'block';
      }
      
      if (adminSession) {
        // Auto-show admin dashboard if admin session exists
        // Uncomment the next line if you want auto-login
        // showAdminDashboard();
      }
    });
  </script>
</body>
</html>
